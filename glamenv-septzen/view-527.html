<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2009/12/31/FreeBSDでローカルのCVSupサーバを構築 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2009/12/31/FreeBSDでローカルのCVSupサーバを構築</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2009-12-31 19:48:10 &nbsp; / &nbsp; last updated at: 2009-12-31 20:49:48<br>
カテゴリ: <a href="category-32.html">BSD</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
昨晩にかけてやってみました。VMwareで専用の仮想マシンを１台作成し、8GBほどのHDDにして手元に取りあえず転がっていた4.4BSD(古っ)を入れ、&quot;/home&quot;を6GBほど確保しました。
<br />
</p>

<p class="paragraph">
本当にCVSup「だけ」動いていれば良いので、インストール直後のほやほやマシンに、とりあえず cvsup パッケージを入れます。
<br />
続いて、ports/net/cvsup-mirror を入れます。(インストール時にportsも展開するよう指定済)
<br />
ちなみにMakefileを見ると、なんでパッケージになっていないのか(NO_PACKAGE)について &quot;too interactive&quot; とのこと。
<br />
</p>

<pre class="plugin_pre">
# cd /usr/ports/net/cvsup-mirror
# make

...

Master site for your updates [cvsup-master.freebsd.org]? cvsup.jp.FreeBSD.org
How many hours between updates of your files [1]? 168
Please answer 1, 2, 3, 4, 6, 8, 12, or 24
# 一週間で済まそうとしたら、24時間以内じゃないと駄目と怒られた。
How many hours between updates of your files [1]? 24

...

Do you wish to mirror the main source repository [y]?(そのままRETURN)
Where would you like to put it [/home/ncvs]?(そのままRETURN)
Do you wish to mirror the installed World Wide Web data [y]? n
Do you wish to mirror the GNATS bug tracking database [y]? n
Do you wish to mirror the mailing list archive [y]? n
# WWWやbugtrack, mlなどは要らないので&quot;n&quot;にしときました。

...

# 以下は全てデフォルト、つまりそのままRETURN入力。
Unique unprivileged user ID for running the client [cvsupin]?
Unique unprivileged group ID for running the client [cvsupin]?
Unique unprivileged user ID for running the server [cvsup]?
Unique unprivileged group ID for running the server [cvsup]?
...
Syslog facility for the server log [daemon]?
Maximum simultaneous client connections [8]?
</pre>
<p class="paragraph">
で、うっかりただの&quot;make&quot;にしちゃってたので、この後 &quot;make install&quot; へ。
<br />
</p>
<pre class="plugin_pre">
# make install

...
(上で指定したユーザーとグループを作るか訊いてくるので、&quot;y&quot;にしとく。)

...
Would you like me to set up the syslog logging [y]?(そのままRETURNにしとく。)
Setting up server logging in &quot;/etc/syslog.conf&quot;.
Creating &quot;/var/log/cvsupd.log&quot;.
Giving syslogd a kick in the pants.
Adding cvsupd log entry to &quot;/etc/newsyslog.conf&quot;.
Done.

Would you like me to set up your crontab for updates every 24 hours [y]?
Scheduling updates every 24 hours in &quot;/etc/crontab&quot;.
Done.  The first update will be 5 minutes from now, at 21:32.
The cvsupd server will be started automatically after the first update,
and whenever you reboot.

You are now a FreeBSD mirror site.
===&gt;   Registering installation for cvsup-mirror-1.2
===&gt;  SECURITY NOTE:
      This port has installed the following startup scripts which may cause
      network services to be started at boot time.
/usr/local/etc/rc.d/cvsupd.sh
...
</pre>
<p class="paragraph">
cvsup-mirrorのinstall終了の5分後、21:32に最初の更新が始まることになります。
<br />
この段階で、&quot;/etc/crontab&quot; に次のようなエントリが設定されていました。
<br />
</p>
<pre>32 21 * * * root /usr/local/etc/cvsup/update.sh
</pre>
<p class="paragraph">
そのまんまです。最初の更新が終われば、このエントリはコメントアウトしてしまいます。というのも、以降は「同期したい時だけ」手動で &quot;/usr/local/etc/cvsup/update.sh&quot; を実行することにしとくからです。VMware内での実験用ですし。
<br />
</p>

<p class="paragraph">
で、昨晩は21:32から最初の更新が始まり・・・終わったのが、日が変わって02:30前後。ADSLで速くもなく遅くもない程度の速度だと思っていますが、それで大体5時間強かかる感じです。
<br />
</p>

<p class="paragraph">
ディスク容量ですが、&quot;/home&quot;が &quot;/home/ncvs&quot; でCVSupミラー専用という状態で以下の使用量になりました。
<br />
</p>
<pre># df -h
Filesystem    Size   Used  Avail Capacity  Mounted on
...
/dev/ad0s1e   6.3G   3.9G   1.9G    67%    /home
</pre>

<p class="paragraph">
6G用意しておいて正解でした。もう8-RELEASEまで到達しているソースコードのCVSup用データなので、それなりに巨大です。
<br />
</p>

<p class="paragraph">
では続いて、ちゃんとサーバとして動くか確認してみます。とりあえず同一マシン内の適当なディレクトリに、CVSupサーバを自分自身にして適当なコレクションを取ってこれるか確認してみました。
<br />
</p>

<p class="paragraph">
実験用と言うことで、&quot;/root&quot;の下にcvsupのDB用ディレクトリ(cvsup_test_db)と、ソース展開用のディレクトリ(cvsup_test_root)を作ります。
<br />
</p>
<pre># cd
# mkdir cvsup_test_db
# mkdir cvsup_test_root
</pre>

<p class="paragraph">
&quot;/usr/share/examples/cvsup/standard-supfile&quot; をコピペし、編集します。
<br />
</p>
<pre># cp /usr/share/examples/cvsup/standard-supfile test-supfile
# vi test-supfile
...
</pre>

<p class="paragraph">
&quot;test-supfile&quot;の中身は、こんな感じにしてみました。
<br />
</p>
<pre># 接続先は自分自身
*default host=localhost

# cvsupのDBディレクトリ。
# この下に&quot;sup&quot;ディレクトリが作成され、その中にDB(ファイルリスト)が作成される。
*default base=/root/cvsup_test_db

# ソースコード展開先ディレクトリ。
# この下に&quot;src&quot;ディレクトリが作成され、その下に展開される。
*default prefix=/root/cvsup_test_root

# 4.xの開発ツリーから取得。(FreeBSD 4-STABLE)
*default tag=RELENG_4

# この辺はもともとあったのをそのまま。
*default release=cvs
*default delete use-rel-suffix
*default compress

# 軽めのソースツリーで試したいので、
# とりあえず&quot;/etc&quot;ディレクトリのコレクションを指定。
src-etc
</pre>

<p class="paragraph">
cvsupを実行してみます。
<br />
</p>
<pre class="plugin_pre">
# cvsup test-supfile
Connected to localhost
Updating collection src-etc/cvs
 Checkout src/etc/MAKEDEV
 Checkout src/etc/MAKEDEV.local
 Checkout src/etc/Makefile
 ...
 Checkout src/etc/termcap.small
 Checkout src/etc/usbd.conf
Finished successfully
</pre>
<p class="paragraph">
無事、&quot;cvsup_test_root/src/etc&quot; の下に、etcディレクトリやファイル群が展開されました。
<br />
&quot;cvsup_test_db/sup&quot;の下にも、&quot;src-etc&quot;コレクション用のデータファイルが作成されていました。
<br />
</p>
<pre># cd cvsup_test_db/
# ls
sup/
# find .
.
./sup
./sup/src-etc
./sup/src-etc/checkouts.cvs:RELENG_4
</pre>

<p class="paragraph">
この後、test-supfileの&quot;tag&quot;を、&quot;RELENG_4_11&quot;とか&quot;RELENG_4_10&quot;とかにしてcvsupしてみると、ちゃんとそのCVSタグの時点でのソースツリーに切り替わってくれます。
<br />
</p>

<p class="paragraph">
最後に、VMware仮想マシンで用意していた別のFreeBSDマシンで、同様のsupfileを用意してsrc-etcを展開出来ることを確認できました(詳細省略)。
<br />
</p>

<p class="paragraph">
このローカルCVSupサーバを使って、年明けはFreeBSDの&quot;make world&quot;の練習でもしてみようかと考えてます・・・。
<br />
</p>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/527<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>