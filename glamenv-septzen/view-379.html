<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2009/05/06/OpenBSD4.5インストール後のpkg_add, pkg_infoとXの設定 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2009/05/06/OpenBSD4.5インストール後のpkg_add, pkg_infoとXの設定</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2009-05-06 15:04:52 &nbsp; / &nbsp; last updated at: 2009-05-06 16:04:22<br>
カテゴリ: <a href="category-32.html">BSD</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
<a href="./view-378.html" >日記/2009/05/05/VMware5でのOpenBSD4.5のインストールメモ</a>にてOpenBSD4.5をセットアップできました。
<br />
</p>

<p class="paragraph">
その後、packagesから幾つかパッケージを追加し、Xを設定してblackboxを立ち上げたのでメモ。
<br />
</p>




<ul><li><a href="#id3f1729">pkg_add, pkg_info でパッケージを追加</a></li>
<li><a href="#idcc50cb">Xの設定</a></li>
<li><a href="#id3a27f6">ゲストOSとの接続がやっぱり数分 - 10分で切れるので、試しにARPを静的に設定してみた</a></li></ul>

<hr />

<h3 id="id3f1729">pkg_add, pkg_info でパッケージを追加</h3>

<p class="paragraph">
packagesについては下記URLを参考に入れてみました。
<br />
</p>
<ul><li> OpenBSD Ports and Packages<ul><li> <a class="externallink" href="http://www.openbsd.hu/ja/ports.html" target="_blank">http://www.openbsd.hu/ja/ports.html</a></li></ul></li></ul>

<p class="paragraph">
最初は &quot;<a class="externallink" href="ftp://ftp.kddlabs.co.jp/OpenBSD/" target="_blank">ftp://ftp.kddlabs.co.jp/OpenBSD/</a>&quot; を使おうとしたのですが、どうも&quot;t&quot;で始まるパッケージまでしか入っていないようでしたので、 &quot;<a class="externallink" href="ftp://ftp.jaist.ac.jp/pub/OpenBSD/" target="_blank">ftp://ftp.jaist.ac.jp/pub/OpenBSD/</a>&quot; に変えました。
<br />
</p>
<pre># export PKG_PATH=ftp://ftp.jaist.ac.jp/pub/OpenBSD/4.5/packages/
# pkg_add bash
</pre>
<p class="paragraph">
という具合に・・・最初は、しようかな、と思ったんですが、暫くtry &amp; error していく内に、単純にftpでtgzをローカルに落として、ローカルファイルを直接指定した方が早そうだったのでそちらに切り替えました。
<br />
</p>

<p class="paragraph">
bash上でvimが使えれば良かったので、vim7, bash、あとおまけでwget, Xのターミナルを使いたかったのでblackbox(ウインドウマネージャ)とrxvtを入れました。
<br />
</p>

<p class="paragraph">
pkg_addは&quot;-n&quot;オプションと&quot;-v&quot;オプションが助かりました。
<br />
</p>
<pre># pkg_add -n -v xxxx.tgz
</pre>
<p class="paragraph">
とすれば、実際にはインストールは行いません。何が行われるか表示だけされるので、それを確認後、
<br />
</p>
<pre># pkg_add -v xxxx.tgz
</pre>
<p class="paragraph">
で実際にインストールできます。
<br />
</p>

<p class="paragraph">
pkg_infoについてはローカルに落としたtgzファイルの情報取得はもちろんのこと、
<br />
</p>
<pre>$ pkg_info -E /usr/local/bin/bash
/usr/local/bin/bash: bash-3.2.48
bash-3.2.48         GNU Bourne Again Shell
</pre>
<p class="paragraph">
というように &quot;-E&quot; でローカルファイル名を指定すると、それを含んだpackage名を表示してくれますので、助かります。
<br />
</p>

<h3 id="idcc50cb">Xの設定</h3>

<p class="paragraph">
基本的に以下のOpenBSD FAQページで事足りました。
<br />
<a class="externallink" href="http://www.openbsd.org/faq/faq11.html" target="_blank">http://www.openbsd.org/faq/faq11.html</a>
<br />
</p>

<p class="paragraph">
流れとしては、
<br />
</p>
<pre>Set machdep.allowaperture=2 in /etc/sysctl.conf. 
</pre>
<p class="paragraph">
とあるとおり /etc/sysctl.conf を修正し(matchdep.allowapertureはsysctlコマンドからの実行時変更は禁止されてました・・・)、
<br />
</p>
<pre># X -configure
</pre>
<p class="paragraph">
でカレントディレクトリに xorg.conf.new ファイルが作成されますので、
<br />
</p>
<pre># X -config /root/xorg.conf.new
</pre>
<p class="paragraph">
で作成された設定ファイルでXを起動します。<strong>ALT + CTRL + BACKSPACE</strong>でXを終了できます。
<br />
</p>

<p class="paragraph">
VMware上ですので、以前自分が書いた <a href="./view-178.html" >技術/Linux/VMwareのゲストOS時にXが800x600でしか立ち上がらない場合</a> を参考に、&quot;Monitor&quot;セクションに以下2行を追加します。
<br />
</p>
<pre>HorizSync    1.0 - 10000.0
VertRefresh  1.0 - 10000.0
</pre>
<p class="paragraph">
&quot;Screen&quot;セクションも、以下の2つにまとめてしまいます。
<br />
</p>
<pre>Section &quot;Screen&quot;
        Identifier &quot;Screen0&quot;
        Device     &quot;Card0&quot;
        Monitor    &quot;Monitor0&quot;
        SubSection &quot;Display&quot;
                Viewport   0 0
                Depth     24
                Modes     &quot;1024x768&quot; &quot;800x600&quot; &quot;640x480&quot;
        EndSubSection
        SubSection &quot;Display&quot;
                Viewport   0 0
                Depth     16
                Modes     &quot;1024x768&quot; &quot;800x600&quot; &quot;640x480&quot;
        EndSubSection
EndSection
</pre>

<p class="paragraph">
また&quot;InputDevice&quot;セクションで、下記ページを参考に日本語キーボードを指定しました。
<br />
</p>
<ul><li> &quot;freebsd 日本語キーボードの設定&quot;<ul><li> <a class="externallink" href="http://ambiesoft.ddo.jp/blog/archives/138" target="_blank">http://ambiesoft.ddo.jp/blog/archives/138</a></li></ul></li></ul>

<p class="paragraph">
最初は未設定だったのですが、１～２個だけ、ずれてしまうキーがあったので指定しました。
<br />
コンソールについては、&quot;/etc/kbdtype&quot; が &quot;jp&quot;になっていたためか、特にキーはずれていませんでした。ですので上記URLでの&quot;keymap&quot;のrc.confへの追加は行っていません。
<br />
</p>

<p class="paragraph">
一通り設定が終われば、xorg.conf.newを /etc/X11/xorg.conf にコピーし、startxで動作確認します。
<br />
</p>

<p class="paragraph">
その後blackboxをpackagesよりpkg_add し、
<br />
</p>
<pre># startx /usr/local/bin/blackbox
</pre>
<p class="paragraph">
で動作確認した結果が下記スクリーンショットになります。
<br />
<a href="./../medias/openbsd45-install-on-vmware5/openbsd_install_22.jpg" title="" target="_blank"><img src="./../medias/openbsd45-install-on-vmware5/openbsd_install_22.jpg" alt="" title="" width="600" /></a>
<br />
</p>

<p class="paragraph">
無事XGA(1024x768)でblackboxが起動しました。あとは ~/.xinitrc に &quot;/usr/local/bin/blackbox&quot; と書いてあげれば、次回、&quot;startx&quot;するだけで自動的にblackboxが起動します。
<br />
</p>

<h3 id="id3a27f6">ゲストOSとの接続がやっぱり数分 - 10分で切れるので、試しにARPを静的に設定してみた</h3>

<p class="paragraph">
元々Xの設定をする気は無かったのですが、やっぱりゲストOSとの接続が数分 - 10分前後で切れて暫く無応答になります。
<br />
</p>

<p class="paragraph">
かなり当てずっぽうなのですが、ホストOS/ゲストOSの両方のARPテーブルにそれぞれ静的にお互いのアドレスを追加してみました。これで暫く様子見です。
<br />
</p>

<p class="paragraph">
ゲストOS : 
<br />
</p>
<pre># arp -s 192.168.250.101 d2:d9:b0:83:e9:8c permanent
# arp -a
 (192.168.250.1) at 00:90:cc:4b:1a:7c on vic0
? (192.168.250.101) at d2:d9:b0:83:e9:8c on vic0
? (192.168.250.101) at d2:d9:b0:83:e9:8c on vic0 permanent static
</pre>
<p class="paragraph">
・・・なんか二つ登録されたりしてますが放置。
<br />
</p>

<p class="paragraph">
ホストOS :
<br />
</p>
<pre>DOS&gt; arp -s 192.168.250.150 00-0c-29-5f-a9-d2
DOS&gt; arp -a

Interface: 192.168.250.101 --- 0x10005
  Internet Address      Physical Address      Type
  192.168.250.1         00-90-cc-4b-1a-7c     dynamic
  192.168.250.150       00-0c-29-5f-a9-d2     static
</pre>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/379<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>