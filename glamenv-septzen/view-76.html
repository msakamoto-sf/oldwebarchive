<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2007/09/11/Xhwlayメモ - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2007/09/11/Xhwlayメモ</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2007-09-11 00:51:06 &nbsp; / &nbsp; last updated at: 2008-12-23 00:54:29<br>
カテゴリ: <a href="category-16.html">Xhwlay</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
後述の通り失敗に終わるのですが、折角なのでチャネルサーバの作り方について書いてあるURLをメモ。
<br />
</p>
<ul><li> <a class="externallink" href="http://blog.hawklab.jp/item-88.html" target="_blank">http://blog.hawklab.jp/item-88.html</a></li>
<li> <a class="externallink" href="http://lab.urume.net/2006,0529,447.html" target="_blank">http://lab.urume.net/2006,0529,447.html</a></li></ul>

<h3 id="id896161">SourceForge.netのWeb環境にPEARを入れようとして挫折した由</h3>

<p class="paragraph">
とりあえずチャネルサーバを立ててみるか、と、SF.netのWebサーバ環境に、go-pear.phpを入れようとする。
<br />
</p>

<pre>[msakamoto-sf@pr-shellE htdocs]$ wget http://go-pear.org/
--01:20:57--  http://go-pear.org/
           =&gt; `index.html&#039;
Resolving go-pear.org... 216.92.131.66
Connecting to go-pear.org|216.92.131.66|:80... failed: Connection refused.
</pre>

<p class="paragraph">
・・・ん？Connection refused?
<br />
</p>

<p class="paragraph">
試しにローカルに一旦落としたgo-pear.phpをUPって、コマンドラインから
<br />
</p>
<pre>$ php go-pear.php
</pre>
<p class="paragraph">
しても、同様のエラーでアウト。
<br />
</p>

<p class="paragraph">
コマンドラインからじゃNGかと思い<span class="hidden">(</span><a class="footnote" href="#footnote_76_1" id="footnote_76_1_r"  title="SELinuxの制限かと思った">*1</a><span class="hidden">)</span>、Apacheからやってみるも、今度は chmod 777 した筈のPEARインストールディレクトリが悉く、パーミッションエラーで弾かれてる。
<br />
</p>

<p class="paragraph">
どうなっているのか、とApacheのプロセスを見ようとすると、
<br />
</p>
<pre>root ... /usr/sbin/vmware-guestd --background /var/run/vmware-gues
</pre>
<p class="paragraph">
VMwareのゲスト用デーモン！？へぇ・・・VMware上で動いていたのか・・・。全然気づかなかった。
<br />
</p>

<p class="paragraph">
で、結局Apacheプロセスが見えなかった。うーん・・・ドキュメントを見てみるか<span class="hidden">(</span><a class="footnote" href="#footnote_76_2" id="footnote_76_2_r"  title="最初に見るべきだった。">*2</a><span class="hidden">)</span>。
<br />
</p>

<p class="paragraph">
<a class="externallink" href="https://sourceforge.net/docs/E07" target="_blank">https://sourceforge.net/docs/E07</a>
<br />
</p>

<pre>E07- 09 Outbound Connectivity
</pre>

<p class="paragraph">
・・・ご免なさいご免なさいご免なさい。ちゃんと明記してありましたね。Webサーバ環境からは、他のSourceForgeサーバも含めて一切内→外へのアクセスはシャットダウンしてあるのでした。
<br />
</p>

<p class="paragraph">
ちょっと待て。
<br />
これじゃ、PEARインストールできないじゃん？
<br />
</p>

<p class="paragraph">
確かにまぁ、ローカルで疑似環境作ってUPれば良いと言えば良いのだけれど、そこまでするのは正直、面倒くさい。ひどく。
<br />
</p>

<p class="paragraph">
<strong> と言うことで、Xhwlayのチャネルサーバを立てるのは諦めます。 </strong>
<br />
</p>

<p class="paragraph">
やっぱり、自前の鯖を使わないと無理そう。とはいえ、殆ど変更が入らないコントローラ系のライブラリで、そこまでするか？というのはある。
<br />
まあ海外の安い、rootをもらえるホスティングサービスと契約するのはアリだし、いつかはそれをやろうとは思っているけど、9-11月にかけて身辺が非常にごとごとする可能性が高く、アッチこっちに手を回す余裕がないのも確か。
<br />
</p>

<p class="paragraph">
というわけで、Xhwlayのチャネルサーバは断念します。
<br />
</p>

<p class="paragraph">
<strong> 2008年12月時点ではOpenPEARがありますので、試してみたいですね・・・。 </strong>
<br />
</p>

<h3 id="id23b7cc">パッケージは作ってみよう。但し、package2.xmlのみ対応で。</h3>

<p class="paragraph">
チャネルサーバが無いと、パッケージの魅力は半減するように思えるので正直諦めようとか思っていたのだけれど、せっかくなので作ってみようか。と、思う。
<br />
</p>

<p class="paragraph">
WEB+DBの33号も参考にしてみる。PEAR_PackageFileManager をインストールすると、doc_dir に当たるディレクトリに幾つかのExampleスクリプトがインストールされるので、それを参考に弄ってみる。
<br />
</p>

<p class="paragraph">
で。
<br />
</p>

<p class="paragraph">
相当の紆余曲折の末、SummaryやDescriptionはサンプルそのままだが、とりあえずパッケージを作ることができた。また、その作業により
<br />
</p>
<pre>generatePackage.xml.php
</pre>
<p class="paragraph">
を新たにリポジトリに追加した。（SVNの作業ディレクトリを丸ごとごっそり移動したばっかりだったので、上手くcommitできるか不安だったが特に問題なかった。よかったにゃ～。）
<br />
</p>

<p class="paragraph">
中身の細かい値は今後修正していくが、とりあえずコレがスケルトンになる。
<br />
</p>
<pre>$ rm package.xml package2.xml     # なぜか削除しておかないと上手く動かない？
$ php generatePackage.xml.php
...
... (XMLが生成され、標準出力に出力される。validateも行われ、何かエラーがあれば表示される)
...
(エラーが無く、XMLも特に問題ないようであれば実際にpackage.xml/package2.xmlを作成・保存)
$ php generatePackage.xml.php make
                              ^^^^ これが追加される。
$
$ ls 
... Xhwlay-X.X.X.tgz ...
$ pear info Xhwlay-X.X.X.tgz
... (パッケージの情報を確認)

$ pear list-file Xhwlay-X.X.X.tgz
... (ファイルのインストール先を確認)

</pre>

<p class="paragraph">
こんな感じで。
<br />
</p>

<p class="paragraph">
・・・色々紆余曲折がありました。最初は、WEB+DB 33号の記事やExampleのスクリプトのつぎはぎから始まったので、XMLのvalidateで何回も怒られた。っつーか、validateする前にも表示してくれるとどこがどう悪いのか分かりやすいんだが。
<br />
で、ようやくvalidateが無くなったと思ったら、「XMLで指定されたファイルが、現実には無いよ？」という感じのERRORが。
<br />
</p>
<pre>Error: File &quot;C:/in_vitro/SVNWORK/xhwlay-php\hwlay/Bookmark.php&quot; in package.xml does not exist
Error: File &quot;C:/in_vitro/SVNWORK/xhwlay-php\ample/templates/pages_default.html&quot; in package.xml does not exist
</pre>

<p class="paragraph">
・・・ん？
<br />
</p>
<pre>xhwlay-php\hwlay =&gt; xhwlay-php\Xhwlay
                               ^
xhwlay-php\ample =&gt; xhwlay-php\sample/
                               ^
</pre>
<p class="paragraph">
の間違いじゃない？
<br />
</p>

<p class="paragraph">
で、いろいろsetOptionの値を確認したり、ソースコードを追っかけてる内に、<strong> ひょっとしたらBUGかもしれない箇所を発見 </strong>。すごい分かりづらいのだけれど、
<br />
</p>
<pre>PEAR/PackageFileManager/File.php#getFileList()
...
$path = substr(dirname($file), strlen(str_replace(
    DIRECTORY_SEPARATOR, &#039;/&#039;, realpath($package_directory))) + 1);
                                                             ^^^ ここが怪しい。
</pre>

<p class="paragraph">
やっている内容は、例えば &#039;packagedirectory&#039; が
<br />
</p>
<pre>C:/your/package/directory
</pre>
<p class="paragraph">
であった時、次のファイルが来たら、
<br />
</p>
<pre>C:/your/package/directory/foo/bar.php
</pre>
<p class="paragraph">
&#039;packagedirectory&#039;分をさっぴいて返す。つまり
<br />
</p>
<pre>C:/your/package/directory/foo/bar.php
                           -
C:/your/package/directory
                           =
                          foo/bar.php
</pre>
<p class="paragraph">
にする、という処理。
<br />
で、どうやら、&#039;packagedirectory&#039; の末尾が&quot;/&quot;で終わっている場合、+1が効いてしまい、&quot;/&quot;の直後1文字まで削られる。つまり、
<br />
</p>
<pre>C:/your/package/directory/foo/bar.php
                           -
C:/your/package/directory/f
                           =
                           oo/bar.php
</pre>
<p class="paragraph">
となってしまうらしい。
<br />
</p>

<p class="paragraph">
良く動いてるよな・・・。<strong> というかこれ、本当にBugなのか？実は単なる自分の設定ミスでちゃんと設定するモノしていれば問題なかったりして。 </strong>
<br />
とにかく、本当かウソか分からないので、一応patch作ってPEARのBugとしてreportしておいた。
<br />
</p>

<p class="paragraph">
<a class="externallink" href="http://pear.php.net/bugs/bug.php?id=12023" target="_blank">http://pear.php.net/bugs/bug.php?id=12023</a>
<br />
</p>

<p class="paragraph">
さて、どうなるか・・・。
<br />
</p>

<h4 id="id8fa00e">どうでも良いけど。</h4>

<p class="paragraph">
これで、PEARのBugレポート、二回目だな。外れクジ引いてるような気が。
<br />
</p>

<p class="paragraph">
あと、PEARの入力フォームが全般的に使いづらい。今回も、例によりAccount忘れたので新規作成したのだけれど、UserNameやFullNameで、やれ大文字小文字、ALNUMしか駄目だとか、<strong> POSTした後に怒られるし。 </strong>しかも、<strong> 入力画面にはそんな注意書きないし。 </strong>
<br />
</p>

<p class="paragraph">
なので、エラーになる度、CAPTCHA入力し直し。おまけに<strong> 必須入力の強調表示が無い為、すごい分かりづらい </strong>し。
<br />
UserNameやパスワード、FullNameなどでは、入力可能な文字数が表示されていないし。
<br />
</p>

<p class="paragraph">
うーん、ユーザーインターフェイスというのを考えたことがあるのか？これもBugというよりはRequestとしてレポートを作れと？うへぇ。
<br />
</p><div class="footnote">
<a id="footnote_76_1" href="#footnote_76_1_r">*1</a>: SELinuxの制限かと思った<br />
<a id="footnote_76_2" href="#footnote_76_2_r">*2</a>: 最初に見るべきだった。
</div>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/76<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>