<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>PHP/PEARインストールメモ - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">PHP/PEARインストールメモ</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2007-09-11 21:08:00 &nbsp; / &nbsp; last updated at: 2008-12-21 21:12:16<br>
カテゴリ: <a href="category-6.html">PHP</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-54.html" title="PHP/MySQL_BLOBに画像を保存するサンプル">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-978.html" title="PHP/PECL OAuth/HTTP Proxyを使う">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-25.html" title="PHP">PHP</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
とあるライブラリをPEARにまとめようと思った。
<br />
ついでに、ローカル(Windows)の環境もPHP5にしようと思った。
<br />
で、最初はCGI形式にしてPHP4とPHP5の両方を動かせるようにすればいいや、と思っていろいろApacheの設定弄くったけど、上手く行かなくて挫折。
<br />
</p>

<p class="paragraph">
で、素直にPHP5を入れた後、PEARをきっちりとインストールしてみようと思った。
<br />
というのは、phpDocumentor等を入れると、何故か
<br />
</p>
<pre>c:\php4
</pre>
<p class="paragraph">
というディレクトリが勝手に作られてしまう。これが非常に邪魔だったので、なんとしてもこの問題をクリアしたかった。
<br />
</p>

<ul><li><a href="#idafe2fc">何処に入れるか。</a></li>
<li><a href="#ida8cfd2">go-pear.batの実行</a></li>
<li><a href="#id2f094e">PEARの設定の上手い保存方法について</a><ul><li><a href="#id3a40e7">結論：PHP_PEAR_SYSCONF_DIR 環境変数を設定せよ。</a></li>
<li><a href="#id87db20">種明かしと PEAR/Config.php の解説</a></li></ul></li></ul>
<hr />
<h3 id="idafe2fc">何処に入れるか。</h3>

<p class="paragraph">
個人的な環境では、以下のようにセッティングし、&quot;pear_0&quot;ディレクトリにインストールしようと目論んでいる。go-pear.batや、go-pear.pharは、PHP5に添付のファイルをコピー。
<br />
</p>
<pre>C:\in_vitro\
            apps\
                 php4\ ... PHP4。PHPUnitとかで動かすかもしんない。
                 php5\ ... PHP5。
                 pear_0\ ... PEAR。とりあえず普通に使うものと言う意味で、&quot;_0&quot;。
                        go-pear.bat
                        PEAR\go-pear.phar
</pre>

<h3 id="ida8cfd2">go-pear.batの実行</h3>

<p class="paragraph">
その前に、go-pear.batを若干修正しておく。
<br />
</p>
<pre>@ECHO OFF
set PHP_BIN=C:\in_vitro\apps\php5\php.exe
%PHP_BIN% -d output_buffering=0 C:\in_vitro\apps\pear_0\PEAR\go-pear.phar
pause
</pre>
<p class="paragraph">
間違えてPHP4のバイナリを動かさないよう、PHP_BINをフルパスで指定。あと、これも間違ってPHP5に入っているPEARではなく、ちゃんと今回セッティングしたpear_0を見に行くようフルパスで指定。
<br />
</p>

<p class="paragraph">
で、動かす。
<br />
</p>
<pre>&gt; cd c:\in_vitro\apps\pear_0
C:\in_vitro\apps\pear_0&gt; go-pear.bat

Are you installing a system-wide PEAR or a local copy?
(system|local) [system] :(そのままENTER)

Below is a suggested file layout for your new PEAR installation.  To
change individual locations, type the number in front of the
directory.  Type &#039;all&#039; to change all of them or simply press Enter to
accept these locations.

 1. Installation base ($prefix)        : C:\in_vitro\apps\pear_0
 2. Temporary directory for processing : C:\in_vitro\apps\pear_0\tmp
 3. Temporary directory for downloads  : C:\in_vitro\apps\pear_0\tmp
 4. Binaries directory                 : C:\in_vitro\apps\pear_0
 5. PHP code directory ($php_dir)      : C:\in_vitro\apps\pear_0\pear
 6. Documentation directory            : C:\in_vitro\apps\pear_0\pear\docs
 7. Data directory                     : C:\in_vitro\apps\pear_0\pear\data
 8. Tests directory                    : C:\in_vitro\apps\pear_0\pear\tests
 9. Name of configuration file         : C:\WINDOWS\pear.ini
10. Path to CLI php.exe                : C:\in_vitro\apps\php5
1-10, &#039;all&#039; or Enter to continue: all
</pre>

<p class="paragraph">
ここで、PEARディレクトリ内には純粋にライブラリとしてのPHPファイルしか入れたく無かった為、6, 7, 8を修正。あと、2と3が一緒なのもアレなので、3を修正。あと、9も修正した。後で顧みるに、9については結局意味が無かったようだけど・・・。
<br />
</p>

<pre>Installation base ($prefix) [C:\in_vitro\apps\pear_0] :
Temporary directory for processing [$prefix\tmp] :
Temporary directory for downloads [$prefix\tmp] : $prefix\downloads
Binaries directory [$prefix] : $prefix\bin
PHP code directory ($php_dir) [$prefix\pear] :
Documentation directory [$php_dir\docs] : $prefix\docs
Data directory [$php_dir\data] : $prefix\data
Tests directory [$php_dir\tests] : $prefix\tests
Name of configuration file [C:\WINDOWS\pear.ini] : $prefix\pear_0_system.ini
Path to CLI php.exe [C:\in_vitro\apps\php5] :

Below is a suggested file layout for your new PEAR installation.  To
change individual locations, type the number in front of the
directory.  Type &#039;all&#039; to change all of them or simply press Enter to
accept these locations.

 1. Installation base ($prefix)        : C:\in_vitro\apps\pear_0
 2. Temporary directory for processing : C:\in_vitro\apps\pear_0\tmp
 3. Temporary directory for downloads  : C:\in_vitro\apps\pear_0\downloads
 4. Binaries directory                 : C:\in_vitro\apps\pear_0\bin
 5. PHP code directory ($php_dir)      : C:\in_vitro\apps\pear_0\pear
 6. Documentation directory            : C:\in_vitro\apps\pear_0\docs
 7. Data directory                     : C:\in_vitro\apps\pear_0\data
 8. Tests directory                    : C:\in_vitro\apps\pear_0\tests
 9. Name of configuration file         : C:\in_vitro\apps\pear_0\pear_0_system.ini
10. Path to CLI php.exe                : C:\in_vitro\apps\php5

1-10, &#039;all&#039; or Enter to continue: (ContinueなのでENTER)

...

** WARNING! Old version found at C:\in_vitro\apps\pear_0\bin, please remove it or be sure 
to use the new c:\in_vitro\apps\pear_0\bin\pear.bat command

The &#039;pear&#039; command is now at your service at c:\in_vitro\apps\pear_0\bin\pear.bat

** The &#039;pear&#039; command is not currently in your PATH, so you need to
** use &#039;c:\in_vitro\apps\pear_0\bin\pear.bat&#039; until you have added
** &#039;C:\in_vitro\apps\pear_0\bin&#039; to your PATH environment variable.

Run it without parameters to see the available actions, try &#039;pear list&#039;
to see what packages are installed, or &#039;pear help&#039; for help.

For more information about PEAR, see:

  http://pear.php.net/faq.php
  http://pear.php.net/manual/

Thanks for using go-pear!
</pre>

<p class="paragraph">
これで、pear.batが
<br />
</p>
<pre>c:\in_vitro\apps\pear_0\bin\pear.bat
</pre>
<p class="paragraph">
としてインストールされた。実際にrequireされるライブラリなどは、
<br />
</p>
<pre>c:\in_vitro\apps\pear_0\PEAR
</pre>
<p class="paragraph">
配下になり、こちらは既にphp.iniのinclude_pathに追加済。
<br />
</p>

<p class="paragraph">
で、今回PHP5に入れ替えたのもあるため、いつもの環境設定バッチファイルを修正する。
<br />
</p>
<pre>c:\in_vitro\setenv.bat
</pre>
<p class="paragraph">
→
<br />
</p>
<pre>REM PHP5
set PHP5_HOME=C:\in_vitro\apps\php5

REM PEAR_0
set PEAR_0_HOME=C:\in_vitro\apps\pear_0\bin

...

set PATH=...;%PHP5_HOME%;%PEAR_0_HOME%;...
</pre>

<p class="paragraph">
ここら辺は大体こんな感じで、細かくはお好みでいつも手を抜いたり凝ったりしている箇所。
<br />
</p>

<p class="paragraph">
次が本題。
<br />
</p>

<h3 id="id2f094e">PEARの設定の上手い保存方法について</h3>

<p class="paragraph">
最初、go-pear.batの実行時。
<br />
</p>
<pre> 9. Name of configuration file         : C:\in_vitro\apps\pear_0\pear_0_system.ini
</pre>
<p class="paragraph">
これを設定していた為、てっきりここに保存されるものだと・・・思っていた自分が阿呆でした。
<br />
</p>

<p class="paragraph">
ファイルは作られたのですが、普通に
<br />
</p>
<pre>&gt; pear install pear/PhpDocumentor
</pre>
<p class="paragraph">
とかすると、何故か
<br />
</p>
<pre>c:\php5\pear\data
             docs
</pre>
<p class="paragraph">
とかできちゃうんですよねぇ～～～～。
<br />
</p>

<pre>C:\in_vitro&gt;pear config-show
CONFIGURATION (CHANNEL PEAR.PHP.NET):
=====================================
Auto-discover new Channels     auto_discover    &lt;not set&gt;
Default Channel                default_channel  pear.php.net
HTTP Proxy Server Address      http_proxy       &lt;not set&gt;
PEAR server [DEPRECATED]       master_server    pear.php.net
Default Channel Mirror         preferred_mirror pear.php.net
Remote Configuration File      remote_config    &lt;not set&gt;
PEAR executables directory     bin_dir          C:\in_vitro\apps\pear_0\bin
PEAR documentation directory   doc_dir          C:\php5\pear\docs
PHP extension directory        ext_dir          C:\in_vitro\apps\php5\ext
PEAR directory                 php_dir          C:\in_vitro\apps\pear_0\pear
PEAR Installer cache directory cache_dir        C:\DOCUME~1\FengJing\LOCALS~1\Temp\pear\cache
PEAR data directory            data_dir         C:\php5\pear\data
PEAR Installer download        download_dir     C:\DOCUME~1\FengJing\LOCALS~1\Temp\pear\cache
directory
PHP CLI/CGI binary             php_bin          C:\in_vitro\apps\php5\php.exe
php.ini location               php_ini          &lt;not set&gt;
PEAR Installer temp directory  temp_dir         C:\DOCUME~1\FengJing\LOCALS~1\Temp\pear\temp
PEAR test directory            test_dir         C:\php5\pear\tests
Cache TimeToLive               cache_ttl        3600
Preferred Package State        preferred_state  stable
Unix file mask                 umask            0
Debug Log Level                verbose          1
PEAR password (for             password         &lt;not set&gt;
maintainers)
Signature Handling Program     sig_bin          c:\gnupg\gpg.exe
Signature Key Directory        sig_keydir       C:\WINDOWS\pearkeys
Signature Key Id               sig_keyid        &lt;not set&gt;
Package Signature Type         sig_type         gpg
PEAR username (for             username         &lt;not set&gt;
maintainers)
User Configuration File        Filename         C:\WINDOWS\pear.ini
System Configuration File      Filename         C:\WINDOWS\pearsys.ini
</pre>

<p class="paragraph">
うぉ～～～い、Configuration Fileも知らない間に C:\WINDOWS になってるしぃ～～～！？
<br />
</p>

<p class="paragraph">
で、この状態で
<br />
</p>
<pre>&gt; pear config-set test_dir c:\in_vitro\apps\pear_0\tests
</pre>
<p class="paragraph">
とかすると、
<br />
</p>
<pre>C:\WINDOWS\pear.ini
</pre>
<p class="paragraph">
に設定が書き込まれちゃうんですよ！！！！
<br />
</p>

<p class="paragraph">
違うの違うの違うの～～～～～！！！そっちじゃねぇ～～～～！！！
<br />
</p>

<h4 id="id3a40e7">結論：PHP_PEAR_SYSCONF_DIR 環境変数を設定せよ。</h4>

<p class="paragraph">
なんでかは置いておきまして、答えを先に。
<br />
</p>
<pre>&gt; set PHP_PEAR_SYSCONF_DIR=c:\in_vitro\apps\pear_0
</pre>
<p class="paragraph">
という感じで、<strong> pear.iniを配置するディレクトリを、PHP_PEAR_SYSCONF_DIR環境変数に設定しておく </strong>事により、まず、Configuration Fileの位置が指定されます。
<br />
</p>

<pre>C:\in_vitro&gt;set PHP_PEAR_SYSCONF_DIR=c:\in_vitro\apps\pear_0
C:\in_vitro&gt;pear config-show
CONFIGURATION (CHANNEL PEAR.PHP.NET):
=====================================
Auto-discover new Channels     auto_discover    &lt;not set&gt;
...
User Configuration File        Filename         c:\in_vitro\apps\pear_0\pear.ini
System Configuration File      Filename         c:\in_vitro\apps\pear_0\pearsys.ini
</pre>

<p class="paragraph">
で、この状態で config-set を行うことで、今回の例であれば c:\in_vitro\apps\pear_0 の pear.ini と pearsys.ini に設定が書き込まれます。<span class="hidden">(</span><a class="footnote" href="#footnote_40_1" id="footnote_40_1_r"  title="この二つ、どう違うのかは未調査。いつか、リベンジ。">*1</a><span class="hidden">)</span>
<br />
</p>

<p class="paragraph">
ハイ、というわけで今回の完了状態：
<br />
</p>
<pre>&gt; C:\in_vitro&gt;pear config-show
CONFIGURATION (CHANNEL PEAR.PHP.NET):
=====================================
Auto-discover new Channels     auto_discover    &lt;not set&gt;
Default Channel                default_channel  pear.php.net
HTTP Proxy Server Address      http_proxy       &lt;not set&gt;
PEAR server [DEPRECATED]       master_server    pear.php.net
Default Channel Mirror         preferred_mirror pear.php.net
Remote Configuration File      remote_config    &lt;not set&gt;
PEAR executables directory     bin_dir          C:\in_vitro\apps\pear_0\bin
PEAR documentation directory   doc_dir          C:\in_vitro\apps\pear_0\docs
PHP extension directory        ext_dir          C:\in_vitro\apps\php5\ext
PEAR directory                 php_dir          C:\in_vitro\apps\pear_0\pear
PEAR Installer cache directory cache_dir        c:\in_vitro\apps\pear_0\cache
PEAR data directory            data_dir         C:\in_vitro\apps\pear_0\data
PEAR Installer download        download_dir     C:\in_vitro\apps\pear_0\downloads
directory
PHP CLI/CGI binary             php_bin          C:\in_vitro\apps\php5\php.exe
php.ini location               php_ini          c:\in_vitro\apps\php5\php.ini
PEAR Installer temp directory  temp_dir         C:\in_vitro\apps\pear_0\tmp
PEAR test directory            test_dir         C:\in_vitro\apps\pear_0\tests
Cache TimeToLive               cache_ttl        3600
Preferred Package State        preferred_state  stable
Unix file mask                 umask            0
Debug Log Level                verbose          1
PEAR password (for             password         &lt;not set&gt;
maintainers)
Signature Handling Program     sig_bin          c:\gnupg\gpg.exe
Signature Key Directory        sig_keydir       c:\in_vitro\apps\pear_0\pearkeys
Signature Key Id               sig_keyid        &lt;not set&gt;
Package Signature Type         sig_type         gpg
PEAR username (for             username         &lt;not set&gt;
maintainers)
User Configuration File        Filename         c:\in_vitro\apps\pear_0\pear.ini
System Configuration File      Filename         c:\in_vitro\apps\pear_0\pearsys.ini
</pre>

<h4 id="id87db20">種明かしと PEAR/Config.php の解説</h4>

<p class="paragraph">
PEARの設定値の秘密は、PEAR/Config.php ファイルにあります。
<br />
まず、今回関係してくる部分に注目し、PEAR/Config.php ファイルの構造を大雑把にまとめると以下のようになります。
<br />
</p>
<ul><li> デフォルト値用を含めた定数定義部</li></ul>
<pre>if (getenv(&#039;PHP_PEAR_SYSCONF_DIR&#039;)) {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, getenv(&#039;PHP_PEAR_SYSCONF_DIR&#039;));
} elseif (getenv(&#039;SystemRoot&#039;)) {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, getenv(&#039;SystemRoot&#039;));
} else {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, PHP_SYSCONFDIR);
}

// Default for master_server
if (getenv(&#039;PHP_PEAR_MASTER_SERVER&#039;)) {
    define(&#039;PEAR_CONFIG_DEFAULT_MASTER_SERVER&#039;, getenv(&#039;PHP_PEAR_MASTER_SERVER&#039;));
} else {
    define(&#039;PEAR_CONFIG_DEFAULT_MASTER_SERVER&#039;, &#039;pear.php.net&#039;);
}
...
</pre>
<ul><li> PEAR_Config クラス定義</li></ul>
<pre>class PEAR_Config extends PEAR
</pre>
<ul><li><ul><li> 設定値の定義(上のデフォルト値はここで使われる)</li></ul></li></ul>
<pre>   var $configuration_info = array(
       // Channels/Internet Access
       &#039;default_channel&#039; =&gt; array(
           &#039;type&#039; =&gt; &#039;string&#039;,
           &#039;default&#039; =&gt; PEAR_CONFIG_DEFAULT_CHANNEL,
           &#039;doc&#039; =&gt; &#039;the default channel to use for all non explicit commands&#039;,
           &#039;prompt&#039; =&gt; &#039;Default Channel&#039;,
           &#039;group&#039; =&gt; &#039;Internet Access&#039;,
           ),
       &#039;preferred_mirror&#039; =&gt; array(
           &#039;type&#039; =&gt; &#039;string&#039;,
           &#039;default&#039; =&gt; PEAR_CONFIG_DEFAULT_CHANNEL,
           &#039;doc&#039; =&gt; &#039;the default server or mirror to use for channel actions&#039;,
           &#039;prompt&#039; =&gt; &#039;Default Channel Mirror&#039;,
           &#039;group&#039; =&gt; &#039;Internet Access&#039;,
           ),
...
</pre>
<ul><li><ul><li> コンストラクタ</li></ul></li></ul>
<pre>function PEAR_Config($user_file = &#039;&#039;, $system_file = &#039;&#039;, $ftp_file = false, 
$strict = true) { ...
</pre>

<p class="paragraph">
Config.phpの冒頭では大量のdefine文が出てきますが、その殆どが、設定値のデフォルト値です。$configuration_infoに指定されています。逆に言えばそれ以外の定数値は、別の用途になりますが、今回の調査対象外ですのでスルーします。
<br />
</p>

<p class="paragraph">
で、なんで
<br />
</p>
<pre>c:\php4\pear
</pre>
<p class="paragraph">
とか
<br />
</p>
<pre>c:\php5\pear
</pre>
<p class="paragraph">
とか作られちゃうの？ですが、デフォルト値でそうした値になっている箇所を追っていくと正体が掴めます。例えばdataやtestsを見てみましょう。
<br />
</p>
<pre>&#039;data_dir&#039; =&gt; array(
    &#039;type&#039; =&gt; &#039;directory&#039;,
    &#039;default&#039; =&gt; PEAR_CONFIG_DEFAULT_DATA_DIR,
    ...
&#039;test_dir&#039; =&gt; array(
    &#039;type&#039; =&gt; &#039;directory&#039;,
    &#039;default&#039; =&gt; PEAR_CONFIG_DEFAULT_TEST_DIR,
    ...
</pre>
<p class="paragraph">
→(getenvのブロックは除去して抽出)
<br />
</p>
<pre>define(&#039;PEAR_CONFIG_DEFAULT_DATA_DIR&#039;, $PEAR_INSTALL_DIR.DIRECTORY_SEPARATOR.&#039;data&#039;);
define(&#039;PEAR_CONFIG_DEFAULT_TEST_DIR&#039;, $PEAR_INSTALL_DIR.DIRECTORY_SEPARATOR.&#039;tests&#039;);
</pre>
<p class="paragraph">
で、$PEAR_INSTALL_DIR は何なのかを見ていくと、Config.phpの冒頭で
<br />
</p>
<pre>if (!defined(&#039;PEAR_INSTALL_DIR&#039;) || !PEAR_INSTALL_DIR) {
    $PEAR_INSTALL_DIR = PHP_LIBDIR . DIRECTORY_SEPARATOR . &#039;pear&#039;;
} else {
    $PEAR_INSTALL_DIR = PEAR_INSTALL_DIR;
}
</pre>
<p class="paragraph">
とあります。
<br />
もちろん、PEAR_INSTALL_DIR等という定数は定義せずに使用していますので、上の分岐に入ります。すると、PHP_LIBDIRという定数に&quot;\pear&quot;を付け足したものが$PEAR_INSTALL_DIRになることが分かりました。というわけで、
<br />
</p>
<pre>&gt; php -r &quot;echo PHP_LIBDIR;&quot;
C:\php5
</pre>
<p class="paragraph">
これで、
<br />
</p>
<pre>C:\php5 + &quot;\pear&quot; =&gt; c:\php5\pear
</pre>
<p class="paragraph">
になり、この下にdataやらdocsやらtestsが作られる、と言うわけです。
<br />
</p>

<p class="paragraph">
さて、肝心の設定ファイルの位置ですが、コンストラクタにその部分が書かれています。
<br />
</p>
<pre>function PEAR_Config($user_file = &#039;&#039;, $system_file = &#039;&#039;, $ftp_file = false,
                     $strict = true)
{
    $this-&gt;PEAR();
    PEAR_Installer_Role::initializeConfig($this);
    $sl = DIRECTORY_SEPARATOR;
    if (empty($user_file)) {
        if (OS_WINDOWS) {
            $user_file = PEAR_CONFIG_SYSCONFDIR . $sl . &#039;pear.ini&#039;;
        } else {
            $user_file = getenv(&#039;HOME&#039;) . $sl . &#039;.pearrc&#039;;
        }
    }
    if (empty($system_file)) {
        if (OS_WINDOWS) {
            $system_file = PEAR_CONFIG_SYSCONFDIR . $sl . &#039;pearsys.ini&#039;;
        } else {
            $system_file = PEAR_CONFIG_SYSCONFDIR . $sl . &#039;pear.conf&#039;;
        }
    }
</pre>

<p class="paragraph">
UNIX系の場合はさておきまして(見れば同じ文脈でどうなるか、分かると思います。)、WINDOWSの場合は
<br />
</p>
<pre>$user_file = PEAR_CONFIG_SYSCONFDIR . $sl . &#039;pear.ini&#039;;
$system_file = PEAR_CONFIG_SYSCONFDIR . $sl . &#039;pearsys.ini&#039;;
</pre>
<p class="paragraph">
となるようです。では、PEAR_CONFIG_SYSCONFDIR の定義を追ってみると・・・
<br />
</p>
<pre>if (getenv(&#039;PHP_PEAR_SYSCONF_DIR&#039;)) {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, getenv(&#039;PHP_PEAR_SYSCONF_DIR&#039;));
} elseif (getenv(&#039;SystemRoot&#039;)) {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, getenv(&#039;SystemRoot&#039;));
} else {
    define(&#039;PEAR_CONFIG_SYSCONFDIR&#039;, PHP_SYSCONFDIR);
}
</pre>
<p class="paragraph">
とあります。次の優先順位で PEAR_CONFIG_SYSCONFDIR の値を設定していることが分かります。
<br />
</p>
<ul><li> PHP_PEAR_SYSCONF_DIR 環境変数</li>
<li> SystemRoot 環境変数</li>
<li> PHP_SYSCONFDIR 組込定数</li></ul>

<p class="paragraph">
ここから、PHP_PEAR_SYSCONF_DIR環境変数を設定することで、好みの場所のPEAR設定ファイルを参照することができる、と分かりました。
<br />
</p>

<p class="paragraph">
ちなみに、Windows版のPHP5では残り二つがどうなるかというと・・・
<br />
</p>
<pre>&gt; php -r &quot;echo getenv(&#039;SystemRoot&#039;);&quot;
C:\WINDOWS
&gt; php -r &quot;echo PHP_SYSCONFDIR;&quot;
C:\php5
</pre>

<p class="paragraph">
と言う形になり、デフォルトで
<br />
</p>
<pre>C:\WINDOWS\pear.ini
</pre>
<p class="paragraph">
になるのも納得できました。
<br />
</p>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-54.html" title="PHP/MySQL_BLOBに画像を保存するサンプル">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-978.html" title="PHP/PECL OAuth/HTTP Proxyを使う">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-25.html" title="PHP">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-25.html" title="PHP">PHP</a>&nbsp;]</li>
</ul><div class="footnote">
<a id="footnote_40_1" href="#footnote_40_1_r">*1</a>: この二つ、どう違うのかは未調査。いつか、リベンジ。
</div>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/40<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>