<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>C言語系/memos/gcc - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">C言語系/memos/gcc</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2009-11-16 11:05:49 &nbsp; / &nbsp; last updated at: 2009-11-28 13:28:12<br>
カテゴリ: <a href="category-10.html">C言語</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-786.html" title="C言語系/memos/binutils">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-843.html" title="C言語系/memos/gcc/舞台裏を知りたいときのヒント集メモ">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
gccのオプションなど自分なりのmemo
<br />
</p>

<ul><li><a href="#idfc7438">基本</a></li>
<li><a href="#idc3147f">コマンドラインオプション</a><ul><li><a href="#id6cb1b5">&quot;--save-temps&quot;, &quot;-v&quot; : 途中成果物の保存と実行内容詳細表示</a></li>
<li><a href="#id848732">&quot;-E&quot;, &quot;-S&quot; : プリプロセスまで/アセンブルまで</a><ul><li><a href="#id0f9999">&quot;-E&quot; : プリプロセスまで</a></li>
<li><a href="#id28f6be">&quot;-S&quot; : アセンブラまで</a></li></ul></li>
<li><a href="#ide89d8b">&quot;-I&quot;, &quot;-L&quot;, &quot;-l&quot;オプション</a></li>
<li><a href="#ida60b40">ライブラリの作成とリンク例</a><ul><li><a href="#id36df0d">静的ライブラリの作成とリンク</a></li>
<li><a href="#idb4c611">動的ライブラリの作成とリンク</a></li></ul></li>
<li><a href="#id07f134">&quot;-Wa,...&quot;, &quot;-Wl,...&quot;</a></li></ul></li>
<li><a href="#id87aadd">TIPS</a></li></ul>
<hr />
<h3 id="idfc7438">基本</h3>

<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&lt;</span><span class="hl-string">stdio.h</span><span class="hl-quotes">&gt;</span><span ></span><span class="hl-code">
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">main</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argc</span><span class="hl-code">, </span><span >char</span><span class="hl-code"> **</span><span class="hl-identifier">argv</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">Hello, World!</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<p class="paragraph">
何も指定しない場合はa.outで出力する。
<br />
</p>
<pre>$ gcc hello.c
$ ls
a.out*  hello.c
$ ./a.out
Hello, World!
</pre>

<p class="paragraph">
出力ファイル名を指定したい場合は、 &quot;-o&quot; オプションを使う。
<br />
</p>
<pre>$ gcc -o hello hello.c
$ ls
hello*  hello.c
$ ./hello
Hello, World!
</pre>

<p class="paragraph">
オブジェクトファイル(*.o)までの生成にしておきたい場合は &quot;-c&quot; オプションを使う。
<br />
</p>
<pre>$ gcc -c hello.c
$ ls
hello.c  hello.o
</pre>

<p class="paragraph">
&quot;-c&quot; オプションと &quot;-o&quot; オプションの併用例：
<br />
</p>
<pre>$ gcc -c -o hello_obj.o hello.c
$ ls
hello.c  hello_obj.o
</pre>

<h3 id="idc3147f">コマンドラインオプション</h3>

<h4 id="id6cb1b5">&quot;--save-temps&quot;, &quot;-v&quot; : 途中成果物の保存と実行内容詳細表示</h4>

<pre class="plugin_pre">
$ gcc --save-temps -v hello.c
Using built-in specs.
Target: i386-redhat-linux
(...)
 as -V -Qy -o hello.o hello.s
GNU assembler version 2.17.50.0.6-6.el5 (i386-redhat-linux) using BFD version 2.17.50.0.6-6.el5 20061020
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/collect2 (...)

$ ls
a.out  hello.c  hello.i  hello.o  hello.s
$ ./a.out
Hello, World!
</pre>

<h4 id="id848732">&quot;-E&quot;, &quot;-S&quot; : プリプロセスまで/アセンブルまで</h4>

<p class="paragraph">
gccに &quot;-E&quot; or &quot;-S&quot; を指定する事で、成果物の段階を指定できる。
<br />
</p>

<h5 id="id0f9999">&quot;-E&quot; : プリプロセスまで</h5>

<p class="paragraph">
&quot;-E&quot;オプションを指定すると、プリプロセッサまでが実行される。&quot;-o&quot;をつけないと標準出力に出力される。
<br />
</p>
<pre class="plugin_pre">
$ gcc -E hello.c
# 1 &quot;hello.c&quot;
(...)
# 2 &quot;hello.c&quot; 2

int main(int argc, char **argv)
{
 printf(&quot;Hello, World!\n&quot;);
 return 0;
}

$ ls
hello.c
</pre>
<p class="paragraph">
&quot;-o&quot;オプションを指定してみる。
<br />
</p>
<pre class="plugin_pre">
$ gcc -E -o hello.i hello.c
$ ls
hello.c  hello.i

（プリプロセスの出力ファイルからコンパイルを継続することも出来る）
$ gcc hello.i
$ ls
a.out*  hello.c  hello.i

$ ./a.out
Hello, World!
</pre>

<p class="paragraph">
&quot;-v&quot;をつけてみると、cppパッケージの&quot;cc1&quot;コマンドの実行まで処理している事が確認できる。
<br />
</p>
<pre class="plugin_pre">
$ gcc -v -E -o hello.i hello.c
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure --prefix=/usr (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/cc1 \
     -E -quiet -v hello.c -o hello.i -mtune=generic
存在しないディレクトリ \
&quot;/usr/lib/gcc/i386-redhat-linux/4.1.2/../../../../i386-redhat-linux/include&quot; \
を無視します
#include &quot;...&quot; の探索はここから始まります:
#include &lt;...&gt; の探索はここから始まります:
 /usr/local/include
 /usr/lib/gcc/i386-redhat-linux/4.1.2/include
 /usr/include
探索リストの終わり

$
</pre>
<p class="paragraph">
※CentOS 5.2 の場合、cppコマンドは &quot;cpp&quot; というRPMパッケージに&quot;cc1&quot;と併せて収録されている。では&quot;cpp&quot;パッケージは&quot;gcc&quot;とは別物か？となるが、RPMパッケージ情報を調べると下記の通り Source RPMは&quot;gcc&quot;になっている。RPMパッケージングの際に、バージョニングの都合などで分離されたものと思われる(cc1まで入れてしまったら分離する意味が無いような気もするが・・・)。
<br />
</p>
<pre>$ rpm -qi cpp
Name        : cpp                          Relocations: (not relocatable)
Version     : 4.1.2                             Vendor: CentOS
Release     : 42.el5                        Build Date: 2008年05月27日 07時17分35秒
Install Date: 2008年08月02日 13時40分43秒      Build Host: builder16.centos.org
Group       : Development/Languages         Source RPM: gcc-4.1.2-42.el5.src.rpm
                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^
</pre>

<h5 id="id28f6be">&quot;-S&quot; : アセンブラまで</h5>

<p class="paragraph">
&quot;-S&quot;オプションを指定すると、アセンブラまでが実行される。
<br />
</p>
<pre class="plugin_pre">
$ ls
hello.c  hello.i

$ gcc -v -S hello.i
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure --prefix=/usr (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/cc1 -fpreprocessed hello.i -quiet \
     -dumpbase hello.i -mtune=generic -auxbase hello -version -o hello.s
GNU C version 4.1.2 20071124 (Red Hat 4.1.2-42) (i386-redhat-linux)
        compiled by GNU C version 4.1.2 20071124 (Red Hat 4.1.2-42).
GGC heuristics: --param ggc-min-expand=64 --param ggc-min-heapsize=64436
Compiler executable checksum: 6b8fcfb678815bd99e272234accc87cd

$ ls
hello.c  hello.i  hello.s
</pre>

<p class="paragraph">
この後、&quot;-c&quot;オプションでオブジェクトファイルの生成までを行える。
<br />
</p>
<pre class="plugin_pre">
$ gcc -v -c hello.s
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure --prefix=/usr (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 as -V -Qy -o hello.o hello.s
GNU assembler version 2.17.50.0.6-6.el5 (i386-redhat-linux) using BFD version 2.17.50.0.6-6.el5 20061020

$ ls
hello.c  hello.i  hello.o  hello.s
</pre>

<p class="paragraph">
最後にオブジェクトファイルを入力として、実行形式のファイルを作成する。
<br />
</p>
<pre class="plugin_pre">
$ gcc -o hello hello.o
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure --prefix=/usr (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/collect2 (...)
$ ls
hello*  hello.c  hello.i  hello.o  hello.s
$ ./hello
Hello, World!
</pre>

<h4 id="ide89d8b">&quot;-I&quot;, &quot;-L&quot;, &quot;-l&quot;オプション</h4>

<p class="paragraph">
&quot;#include&quot;パスの追加指定は&quot;-I&quot;オプションを使う。
<br />
</p>
<pre>gcc (...) -I/usr/include/xxxyyy -I/opt/include/zzzz (...)
</pre>

<p class="paragraph">
コンパイル時の&quot;*.so&quot;のディレクトリ指定は&quot;-L&quot;オプションを使う。
<br />
</p>
<pre>gcc (...) -L/usr/lib/xxxyyyy (...)
</pre>

<p class="paragraph">
&quot;libxyz(.&lt;major&gt;.&lt;minor&gt;.&lt;minor2&gt;).so&quot;を指定したい場合は、&quot;-l&quot;オプションで&quot;xyz&quot;の部分だけを指定する。
<br />
</p>
<pre>gcc (...) -lxyz (...)
</pre>

<p class="paragraph">
&quot;-I&quot;, &quot;-L&quot;, &quot;-l&quot; 共に、値との間に空白は挟まない。
<br />
</p>
<pre>NG:
gcc (...) -I /usr/include/xxyyzz (...)
            ^
</pre>

<h4 id="ida60b40">ライブラリの作成とリンク例</h4>

<p class="paragraph">
静的・動的のそれぞれの作成とリンクのサンプルを載せる。（なお、以降出てくるgccのオプションで&quot;-Wall&quot;が付いていないのはサンプルだから、ということでご了承願います）
<br />
</p>

<p class="paragraph">
ソースコード構成：
<br />
</p>
<pre>$ ls
calc/  call_calc.c
$ ls calc/
calc.h  calc1.c  calc2.c
</pre>

<p class="paragraph">
call_calc.c:
<br />
</p>
<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&lt;</span><span class="hl-string">stdio.h</span><span class="hl-quotes">&gt;</span><span ></span><span class="hl-code">
</span><span >#include</span><span > </span><span class="hl-quotes">&quot;</span><span class="hl-string">calc.h</span><span class="hl-quotes">&quot;</span><span ></span><span class="hl-code">
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">main</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argc</span><span class="hl-code">, </span><span >char</span><span class="hl-code"> **</span><span class="hl-identifier">argv</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code"> = </span><span class="hl-number">1</span><span class="hl-code">;
        </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">y</span><span class="hl-code"> = </span><span class="hl-number">2</span><span class="hl-code">;
        </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">z1</span><span class="hl-code"> = </span><span class="hl-identifier">calc1</span><span class="hl-brackets">(</span><span class="hl-identifier">x</span><span class="hl-code">, </span><span class="hl-identifier">y</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">z2</span><span class="hl-code"> = </span><span class="hl-identifier">calc2</span><span class="hl-brackets">(</span><span class="hl-identifier">x</span><span class="hl-code">, </span><span class="hl-identifier">y</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">calc1(%d, %d) = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">x</span><span class="hl-code">, </span><span class="hl-identifier">y</span><span class="hl-code">, </span><span class="hl-identifier">z1</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">calc2(%d, %d) = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">x</span><span class="hl-code">, </span><span class="hl-identifier">y</span><span class="hl-code">, </span><span class="hl-identifier">z2</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<p class="paragraph">
calc/calc.h:
<br />
</p>
<div class="hl-main"><pre><span >int</span><span class="hl-code"> </span><span class="hl-identifier">calc1</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">calc2</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
calc/calc1.c: (足し算)
<br />
</p>
<div class="hl-main"><pre><span >int</span><span class="hl-code"> </span><span class="hl-identifier">calc1</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>
<p class="paragraph">
calc/calc1.c: (掛け算)
<br />
</p>
<div class="hl-main"><pre><span >int</span><span class="hl-code"> </span><span class="hl-identifier">calc2</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> * </span><span class="hl-identifier">b</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<p class="paragraph">
calc1, calc2を含んだライブラリを静的・動的それぞれのパターンで作成し、call_calc.cとリンクさせてみる。
<br />
</p>

<h5 id="id36df0d">静的ライブラリの作成とリンク</h5>

<p class="paragraph">
binutilsのarコマンドでlibcalc.aを生成する。&quot;-r&quot;で格納するアーカイブファイル名を指定する。&quot;-s&quot;オプションで、リンクを早くする為に予め索引を作っておく。作成された索引は &quot;nm -s&quot; で確認できる。
<br />
</p>
<pre class="plugin_pre">
$ cd ./calc
$ ls
calc.h  calc1.c  calc2.c
$ gcc -c -o calc1_nofpic.o calc1.c
$ gcc -c -o calc2_nofpic.o calc2.c
$ ar -s -r libcalc.a calc1_nofpic.o calc2_nofpic.o
ar: creating libcalc.a
$ ar t libcalc.a
calc1_nofpic.o
calc2_nofpic.o
[msakamoto@akane calc]$ nm -s libcalc.a

Archive index:
calc1 in calc1_nofpic.o
calc2 in calc2_nofpic.o

calc1_nofpic.o:
00000000 T calc1

calc2_nofpic.o:
00000000 T calc2

$ ls
calc.h  calc1.c  calc1_nofpic.o  calc2.c  calc2_nofpic.o  libcalc.a
</pre>

<p class="paragraph">
続いてcall_calc.cをコンパイル・リンクする。&quot;-I&quot;でcalc.hのあるディレクトリを指定する。リンク時には、libcalc.aを後ろに指定する。
<br />
</p>
<pre class="plugin_pre">
$ cd ../
$ ls
calc  call_calc.c

$ gcc -Wall -I./calc -c -o call_calc.o call_calc.c

$ ls
calc  call_calc.c  call_calc.o

$ gcc -v -o call_calc_static call_calc.o ./calc/libcalc.a
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/collect2 \
     (...) -o call_calc_static (...) call_calc.o ./calc/libcalc.a (...)

$ ls
calc  call_calc.c  call_calc.o  call_calc_static*

$ ./call_calc_static
calc1(1, 2) = 3
calc2(1, 2) = 2
</pre>

<h5 id="idb4c611">動的ライブラリの作成とリンク</h5>

<p class="paragraph">
calc1.c, calc2.cを &quot;-fPIC&quot; 付で位置独立コードとしてコンパイルする。
<br />
</p>
<pre class="plugin_pre">
$ cd ./calc
$ ls
calc.h  calc1.c  calc1_nofpic.o  calc2.c  calc2_nofpic.o  libcalc.a
$ gcc -fPIC -c -o calc1_pic.o calc1.c
$ gcc -fPIC -c -o calc2_pic.o calc2.c
$ gcc -shared -o libcalc.so calc1_pic.o calc2_pic.o
$ ls
calc.h
calc1.c  calc1_nofpic.o  calc1_pic.o
calc2.c  calc2_nofpic.o  calc2_pic.o
libcalc.a
libcalc.so*
</pre>
<p class="paragraph">
※今回のサンプルでは&quot;-Wl,-soname=xxxx&quot;は使わない。後日このオプションについて検証する。
<br />
</p>

<p class="paragraph">
続いてcall_calc.cをコンパイル・リンクする。&quot;-I&quot;でcalc.hのあるディレクトリを指定する。リンク時には、&quot;-L&quot;でlibcalc.soの存在するディレクトリを指定し、&quot;-l&quot;でライブラリ名(&quot;calc&quot;)を指定する。今回はシステムのライブラリディレクトリにはインストールしないので、一時的にLD_LIBRARY_PATHでlibcalc.soがあるディレクトリを指定し、実行する。
<br />
</p>
<pre class="plugin_pre">
$ cd ../
$ ls
calc  call_calc.c  call_calc.o  call_calc_static*

$ gcc -v -L./calc -lcalc -o call_calc_so call_calc.o
Using built-in specs.
Target: i386-redhat-linux
コンフィグオプション: ../configure (...)
スレッドモデル: posix
gcc バージョン 4.1.2 20071124 (Red Hat 4.1.2-42)
 /usr/libexec/gcc/i386-redhat-linux/4.1.2/collect2 (...) \
 -o call_calc_so (...) -L./calc (...) -lcalc call_calc.o (...)

$ export LD_LIBRARY_PATH=./calc; ./call_calc_so
calc1(1, 2) = 3
calc2(1, 2) = 2
</pre>

<h4 id="id07f134">&quot;-Wa,...&quot;, &quot;-Wl,...&quot;</h4>

<p class="paragraph">
gcc-4.1.2 のmanページから抜粋：
<br />
</p>
<pre>-Wa,option
    option  をアセンブラに対するオプションとして渡します。
    option がコンマを含む場合は、そのコンマで区切られた複数のオプションとして与えられます。
-Wl,option
    オプション option をリンカに渡します。
    option がコンマを含む場合は、それらのコンマで複数のオプションとして分割されます。
</pre>

<h3 id="id87aadd">TIPS</h3>

<p class="paragraph">
他、書籍・雑誌記事・Webなどから拾い読みしたTIPSなど。
<br />
</p>

<p class="paragraph">
gccオプション：
<br />
</p>
<pre>-print-prog-name=XXXXX : gccがkickする外部コマンドの絶対パス表示
-Wall : 全ての警告を表示
-Werror : 警告をエラーと見なす
</pre>

<p class="paragraph">
cppオプション：
<br />
</p>
<pre>-H : indent形式でインクルードの状況を表示
-M : Makefile形式で外部依存ファイルリストを表示
-dM : 全てのマクロ定義文表示。空のファイルを読ませれば、ビルトイン定義を表示してくれる。
-nostdinc : ヘッダーファイル検索パスを初期化
-v : 詳細表示
</pre>


<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-786.html" title="C言語系/memos/binutils">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-843.html" title="C言語系/memos/gcc/舞台裏を知りたいときのヒント集メモ">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/479<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>