<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/Linux/CentOS/CentOS6でのcron, anacron - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/Linux/CentOS/CentOS6でのcron, anacron</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2014-09-22 19:58:20 &nbsp; / &nbsp; last updated at: 2014-09-22 19:58:51<br>
カテゴリ: <a href="category-20.html">Linux</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1257.html" title="技術/Linux/CentOS/512MB以下のメモリ搭載マシンにインストールメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1320.html" title="技術/Linux/CentOS/CentOS6系でのyum-cronによるパッケージ自動更新">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
以前、ローカルでCentOS 6.3をDVDイメージからセットアプしたときは気づかなかったが、最近AWSのEC2で、Marketplace提供のCentOS 6.4 or 6.5のAMIを使ってみたら気づいた。
<br />
</p>

<h3 id="idd719ed">cronとanacronの違い</h3>

<dl>
<dt>cron</dt>
<dd>指定された時間と間隔でジョブを実行する。分単位で指定できる。マシンが起動している間のみ、ジョブを実行する。</dd>
<dt>anacron</dt>
<dd>指定された日数間隔でジョブを実行する。マシンが停止していたら、その間の日数を計算してジョブを実行する。</dd>
</dl>

<p class="paragraph">
実行形態
<br />
</p>
<ul><li> cron : デーモンとして常時起動している。</li>
<li> anacron : anacron自体は常時起動せず、cronからcron.hourlyなどで定期的に起動される。</li></ul>

<p class="paragraph">
cronとanacronの違いの例として、毎日 03:00 に実行するジョブをcronとanacronとでそれぞれ登録してみる。anacronは毎時5分に &quot;/etc/cron.hourly&quot; ディレクトリ以下のスクリプトにより、cronから実行される。
<br />
</p>

<p class="paragraph">
/etc/crontab
<br />
</p>
<pre>0 3 * * * root /foo/bar/job.sh
</pre>
<p class="paragraph">
/etc/anacrontab
<br />
</p>
<pre>...
# anacronの場合は、ぴったり何時に実行ではなく、実行する時間帯を指定。3時-5時に設定。
START_HOURS_RANGE=3-5
#period in days   delay in minutes   job-identifier   command
1                 5                  foo.job          /foo/bar/job2.sh
</pre>

<p class="paragraph">
メンテナンスのため00:00 - 04:00 までそのマシンが停止するケースだと、以下のような動きになる。
<br />
</p>
<pre class="plugin_pre">
00:00 - マシンシャットダウン

03:00 - シャットダウン中なので、cronもanacronも実行されない。

04:00 - マシン起動

04:05 - cron.hourlyによりanacronが実行される。
        → START_HOURS_RANGE内なので、&quot;foo.job&quot;の前回起動した日時を
        /var/spool/anacron/(job-identifier) ファイルから読み取り、
        &quot;period in days&quot; 経過していれば実行する。
</pre>

<p class="paragraph">
このように、cronではジョブ実行時間帯にマシンが停止していればそのジョブは実行されない。
<br />
anacronであれば、日数間隔で大雑把にはなるが、マシンが起動したあとの最初のanacron実行時に、停止している間に実行されるべきだったジョブを実行できる。
<br />
</p>

<h3 id="id4de018">最新 CentOS 6 での cron, anacron パッケージ状況</h3>

<p class="paragraph">
cron が、vixie-cron から Fedoraプロジェクトでforkされた cronie というパッケージに変更されている。
<br />
</p>

<p class="paragraph">
CentOS 6.4 AWS Marketplace AMI (yum update後)：
<br />
</p>
<pre># rpm -qa | grep cron
cronie-1.4.4-12.el6.x86_64
crontabs-1.10-33.el6.noarch
cronie-anacron-1.4.4-12.el6.x86_64
</pre>

<h4 id="id13c083">cronie, crontabsパッケージ</h4>

<p class="paragraph">
crondデーモン本体を cronie が、スケルトンの crontab ファイル・ディレクトリを crontabsパッケージが提供している。
<br />
</p>

<pre class="plugin_pre">
# rpm -ql cronie
/etc/cron.d/0hourly
/etc/cron.deny
/etc/pam.d/crond
/etc/rc.d/init.d/crond
/etc/sysconfig/crond
/usr/bin/crontab
/usr/sbin/crond
...
/var/spool/cron
</pre>

<p class="paragraph">
/etc/cron.d/0hourly:
<br />
</p>
<pre>SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/
01 * * * * root run-parts /etc/cron.hourly
</pre>

<p class="paragraph">
crontabsパッケージの内容：
<br />
</p>
<pre># rpm -ql crontabs
/etc/cron.daily
/etc/cron.hourly
/etc/cron.monthly
/etc/cron.weekly
/etc/crontab
/usr/bin/run-parts
/usr/share/man/man4/crontabs.4.gz
</pre>

<p class="paragraph">
/etc/crontab:
<br />
</p>
<pre class="plugin_pre">
# more /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
HOME=/

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed

</pre>

<h4 id="id852ccb">cronie-anacronパッケージ</h4>

<p class="paragraph">
anacronの実行ファイルと、デフォルトの、cron.hourlyでanacronを実行するためのcron設定ファイルが cronie-anacronパッケージでインストールされる。
<br />
</p>

<pre># rpm -ql cronie-anacron
/etc/anacrontab
/etc/cron.hourly/0anacron
/usr/sbin/anacron
/usr/share/man/man5/anacrontab.5.gz
/usr/share/man/man8/anacron.8.gz
/var/spool/anacron
/var/spool/anacron/cron.daily
/var/spool/anacron/cron.monthly
/var/spool/anacron/cron.weekly
</pre>

<p class="paragraph">
/etc/anacrontab:
<br />
</p>
<pre class="plugin_pre">
# more /etc/anacrontab
# /etc/anacrontab: configuration file for anacron

# See anacron(8) and anacrontab(5) for details.

SHELL=/bin/sh
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# the maximal random delay added to the base delay of the jobs
RANDOM_DELAY=45
# the jobs will be started during the following hours only
START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7      25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45    cron.monthly            nice run-parts /etc/cron.monthly
</pre>

<p class="paragraph">
デフォルトでは START_HOURS_RANGE が 3時～22時と非常に広いレンジになっている。
<br />
考え方としては、CentOSをインストールしたのが 3時～22時の間であればその間のcron.hourlyにより、最初のanacronジョブが実行される。
<br />
23時以降も cron.hourly で起動されるが、START_HOURS_RANGE外なのでジョブは実行されない。
<br />
3時になって cron.hourly によりanacronが実行されると、START_HOURS_RANGE内に入ったので、ジョブが実行される。
<br />
そのさい、&quot;delay in minutes&quot; で遅延した後に、さらにRANDOM_DELAYで指定した分数の間、ランダムの分で遅延してジョブが実行される。
<br />
</p>

<h3 id="id4e509a">CentOS 6 での cron, anacron 実行順序の整理</h3>

<p class="paragraph">
整理すると、以下のように事実上、anacronが &quot;/etc/cron.daily&quot;, &quot;/etc/cron.weekly&quot;, &quot;/etc/cron.monthly&quot; を実行している。
<br />
</p>

<pre>/etc/crontab : 空っぽ
/etc/cron.d/
    0hourly : 毎時1分に &quot;/etc/cron.hourly&quot; 以下を実行
/etc/cron.hourly/
    0anacron : anacron 実行
</pre>
<p class="paragraph">
→ crond自身は上記まで、つまり &quot;/etc/cron.d/0hourly&quot; 経由で &quot;/etc/cron.hourly/&quot; までがcrondの範囲。
<br />
&quot;/etc/cron.(daily|weekly|monthly)&quot; は、以下のようにanacron経由で実行される。
<br />
/etc/anacrontab:
<br />
</p>
<pre class="plugin_pre">
...
START_HOURS_RANGE=3-22

#period in days   delay in minutes   job-identifier   command
1       5       cron.daily              nice run-parts /etc/cron.daily
7      25      cron.weekly             nice run-parts /etc/cron.weekly
@monthly 45    cron.monthly            nice run-parts /etc/cron.monthly
</pre>

<h3 id="id795e87">CentOS5時代のcrondのみによる制御に戻すには</h3>

<p class="paragraph">
cronie-noanacronをインストールして、代わりにcronie-anacronを削除すれば良いらしい。
<br />
</p>
<pre>yum install cronie-noanacron
yum remove cronie-anacron
</pre>


<h3 id="id6ac176">参考リンク</h3>

<ul><li> <a class="externallink" href="https://fedorahosted.org/cronie/" target="_blank">https://fedorahosted.org/cronie/</a><ul><li> Fedoraで分岐したcronieの開発サイト</li></ul></li></ul>

<ul><li> anacronふたたび。（「RHEL6で悩ましい諸々」シリーズ） - めもめも<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/enakai00/20111004/1317718773" target="_blank">http://d.hatena.ne.jp/enakai00/20111004/1317718773</a></li></ul></li>
<li> cronとanacronとRHEL5系6系 | ツチノコブログ<ul><li> <a class="externallink" href="http://tsuchinoko.dmmlabs.com/?p=791" target="_blank">http://tsuchinoko.dmmlabs.com/?p=791</a></li></ul></li>
<li> CentOS6以降でcron.dailyなどが適当な時間で起動するのを変更する | Hack<ul><li> <a class="externallink" href="http://hack.aipo.com/archives/420/" target="_blank">http://hack.aipo.com/archives/420/</a></li></ul></li>
<li> ALL about Linux: CentOS6 の cron.daily 実行時刻を CentOS5 以前と同様に設定する<ul><li> <a class="externallink" href="http://luna2-linux.blogspot.jp/2013/01/centos6-crondaily-centos5.html" target="_blank">http://luna2-linux.blogspot.jp/2013/01/centos6-crondaily-centos5.html</a></li></ul></li>
<li> CentOS 6.2 crondとanacronの関係について調べてみた - gitrhythm.net<ul><li> <a class="externallink" href="https://gitrhythm.heroku.com/blog/2012/02/20/centos62-crond-and-anacron/" target="_blank">https://gitrhythm.heroku.com/blog/2012/02/20/centos62-crond-and-anacron/</a></li></ul></li>
<li> RHEL 6のジョブスケジューラ「anacron」とは　Part1 | 技術ブログ| レック・テクノロジー・コンサルティング株式会社<ul><li> <a class="externallink" href="http://www.reqtc.com/column/anacron1.html" target="_blank">http://www.reqtc.com/column/anacron1.html</a></li></ul></li>
<li> OSSはアルミニウムの翼で飛ぶ: RHEL6 (7)cronとanacron<ul><li> <a class="externallink" href="http://aikotobaha.blogspot.jp/2011/02/rhel6-7cronanacron.html" target="_blank">http://aikotobaha.blogspot.jp/2011/02/rhel6-7cronanacron.html</a></li></ul></li>
<li> CentOS6.4のCronインストール・URLを自動実行 | WebEngineeer<ul><li> <a class="externallink" href="http://www.webengineeer.com/cron/" target="_blank">http://www.webengineeer.com/cron/</a></li></ul></li>
<li> CentOS6でanacronの時間を夜間のみに限定する | Hack<ul><li> <a class="externallink" href="http://hack.aipo.com/archives/3171/" target="_blank">http://hack.aipo.com/archives/3171/</a></li></ul></li></ul>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1257.html" title="技術/Linux/CentOS/512MB以下のメモリ搭載マシンにインストールメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1320.html" title="技術/Linux/CentOS/CentOS6系でのyum-cronによるパッケージ自動更新">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1319<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>