<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2012/09/30/Apache IvyとローカルのMavenリポジトリの連携 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2012/09/30/Apache IvyとローカルのMavenリポジトリの連携</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2012-09-30 17:18:47 &nbsp; / &nbsp; last updated at: 2012-09-30 17:31:32<br>
カテゴリ: <a href="category-67.html">Ivy</a>&nbsp;<a href="category-62.html">Maven</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
Apache Ivyを触ってみました。
<br />
</p>

<ul><li> Home | Apache Ivy(TM)<ul><li> <a class="externallink" href="http://ant.apache.org/ivy/index.html" target="_blank">http://ant.apache.org/ivy/index.html</a></li></ul></li></ul>

<p class="paragraph">
入門編としては以下のBlogが大変参考になりました：
<br />
</p>
<ul><li> Apache Ivyの紹介と基本的な使い方 - 達人プログラマーを目指して<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/ryoasai/20110101/1293904479" target="_blank">http://d.hatena.ne.jp/ryoasai/20110101/1293904479</a></li></ul></li></ul>

<p class="paragraph">
Apache Ivyは依存関係のjarを取得する点に専念しており、その分Mavenのような複雑さはありません。Antが使えるのであればすんなりと入っていけると思います。Antならではの細かいカスタマイズに応えてくれます。その点で、Mavenを適用できないレガシーなプロジェクトであったり、依存関係の処理にMavenでは対応しきれない特殊な部分が出てくるようなプロジェクトには最適です。
<br />
</p>

<p class="paragraph">
今回試したのは、「MavenのローカルリポジトリをIvyから参照する」です。
<br />
</p>




<h3 id="id2bbb0f">Ivyの&quot;cache&quot;ディレクトリについて</h3>

<p class="paragraph">
実は当初勘違いしていて、Ivyって依存関係を&quot;.ivy&quot;とかにDLして、そこに全部jarを保存しておいてくれるものかと思ってました。Mavenの&quot;.m2/repository/&quot;みたいな感じで、classpathは適当にAntのbuild.xml中で自動解決してくれる～みたいな。
<br />
しかしこれは完全な勘違いで、Ivyのメインはあくまでも依存関係を「ダウンロード」することにあります。classpathの調整はやってくれないんですね。じゃあどう使うのかというと、Antプロジェクトの中に&quot;lib&quot;ディレクトリを作っておいて、&quot;&lt;ivy:retrieve/&gt;&quot;を実行することでその中にjarをダウンロードしてくれます。
<br />
</p>

<p class="paragraph">
ですが、複数のいろいろなプロジェクトで&quot;&lt;ivy:retrieve/&gt;&quot;するたびに毎回リポジトリからDLするのは通信の無駄が発生します。
<br />
というわけで、Ivyは一旦&quot;$HOME/.ivy2/cache/&quot;ディレクトリ以下にjarなどのDLファイルをキャッシュします。
<br />
&quot;&lt;ivy:retrieve/&gt;&quot;でプロジェクトローカルの&quot;lib/&quot;には、まずこのキャッシュを見に行って、無ければMavenなどのリポジトリに取りに行くようです。
<br />
</p>

<p class="paragraph">
逆に言えば、一旦、ひと通りのプロジェクトで&quot;&lt;ivy:retrieve/&gt;&quot;してしまえばキャッシュは不要です。ということで、ディスクスペースの節約のためにキャッシュをクリアしましょう・・・ということで&quot;&lt;ivy:cleancache/&gt;&quot;というタスクが提供されています。これを使うと &quot;$HOME/.ivy2/cache/&quot; 以下が空っぽになります。
<br />
</p>

<h3 id="idc94241">Mavenのローカルリポジトリとの連携について</h3>

<p class="paragraph">
ここも勘違いしてたところがありまして、当初 &quot;$HOME/.ivy2/cache/&quot; って永続的なものかと思ってました。なので、「う～ん、Mavenも使ってたら &quot;$HOME/.m2/repository/&quot; と &quot;$HOME/.ivy2/cache/&quot; で重複してるので無駄だよな～、&quot;.ivy2/cache/&quot; を &quot;.m2/repository/&quot; で使い回しできないかな？」と思ったんです。
<br />
</p>

<p class="paragraph">
ですが上記の通り &quot;.ivy2/cache/&quot; はあくまでもキャッシュであるため、いつかは &quot;&lt;ivy:cleancache/&gt;&quot; でクリアされてしまうんです。
<br />
一応技術的には &quot;.m2/repository/&quot; を &quot;.ivy2/cache/&quot; に使い回しも出来るようなんですが・・・<strong>しかしそんなことをしてしまうと、うっかり &quot;&lt;ivy:cleancache/&gt;&quot; するとそれまでせっかく蓄積されたMavenのローカルリポジトリがゼロクリアされてしまう</strong>んですよね。いやまぁ、また自動でDLされるんだからいいじゃん、と言えばそうなんですが。
<br />
</p>

<p class="paragraph">
じゃぁどこでIvyとMavenのローカルリポジトリは連携するのか？ですが、単純にIvyが依存関係を探すリポジトリとして &quot;.m2/repository/&quot; を追加する、という連携方法になります。
<br />
あり得るパターンとしてはMavenで構築した自作ライブラリを&quot;mvn install&quot;で &quot;.m2/repository/&quot; 以下にインストールして、それをIvyで取りに行く、みたいな感じでしょうか。
<br />
</p>

<p class="paragraph">
ぶっちゃけ &quot;&lt;ivy:cleancache/&gt;&quot; で &quot;.ivy2/cache/&quot; 以下をクリアしたとしても、プロジェクトローカルには &quot;.jar&quot; ファイルが置かれてしまうので、Mavenも使ってたらどっちにしてもjarファイルは重複して存在してしまいます。
<br />
しかしそもそもIvyを使う目的は「Mavenでは歯が立たない様な依存関係の解決」にあり、どうしてもそうなるとプロジェクトローカルに&quot;.jar&quot;を置く、という流れになってしまうので、これはもう逃れられない訳です。それが嫌ならMavenにせーよ、という。
<br />
</p>

<p class="paragraph">
ちなみにプロジェクトローカルにjarをDLするというIvyの流れ上、依存対象のjarがアップデートされても自動的には同期してくれません。バージョン番号変えるとか、一旦 &quot;&lt;ivy:cleancache/&gt;&quot; するとか、他にも更新チェック用の細かい設定があったりするようです。そのへんは今回は試してません。
<br />
</p>

<p class="paragraph">
参考：
<br />
</p>
<ul><li> Use maven repository as local ivy cache - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/6216224/use-maven-repository-as-local-ivy-cache" target="_blank">http://stackoverflow.com/questions/6216224/use-maven-repository-as-local-ivy-cache</a></li></ul></li>
<li> java - Apache Ivy: Difference between local Ivy cache and local repository - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/9366281/apache-ivy-difference-between-local-ivy-cache-and-local-repository" target="_blank">http://stackoverflow.com/questions/9366281/apache-ivy-difference-between-local-ivy-cache-and-local-repository</a></li></ul></li>
<li> java - ivysettings.xml: add local maven path - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/8617963/ivysettings-xml-add-local-maven-path" target="_blank">http://stackoverflow.com/questions/8617963/ivysettings-xml-add-local-maven-path</a></li></ul></li></ul>


<h3 id="id8dd157">実際に &quot;.m2/repository/&quot; にインストールしたjarをIvyでDLしてみる</h3>

<p class="paragraph">
というわけで試してみました。
<br />
環境：
<br />
</p>
<pre>Win7-SP1 64bit
JDK 1.7.0_07, 64bit Oracle JVM
Apache Maven 3.0.4 (r1232337; 2012-01-17 17:44:56+0900)
Apache Ant(TM) version 1.8.2 compiled on December 20 2010
Apache Ivy 2.2.0
</pre>

<h4 id="id4337e6">まずMavenでjarを作ります。</h4>

<p class="paragraph">
&quot;mvnjartest&quot;という名前でMavenプロジェクトを作ってみました。
<br />
</p>

<p class="paragraph">
commons-langに依存させます。
<br />
</p>

<p class="paragraph">
mvnjartest/pom.xml:
<br />
</p>
<pre class="plugin_pre">
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;mvntest&lt;/groupId&gt;
  &lt;artifactId&gt;mvnjartest&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;mvnjartest&lt;/name&gt;
  &lt;url&gt;http://maven.apache.org&lt;/url&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;commons-lang&lt;/groupId&gt;
      &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
      &lt;version&gt;2.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;3.8.1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;
</pre>

<p class="paragraph">
ライブラリの動作としては、文字列をcapitalizeしたものを返します。
<br />
</p>

<p class="paragraph">
src/main/java/mvnjartest/App.java:
<br />
</p>
<div class="hl-main"><pre><span class="hl-reserved">package</span><span class="hl-code"> </span><span class="hl-identifier">mvnjartest</span><span class="hl-code">;
 
</span><span class="hl-reserved">import</span><span class="hl-code"> </span><span class="hl-identifier">org</span><span class="hl-code">.</span><span class="hl-identifier">apache</span><span class="hl-code">.</span><span class="hl-identifier">commons</span><span class="hl-code">.</span><span class="hl-identifier">lang</span><span class="hl-code">.</span><span class="hl-identifier">WordUtils</span><span class="hl-code">;
 
</span><span class="hl-reserved">public</span><span class="hl-code"> </span><span class="hl-reserved">class</span><span class="hl-code"> </span><span class="hl-identifier">App</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">String</span><span class="hl-code"> </span><span class="hl-identifier">message</span><span class="hl-code">;
    </span><span class="hl-reserved">public</span><span class="hl-code"> </span><span class="hl-identifier">App</span><span class="hl-brackets">(</span><span class="hl-identifier">String</span><span class="hl-code"> </span><span class="hl-identifier">m</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">this</span><span class="hl-code">.</span><span class="hl-identifier">message</span><span class="hl-code"> = </span><span class="hl-identifier">m</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-reserved">public</span><span class="hl-code"> </span><span class="hl-identifier">String</span><span class="hl-code"> </span><span class="hl-identifier">capitalize</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">WordUtils</span><span class="hl-code">.</span><span class="hl-identifier">capitalizeFully</span><span class="hl-brackets">(</span><span class="hl-identifier">message</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span></pre></div>

<p class="paragraph">
(testは省略)
<br />
</p>

<p class="paragraph">
ビルドしてローカルリポジトリにインストールします。
<br />
</p>
<pre>&gt; mvn install
</pre>

<p class="paragraph">
以下のようなディレクトリ構成でインストールされました。
<br />
</p>
<pre>&quot;$HOME/.m2/repository/
    mvntest/
        mvnjartest/
            maven-metadata-local.xml
            1.0-SNAPSHOT/
                _maven.repositories
                maven-metadata-local.xml
                mvnjartest-1.0-SNAPSHOT.jar
                mvnjartest-1.0-SNAPSHOT.pom
</pre>


<h4 id="id660e14">上で作ったjarをIvyでDLしてくるサンプルアプリを作ります。</h4>

<p class="paragraph">
&quot;mvnjartest-1.0-SNAPSHOT.jar&quot;をIvyでDLしてくるサンプルを &quot;resolv-test&quot; というプロジェクト名で作ってみました。
<br />
</p>

<p class="paragraph">
まず依存性を定義する ivy.xml を用意します。
<br />
resolv-test/ivy.xml:
<br />
</p>
<pre class="plugin_pre">
&lt;ivy-module version=&quot;1.0&quot;&gt;
    &lt;info organisation=&quot;ivytest&quot; module=&quot;resolv-test&quot;/&gt;
    &lt;dependencies&gt;
        &lt;dependency org=&quot;commons-lang&quot; name=&quot;commons-lang&quot; rev=&quot;2.0&quot; conf=&quot;default&quot;/&gt;
        &lt;dependency org=&quot;mvntest&quot; name=&quot;mvnjartest&quot; rev=&quot;1.0-SNAPSHOT&quot; conf=&quot;default&quot;/&gt;
    &lt;/dependencies&gt;
&lt;/ivy-module&gt;
</pre>

<p class="paragraph">
続いて、&quot;$HOME/.m2/repository/&quot; をリポジトリて参照する設定を ivysettigs.xml として用意します。
<br />
resolv-test/ivysettings.xml:
<br />
</p>
<pre class="plugin_pre">
&lt;ivysettings&gt;
  &lt;property name=&quot;local-m2-dir&quot; value=&quot;${user.home}/.m2/repository/&quot; /&gt;
  &lt;settings defaultResolver=&quot;chain-to-m2local&quot;/&gt;
  &lt;resolvers&gt;
    &lt;chain name=&quot;chain-to-m2local&quot;&gt;
      &lt;filesystem name=&quot;local-m2-repo&quot; m2compatible=&quot;true&quot; local=&quot;true&quot;&gt;
        &lt;artifact pattern=&quot;${local-m2-dir}/[organisation]/[module]/[revision]/[module]-[revision].[ext]&quot; /&gt;
        &lt;ivy pattern=&quot;${local-m2-dir}/[organisation]/[module]/[revision]/[module]-[revision].pom&quot; /&gt;
      &lt;/filesystem&gt;
      &lt;ibiblio name=&quot;ibiblio&quot; m2compatible=&quot;true&quot; /&gt;
    &lt;/chain&gt;
  &lt;/resolvers&gt;
&lt;/ivysettings&gt;
</pre>

<p class="paragraph">
Ivyでは依存性の解決方法でStrategyパターンを採用しており、ファイルシステム上から取得する方法が提供されています。解決方法(resolver)の連鎖(chain)に、&quot;$HOME/.m2/repository/&quot; 以下を参照するfilesystem resolverを組み込んでいます。filesystem上になければibiblioから取得するresolverを追加しています。
<br />
</p>

<p class="paragraph">
&quot;ibiblio&quot;というのは、インターネット上にあるリソースをコレクションしたミラーサイトの一種のようです。ibiblioが提供しているミラーの中に、Mavenリポジトリが含まれています。
<br />
ibiblioについて：
<br />
</p>
<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/Ibiblio" target="_blank">http://en.wikipedia.org/wiki/Ibiblio</a></li>
<li> <a class="externallink" href="http://www.ibiblio.org/" target="_blank">http://www.ibiblio.org/</a></li>
<li> <a class="externallink" href="http://mirrors.ibiblio.org/maven2/" target="_blank">http://mirrors.ibiblio.org/maven2/</a><ul><li> Maven2のリポジトリ構成になってました。</li></ul></li></ul>

<p class="paragraph">
肝心のbuild.xmlです。build.xml中にjavaソースファイルも作成するように手抜きしてます。
<br />
resolv-test/build.xml:
<br />
</p>
<pre class="plugin_pre">
&lt;project name=&quot;resolv-test&quot; default=&quot;run&quot; xmlns:ivy=&quot;antlib:org.apache.ivy.ant&quot;&gt;
    &lt;property name=&quot;src.dir&quot; value=&quot;${basedir}/src&quot; /&gt;
    &lt;ivy:settings file=&quot;${basedir}/ivysettings.xml&quot; /&gt;
    &lt;property name=&quot;lib.dir&quot; value=&quot;${basedir}/lib&quot; /&gt;
    &lt;property name=&quot;build.dir&quot; value=&quot;${basedir}/build&quot; /&gt;

    &lt;path id=&quot;lib.path.id&quot;&gt;
        &lt;fileset dir=&quot;${lib.dir}&quot; /&gt;
    &lt;/path&gt;
    &lt;path id=&quot;run.path.id&quot;&gt;
        &lt;path refid=&quot;lib.path.id&quot; /&gt;
        &lt;path location=&quot;${build.dir}&quot; /&gt;
    &lt;/path&gt;

    &lt;target name=&quot;generate-src&quot; description=&quot;generate sample java source&quot;&gt;
        &lt;mkdir dir=&quot;${src.dir}/example&quot; /&gt;
        &lt;echo file=&quot;${src.dir}/example/Hello.java&quot;&gt;
package example;

import mvnjartest.App;

public class Hello {
    public static void main(String[] args) {
        App a = new App(&quot;hello world&quot;);
        System.out.println(a.capitalize());
    }
}
        &lt;/echo&gt;
    &lt;/target&gt;

    &lt;target name=&quot;resolve&quot; description=&quot;resolve and retrieve dependencies with ivy&quot;&gt;
        &lt;ivy:retrieve/&gt;
    &lt;/target&gt;

    &lt;target name=&quot;run&quot; depends=&quot;generate-src,resolve&quot; description=&quot;compile and run sample&quot;&gt;
        &lt;mkdir dir=&quot;${build.dir}&quot; /&gt;
        &lt;javac srcdir=&quot;${src.dir}&quot; destdir=&quot;${build.dir}&quot; classpathref=&quot;lib.path.id&quot; /&gt;
        &lt;java classpathref=&quot;run.path.id&quot; classname=&quot;example.Hello&quot;/&gt;
    &lt;/target&gt;

    &lt;target name=&quot;clean&quot; description=&quot;clean src and build directories&quot;&gt;
        &lt;delete includeemptydirs=&quot;true&quot; quiet=&quot;true&quot;&gt;
            &lt;fileset dir=&quot;${src.dir}&quot; /&gt;
            &lt;fileset dir=&quot;${build.dir}&quot; /&gt;
        &lt;/delete&gt;
    &lt;/target&gt;

    &lt;target name=&quot;clean-cache&quot; description=&quot;clean ivy cache&quot;&gt;
        &lt;ivy:cleancache /&gt;
    &lt;/target&gt;
&lt;/project&gt;
</pre>

<p class="paragraph">
antでデフォルトの&quot;run&quot;ターゲットを実行すると・・・
<br />
</p>
<ol><li> &quot;src/example/Hello.java&quot;を生成して、</li>
<li> &quot;lib/&quot; 以下にIvyで依存jarをDLして、</li>
<li> コンパイルして、実行します。</li></ol>

<p class="paragraph">
&quot;ant resolve&quot; でIvyの依存性解決だけを単体で動かしてみた時の出力：
<br />
</p>
<pre class="plugin_pre">
&gt; ant resolve
Buildfile: ...\resolv-test\build.xml

resolve:
[ivy:retrieve] :: Ivy 2.2.0 - 20100923230623 :: http://ant.apache.org/ivy/ ::
[ivy:retrieve] :: loading settings :: file = ...\resolv-test\ivysettings.xml
[ivy:retrieve] :: resolving dependencies :: ivytest#resolv-test;working@HOGEHOGE
[ivy:retrieve]  confs: [default]

[ivy:retrieve]  found commons-lang#commons-lang;2.0 in ibiblio
### ibiblioでcommons-langが見つかりました。

[ivy:retrieve]  found mvntest#mvnjartest;1.0-SNAPSHOT in local-m2-repo
[ivy:retrieve]  found commons-lang#commons-lang;2.1 in local-m2-repo
### &quot;$HOME/.m2/repository/&quot; 上からmvnjartestとcommons-langが見つかりました。
### commons-langについてはmvnjartestのビルド時点でDLしています。

[ivy:retrieve] downloading C:\Users\xxxx\.m2\repository\mvntest\mvnjartest\1.0-SNAPSHOT\mvnjartest-1.0-SNAPSHOT.jar...
[ivy:retrieve] .. (1kB)
[ivy:retrieve]  [SUCCESSFUL ] mvntest#mvnjartest;1.0-SNAPSHOT!mvnjartest.jar (18ms)
[ivy:retrieve] downloading C:\Users\xxxx\.m2\repository\commons-lang\commons-lang\2.1\commons-lang-2.1.jar ...
[ivy:retrieve] ..... (202kB)
[ivy:retrieve] .. (0kB)
[ivy:retrieve]  [SUCCESSFUL ] commons-lang#commons-lang;2.1!commons-lang.jar (103ms)
### 両方のjarファイルとも、ローカルからプロジェクトの&quot;lib/&quot;以下にコピーされました。

[ivy:retrieve] :: resolution report :: resolve 853ms :: artifacts dl 127ms
[ivy:retrieve]  :: evicted modules:
[ivy:retrieve]  commons-lang#commons-lang;2.0 by [commons-lang#commons-lang;2.1] in [default]
        ---------------------------------------------------------------------
        |                  |            modules            ||   artifacts   |
        |       conf       | number| search|dwnlded|evicted|| number|dwnlded|
        ---------------------------------------------------------------------
        |      default     |   3   |   3   |   3   |   1   ||   2   |   2   |
        ---------------------------------------------------------------------
[ivy:retrieve] :: retrieving :: ivytest#resolv-test
[ivy:retrieve]  confs: [default]
[ivy:retrieve]  2 artifacts copied, 0 already retrieved (204kB/21ms)

BUILD SUCCESSFUL
Total time: 1 second
</pre>


<p class="paragraph">
この時点で、mvnjartestとcommons-langのjarファイルは3箇所に重複して存在することになります。
<br />
</p>
<ol><li> &quot;$HOME/.m2/repository/&quot; 以下</li>
<li> &quot;$HOME/.ivy2/cache/&quot; 以下</li>
<li> &quot;resolv-test/lib/&quot; 以下</li></ol>

<p class="paragraph">
&quot;$HOME/.ivy2/cache/&quot;以下は、 &quot;&lt;ivy:cleancache/&gt;&quot;をトリガーする以下のターゲットで空っぽにします。
<br />
</p>
<pre>&gt; ant clean-cache
</pre>

<p class="paragraph">
これでjarファイルの重複は2箇所、Ivyの使用目的としては必要最低限になります。
<br />
もしもMavenを全く使用せず、開発マシン上にはAntとIvyのみがセットアップされているのであれば、&quot;$HOME/.m2/repository/&quot; も存在しないためjarファイルの重複は存在しなくなります。
<br />
</p>

<p class="paragraph">
・・・というところまで理解してれば、GroovyのGrapeで&quot;$HOME/.m2/repository/&quot;との連携方法も整理できるかな・・・。
<br />
</p>

<h4 id="id80d582">おまけ : ibiblio resolverだけでも&quot;$HOME/.m2/repository/&quot;を参照できました。</h4>

<p class="paragraph">
ivysettings.xml:
<br />
</p>
<pre class="plugin_pre">
&lt;ivysettings&gt;
  &lt;settings defaultResolver=&quot;chain-to-m2local&quot;/&gt;
  &lt;resolvers&gt;
    &lt;chain name=&quot;chain-to-m2local&quot;&gt;
      &lt;ibiblio name=&quot;local&quot; root=&quot;file:${user.home}/.m2/repository/&quot; m2compatible=&quot;true&quot;/&gt;
      &lt;ibiblio name=&quot;ibiblio&quot; m2compatible=&quot;true&quot; /&gt;
    &lt;/chain&gt;
  &lt;/resolvers&gt;
&lt;/ivysettings&gt;
</pre>

<p class="paragraph">
もともと&quot;m2compatible&quot;が有効なので、rootで指定したリソース以下をそのままMaven2リポジトリとして参照できるようです。なので、あとはrootで&quot;file:&quot;以下をローカルファイルシステムを指定するだけで ibiblio resolverでも解決できてしまうようです。
<br />
</p>

<p class="paragraph">
参考：
<br />
</p>
<ul><li> Groovy - Grape, &quot;Add your local Maven2 repository&quot;<ul><li> <a class="externallink" href="http://groovy.codehaus.org/Grape" target="_blank">http://groovy.codehaus.org/Grape</a></li></ul></li></ul>

<p class="paragraph">
何気に次のエントリのネタにしようとしてた内容・・・。
<br />
</p>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1099<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>