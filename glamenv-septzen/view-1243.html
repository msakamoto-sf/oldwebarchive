<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/Security/PKI,SSL,TLS/SSL, Certificate, Public Key Pinning - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/Security/PKI,SSL,TLS/SSL, Certificate, Public Key Pinning</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2013-11-24 15:22:06 &nbsp; / &nbsp; last updated at: 2014-09-06 15:43:21<br>
カテゴリ: <a href="category-80.html">SSL/TLS</a>&nbsp;<a href="category-23.html">セキュリティ</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1289.html" title="技術/Security/OAuth/Covert Redirectメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1058.html" title="技術/Security/PKI,SSL,TLS/メモ01_拡張子の迷宮(pem,der,crt,cer,csr,...)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
勉強中のメモ。（あくまでも個人の意見や見解です）
<br />
</p>

<ul><li> Certificate and Public Key Pinning - OWASP<ul><li> <a class="externallink" href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning" target="_blank">https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning</a></li></ul></li>
<li> Certificate and Public Key Pinning | グローバルサインブログ｜SSLサーバ証明書ならグローバルサイン (旧日本ジオトラスト株式会社)<ul><li> <a class="externallink" href="https://jp.globalsign.com/blog/2013/certificate_public_key_pinning.html" target="_blank">https://jp.globalsign.com/blog/2013/certificate_public_key_pinning.html</a></li></ul></li>
<li> SSL Pinning for Increased App Security by Jay Graves of Double Encore<ul><li> <a class="externallink" href="http://www.doubleencore.com/2013/03/ssl-pinning-for-increased-app-security/" target="_blank">http://www.doubleencore.com/2013/03/ssl-pinning-for-increased-app-security/</a></li></ul></li>
<li> LumberBlog: Why app developers should care about SSL pinning<ul><li> <a class="externallink" href="http://blog.lumberlabs.com/2012/04/why-app-developers-should-care-about.html" target="_blank">http://blog.lumberlabs.com/2012/04/why-app-developers-should-care-about.html</a></li></ul></li>
<li> スマートフォンアプリのSSLとかの解説っぽいもの - Togetter<ul><li> <a class="externallink" href="http://togetter.com/li/253658" target="_blank">http://togetter.com/li/253658</a></li></ul></li></ul>

<p class="paragraph">
2014-09追記：
<br />
</p>
<ul><li> 不正なSSL証明書を見破るPublic Key Pinningを試す - ぼちぼち日記<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/jovi0608/20140902/1409635279" target="_blank">http://d.hatena.ne.jp/jovi0608/20140902/1409635279</a></li></ul></li>
<li> Firefox 32、「Public Key Pinning」を導入へ | マイナビニュース<ul><li> <a class="externallink" href="http://news.mynavi.jp/news/2014/09/02/034/" target="_blank">http://news.mynavi.jp/news/2014/09/02/034/</a></li></ul></li>
<li> Firefox 32 supports Public Key Pinning<ul><li> <a class="externallink" href="http://monica-at-mozilla.blogspot.jp/2014/08/firefox-32-supports-public-key-pinning.html" target="_blank">http://monica-at-mozilla.blogspot.jp/2014/08/firefox-32-supports-public-key-pinning.html</a></li></ul></li>
<li> draft-ietf-websec-key-pinning-20 - Public Key Pinning Extension for HTTP<ul><li> <a class="externallink" href="http://tools.ietf.org/html/draft-ietf-websec-key-pinning-20" target="_blank">http://tools.ietf.org/html/draft-ietf-websec-key-pinning-20</a></li></ul></li>
<li> Kazuho&#039;s Weblog: 自社サーバと交信するスマホアプリにおけるサーバ証明書の発行手法について（SSL Pinningと独自CA再考）<ul><li> <a class="externallink" href="http://blog.kazuhooku.com/2014/07/ssl-pinningca.html" target="_blank">http://blog.kazuhooku.com/2014/07/ssl-pinningca.html</a></li></ul></li>
<li> スマートフォンアプリのSSLとか - Togetterまとめ<ul><li> <a class="externallink" href="http://togetter.com/li/253510" target="_blank">http://togetter.com/li/253510</a></li></ul></li>
<li> 徳丸　浩 on Twitter: &quot;僕がSSL pinningはアプリケーション要件でやってもいいけど、やってなくても脆弱性ではないことにこだわる本当の理由は、「できればpinningはやってほしくない」と思っているからで、その理由はこちらでも述べました <a class="externallink" href="http://t.co/vCJVtKeeQ2" target="_blank">http://t.co/vCJVtKeeQ2</a>&quot;<ul><li> <a class="externallink" href="https://twitter.com/ockeghem/status/488808334288363520" target="_blank">https://twitter.com/ockeghem/status/488808334288363520</a></li></ul></li></ul>


<ul><li> 目的<ul><li> OSやライブラリによる証明書チェーンの検証に頼らず、アプリケーション側で独自に、接続先のサーバ証明書を検証する。<ul><li> 具体的にサーバ証明書(X509)のどの項目を検証するのかについては上に挙げた資料参照。</li></ul></li></ul></li></ul>

<ul><li> 技法<ul><li> SSL/TLS通信を行うアプリケーションで、サーバ証明書の検証時に、証明書の公開鍵や署名、ホスト名などをアプリ側で持っているリストと一致しているか検証する。</li></ul></li></ul>

<ul><li> 誰が行うのか<ul><li> アプリケーションの開発者が行う。ChromeなどWebブラウザアプリや、スマホアプリなど、SSL/TLS接続を行うアプリケーション全般の開発者が行う。</li></ul></li></ul>

<ul><li> 背景 (より突っ込んだ&quot;目的&quot;)<ul><li> 1. 認証局自体が攻撃されて、不正に証明書を発行される事例が近年発生している。不正に発行された証明書を使った悪意のあるサーバに対して、中間者攻撃などを使って誘導された場合、単にルート認証局からの証明書チェーンを検証しただけでは、本当に接続先のサーバが正規のサーバであるか検証できたことにならない。このため、サーバ証明書自体をアプリ側でも検証し、アプリ側に埋め込まれている正規のサーバ証明書と同じ内容か検証する。もしアプリ側の証明書情報と一致しなければ、攻撃者により誘導された不正なサーバに接続している可能性があることを判別できる。<ul><li> 例 : ルート認証局のシステムが攻撃され、攻撃者により勝手にGoogle.comの証明書が発行され、攻撃者が用意したサーバに設定されるケース。攻撃によるものとはいえ、証明書自体は正規のルート認証局から発行されたものであるため、検証自体は成功する。その結果、被害者はGoogle.comに接続していると思い込んで、実際は攻撃者により誘導されたサーバに接続し、重要情報をやりとりする。</li></ul></li>
<li> 2. アプリケーションのSSL/TLS通信を悪意のある利用者が盗聴・改ざんすることを防ぐ。<ul><li> BurpなどMITMに対応してSSL/TLSの内容を盗聴・改ざん可能なプロキシツールがある。</li>
<li> これらのプロキシツールはアプリから接続された時にプロキシツール自身がSSL/TLSハンドシェイクを行う。この時、プロキシツールはアプリに対して、アプリ自身が生成したサーバ証明書を提示し、サーバとして振る舞う。プロキシツールは内部で生成した独自のルートCA証明書を保持し、共通してそれを認証局としてサーバ証明書を生成する仕組みを有する（場合が多い）。</li>
<li> アプリケーションの通信を解析したい利用者は、これらプロキシツールのルートCA証明書をエキスポートした後、自身の環境に信頼できるルート認証局の証明書としてインポートする。<ul><li> この部分の難易度をPC/iOS/Androidそれぞれで正確に判定できる情報は持ち合わせてないので不明。</li></ul></li>
<li> このため、単に証明書のキーチェーンだけを検証するだけでは、プロキシツールが介在していることを検出出来ない。サーバ証明書までをアプリ独自に検証することにより、もし一致していなければ、プロキシツールが生成した証明書でありプロキシツールが介在している可能性が考えられ、通信エラーとするなどしてSSL/TLS通信内容を盗聴・改ざんされることを防ぐことが可能になる。（100%防ぐことは出来なくとも、難易度を上げることはできる）</li></ul></li>
<li> 3. 金銭面などもろもろの事情により、一般の認証局で証明書を発行できず、自己署名証明書を使いたい。証明書の検証を全く行わない事は危険なので、自己署名証明書のサーバ証明書をアプリ側で保持しておき、OS/ライブラリのルート認証局からのチェーン検証は行わず、サーバ証明書の情報だけを検証したい。</li>
<li> (他に何かあるか？)</li></ul></li></ul>

<ul><li> 実装にはいくつかのバリエーションがありそう。<ul><li> Chrome : Google.comの証明書について、予めChrome内にホワイトリストが埋め込まれていて、それらとの一致を検査しているらしい。</li>
<li> 単一のサーバとしか通信しないアプリケーションなら、開発者が予めそのサーバの証明書を入手して、それらの情報をアプリに埋め込み、それと一致するかチェックできそう。</li>
<li> Webブラウザなど不特定多数のサーバと接続する場合：そのサーバに最初に接続した時のサーバ証明書情報を覚えておいて、2回め以降の接続でそれと異なるようであれば警告あるいはエラーとするなどありそう。SSHクライアントでよく見かける。<ul><li> ただしこの場合、初回接続時に既に攻撃を受けて攻撃者のサーバに誘導されていればナンセンスである。</li></ul></li>
<li> チェーン検証の有無についてもバリエーションが出そう。<ul><li> OS/ライブラリによる、システムの証明書を用いたチェーン検証＋独自のサーバ証明書検証を行うパターン</li>
<li> 独自の証明書ストアを埋め込み、それによるチェーン検証＋独自のサーバ証明書検証を行うパターン</li>
<li> OS/ライブラリによるチェーン検証も、独自の証明書ストアによるチェーン検証も行わず、単にサーバ証明書の検証だけを行うパターン</li></ul></li></ul></li></ul>

<ul><li> デメリット<ul><li> サーバ証明書が再発行などで変更された場合、アプリ側に埋め込んだ情報も同期させる必要がある。つまり、アプリも同時に変更して配布する必要があり、自動更新処理などを検討する必要が生じる。</li></ul></li></ul>

<ul><li> メモ<ul><li> Pinningしていないのはアプリケーションの脆弱性か？・・・どうなんだろう・・。</li>
<li> 背景の2番目、SSL/TLS通信の盗聴・改ざんを防ぐためというのは個人的にはあんまりオススメしたく無いかな・・・。アプリの利用者自身により通信内容が見られて、改ざんされても、それでもセキュリティが担保されるようにシステムを作っておくほうが順序としては先の気がする。ただそういう要望がある、かもしれない、というのは認識しておきたところ。</li>
<li> SSL Pinningさえしておけば、自己署名証明書でも良いか？<ul><li> 最低限度、アプリが妥当と認めるサーバとSSL/TLS接続を確立している、という点は担保できる。</li>
<li> しかし、その証明書に対する第三者機関による認証、という点を担保できていない状態になる。</li>
<li> ユーザの立場では、サーバ証明書を確認した場合に自己署名証明書だと、本当に正当な相手なのか確認できず、不安が残る。極端な話、アプリもサーバもセットで攻撃者が用意したフィッシングアプリ＋サーバを想定すれば、自己署名証明書は利用者に対して不安を残すだけとなる。</li>
<li> スマホアプリだとサーバ証明書を確認できるユースケースが限られるなどの議論は出てきそうだが、技術スキルのあるユーザがサーバ証明書を確認することは不可能とはいえない状況である。</li>
<li> やはり一般的な認証局に発行してもらった証明書を使ってシステムを構築し、ユーザからも、確かに第三者により身元が証明されたものであることを確認できる状態のほうが適切といえそう・・・。</li></ul></li></ul></li></ul>


<p class="paragraph">
他：
<br />
</p>

<ul><li> Forward Secrecy at Twitter | Twitter Blogs<ul><li> <a class="externallink" href="https://blog.twitter.com/2013/forward-secrecy-at-twitter-0" target="_blank">https://blog.twitter.com/2013/forward-secrecy-at-twitter-0</a><ul><li> SSL/TLSの接続開始時のセキュリティ技術である &quot;Forward Secrecy&quot; をTwitterでも取り入れてみたよ、という記事(多分)。・・・なんだけど、最後のほうでHTTPSをより強化するためになぜかcertificate pinningが推奨されてる。HSTSとかと一緒になってるので、HTTPS関連の最近の改良トピックを一緒くたに推奨として混ぜ込んだだけ？</li></ul></li></ul></li>
<li> SSL/TLS &amp; Perfect Forward Secrecy | Vincent Bernat<ul><li> <a class="externallink" href="http://vincent.bernat.im/en/blog/2011-ssl-perfect-forward-secrecy.html" target="_blank">http://vincent.bernat.im/en/blog/2011-ssl-perfect-forward-secrecy.html</a><ul><li> &quot;Forward Secrecy&quot; の解説記事。SSL/TLSの鍵交換に使うアルゴリズムとかその辺の話っぽい。</li></ul></li></ul></li></ul>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1289.html" title="技術/Security/OAuth/Covert Redirectメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1058.html" title="技術/Security/PKI,SSL,TLS/メモ01_拡張子の迷宮(pem,der,crt,cer,csr,...)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1243<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>