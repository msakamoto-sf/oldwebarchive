<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ4(LVMでXFSのrootパーティションをマウントしたままオンライン拡張) - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ4(LVMでXFSのrootパーティションをマウントしたままオンライン拡張)</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2015-03-15 19:48:13 &nbsp; / &nbsp; last updated at: 2017-02-12 19:51:31<br>
カテゴリ: <a href="category-103.html">CentOS7</a>&nbsp;<a href="category-20.html">Linux</a>&nbsp;<a href="category-71.html">VirtualBox</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1408.html" title="技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ3(EPELリポジトリの追加, Xfce4インストール + ibus-daemonで日本語入力)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1410.html" title="技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ5(VirtualBoxの共有フォルダー)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
CentOS7をVirtualBox 4.3.24 にインストールした、<a href="./view-1408.html" >技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ3(EPELリポジトリの追加, Xfce4インストール + ibus-daemonで日本語入力)</a>の続きです。
<br />
</p>

<p class="paragraph">
今回のインストール作業では、最初にVMを作成した時の8GBのディスクイメージでこれまで作業してきました。しかしこの先、実験とか勉強とかで作業してくと、8GBでは容量不足です。そこで、VirtualBoxで20GBのディスクを追加し、LVMでrootパーティションを拡張してみます。
<br />
</p>




<h3 id="id9ce740">VirtualBox側でのディスク追加</h3>

<p class="paragraph">
VMを一旦シャットダウンし、20GBのディスクを追加して、起動する。起動後に &quot;lsblk&quot; コマンドで確認したところ、&quot;/dev/sdb&quot; として認識された。
<br />
</p>
<pre class="plugin_pre">
# lsblk
NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                         8:0    0    8G  0 disk            # ←これが最初の8GBのディスク
├─sda1                      8:1    0  500M  0 part /boot
└─sda2                      8:2    0  7.5G  0 part 
  ├─centos_c7x64dev1-root 253:0    0  6.7G  0 lvm  /
  └─centos_c7x64dev1-swap 253:1    0  820M  0 lvm  [SWAP]
sdb                         8:16   0   20G  0 disk            # ←これが追加した20GBのディスク
sr0                        11:0    1 1024M  0 rom  
</pre>

<h3 id="id9d3644">PV(Physical Volume)の作成</h3>

<p class="paragraph">
fdiskでLVM用のパーティション追加→pvcreateでPV作成。
<br />
</p>
<pre class="plugin_pre">
# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x95dbdb71.

Command (m for help): n   # ← 新規パーティション作成
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p  # ← プライマリパーティションを指定
Partition number (1-4, default 1):   # ←何も入力せずENTER
First sector (2048-41943039, default 2048):   # ←何も入力せずENTER
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039): 
Using default value 41943039
Partition 1 of type Linux and of size 20 GiB is set

Command (m for help): t  # ← パーティションタイプを指定
Selected partition 1
Hex code (type L to list all codes): 8e  # ← Linux LVMを指定
Changed type of partition &#039;Linux&#039; to &#039;Linux LVM&#039;

Command (m for help): p  # ← パーティション設定状況を確認

Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x95dbdb71

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048    41943039    20970496   8e  Linux LVM

Command (m for help): w  # ← パーティションテーブルに書き込み
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
</pre>
<p class="paragraph">
→ lsblkで確認すると、&quot;/dev/sdb1&quot; でパーティション作れてた。
<br />
</p>
<pre class="plugin_pre">
# lsblk
NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                         8:0    0    8G  0 disk 
(...)
sdb                         8:16   0   20G  0 disk 
└─sdb1                      8:17   0   20G  0 part 
</pre>

<p class="paragraph">
→ &quot;pvcreate&quot; コマンドでPV作成：
<br />
</p>
<pre class="plugin_pre">
# pvcreate /dev/sdb1
  Physical volume &quot;/dev/sdb1&quot; successfully created
</pre>

<h3 id="id8ed5b8">VG(Volume Group)に追加</h3>

<p class="paragraph">
現状のVolume Group確認：
<br />
</p>
<pre class="plugin_pre">
# vgdisplay
  --- Volume group ---
  VG Name               centos_c7x64dev1
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               7.51 GiB
  PE Size               4.00 MiB
  Total PE              1922
  Alloc PE / Size       1922 / 7.51 GiB
  Free  PE / Size       0 / 0   
  VG UUID               aSp0xQ-VKM4-x3cb-AXNu-RK9e-VXBe-JyVT23
</pre>

<p class="paragraph">
→これ一個だけ。これから、root用とswap用をLVに切り出して使ってる。これに &quot;/dev/sdb1&quot; を追加する：
<br />
</p>
<pre class="plugin_pre">
# vgextend centos_c7x64dev1 /dev/sdb1
  Volume group &quot;centos_c7x64dev1&quot; successfully extended

→
# vgdisplay
  --- Volume group ---
  VG Name               centos_c7x64dev1
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  4
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               27.50 GiB
  PE Size               4.00 MiB
  Total PE              7041
  Alloc PE / Size       1922 / 7.51 GiB
  Free  PE / Size       5119 / 20.00 GiB  # ←Free部分に20GBが追加された。
  VG UUID               aSp0xQ-VKM4-x3cb-AXNu-RK9e-VXBe-JyVT23
</pre>

<h3 id="id844882">LV(Logical Volume) 拡張</h3>

<p class="paragraph">
現在のLV一覧：
<br />
</p>
<pre class="plugin_pre">
# lvdisplay
  --- Logical volume ---
  LV Path                /dev/centos_c7x64dev1/swap
  LV Name                swap
  VG Name                centos_c7x64dev1
  LV UUID                uEDQ7Y-V3U2-FGkb-kDOt-uQof-6q6p-2EsEKV
  LV Write Access        read/write
  LV Creation host, time localhost, 2015-03-15 02:49:59 +0900
  LV Status              available
  # open                 2
  LV Size                820.00 MiB
  Current LE             205
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/centos_c7x64dev1/root
  LV Name                root
  VG Name                centos_c7x64dev1
  LV UUID                blpdBV-Ho2U-mWFi-qoC7-z3aM-lebw-WnGhDi
  LV Write Access        read/write
  LV Creation host, time localhost, 2015-03-15 02:49:59 +0900
  LV Status              available
  # open                 1
  LV Size                6.71 GiB
  Current LE             1717
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
</pre>

<p class="paragraph">
→ &quot;root&quot; LVに追加する。LV Pathの &quot;/dev/centos_c7x64dev1/root&quot; を指定する。また、&quot;-l&quot; のオプションで &quot;+&quot; がついていることを確認すること。
<br />
</p>
<pre class="plugin_pre">
# lvextend -l +100%FREE /dev/centos_c7x64dev1/root
  Extending logical volume root to 26.70 GiB
  Logical volume root successfully resized
</pre>
<p class="paragraph">
→lsblkで確認すると、/dev/sdb1が centos_c7x64dev1-root のLVMとして追加されてことが分かる：
<br />
</p>
<pre class="plugin_pre">
# lsblk
NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                         8:0    0    8G  0 disk 
├─sda1                      8:1    0  500M  0 part /boot
└─sda2                      8:2    0  7.5G  0 part 
  ├─centos_c7x64dev1-root 253:0    0 26.7G  0 lvm  /
  └─centos_c7x64dev1-swap 253:1    0  820M  0 lvm  [SWAP]
sdb                         8:16   0   20G  0 disk 
└─sdb1                      8:17   0   20G  0 part 
  └─centos_c7x64dev1-root 253:0    0 26.7G  0 lvm  /  # ← LVMとして認識された
sr0                        11:0    1 1024M  0 rom  
</pre>

<h3 id="iddc4463">ファイルシステムの拡張</h3>

<p class="paragraph">
xfsなのでオンラインリサイズが可能。resize2fsではなく、xfs_growfsで実行できる。マウントポイントを指定する。
<br />
以下の例(&quot;/&quot;)のようにアンマウントしておく必要はない。マウントしたままできる。
<br />
</p>
<pre class="plugin_pre">
# xfs_growfs /
meta-data=/dev/mapper/centos_c7x64dev1-root isize=256    agcount=4, agsize=439552 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0
data     =                       bsize=4096   blocks=1758208, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 1758208 to 7000064

（一瞬で終わった→不安になってリターンコードをチェック）
# echo $?
0
（→成功してる・・・）
</pre>

<p class="paragraph">
念のため、再起動後にdfコマンドで確認：
<br />
</p>
<pre class="plugin_pre">
$ df -h
Filesystem                         Size  Used Avail Use% Mounted on
/dev/mapper/centos_c7x64dev1-root   27G  5.6G   22G  21% /            # ←確かに20GB増えてる。成功。
devtmpfs                           912M     0  912M   0% /dev
tmpfs                              921M  8.0K  921M   1% /dev/shm
tmpfs                              921M  8.7M  912M   1% /run
tmpfs                              921M     0  921M   0% /sys/fs/cgroup
/dev/sda1                          497M  158M  340M  32% /boot
</pre>


<p class="paragraph">
参考：
<br />
</p>
<ul><li> Linux LVM (Logical Volume Manager) まとめ<ul><li> <a class="externallink" href="https://www.upken.jp/kb/linux-lvm.html" target="_blank">https://www.upken.jp/kb/linux-lvm.html</a></li></ul></li></ul>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1408.html" title="技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ3(EPELリポジトリの追加, Xfce4インストール + ibus-daemonで日本語入力)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1410.html" title="技術/VirtualBox/CentOS7インストール(2015-03時点)/メモ5(VirtualBoxの共有フォルダー)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1409<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>