<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2013/03/30/本日の調査メモその3 : CRaSHの紹介 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2013/03/30/本日の調査メモその3 : CRaSHの紹介</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2013-03-30 23:15:00 &nbsp; / &nbsp; last updated at: 2013-03-30 23:18:14<br>
カテゴリ: <a href="category-68.html">Groovy</a>&nbsp;<a href="category-11.html">Java</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
Twitterで見かけたのですが、JVMのモニタリング・・・というかJMX + 便利コマンド各種をSSHとかTelnet経由で使えるようにlistenしてくれる面白いツールがありました。
<br />
</p>

<ul><li> CRaSH the shell for the Java Platform<ul><li> <a class="externallink" href="http://www.crashub.org/" target="_blank">http://www.crashub.org/</a></li></ul></li></ul>

<p class="paragraph">
ソースコードはGitHubで、リリースファイルのダウンロードはGoogleCode使ってるようです。
<br />
</p>
<ul><li> <a class="externallink" href="https://github.com/crashub" target="_blank">https://github.com/crashub</a></li>
<li> <a class="externallink" href="https://code.google.com/p/crsh/" target="_blank">https://code.google.com/p/crsh/</a></li></ul>

<p class="paragraph">
公式の&quot;Demo&quot;からWeb上で試せるんですが、スレッドの一覧とか、スレッドにinterrupt送れたりと、スレッドが固まってしまった場合にインタラクティブに制御出来ます。実運用環境で利用できる代物かどうかは未知数ですが、アイデアとしては非常に面白いです。VisualVMのPluginとしても利用できるようです。Groovyでカスタムコマンドを作成出来るというのも面白そうですね。
<br />
</p>

<p class="paragraph">
今日は crash-1.2.0-war.tar.gz をDLして、Win上のTomcat6にデプロイしてみました。
<br />
tarボールを解凍すると crash.war が出てきますので、Tomcat6の /webapps/ 以下に配置してTomcatを起動します。
<br />
こんな感じで配備ログが出て来ました。
<br />
</p>
<pre class="plugin_pre">
情報: Webアプリケーションディレクトリ crash を配備します
3 30, 2013 10:55:15 午後 org.crsh.plugin.PluginLifeCycle configureProperty
情報: Configuring property vfs.refresh_period=1 from properties
...
3 30, 2013 10:55:15 午後 org.crsh.plugin.PluginLifeCycle configureProperty
情報: Configuring property ssh.port=2000 from properties
...
3 30, 2013 10:55:15 午後 org.crsh.ssh.SSHPlugin init
情報: Booting SSHD
....
3 30, 2013 10:55:15 午後 org.crsh.ssh.term.SSHLifeCycle doInit
情報: About to start CRaSSHD
3 30, 2013 10:55:16 午後 org.crsh.ssh.term.SSHLifeCycle doInit
情報: CRaSSHD started on port 2000
...
</pre>

<p class="paragraph">
どうやらポート2000でSSHで接続できるようです。TomcatのJVMにSSHで接続できるなんて、新鮮ですね。
<br />
ログインするときのユーザ名とパスワードですが、warが展開されたあとの &quot;/WEB-INF/crash/crash.properties&quot; ファイルで指定します。1.2.0-warでのデフォルトは以下のようになっていて、&quot;admin&quot;ユーザ、パスワード&quot;admin&quot;でログインできます。
<br />
</p>

<p class="paragraph">
crash/WEB-INF/crash/crash.properties:
<br />
</p>
<pre class="plugin_pre">
# SSH configuration
crash.ssh.port=2000
#crash.ssh.keypath=/path/to/the/key/file

# Telnet configuration
crash.telnet.port=5000

# Authentication configuration
crash.auth=simple
crash.auth.simple.username=admin
crash.auth.simple.password=admin
</pre>

<p class="paragraph">
実際にSSHクライアントを起動し、接続してみます。
<br />
</p>
<pre class="plugin_pre">
[user@LB-L400B-120908 ~]$ ssh -p 2000 admin@localhost
admin@localhost&#039;s password:
   ______
 .~      ~. |`````````,       .&#039;.                   ..&#039;&#039;&#039;&#039; |         |
|           |&#039;&#039;&#039;|&#039;&#039;&#039;&#039;&#039;      .&#039;&#039;```.              .&#039;&#039;       |_________|
|           |    `.       .&#039;       `.         ..&#039;          |         |
 `.______.&#039; |      `.   .&#039;           `. ....&#039;&#039;             |         | 1.2.0

Follow and support the project on http://www.crashub.org
Welcome to LB-L400B-120908 + !
It is Sat Mar 30 22:55:23 JST 2013 now
%
</pre>

<p class="paragraph">
&quot;help&quot;と入力するとコマンドのヘルプが見れます。
<br />
</p>
<pre class="plugin_pre">
% help
Try one of these commands with the -h or --help switch:

NAME      DESCRIPTION
dashboard
env       display the term env
filter    A filter for a stream of map
help      provides basic help
java      various java language commands
jdbc      JDBC connection
jmx       Java Management Extensions
jndi      Java Naming and Directory Interface
jpa       Java persistance API
jvm       JVM informations
log       logging commands
man       format and display the on-line manual pages
shell     shell related command
sleep     sleep for some time
sort      Sort a map
system    vm system properties commands
thread    JVM thread commands
</pre>

<p class="paragraph">
各コマンドでも&quot;-h&quot;や&quot;help&quot;でコマンドごとのヘルプを表示できます。
<br />
</p>

<pre class="plugin_pre">
% thread help
usage: thread[-h | --help] COMMAND [ARGS]

The most commonly used thread commands are:
   interrupt        interrupt vm threads
   stop             stop vm threads
   top              thread top
   ls               list the vm threads
   dump             dump vm threads
   produce          produces threads for pipe
</pre>

<p class="paragraph">
&quot;thread top&quot;とかすると、TOPで3秒間隔くらいで更新されました。Ctrl-Cで戻れるとか、これがJavaで動いているのかとびっくりします。&quot;thread dump&quot;の使い方がちょっと分からない・・・。
<br />
</p>

<p class="paragraph">
Groovy読める人は、&quot;/WEB-INF/crash/commands/base&quot; の下に各コマンドのGroovyソースコードが置いてあるので、それ読むと良いかもしれません。
<br />
</p>

<p class="paragraph">
あと便利なことに、CRaSHのコマンドラインってTAB補完が効くんですよね。上下カーソルでコマンド履歴もアクセスできます。
<br />
まるでGNU readlineのようなのですが、依存ライブラリをチラ見したら &quot;jline&quot; とかいうjarが入ってました。
<br />
</p>

<ul><li> JLine - JLine<ul><li> <a class="externallink" href="http://jline.sourceforge.net/" target="_blank">http://jline.sourceforge.net/</a></li></ul></li>
<li> jline/jline2 · GitHub<ul><li> <a class="externallink" href="https://github.com/jline/jline2" target="_blank">https://github.com/jline/jline2</a></li></ul></li></ul>

<p class="paragraph">
やっぱりreadlineみたいな機能をJavaで実現するためのライブラリのようですが、これもまた面白そうですね。
<br />
</p>

<p class="paragraph">
以上、CRaSHの紹介でした。<br />
</p>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1176<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>