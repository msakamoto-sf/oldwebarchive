<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2010/03/08/FreePWING, wikipedia-fpwでWikipedia-jaのデータを変換 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2010/03/08/FreePWING, wikipedia-fpwでWikipedia-jaのデータを変換</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2010-03-08 13:11:38 &nbsp; / &nbsp; last updated at: 2010-03-08 18:29:47<br>
カテゴリ: </div>

<div class="data_body">
<p class="paragraph">
知り合いからWikipedia-jaのデータを、辞書ソフトで使われる JIS X 4081 形式に変換出来ないかと頼まれた。
<br />
変換ツールは存在するのだが、プログラマではないその知り合いでは、自分で試すには難易度が高すぎるらしい。
<br />
</p>




<h3 id="idf1ee82">基本手順と参考URL</h3>

<p class="paragraph">
順序：
<br />
</p>
<ol><li> PerlをINT64bit、large-fileサポート付でコンパイル。</li>
<li> FreePWINGを入れる。これ&quot;./configure &amp;&amp; make &amp;&amp; make install&quot;が必要。</li>
<li> wikipedia-fpwを持ってきて、テケトーなディレクトリに展開する。</li>
<li> wikipedia-jaのデータ持ってきて、wikipedia-fpwのディレクトリで伸長する。</li>
<li> wikipedia-fpw.confを調整する。相互参照(enable-reference)をＯＦＦ、数式を使わなければenable_mathをOFF。</li>
<li> 変換実行。</li></ol>

<p class="paragraph">
FreePWINGとwikipedia-fpw：
<br />
</p>
<ul><li> FreePWING<ul><li> <a class="externallink" href="http://www.sra.co.jp/people/m-kasahr/freepwing/" target="_blank">http://www.sra.co.jp/people/m-kasahr/freepwing/</a></li></ul></li>
<li> wikipedia-fpw<ul><li> <a class="externallink" href="http://ikazuhiro.g.ribbon.to/dic/wikipedia-fpw.html" target="_blank">http://ikazuhiro.g.ribbon.to/dic/wikipedia-fpw.html</a></li></ul></li></ul>

<p class="paragraph">
CPANで必要？かもなモジュール：
<br />
</p>
<ul><li> mimeTex, Image::Magick(数式ON時)</li>
<li> DB_File, BDB(?) : こちらはOut of memoryとかが出た時用。</li></ul>

<p class="paragraph">
他参考：FreePWINGのバージョンがビミョーに古い記事もあるので注意。FreePWING 1.6以降推奨らしい。
<br />
</p>
<ul><li> <a class="externallink" href="http://blog.otsuka-miso.com/Entry/7/" target="_blank">http://blog.otsuka-miso.com/Entry/7/</a></li>
<li> <a class="externallink" href="http://ikazuhiro.s206.xrea.com/staticpages/index.php/wikipedia-fpw" target="_blank">http://ikazuhiro.s206.xrea.com/staticpages/index.php/wikipedia-fpw</a></li>
<li> <a class="externallink" href="http://kagebane.blogspot.com/2009/02/wikipedia-wikipediawikipedia-epwing.html" target="_blank">http://kagebane.blogspot.com/2009/02/wikipedia-wikipediawikipedia-epwing.html</a></li>
<li> <a class="externallink" href="http://naotaso.seesaa.net/article/70499096.html" target="_blank">http://naotaso.seesaa.net/article/70499096.html</a></li>
<li> <a class="externallink" href="http://pub.ne.jp/spitz/?entry_id=1070982" target="_blank">http://pub.ne.jp/spitz/?entry_id=1070982</a></li>
<li> <a class="externallink" href="http://yoosee.net/d/archives/2008/03/03/002.html" target="_blank">http://yoosee.net/d/archives/2008/03/03/002.html</a></li></ul>

<h3 id="ide73dc4">Perlのコンパイル＆インストール（適当）</h3>

<p class="paragraph">
今回使ったサーバでは64bitintが無効のPerlがインストールされていた。OSインストール時に一緒に入ってきたパッケージなので、弄りたくない。
<br />
そこで、適当なディレクトリに手動でPerlを64bitint, largefiles対応でコンパイル＆インストールしてそっちを使うようにする。
<br />
</p>

<p class="paragraph">
かなりざっくりと、tarボールのDLからコンパイル＋インストールの流れ：
<br />
</p>
<pre class="plugin_pre">
$ wget http://www.cpan.org/src/perl-5.10.1.tar.bz2

$ tar jxvf perl-5.10.1.tar.bz2

$ ./Configure \
-ds -e \
-Duse64bitint -Duselargefiles \
-Doptimize=-O2 -Dcccdlflags=-fPIC -Darchname=i386-linux \
-Dd_dosuid -Dusethreads -Ud_setresuid -Ud_setresgid -Dd_semctl_semun \
-Di_db -Di_ndbm -Di_gdbm \
-Dprefix=/foo/bar/perl-5.10.1 \
-Dinstallprefix=/foo/bar/perl-5.10.1

（細かいコンパイルオプションは、パッケージでインストールされたPerlのものを流用）

$ make &amp;&amp; make test

$ su

# make install
</pre>

<p class="paragraph">
今回コンパイル＋インストールしたPerlを使いたい場合は、PATHを調整する。
<br />
bash例：
<br />
</p>
<pre>$ PATH=/foo/bar/perl-5.10.1/bin:$PATH
$ export PATH
$ cpan
（適当にセッティング）
</pre>

<h3 id="id9288ba">FreePWINGのインストール</h3>

<p class="paragraph">
かなりざっくりと：
<br />
</p>
<pre class="plugin_pre">
$ wget ftp://ftp.sra.co.jp/pub/misc/freepwing/freepwing-1.6.1.tar.bz2

$ tar jxvf freepwing-1.6.1.tar.bz2

$ cd freepwing-1.6.1

$ ./configure \
--prefix=/foo/bar/freepwing-1.6.1 \
--with-perllibdir=/foo/bar/perl-5.10.1/lib/site_perl/5.10.1
（手動インストールしたPerlを使うように、&quot;--with-perllibdir&quot;を調整する）
</pre>

<p class="paragraph">
なおautoconfig中で&quot;perl5&quot;ディレクトリを見ている。上で手動コンパイル＆インストールしたPerlは
<br />
</p>
<pre>perl5.10.1
</pre>
<p class="paragraph">
というディレクトリにインストールされた為、とりあえずシンボリックリンクを作ってごまかした：
<br />
</p>
<pre>$ ln perl5.10.1 perl5
</pre>

<p class="paragraph">
あとはmake &amp; make install:
<br />
</p>
<pre>$ make
$ su
# make install
</pre>

<h3 id="id6bacda">wikipedia-fpwとwikipediaデータのDL, 変換実行</h3>

<p class="paragraph">
ざっくりと：詳細は前掲の参考URL参照。
<br />
</p>
<pre>$ wget http://ikazuhiro.s206.xrea.com/filemgmt/visit.php/134
$ tar zxvf wikipedia-fpw-20091202-src.tar.gz
$ cd wikipedia-fpw-20091202
$ wget http://download.wikimedia.org/jawiki/20100217/jawiki-20100217-pages-articles.xml.bz2
</pre>

<p class="paragraph">
時間掛かるので、nohupコマンドでターミナル(puttyやTeraTerm)からログアウトしても実行し続けるようにする。そのための、PATH調整を含めた簡単なスクリプトを作る。
<br />
</p>

<p class="paragraph">
do_conv.sh:
<br />
</p>
<pre class="plugin_pre">
#!/bin/sh

PATH=/foo/bar/freepwing-1.6.1/bin:/foo/bar/perl-5.10.1/bin:$PATH
export PATH

fpwmake &gt; foo.log 2&gt;&amp;1
echo $0 &gt;&gt; foo.log
</pre>

<p class="paragraph">
実行。
<br />
</p>
<pre>$ nohup sh do_conv.sh &amp;
</pre>
<p class="paragraph">
これで、ターミナルからログアウトしてもOK。
<br />
</p>

<p class="paragraph">
→仕掛けたのが2/22, 23:00位。
<br />
終わったのが・・・
<br />
</p>
<pre class="plugin_pre">
$ stat foo.log
  File: `foo.log&#039;
  Size: 66141838        Blocks: 129320     IO Block: 4096   通常ファイル
Device: 303h/771d       Inode: 15418803    Links: 1
Access: (0644/-rw-r--r--)  Uid: (  600/    lain)   Gid: (  600/    king)
Access: 2010-02-23 08:29:29.000000000 +0900
Modify: 2010-02-23 05:33:47.000000000 +0900
Change: 2010-02-23 05:33:47.000000000 +0900
</pre>
<p class="paragraph">
→5時過ぎ。6時間半かかった。
<br />
</p>

<h3 id="id58f6d3">変換データの圧縮、パッケージングでの注意点(2GB越のデータをzip圧縮→要注意)</h3>

<p class="paragraph">
&quot;fpwmake&quot;コマンドの引数に&quot;package&quot;を指定すると、辞書ソフトで読めるディレクトリ構造にパッケージング＋圧縮してくれる。
<br />
</p>
<pre>$ fpwmake package
</pre>

<p class="paragraph">
自分の環境ではすぐ終わってしまった。
<br />
圧縮しているようには思えないほどすぐに終了してしまったので、パッケージファイルを解凍してみる。
<br />
・・・HONMONファイルとか実際にコピーされてないっぽい。
<br />
ディレクトリ構造、README.PKGやCATALOGS, ライセンスファイルの入ったzipファイルは作成されていた。
<br />
</p>

<p class="paragraph">
ログに実行されたシェルスクリプトが出てきたし、
<br />
<a class="externallink" href="http://www.sra.co.jp/people/m-kasahr/freepwing/doc/freepwing-04.html#package" target="_blank">http://www.sra.co.jp/people/m-kasahr/freepwing/doc/freepwing-04.html#package</a>
<br />
とかも見て、足りてないデータファイルを手動でコピーしてzipする。
<br />
・・・が、それでもHONMONファイルがzipアーカイブされていない。
<br />
</p>

<p class="paragraph">
ログに出てきたzipコマンドは下記の通り。
<br />
</p>
<pre>zip -9rkq wikipedia-fpw-20091202.zip WIKIP
</pre>

<p class="paragraph">
&quot;-q&quot;を外して詳細を表示させると、見事にHONMONがスルーされている。
<br />
手動でアーカイブに追加してみると・・・
<br />
</p>
<pre>$ zip -9k wikipedia-fpw-20091202.zip WIKIP/WIKIP/DATA/HONMON
       zip warning: name not matched: WIKIP/WIKIP/DATA/HONMON

zip error: Nothing to do! (wikipedia-fpw-20091202.zip)
</pre>

<p class="paragraph">
HONMONファイルは2GBを超えている。・・・いや～な予感がして、&quot;zip warning: name not matched 2GB&quot;でぐぐってみたら・・・
<br />
</p>
<ul><li> Gentoo Bug 200995 - app-arch/zip missing flags for &gt;2GB files<ul><li> <a class="externallink" href="http://bugs.gentoo.org/200995" target="_blank">http://bugs.gentoo.org/200995</a></li></ul></li></ul>

<p class="paragraph">
2GBを超えるファイルを扱うには
<br />
</p>
<pre>-D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE
</pre>
<p class="paragraph">
が必要とのこと。
<br />
</p>

<p class="paragraph">
さすがにzipコマンドまで手動コンパイル＆インストールする気力は無かった。
<br />
ディレクトリ構造だけ整えて、試しにtar.gzで圧縮してみたら上手く行った。
<br />
</p>

<p class="paragraph">
&quot;fpwmake&quot;でパッケージ＆圧縮する時は、使われるzipコマンドが2GB超えに対応しているか確認してからの方がよい。
<br />
そうでない場合は、手動でディレクトリ構造を整え、別途2GB超えに対応している圧縮ツールを使う。
<br />
</p>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/609<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>