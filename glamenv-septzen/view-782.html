<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Assembler/ForFun(x86_32)/01, 16bit DOS with debug.exe - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">Assembler/ForFun(x86_32)/01, 16bit DOS with debug.exe</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2010-09-14 19:58:24 &nbsp; / &nbsp; last updated at: 2010-09-19 21:00:24<br>
カテゴリ: <a href="category-48.html">Assembler</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-790.html" title="Assembler/ForFun(x86_32)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-783.html" title="Assembler/ForFun(x86_32)/02, 16bit DOS with NASM">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-410.html" title="Assembler">Assembler</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
1980年代のCP/Mから30年にわたり生き延びてきたデバッガ兼アセンブラが&quot;debug.exe&quot;です。
<br />
永らくDOSやWindowsに同梱されてきたdebug.exeですが、さすがにWindows7には含まれていないようです。
<br />
もし手元のPCがWindowsXP以前のOSなら、今の内に往時の16bitDOSアセンブラプログラミングを体験してみましょう。
<br />
</p>

<p class="paragraph">
なおdebugコマンドでのアセンブラの記述はIntel方式(destination, source)です。
<br />
</p>




<p class="paragraph">
参考資料：
<br />
</p>
<ul><li> アセンブリ言語入門<ul><li> <a class="externallink" href="http://wisdom.sakura.ne.jp/programming/asm/index.html" target="_blank">http://wisdom.sakura.ne.jp/programming/asm/index.html</a></li></ul></li>
<li> MS-DOS DEBUG Program<ul><li> <a class="externallink" href="http://mirror.href.com/thestarman/asm/debug/debug.htm" target="_blank">http://mirror.href.com/thestarman/asm/debug/debug.htm</a></li></ul></li>
<li> Ralf Brown&#039;s Interrupt List - HTML Version<ul><li> <a class="externallink" href="http://www.ctyme.com/rbrown.htm" target="_blank">http://www.ctyme.com/rbrown.htm</a></li></ul></li>
<li> debug (command) - Wikipedia, the free encyclopedia<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/Debug_%28command%29" target="_blank">http://en.wikipedia.org/wiki/Debug_%28command%29</a></li></ul></li>
<li> COM file - Wikipedia, the free encyclopedia<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/COM_file" target="_blank">http://en.wikipedia.org/wiki/COM_file</a></li></ul></li></ul>

<hr />
<ul><li><a href="#idee2fdc">実行方法</a></li>
<li><a href="#id363b8b">debugコマンド一覧</a><ul><li><a href="#id8301b0">アセンブラの入力と実行：A,G,P,T,Uコマンド</a><ul><li><a href="#idaffb75">練習</a></li></ul></li>
<li><a href="#id28d542">メモリ・レジスタの表示と書き込み：E,D,Rコマンド</a><ul><li><a href="#idaffb75">練習</a></li></ul></li>
<li><a href="#id728804">ファイルへの書き込みと終了：N,W,Qコマンド</a></li></ul></li>
<li><a href="#ide9d62e">&quot;Hello, World!&quot;</a></li>
<li><a href="#id4c27e8">まとめ</a></li></ul>
<hr />
<h3 id="idee2fdc">実行方法</h3>

<p class="paragraph">
コマンドプロンプトを開き、&quot;debug&quot; 又は &quot;debug.exe&quot; を実行します。
<br />
</p>
<pre>C:\&gt;debug
-
</pre>
<p class="paragraph">
&quot;-&quot;がdebug用のコマンド入力プロンプトです。
<br />
</p>

<p class="paragraph">
既存のプログラムをデバッグすることも可能です。debug に続いてデバッグ対象のプログラム名を指定します。
<br />
</p>
<pre>C:\&gt;debug.exe test.com
-g =100
プログラムは正常に終了しました.
-q
</pre>

<h3 id="id363b8b">debugコマンド一覧</h3>

<p class="paragraph">
最初にパラメータの書式についてまとめておきます。
<br />
</p>
<dl>
<dt> &quot;Value&quot;形式 </dt>
<dd>16進数をそのまま書く。&quot;0x&quot;や&quot;h&quot;などの接頭辞・接尾辞は不要。</dd>
<dt> &quot;Address&quot;形式 </dt>
<dd>
<p class="paragraph">
segment:offset形式又は単純なoffset形式。
<br />
</p>
<ul><li> &quot;1AFE:00B0&quot; - segment:offset</li>
<li> &quot;DS:A0EE&quot; - segument register:offset</li>
<li> &quot;0FE0&quot; - offset</li></ul></dd>
<dt> &quot;List&quot;形式 </dt>
<dd>
<p class="paragraph">
1つ以上のバイト or 文字データ。
<br />
</p>
<ul><li> &quot;10, 20, 30, 40&quot;</li>
<li> &quot; &#039;A&#039;, &#039;B&#039;, &#039;C&#039;, 0&quot;</li></ul></dd>
<dt> &quot;Range&quot;形式 </dt>
<dd>
<p class="paragraph">
アドレス範囲を表現する形式。
<br />
</p>
<ul><li> &quot;Address_From [[,] Address_To]&quot; - &quot;100, 200&quot;, &quot;CS:200,300&quot; &quot;10 20&quot; (Address_To省略時は適当な標準値が使用される)</li>
<li> &quot;Address L Length&quot; - &quot;100 L 20&quot; (100から20hバイトの範囲)</li></ul></dd>
<dt> &quot;String&quot;形式 </dt>
<dd>ダブル or シングルクォートで囲まれた文字列。</dd>
</dl>

<p class="paragraph">
以下、本記事で使用する主要なdebugコマンドを紹介していきます。その他のdebugコマンドについては冒頭で紹介した解説記事や&quot;?&quot;コマンドを参照して下さい。
<br />
</p>

<p class="paragraph">
<strong>コマンドやパラメータは、大文字小文字どちらで入力してもOKです。</strong>
<br />
</p>

<h4 id="id8301b0">アセンブラの入力と実行：A,G,P,T,Uコマンド</h4>

<dl>
<dt> &#039;A&#039;(Assemble) </dt>
<dd>
<pre>-A            ... 現在のIPからアセンブラ入力を開始
-A &quot;Address&quot;  ... &quot;Address&quot;で指定されたアドレスからアセンブラ入力を開始
</pre>
<p class="paragraph">
アセンブラ入力中は、現在入力中のアドレスがsegment:offset形式のプロンプトとして表示されます。
<br />
アセンブラ入力を終了してdebugコマンドプロンプトに戻るには、空行を入力します。
<br />
</p></dd>
<dt> &#039;G&#039;(Go) </dt>
<dd>
<pre>-G ... 現在のIPから実行開始
-G breakpoint ... 現在のIPから実行開始し、breakpoint(&quot;Address&quot;形式)で停止
-G = start breakpoint ... start(&quot;Address&quot;形式)から実行を開始、breakpointで停止
-G = start bp1 bp2 ... 上と同じだが、複数のbreakpointを設定可能
</pre>
<p class="paragraph">
なおstartの値がoffset形式で指定された場合、&quot;CS:offset&quot;から開始される。
<br />
</p></dd>
<dt> &#039;P&#039;(Proceed) </dt>
<dd>
<p class="paragraph">
1つ以上の命令を実行後、レジスタ値を表示して停止。LOOPやサブルーチンの中は追わない。
<br />
</p>
<pre>-P ... 現在のIPから1命令実行して停止
-P number ... 現在のIPからnumber命令実行して停止
-P = start ... start(&quot;Address&quot;形式)から1命令実行して停止
-P = start number ... start(&quot;Address&quot;形式)からnumber命令実行して停止
</pre></dd>
<dt> &#039;T&#039;(Trace) </dt>
<dd>
<p class="paragraph">
1つ以上の命令を実行後、レジスタ値を表示して停止。LOOPやサブルーチンの中まで追うところが&#039;P&#039;と違う点。
<br />
</p>
<pre>-T ... 現在のIPから1命令実行して停止
-T number ... 現在のIPからnumber命令実行して停止
-T = start ... start(&quot;Address&quot;形式)から1命令実行して停止
-T = start number ... start(&quot;Address&quot;形式)からnumber命令実行して停止
</pre></dd>
<dt> &#039;U&#039;(Unassemble) </dt>
<dd>
<p class="paragraph">
メモリ範囲を指定して逆アセンブル表示。
<br />
</p>
<pre>-U ... 最後に&#039;U&#039;が実行されたアドレスから32byte逆アセンブル
-U address ... 指定アドレスから32byte逆アセンブル
-U range ... 指定範囲を逆アセンブル
</pre></dd>
</dl>

<h5 id="idaffb75">練習</h5>

<p class="paragraph">
以下のアセンブラをCS:0100から打ち込み、G/P/Tで実行してみましょう。
<br />
</p>
<pre>MOV     CX,0005
MOV     AX,0000
MOV     BX,0000
ADD     AX,CX
INC     BX
LOOP    0109
</pre>

<pre>&gt; debug.exe
-A 100
2CED:0100 mov cx,5
2CED:0103 mov ax,0
2CED:0106 mov bx,0
2CED:0109 add ax,cx
2CED:010B inc bx
2CED:010C loop 109
2CED:010E
※&quot;2CED:xxxx&quot;は勝手に表示されます。それ以降のアセンブラコードを
実際にキーボードから入力します。最後に空行でアセンブラ入力終了です。
</pre>

<p class="paragraph">
ではIP=100から開始して、ADDコマンドの109hで止めてみます。
<br />
</p>
<pre>-G =100 109
AX=0000  BX=0000  CX=0005  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=0109   NV UP EI PL NZ NA PO NC
2CED:0109 01C8          ADD     AX,CX
</pre>
<p class="paragraph">
AX, BX, CXが&quot;MOV&quot;命令の通りになり、IPは109hを指しているのが分かります。
<br />
</p>

<p class="paragraph">
続いて&quot;P&quot;コマンドで1命令だけ実行してみます。
<br />
</p>
<pre>-P
AX=0005  BX=0000  CX=0005  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=010B   NV UP EI PL NZ NA PE NC
2CED:010B 43            INC     BX
</pre>
<p class="paragraph">
AXにCXの値が加算され、IPが次の命令を指します。
<br />
</p>

<p class="paragraph">
今度は&quot;T&quot;コマンドで、複数の命令を実行させてみます。&quot;T&quot;なのでLOOPの中も追ってくれます。
<br />
</p>
<pre class="plugin_pre">
-T 5

AX=0005  BX=0001  CX=0005  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=010C   NV UP EI PL NZ NA PO NC
2CED:010C E2FB          LOOP    0109

AX=0005  BX=0001  CX=0004  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=0109   NV UP EI PL NZ NA PO NC
2CED:0109 01C8          ADD     AX,CX

AX=0009  BX=0001  CX=0004  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=010B   NV UP EI PL NZ NA PE NC
2CED:010B 43            INC     BX

AX=0009  BX=0002  CX=0004  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=010C   NV UP EI PL NZ NA PO NC
2CED:010C E2FB          LOOP    0109

AX=0009  BX=0002  CX=0003  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=0109   NV UP EI PL NZ NA PO NC
2CED:0109 01C8          ADD     AX,CX
</pre>
<p class="paragraph">
LOOP → 109へ戻ってまたLOOP という動きを、1命令毎に細かく追うことが出来ます。
<br />
</p>

<p class="paragraph">
最後に&quot;U&quot;コマンドを試してみましょう。
<br />
</p>
<pre class="plugin_pre">
-U 100
2CED:0100 B90500        MOV     CX,0005
2CED:0103 B80000        MOV     AX,0000
2CED:0106 BB0000        MOV     BX,0000
2CED:0109 01C8          ADD     AX,CX
2CED:010B 43            INC     BX
2CED:010C E2FB          LOOP    0109
2CED:010E 0000          ADD     [BX+SI],AL
2CED:0110 0000          ADD     [BX+SI],AL
2CED:0112 0000          ADD     [BX+SI],AL
2CED:0114 0000          ADD     [BX+SI],AL
2CED:0116 0000          ADD     [BX+SI],AL
2CED:0118 0000          ADD     [BX+SI],AL
2CED:011A 0000          ADD     [BX+SI],AL
2CED:011C 3400          XOR     AL,00
2CED:011E DC2C                  FSUBR   QWORD PTR [SI]
</pre>
<p class="paragraph">
開始アドレスしか指定していない為、32byte分逆アセンブルされました。
<br />
実際に入力したのは10Dまでなので、範囲を絞ってみましょう。
<br />
</p>
<pre>-U 100 10D
2CED:0100 B90500        MOV     CX,0005
2CED:0103 B80000        MOV     AX,0000
2CED:0106 BB0000        MOV     BX,0000
2CED:0109 01C8          ADD     AX,CX
2CED:010B 43            INC     BX
2CED:010C E2FB          LOOP    0109
</pre>

<p class="paragraph">
範囲指定なので&quot;L&quot;を使うこともできます。
<br />
</p>
<pre>-U 100 L D
2CED:0100 B90500        MOV     CX,0005
2CED:0103 B80000        MOV     AX,0000
2CED:0106 BB0000        MOV     BX,0000
2CED:0109 01C8          ADD     AX,CX
2CED:010B 43            INC     BX
2CED:010C E2FB          LOOP    0109
</pre>

<h4 id="id28d542">メモリ・レジスタの表示と書き込み：E,D,Rコマンド</h4>

<dl>
<dt> &#039;E&#039;(Enter) </dt>
<dd>
<p class="paragraph">
アドレスにデータを書き込みます。
<br />
</p>
<pre>-E address ... 指定されたアドレスに1バイトデータを書き込みます。
               address(&quot;Address&quot;形式)がoffsetの場合はDS:offsetとして処理されます。
-E address list ... 指定されたアドレスから、listで指定されたシーケンシャルデータを
                    書き込みます。
</pre>
<p class="paragraph">
なお、&quot;list&quot;には&quot;String&quot;形式も指定可能ですが、&quot;\t&quot;&quot;\r&quot;&quot;\n&quot;等のエスケープシーケンスは展開されません。またC言語のように末尾の0x00は付与されないので、必要なら明示的に指定する必要があります。
<br />
</p></dd>
<dt> &#039;D&#039;(Dump) </dt>
<dd>
<p class="paragraph">
メモリ内容を16進ダンプします。
<br />
</p>
<pre>-D  ... 最後にダンプしたアドレス or 初回ならDS:0からダンプ
-D address ... 指定されたアドレスからダンプ
-D range ... 指定されたメモリ範囲をダンプ
</pre></dd>
<dt> &#039;R&#039;(Register) </dt>
<dd>
<p class="paragraph">
レジスタ内容を表示、あるいは新しい値を設定します。
<br />
</p>
<pre>-R  ... 現在のレジスタ内容を表示
-R register ... 指定されたレジスタ内容を表示し、新しい値を入力
</pre>
<p class="paragraph">
&quot;register&quot;には、&#039;R&#039;で表示されるレジスタ名(AX, BX, ...)の他にフラグレジスタの&quot;F&quot;も指定出来ます。
<br />
</p></dd>
</dl>

<h5 id="idaffb75">練習</h5>

<p class="paragraph">
debugコマンド起動時点でのレジスタ値を確認してみます。
<br />
</p>
<pre>&gt; debug.exe
-R
AX=0000  BX=0000  CX=0000  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
DS=2CED  ES=2CED  SS=2CED  CS=2CED  IP=0100   NV UP EI PL NZ NA PO NC
2CED:0100 B90500        MOV     CX,0005
</pre>
<p class="paragraph">
DS, ES, SS, CS が全て同じセグメントになっています。IPが0100hに設定済です。CS:0 - CS:FFhはdebug.exe用の予約領域です。
<br />
SPはFFEEになっています。DS,CS,SS全て同じセグメントなので、あまりスタックにpushしすぎるとプログラムやデータ領域を壊してしまうかもしれませんので注意が必要です。
<br />
</p>

<p class="paragraph">
AXの値を変更してみます。
<br />
</p>
<pre>-r ax
AX 0000
:
</pre>
<p class="paragraph">
&quot;:&quot;で新しい値の入力待ちです。&quot;1234&quot;(hex)を入力してみます。
<br />
</p>
<pre>-r ax
AX 0000
:1234(リターン)
-r
AX=1234  BX=0000  CX=0000  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000
...
</pre>
<p class="paragraph">
AXが更新されているのが分かります。
<br />
</p>

<p class="paragraph">
DS:0200hから&quot;Hello World!&quot;を書き込んでみましょう。まずは1byte単位で書き込んでみます。
<br />
</p>
<pre>-E 200
2CED:0200  00.
</pre>
<p class="paragraph">
ここで入力待ちなので、そのまま16進で&quot;48&quot;(=&#039;H&#039;)を入力します。
<br />
</p>
<pre>-E 200
2CED:0200  00.48(リターン)
-
</pre>
<p class="paragraph">
引き続き、DS:0201に&quot;e&quot;(0x65)を書き込んでみます。
<br />
</p>
<pre>-E 201
2CED:0201  00.65(リターン)
</pre>

<p class="paragraph">
DS:0202以降は&quot;llo, World!&quot;と文字列でまとめて書き込んでみます。
<br />
</p>
<pre>-E 202 &quot;llo, World!&quot; 00
</pre>

<p class="paragraph">
では&quot;D&quot;コマンドでダンプしてみます。
<br />
</p>
<pre>-D 200 L F
2CED:0200  48 65 6C 6C 6F 2C 20 57-6F 72 6C 64 21 00 00      Hello, World!..
-
</pre>
<p class="paragraph">
ちゃんと&quot;Hello, World!&quot;をメモリアドレス上に書き込めたことを確認出来ました。
<br />
</p>

<p class="paragraph">
ちなみに&quot;\r\n\00&quot;を末尾に指定するのであれば、
<br />
</p>
<pre>-E 200 &quot;Hello, World!&quot; 0D 0A 00
</pre>
<p class="paragraph">
とする必要があります。
<br />
</p>

<h4 id="id728804">ファイルへの書き込みと終了：N,W,Qコマンド</h4>

<dl>
<dt> &#039;N&#039;(Name) </dt>
<dd>
<p class="paragraph">
後述の&#039;W&#039;コマンドで書き出すファイル名を指定します。
<br />
</p>
<pre>-N [Drive:\path\]8_3_name.ext
</pre>
<p class="paragraph">
ファイル名はDOSの8.3形式で指定する必要があります。
<br />
</p></dd>
<dt> &#039;W&#039;(Write) </dt>
<dd>
<p class="paragraph">
メモリイメージをファイルに出力します。出力するサイズをBXとCXレジスタで指定します。&quot;BX:CX&quot;と記述する場合もありますが、segment:offsetの計算ではなく、単純に高位16bitをBX、低位16bitをCXで指定します。したがって理論的には32bitサイズのメモリイメージをファイルに出力可能ですが、そもそも64KiBセグメントに囲まれた16bitDOSプログラミングの世界なので、BXは0で問題ないでしょう。
<br />
</p>
<pre>-W  ... CS:0100h からBX:CXサイズ分出力
-W CS:0200  ... CS:0200h からBX:CXサイズ分出力
</pre>

<p class="paragraph">
CS:0100hからのメモリイメージをファイルに書き込むと、結果としてCOMファイルが出力されます。DOS MZ実行形式ではありません。
<br />
ファイルサイズは最大 65280 Bytes で、これがそのままCS:0100h以降にロードされます。65280は丁度64KiB - FFhです。
<br />
CS:0000h - CS:00FFh はシステム(or debug.exe)の予約領域です。
<br />
</p></dd>
<dt> &#039;Q&#039;(Quit) </dt>
<dd>debugコマンドを終了します。</dd>
</dl>

<p class="paragraph">
N, W コマンドについては後述の&quot;Hello, World!&quot;プログラムで練習してみます。
<br />
</p>

<h3 id="ide9d62e">&quot;Hello, World!&quot;</h3>

<p class="paragraph">
ではいよいよdebugコマンドを使って &quot;Hello, World!&quot; を作ってみます。
<br />
使用するDOSファンクションは次の２つで充分でしょう。
<br />
</p>
<table>
	<tr>
		<td> AH=09h </td>
		<td> DOS 1+ - WRITE STRING TO STANDARD OUTPUT </td>
	</tr>
	<tr>
		<td> AH=4Ch </td>
		<td> DOS 2+ - EXIT - TERMINATE WITH RETURN CODE </td>
	</tr>
</table>

<p class="paragraph">
AH=09hで表示する文字列は、&quot;$&quot;終端になっている必要があります。
<br />
DOSファンクションコールの詳細は、&quot;Ralf Brown&#039;s Interrupt List&quot;を参照して下さい。
<br />
</p>

<pre class="plugin_pre">
C:\&gt;debug
-A 100
2CED:0100 mov ah,9
2CED:0102 mov dx,200
2CED:0105 int 21
2CED:0107 mov ah,4c
2CED:0109 mov al,1
2CED:010B int 21
2CED:010D
-E 200 &quot;Hello, World!$&quot;
-N HELLOW.COM
-R BX
BX 0000
:0
-R CX
CX 0000
:300
-W
00300 バイト書き込み中.
-Q
</pre>

<p class="paragraph">
実行してみます。
<br />
</p>
<pre>C:\&gt;HELLOW.COM
Hello, World!
C:\&gt;echo %ERRORLEVEL%
1
</pre>

<p class="paragraph">
&quot;Hello, World!&quot;が表示され、戻り値(=1)もERRORLEVELを通じて確認出来ました。
<br />
</p>

<h3 id="id4c27e8">まとめ</h3>

<p class="paragraph">
debug.exeの主要コマンドと、実際に&quot;Hello, World!&quot;を組み立てる手順を見ていきました。
<br />
32bitから64bitへの移行が進んでいる2010年現在、16bitDOS環境のdebug.exeを使う機会は滅多にないと思いますが、もし万が一、使う場面に遭遇した時にこのページを思い出して頂ければ幸いです。
<br />
</p>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-790.html" title="Assembler/ForFun(x86_32)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-783.html" title="Assembler/ForFun(x86_32)/02, 16bit DOS with NASM">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-790.html" title="Assembler/ForFun(x86_32)">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-410.html" title="Assembler">Assembler</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/782<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>