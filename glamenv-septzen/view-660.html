<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>日記/2010/05/25/PEフォーマットのIMAGE_DOS_HEADERを眺めてみる - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">日記/2010/05/25/PEフォーマットのIMAGE_DOS_HEADERを眺めてみる</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2010-05-25 17:42:36 &nbsp; / &nbsp; last updated at: 2010-05-25 19:28:39<br>
カテゴリ: <a href="category-48.html">Assembler</a>&nbsp;<a href="category-28.html">Python</a>&nbsp;<a href="category-8.html">Windows</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
Pythonの練習。
<br />
</p>




<p class="paragraph">
cui01.c:
<br />
</p>
<pre class="plugin_pre">#include &lt;stdio.h&gt;

int main(int argc, char *argv[])
{
	printf(&quot;Hello, World!\n&quot;);
	return 0;
}</pre>
<p class="paragraph">
コンパイル：
<br />
</p>
<pre>&gt; cl cui01.c
</pre>

<p class="paragraph">
IMAGE_DOS_HEADER部分を取り出してみる。
<br />
show_dos_header.py:
<br />
</p>
<div class="hl-main"><pre><span class="hl-reserved">import</span><span class="hl-code"> </span><span class="hl-identifier">sys</span><span class="hl-code">, </span><span class="hl-identifier">logging</span><span class="hl-code">, </span><span class="hl-identifier">struct</span><span class="hl-code">, </span><span class="hl-identifier">ctypes</span><span class="hl-code">
 
</span><span class="hl-identifier">WORD</span><span class="hl-code"> = </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">c_ushort</span><span class="hl-code">
</span><span class="hl-identifier">LONG</span><span class="hl-code"> = </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">c_long</span><span class="hl-code">
 
</span><span class="hl-reserved">class</span><span class="hl-code"> </span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">(</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">Structure</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-identifier">_fields_</span><span class="hl-code"> = </span><span class="hl-brackets">[</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_magic</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Magic number</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cblp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Bytes on last page of file</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Pages in file</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_crlc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Relocations</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cparhdr</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Size of header in paragraphs</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_minalloc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Minimum extra paragraphs needed</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_maxalloc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Maximum extra paragraphs needed</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ss</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial (relative) SS value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_sp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial SP value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_csum</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Checksum</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ip</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial IP value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cs</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial (relative) CS value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_lfarlc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># File address of relocation table</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ovno</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Overlay number</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_res</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-code"> * </span><span class="hl-number">4</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Reserved words</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_oemid</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># OEM identifier (for e_oeminfo)</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_oeminfo</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># OEM information; e_oemid specific</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_res2</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-code"> * </span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Reserved words</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_lfanew</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">LONG</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># File address of new exe header</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">
 
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-number">2</span><span class="hl-code"> != </span><span class="hl-builtin">len</span><span class="hl-brackets">(</span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">'</span><span class="hl-string">usage: python %s filename</span><span class="hl-quotes">'</span><span class="hl-code"> % </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-number">0</span><span class="hl-brackets">]</span><span class="hl-code">
  </span><span class="hl-identifier">quit</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-identifier">file_name</span><span class="hl-code"> = </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-number">1</span><span class="hl-brackets">]</span><span class="hl-code">
 
</span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">basicConfig</span><span class="hl-brackets">(</span><span class="hl-code">
    </span><span class="hl-identifier">level</span><span class="hl-code">=</span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">DEBUG</span><span class="hl-code">,
    </span><span class="hl-identifier">format</span><span class="hl-code">=</span><span class="hl-quotes">'</span><span class="hl-string">%(asctime)s %(name)s %(levelname)s %(message)s</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">log</span><span class="hl-code"> = </span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">getLogger</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">main</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-reserved">try</span><span class="hl-code">:
  </span><span class="hl-identifier">f</span><span class="hl-code"> = </span><span class="hl-builtin">open</span><span class="hl-brackets">(</span><span class="hl-identifier">file_name</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">rb</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-reserved">except</span><span class="hl-code"> </span><span class="hl-reserved">IOError</span><span class="hl-code">, </span><span class="hl-identifier">e</span><span class="hl-code">:
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">open(%s) faileed.</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">file_name</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-reserved">raise</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-code">
 
</span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">seek</span><span class="hl-brackets">(</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">data</span><span class="hl-code"> = </span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">read</span><span class="hl-brackets">(</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">sizeof</span><span class="hl-brackets">(</span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">header</span><span class="hl-code"> = </span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">fit</span><span class="hl-code"> = </span><span class="hl-builtin">min</span><span class="hl-brackets">(</span><span class="hl-builtin">len</span><span class="hl-brackets">(</span><span class="hl-identifier">data</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">sizeof</span><span class="hl-brackets">(</span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">memmove</span><span class="hl-brackets">(</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">addressof</span><span class="hl-brackets">(</span><span class="hl-identifier">header</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-identifier">data</span><span class="hl-code">, </span><span class="hl-identifier">fit</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-string">IMAGE_DOS_HEADER:</span><span class="hl-quotes">&quot;</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_magic: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_magic</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_cblp: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_cblp</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_cp: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_cp</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_crlc: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_crlc</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_cparhdr: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_cparhdr</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_minalloc: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_minalloc</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_maxalloc: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_maxalloc</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_ss: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_ss</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_sp: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_sp</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_csum: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_csum</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_ip: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_ip</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_cs: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_cs</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_lfarlc: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_lfarlc</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_ovno: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_ovno</span><span class="hl-code">
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-identifier">i</span><span class="hl-code"> </span><span class="hl-reserved">in</span><span class="hl-code"> </span><span class="hl-builtin">range</span><span class="hl-brackets">(</span><span class="hl-number">4</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_res[%d]: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-brackets">(</span><span class="hl-identifier">i</span><span class="hl-code">, </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_res</span><span class="hl-brackets">[</span><span class="hl-identifier">i</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_oemid: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_oemid</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_oeminfo: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_oeminfo</span><span class="hl-code">
</span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-identifier">i</span><span class="hl-code"> </span><span class="hl-reserved">in</span><span class="hl-code"> </span><span class="hl-builtin">range</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_res2[%d]: %04X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-brackets">(</span><span class="hl-identifier">i</span><span class="hl-code">, </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_res2</span><span class="hl-brackets">[</span><span class="hl-identifier">i</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-special">\t</span><span class="hl-string">e_lfanew: %08X</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_lfanew</span></pre></div>

<p class="paragraph">
ctypes.Structureにファイルから読んだ生データ(string)を取り込ませるtipsについては下記参照：
<br />
</p>
<ul><li> How to pack and unpack using ctypes (Structure &lt;-&gt; str) - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/1825715/how-to-pack-and-unpack-using-ctypes-structure-str" target="_blank">http://stackoverflow.com/questions/1825715/how-to-pack-and-unpack-using-ctypes-structure-str</a></li></ul></li></ul>

<p class="paragraph">
続いて、DOSのStub実行データ部分を抜き出す・・・というか、正確にはIMAGE_DOS_HEADERとそのe_lfanewの示すファイル位置の間に存在するデータ部分を抜き出す。
<br />
</p>
<pre>IMAGE_DOS_HEADER
DOS_STUB
IMAGE_NT_HEADERS
</pre>
<p class="paragraph">
の順に並んでる筈だから・・・多分Stub実行イメージ本体で良いんだよね？セグメントとかその辺が絡んできそうなのであまり突っ込まないが、とりあえずIMAGE_DOS_HEADERとIMAGE_NT_HEADERSの間を抜き出すプログラム：
<br />
extract_dos_stub.py:
<br />
</p>
<div class="hl-main"><pre><span class="hl-reserved">import</span><span class="hl-code"> </span><span class="hl-identifier">sys</span><span class="hl-code">, </span><span class="hl-identifier">logging</span><span class="hl-code">, </span><span class="hl-identifier">struct</span><span class="hl-code">, </span><span class="hl-identifier">ctypes</span><span class="hl-code">
 
</span><span class="hl-identifier">WORD</span><span class="hl-code"> = </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">c_ushort</span><span class="hl-code">
</span><span class="hl-identifier">LONG</span><span class="hl-code"> = </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">c_long</span><span class="hl-code">
 
</span><span class="hl-reserved">class</span><span class="hl-code"> </span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">(</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">Structure</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-identifier">_fields_</span><span class="hl-code"> = </span><span class="hl-brackets">[</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_magic</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Magic number</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cblp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Bytes on last page of file</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Pages in file</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_crlc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Relocations</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cparhdr</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Size of header in paragraphs</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_minalloc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Minimum extra paragraphs needed</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_maxalloc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Maximum extra paragraphs needed</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ss</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial (relative) SS value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_sp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial SP value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_csum</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Checksum</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ip</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial IP value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_cs</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Initial (relative) CS value</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_lfarlc</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># File address of relocation table</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_ovno</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Overlay number</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_res</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-code"> * </span><span class="hl-number">4</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Reserved words</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_oemid</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># OEM identifier (for e_oeminfo)</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_oeminfo</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># OEM information; e_oemid specific</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_res2</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">WORD</span><span class="hl-code"> * </span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># Reserved words</span><span class="hl-code">
      </span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">e_lfanew</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">LONG</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment"># File address of new exe header</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">
 
</span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-number">3</span><span class="hl-code"> != </span><span class="hl-builtin">len</span><span class="hl-brackets">(</span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">)</span><span class="hl-code">:
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">'</span><span class="hl-string">usage: python %s filename output</span><span class="hl-quotes">'</span><span class="hl-code"> % </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-number">0</span><span class="hl-brackets">]</span><span class="hl-code">
  </span><span class="hl-identifier">quit</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-identifier">file_name</span><span class="hl-code"> = </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-number">1</span><span class="hl-brackets">]</span><span class="hl-code">
</span><span class="hl-identifier">out_file</span><span class="hl-code"> = </span><span class="hl-identifier">sys</span><span class="hl-code">.</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-number">2</span><span class="hl-brackets">]</span><span class="hl-code">
 
</span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">basicConfig</span><span class="hl-brackets">(</span><span class="hl-code">
    </span><span class="hl-identifier">level</span><span class="hl-code">=</span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">DEBUG</span><span class="hl-code">,
    </span><span class="hl-identifier">format</span><span class="hl-code">=</span><span class="hl-quotes">'</span><span class="hl-string">%(asctime)s %(name)s %(levelname)s %(message)s</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">log</span><span class="hl-code"> = </span><span class="hl-identifier">logging</span><span class="hl-code">.</span><span class="hl-identifier">getLogger</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">main</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-reserved">try</span><span class="hl-code">:
  </span><span class="hl-identifier">f</span><span class="hl-code"> = </span><span class="hl-builtin">open</span><span class="hl-brackets">(</span><span class="hl-identifier">file_name</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">rb</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-reserved">except</span><span class="hl-code"> </span><span class="hl-reserved">IOError</span><span class="hl-code">, </span><span class="hl-identifier">e</span><span class="hl-code">:
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">open(%s) faileed.</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">file_name</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-reserved">raise</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-code">
 
</span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">seek</span><span class="hl-brackets">(</span><span class="hl-number">0</span><span class="hl-code">, </span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">dos_header_sz</span><span class="hl-code"> = </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">sizeof</span><span class="hl-brackets">(</span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-identifier">data</span><span class="hl-code"> = </span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">read</span><span class="hl-brackets">(</span><span class="hl-identifier">dos_header_sz</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">header</span><span class="hl-code"> = </span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">fit</span><span class="hl-code"> = </span><span class="hl-builtin">min</span><span class="hl-brackets">(</span><span class="hl-builtin">len</span><span class="hl-brackets">(</span><span class="hl-identifier">data</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">sizeof</span><span class="hl-brackets">(</span><span class="hl-identifier">IMAGE_DOS_HEADER</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">memmove</span><span class="hl-brackets">(</span><span class="hl-identifier">ctypes</span><span class="hl-code">.</span><span class="hl-identifier">addressof</span><span class="hl-brackets">(</span><span class="hl-identifier">header</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-identifier">data</span><span class="hl-code">, </span><span class="hl-identifier">fit</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-identifier">pe_offset</span><span class="hl-code"> = </span><span class="hl-identifier">header</span><span class="hl-code">.</span><span class="hl-identifier">e_lfanew</span><span class="hl-code">
 
</span><span class="hl-identifier">stub_size</span><span class="hl-code"> = </span><span class="hl-identifier">pe_offset</span><span class="hl-code"> - </span><span class="hl-identifier">dos_header_sz</span><span class="hl-code">
</span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">seek</span><span class="hl-brackets">(</span><span class="hl-identifier">dos_header_sz</span><span class="hl-code">, </span><span class="hl-number">0</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-identifier">stub_data</span><span class="hl-code"> = </span><span class="hl-identifier">f</span><span class="hl-code">.</span><span class="hl-identifier">read</span><span class="hl-brackets">(</span><span class="hl-identifier">stub_size</span><span class="hl-brackets">)</span><span class="hl-code">
 
</span><span class="hl-reserved">try</span><span class="hl-code">:
  </span><span class="hl-identifier">f_out</span><span class="hl-code"> = </span><span class="hl-builtin">open</span><span class="hl-brackets">(</span><span class="hl-identifier">out_file</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">wb</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-identifier">f_out</span><span class="hl-code">.</span><span class="hl-identifier">write</span><span class="hl-brackets">(</span><span class="hl-identifier">stub_data</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-identifier">f_out</span><span class="hl-code">.</span><span class="hl-identifier">close</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-string">DOS Stub executable binary image is saved to %s.</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">out_file</span><span class="hl-code">
  </span><span class="hl-reserved">print</span><span class="hl-code"> </span><span class="hl-quotes">&quot;</span><span class="hl-string">%d - %d (%d bytes) are extracted from %s</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-brackets">(</span><span class="hl-code">
      </span><span class="hl-identifier">dos_header_sz</span><span class="hl-code">, </span><span class="hl-identifier">dos_header_sz</span><span class="hl-code"> + </span><span class="hl-identifier">stub_size</span><span class="hl-code">, </span><span class="hl-identifier">stub_size</span><span class="hl-code">, </span><span class="hl-identifier">file_name</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-reserved">except</span><span class="hl-code"> </span><span class="hl-reserved">IOError</span><span class="hl-code">, </span><span class="hl-identifier">e</span><span class="hl-code">:
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">open(%s) faileed.</span><span class="hl-quotes">&quot;</span><span class="hl-code"> % </span><span class="hl-identifier">file_name</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-identifier">log</span><span class="hl-code">.</span><span class="hl-identifier">error</span><span class="hl-brackets">(</span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code">
  </span><span class="hl-reserved">raise</span><span class="hl-code"> </span><span class="hl-identifier">e</span></pre></div>

<p class="paragraph">
実際に抜き出してみる。
<br />
</p>
<pre>&gt; extract_dos_stub.py cui01.exe dos_stub
</pre>

<p class="paragraph">
ndisasmで逆アセンブルしてみる。
<br />
</p>
<pre class="plugin_pre">
&gt; ndisasm -b 16 dos_stub
00000000  0E                push cs
00000001  1F                pop ds
00000002  BA0E00            mov dx,0xe
00000005  B409              mov ah,0x9
00000007  CD21              int 0x21
00000009  B8014C            mov ax,0x4c01
0000000C  CD21              int 0x21
0000000E  54                push sp
0000000F  686973            push word 0x7369
(...)
</pre>
<p class="paragraph">
ここで
<br />
</p>
<pre>0000000E  54                push sp
</pre>
<p class="paragraph">
以下は丁度
<br />
</p>
<pre>This program cannot be run in DOS mode.
</pre>
<p class="paragraph">
の文字列になる。その後ろにもバイト列が幾つか続いているが、よく分からないのでスルー。
<br />
実行コードとしてはこれだけになる・・・のだろう、多分。
<br />
</p>
<pre>00000000  0E                push cs
00000001  1F                pop ds
00000002  BA0E00            mov dx,0xe
00000005  B409              mov ah,0x9
00000007  CD21              int 0x21
00000009  B8014C            mov ax,0x4c01
0000000C  CD21              int 0x21
</pre>
<p class="paragraph">
0x7の&quot;int 0x21&quot;は、AHが0x9なので文字列表示。CS(Code Segment)をDSレジスタにコピーした後、DXレジスタに&quot;0xe&quot;、つまり&quot;This program ...&quot;の先頭のアドレスが指定される。これはAH=09hのINT21呼び出しでは、文字列の先頭アドレスを&quot;DS:DX&quot;で指定する為である。
<br />
</p>
<ul><li> Int 21/AH=09h<ul><li> <a class="externallink" href="http://www.ctyme.com/intr/rb-2562.htm" target="_blank">http://www.ctyme.com/intr/rb-2562.htm</a></li></ul></li></ul>

<p class="paragraph">
文字列表示が終われば、今度は0xCの&quot;int 0x21&quot;。こんどはAXが0x4c01になる。つまりAH=4C, AL=01。なのでreturn codeは1になる。
<br />
</p>
<ul><li> Int 21/AH=4Ch<ul><li> <a class="externallink" href="http://www.ctyme.com/intr/rb-2974.htm" target="_blank">http://www.ctyme.com/intr/rb-2974.htm</a></li></ul></li></ul>

<p class="paragraph">
以上。
<br />
</p>

<p class="paragraph">
ちなみに、バイナリエディタでe_lfanewのところを適当な値に書き換えると、&quot;PE\00\00&quot;が見つからなくなるためか、DOSモードでの実行になる。<br />
</p>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/660<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>