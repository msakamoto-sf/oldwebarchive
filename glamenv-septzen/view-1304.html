<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/IDE/Eclipse/Web Tools Platform (WTP), m2e-wtp - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/IDE/Eclipse/Web Tools Platform (WTP), m2e-wtp</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2014-08-03 19:23:00 &nbsp; / &nbsp; last updated at: 2017-01-07 22:35:54<br>
カテゴリ: <a href="category-63.html">Eclipse</a>&nbsp;<a href="category-11.html">Java</a>&nbsp;<a href="category-62.html">Maven</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1154.html" title="技術/IDE/Eclipse">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1328.html" title="技術/IDE/Eclipse/import Ant project">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
EclipseでWTPツールやm2e-wtpを試したメモです。
<br />
</p>

<ul><li> Web Tools Platform (WTP) Project<ul><li> <a class="externallink" href="http://www.eclipse.org/webtools/" target="_blank">http://www.eclipse.org/webtools/</a></li></ul></li></ul>

<p class="paragraph">
ちょっと古いけど、Server登録後に新規プロジェクトで&quot;Web&quot; -&gt; &quot;Dynamic Web Project&quot; or &quot;Static Web Project&quot; 作る流れは変わってない。
<br />
</p>
<ul><li> Eclipse 3.1を使おう（3）：Webアプリのための標準プラグイン「WTP」 (1/2) - ＠IT<ul><li> <a class="externallink" href="http://www.atmarkit.co.jp/ait/articles/0511/12/news011.html" target="_blank">http://www.atmarkit.co.jp/ait/articles/0511/12/news011.html</a></li></ul></li>
<li> Eclipse 3.1を使おう（4）：Eclipse WTPを使った始めてのWebアプリ (1/2) - ＠IT<ul><li> <a class="externallink" href="http://www.atmarkit.co.jp/ait/articles/0511/29/news111.html" target="_blank">http://www.atmarkit.co.jp/ait/articles/0511/29/news111.html</a></li></ul></li>
<li> [ThinkIT] 第1回：Eclipse WTPの概要とインストール (1/3)<ul><li> <a class="externallink" href="http://thinkit.co.jp/free/tech/24/1/" target="_blank">http://thinkit.co.jp/free/tech/24/1/</a></li></ul></li>
<li> 18. 統合開発環境に関する知識 II | 日本OSS推進フォーラム<ul><li> <a class="externallink" href="http://ossforum.jp/node/984" target="_blank">http://ossforum.jp/node/984</a><ul><li> II-18-3 から II-18-5 までが、Eclipse 3.3以降でのWTPを使った開発方法の解説になっている。</li></ul></li></ul></li></ul>

<h3 id="id79e97e">プロジェクト作成の基本</h3>

<p class="paragraph">
&quot;Web&quot;カテゴリから&quot;Dynamic Web Project&quot;を選択すればJavaEEのServletアプリを、&quot;Static Web Project&quot;を選択すれば静的なWebページプロジェクトを作れます。
<br />
<a href="./../images/misc_java_ide/wtp-create-proj-types.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-create-proj-types.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
多分、他にもWTPで作れるようになるプロジェクトあると思うんですが、代表例は上記2つかと。
<br />
</p>

<p class="paragraph">
&quot;Dynamic Web Project&quot;だと、&quot;Java EE&quot;パースペクティブでこんな感じになり、web.xmlの構成要素を視認しやすくなります。右クリックでServletを追加したりすることもできます。
<br />
<a href="./../images/misc_java_ide/wtp-proj-demo-dynamic-1.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-proj-demo-dynamic-1.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
&quot;Static Web Project&quot;はシンプルにこんな感じになります。JavaScript開発用のライブラリが追加されてます。
<br />
<a href="./../images/misc_java_ide/wtp-proj-demo-static-1.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-proj-demo-static-1.png" alt="" title=""  /></a>
<br />
</p>

<h3 id="idb6ad78">Debug or Run時のHot Deployについて</h3>

<p class="paragraph">
環境：
<br />
</p>
<pre>Win7Pro 64bit 日本語版
Eclipse 4.2 Juno SR2
Eclipse Java Web Developer Tools 3.4.2.v201209272000-7F7DFSpC26SrlX9qoilV1RGQC9ivZy86-bz-IBHe
ServerとしてTomcat 7.0.x系
</pre>

<p class="paragraph">
WTPを使ってDebug or Runを実行し、その最中にJavaのソースコードを修正すると、コンテキストの再ロードが発生するようです。
<br />
Tomcat 7.0.x系を使って起動している最中にJavaのソースを修正して保存したら、数秒後、以下のようなログがコンソールに出力されました。
<br />
</p>
<pre>8 03, 2014 6:43:11 午後 org.apache.catalina.core.StandardContext reload
情報: このコンテキストの再ロードを開始しました
8 03, 2014 6:43:13 午後 org.apache.catalina.core.StandardContext reload
情報: このコンテキストの再ロードが完了しました
</pre>

<p class="paragraph">
コンテキストの再ロードになるので、ごっそり入れ替わるイメージになります。Servletアプリのshutdownとstartが発生するので、ContextListenerやstartup=1のServletのinit()などで複雑なクリーナップや準備処理をしていると、時間がかかるかもしれません。
<br />
</p>

<h3 id="ide72bfb">m2e-wtp</h3>

<p class="paragraph">
Mavenプロジェクトの場合、Maven用のディレクトリ構成とEclipseのデフォルトのディレクトリ構成が大きく異なるため、そのままではWTPで処理できません。このギャップを埋めてくれるのがm2e-wtpプラグインになります。
<br />
</p>

<p class="paragraph">
本家：
<br />
</p>
<ul><li> m2e-wtp<ul><li> <a class="externallink" href="https://www.eclipse.org/m2e-wtp/" target="_blank">https://www.eclipse.org/m2e-wtp/</a></li></ul></li></ul>

<p class="paragraph">
参考：
<br />
</p>
<ul><li> [ 2809 ] [maven]Eclipse m2eとWTPプラグインを使う時のTips ::: Serendipity 2 future lies&#039;n sundome. (´・ω・)<ul><li> <a class="externallink" href="http://www.h3.dion.ne.jp/~alpha-pz/misc2809.html" target="_blank">http://www.h3.dion.ne.jp/~alpha-pz/misc2809.html</a></li></ul></li>
<li> JavaEE7(GlassFish4.0)のEclipse4.3(Kepler)におけるMaven(M2E)連携 | あらぶるトラブル<ul><li> <a class="externallink" href="http://araburu.epea.co.jp/?p=48" target="_blank">http://araburu.epea.co.jp/?p=48</a></li></ul></li>
<li> Hello world with Jetty + Maven + Eclipse WTP tutorial — Virtage Devblog<ul><li> <a class="externallink" href="http://devblog.virtage.com/2013/02/hello-world-with-jetty-maven-eclipse-wtp-tutorial/" target="_blank">http://devblog.virtage.com/2013/02/hello-world-with-jetty-maven-eclipse-wtp-tutorial/</a></li></ul></li></ul>

<p class="paragraph">
試しに、自分で作った練習用のJersey + Servletソースを読み込ませてみました。
<br />
<a class="externallink" href="https://github.com/msakamoto-sf/jaxrs2-exercise-jersey-servlet" target="_blank">https://github.com/msakamoto-sf/jaxrs2-exercise-jersey-servlet</a>
<br />
</p>

<p class="paragraph">
SourceTreeでcloneしたあと、EclipseのProjectのImportで、既存のMavenプロジェクトをインポートします。
<br />
→ Java パースペクティブですと、普通のMavenプロジェクトとして表示されます。
<br />
<a href="./../images/misc_java_ide/m2e-wtp-demo2.png" title="" target="_blank"><img src="./../images/misc_java_ide/m2e-wtp-demo2.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→ &quot;Java EE&quot; パースペクティブに切り替えると、m2e-wtpをインストールした状態ですと、自動的に認識して、WTPにあわせた見え方になりました。
<br />
<a href="./../images/misc_java_ide/m2e-wtp-demo1.png" title="" target="_blank"><img src="./../images/misc_java_ide/m2e-wtp-demo1.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
Debug, Run も他のwtpプロジェクトと変わらずに操作できます。
<br />
MavenのServletアプリを通常のJavaプロジェクトで扱うと、&quot;src/main/webapp&quot; まで辿らないとHTMLやWEB-INFが開けないのですが、m2e-wtpであれば、&quot;Deployed Resources&quot; -&gt; &quot;webapp&quot; から簡単にアクセスできる点も魅力的です。
<br />
WTPのプロジェクトでは、&quot;Deployment Assembly&quot; の設定がキモになるようですが、m2e-wtpがインストールされていると、以下の様な設定に調整してくれました。
<br />
<a href="./../images/misc_java_ide/m2e-wtp-demo3.png" title="" target="_blank"><img src="./../images/misc_java_ide/m2e-wtp-demo3.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
今回試したケースでは、Mavenプロジェクトとしてインポートした後、Java EEパースペクティブに切り替えたら自動的に認識されました。そのため、明示的に&quot;Dynamic Web Project&quot;としてインポートする方法は未調査となります。
<br />
</p>

<p class="paragraph">
2014-08-02時点の環境：
<br />
</p>
<pre>Win7Pro 64bit 日本語版
Eclipse 4.2 Juno SR2
Eclipse Java Web Developer Tools 3.4.2.v201209272000-7F7DFSpC26SrlX9qoilV1RGQC9ivZy86-bz-IBHe
m2e-wtp - Maven Integration for WTP 1.0.1.20130911-1545
ServerとしてTomcat 7.0.x系
</pre>

<p class="paragraph">
※自動的に &quot;.project&quot; ファイルに以下のエントリーが追加される・・・。これ、m2e-wtpが入ってないEclipse環境で開いてもエラーにならないかな？
<br />
</p>
<pre>   &lt;buildSpec&gt;
       &lt;buildCommand&gt;
           &lt;name&gt;org.eclipse.wst.common.project.facet.core.builder&lt;/name&gt;
           &lt;arguments&gt;
           &lt;/arguments&gt;
       &lt;/buildCommand&gt;
       ....
   &lt;buildSpec&gt;
   &lt;natures&gt;
       ...
       &lt;nature&gt;org.eclipse.wst.common.project.facet.core.nature&lt;/nature&gt;
   &lt;/natures&gt;
</pre>

<h3 id="id23a288">トラブル</h3>

<p class="paragraph">
WTPは単一のPlugin, Featureではなく、複数の要素から成り立っているため、細かいトラブルがぼちぼちありそうです。
<br />
以下、実際に遭遇したのを紹介します。
<br />
</p>

<h4 id="idadcd52">Tomcatを使ってDynamic Web ProjectをDebugすると、時々勝手にTomcatのスレッドの「processWorkerExit()」でbreakする。</h4>

<p class="paragraph">
環境：
<br />
</p>
<pre>Win7Pro 64bit 日本語版
Eclipse 4.2 Juno SR2
Eclipse Java Web Developer Tools 3.4.2.v201209272000-7F7DFSpC26SrlX9qoilV1RGQC9ivZy86-bz-IBHe
</pre>

<p class="paragraph">
こんな感じで、放置しとくと、どっかのタイミングで繰り返し、勝手にbreakします。
<br />
<a href="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break2.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break2.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
同様の症状：
<br />
</p>
<ul><li> java - Eclipse breaks on processWorkerExit - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/10356905/eclipse-breaks-on-processworkerexit" target="_blank">http://stackoverflow.com/questions/10356905/eclipse-breaks-on-processworkerexit</a></li></ul></li>
<li> java - OpenJDK breaks on processWorkerExit with no breakpoint - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/7451862/openjdk-breaks-on-processworkerexit-with-no-breakpoint" target="_blank">http://stackoverflow.com/questions/7451862/openjdk-breaks-on-processworkerexit-with-no-breakpoint</a></li></ul></li></ul>

<p class="paragraph">
どうも、Window -&gt; Preference -&gt; Java -&gt; Debug で、&quot;Suspend execution on uncaught exceptions&quot;にチェックが入ってると、Tomcat内の部分についてもチェックするようになり、breakしてしまうようです。
<br />
<a href="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break1.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break1.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→こんな感じで、チェックを外してあげれば、Debug実行で勝手にbreakすることは無くなりました。
<br />
<a href="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break3.png" title="" target="_blank"><img src="./../images/misc_java_ide/wtp-tomcat7-uncaught-ex-break3.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
とはいえ、本来はアプリのコードでbreakしてくれた方がうれしいので、チェックはONにしておきたいところではあります・・・。
<br />
</p>

<h4 id="id440619">Static Web ProjectでRun or Debugすると &quot;java.lang.NoClassDefFoundError: org/eclipse/jetty/webapp/WebAppContext&quot; 発生</h4>

<p class="paragraph">
環境：
<br />
</p>
<pre>Win7Pro 64bit 日本語版
Eclipse 4.2 Juno SR2
Eclipse Java Web Developer Tools 3.4.2.v201209272000-7F7DFSpC26SrlX9qoilV1RGQC9ivZy86-bz-IBHe
</pre>

<p class="paragraph">
&quot;Console&quot;を開くとこんな例外が出てた：
<br />
</p>
<pre class="plugin_pre">
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/eclipse/jetty/webapp/WebAppContext
	at java.lang.Class.getDeclaredMethods0(Native Method)
	at java.lang.Class.privateGetDeclaredMethods(Class.java:2442)
	at java.lang.Class.getMethod0(Class.java:2685)
	at java.lang.Class.getMethod(Class.java:1620)
	at sun.launcher.LauncherHelper.getMainMethod(LauncherHelper.java:492)
	at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:484)
Caused by: java.lang.ClassNotFoundException: org.eclipse.jetty.webapp.WebAppContext
	at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:423)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:356)
	... 6 more
</pre>

<p class="paragraph">
検索するといくつか同様の症状が見つかったが、どれもJuno SR2で、自分も同じ。
<br />
</p>

<ul><li> jetty - Eclipse Juno with Web Tools Platform - HTTP Preview at localhost throws NoClassDefFoundError - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/16047969/eclipse-juno-with-web-tools-platform-http-preview-at-localhost-throws-noclassd" target="_blank">http://stackoverflow.com/questions/16047969/eclipse-juno-with-web-tools-platform-http-preview-at-localhost-throws-noclassd</a></li></ul></li>
<li> Bug 402848 – Eclipse Juno SR2 HTTP Preview server does not start<ul><li> <a class="externallink" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=402848" target="_blank">https://bugs.eclipse.org/bugs/show_bug.cgi?id=402848</a></li></ul></li>
<li> Eclipse Community Forums: Web Tools Project (WTP) » Starting HTTP Preview Java exception<ul><li> <a class="externallink" href="http://www.eclipse.org/forums/index.php/t/458827/" target="_blank">http://www.eclipse.org/forums/index.php/t/458827/</a></li></ul></li></ul>

<p class="paragraph">
一応対処法が載っているが、どうもかなり面倒くさい手順になりそう。
<br />
&quot;Dynamic Web Project&quot; + Tomcat ではこんなエラーは起きない。
<br />
&quot;HTTP Preview Server&quot;を使う時だけか？
<br />
</p>

<p class="paragraph">
結論としては、他のEclipseのバージョンで試してみるか、&quot;Dynamic Web Project&quot;化して試すか、別のIDEや環境にするか。
<br />
静的Webページを開発するのであれば、Eclipseに拘る必要も無いと思います。
<br />
</p>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1154.html" title="技術/IDE/Eclipse">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1328.html" title="技術/IDE/Eclipse/import Ant project">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1154.html" title="技術/IDE/Eclipse">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1304<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>