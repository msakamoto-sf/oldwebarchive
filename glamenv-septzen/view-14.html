<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>レジストリの直接編集によるファイルの拡張子と関連づけ - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">レジストリの直接編集によるファイルの拡張子と関連づけ</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2004-09-03 00:00:00 &nbsp; / &nbsp; last updated at: 2008-11-27 23:51:11<br>
カテゴリ: <a href="category-8.html">Windows</a>&nbsp;</div>

<div class="data_body">
<ul><li><a href="#id48c3d6">はじめに</a><ul><li><a href="#id867859">注意</a></li></ul></li>
<li><a href="#ide87c11">編集対象のレジストリ群</a></li>
<li><a href="#id94ad8e">ファイルの拡張子とその関連づけを設定するには</a><ul><li><a href="#idf5215e">操作１：アプリケーションのProgIDを登録する。</a></li>
<li><a href="#idb5ea26">操作２：拡張子を登録し、関連づけを行う。</a></li></ul></li>
<li><a href="#id0856ed">新しい拡張子のファイルをダブルクリックしたとき、何が起こるか？</a></li>
<li><a href="#id9ea733">「プログラムから開く」のからくり(Inside for &quot;Open With...&quot; dialog box.)</a><ul><li><a href="#id47af4b">&quot;NoOpenWith&quot;エントリ</a></li>
<li><a href="#ida45219">「プログラムから開く」の履歴</a></li>
<li><a href="#ida35f91">トラブルシューティング(Trouble Shooting)</a></li></ul></li>
<li><a href="#id26fc50">参考URL</a></li></ul>
<hr />
<h3 id="id48c3d6">はじめに</h3>

<p class="paragraph">
このドキュメントは、Windows2000以上の環境で、レジストリを直接編集することによりファイルの拡張子とその関連づけの設定を行うための指南書として作成したものです。
<br />
通常、ユーザーレベルでファイルの関連づけを設定するには以下の方法が提供されています。
<br />
</p>
<ul><li> エクスプローラの「ツール」→「フォルダオプション」</li>
<li> ファイルを右クリックして表示されるコンテキストメニューの「プログラムから開く」</li>
<li> ログインユーザーのホームディレクトリ(Documents and Settings\(USER))の「SendTo」へのショートカットの追加</li></ul>

<p class="paragraph">
しかし、トラブルが起こった場合上記の設定を弄くるだけでは解決しない場合も多々あります。（往々にしてそういうトラブルの解決策はネット上にすら存在しません。）そういった場合、最終手段としてレジストリを直接編集し、拡張子とその関連づけを設定し直す必要があります。
<br />
</p>

<p class="paragraph">
このドキュメントは、そのような局面において「広大なレジストリのどこを編集すれば良いのか？」を解説するものです。
<br />
</p>

<p class="paragraph">
なお、このドキュメントは<strong> 無保証であり、無保障です。</strong>このドキュメントを参考にした操作により発生したいかなる現象も、操作を行った者の自己責任となります。ありきたりですが予防線でした。
<br />
</p>

<h4 id="id867859">注意</h4>

<p class="paragraph">
このドキュメントを読む対象としては、レジストリエディタを起動し、操作できる人間を仮定しています。「レジストリエディタって何？」とか、「キーの追加ってどうやるの？」という方は、まずは「regedit.exe」などで検索し、使い方を覚えてからこのドキュメントを利用してください。（残念ですがそこまで手が回らないッス・・・）
<br />
</p>

<h3 id="ide87c11">編集対象のレジストリ群</h3>

<p class="paragraph">
ファイルの拡張子とその関連づけを保っているレジストリとそのキーを以下に示します。
<br />
</p>

<dl>
<dt> HKEY_LOCAL_MACHINE(HKLM)\SOFTWARE\Classes </dt>
<dd>拡張子と、「ProgID」とも呼ばれる「アプリケーション識別子」が登録されています。</dd>
<dt> HKEY_LOCAL_MACHIN(HKLM)\SOFTWARE\Classes\Applications </dt>
<dd>上のサブキーとなりますが、重要です。なぜなら「プログラムから開く」に一覧表示されるアプリケーション群の設定が格納されるからです。</dd>
<dt> HKEY_USERS(HKU)\(ユーザー識別子)\Software\Classes\Applications </dt>
<dd>「プログラムから開く」の「参照」で手動選択した実行ファイルの設定が格納されます。</dd>
<dd>いわば、HKEY_LOCAL_MACHIN\SOFTWARE\Classes\Applications のユーザー別の設定です。</dd>
<dt> (HKEY_USERS\(ユーザー識別子)_Classes) </dt>
<dd>HKEY_USERS\(ユーザー識別子)\Software\Classes へのシュートカットです。</dd>
</dl>

<p class="paragraph">
このように、実際に操作するレジストリの範囲は案外と狭かったりします。しかし、今までレジストリをさわったり弄ったことのある人なら次の疑問が生じるかもしれません。
<br />
</p>

<p class="paragraph">
「HKEY_CLASSES_ROOT(HKCR)キーは操作しないのですか？」
<br />
</p>

<p class="paragraph">
これに対する答えとしては、
<br />
</p>

<p class="paragraph">
「HKCRはHKLM\SOFTWARE\Classes + HKU\(ユーザー識別子)\Software\Classes\Applications である」
<br />
</p>

<p class="paragraph">
つまり、HKEY_CLASS_ROOTはエイリアス(別名)であり、あくまでも「現在ログイン中のユーザー設定の確認用」として使用すべきなのです。実際に編集すると分かりますが、HKLM\Software\Classes や HKU\...\Software\Classes\Applications に対して行った変更は直ちに HKCR 以下にも反映されます。
<br />
</p>

<p class="paragraph">
本ドキュメントでは、「HKCRの実体は別にある」ことを明確にするため、あえてHKCRではなくその元となるHKLMやHKUを操作することにします。
<br />
</p>

<h3 id="id94ad8e">ファイルの拡張子とその関連づけを設定するには</h3>

<h4 id="idf5215e">操作１：アプリケーションのProgIDを登録する。</h4>

<p class="paragraph">
最初に行うのは、HKLM\Software\Classes 以下に「<strong>ProgID</strong>」と呼ばれる形でアプリケーションを登録することです。
<br />
結論から先に言ってしまうと、Windowsのエクスプローラ（と言うよりは&quot;シェル&quot;）は、ファイルがダブルクリックされると以下の順でたどっていきます。
<br />
</p>
<pre>拡張子 → 拡張子に設定された ProgID → ProgID に設定された実行ファイル本体
</pre>
<p class="paragraph">
従って、とにもかくにも &quot;ProgID&quot; を登録しないと始まらないわけです。
<br />
</p>

<ol><li> &quot;ProgID&quot;となるキーを HKLM\SOFTWARE\Classes 以下に登録します。このキー名は実行ファイル名とは関係なく、アプリケーションが扱うドキュメントの説明文字列みたくします。今回は「hoge.exe」というアプリを想定し、「Hoge.Document」という名前でキーを登録します。</li>
<li> 「Hoge.Document」以下に「shell」キーを追加します。</li>
<li> その中に「open」キーを追加します。</li>
<li> さらにその中に「command」キーを追加します。</li>
<li> 「command」キーの「(既定)」エントリを編集し、hoge.exe へのフルパスと、ファイル名の指示方法を設定します。ダブルクリックされたファイル名は &quot;%1&quot; という変数で取得できますので、たとえば次のようになります。</li></ol>
<pre>C:\Program Files\Hoge\hoge.exe &quot;%1&quot;
</pre>

<p class="paragraph">
この時点までを自動登録するファイル「hoge1.reg」の内容を示します。
<br />
</p>
<ul><li> hoge1.reg</li></ul>
<pre>[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Hoge.Document]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Hoge.Document\shell]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Hoge.Document\shell\open]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Hoge.Document\shell\open\command]
@=&quot;\&quot;C:\\Program Files\\Hoge\\hoge.exe\&quot; \&quot;%1\&quot;&quot;
</pre>

<h4 id="idb5ea26">操作２：拡張子を登録し、関連づけを行う。</h4>

<p class="paragraph">
続いて拡張子を登録します。今回は「.hoge」という新たな拡張子を設定してみます。
<br />
</p>

<ol><li> HKLM\Software\Classes 以下に「.hoge」というキーを追加します。</li>
<li> 「(既定)」エントリを編集し、先ほど追加した「Hoge.Document」というProgIDに設定します。これにより、「.hoge」という拡張子をダブルクリックすると「hoge.exe」が起動するようになります。今回の操作を自動登録するファイル「hoge2.reg」の内容を示します。</li></ol>

<ul><li> hoge2.reg</li></ul>
<pre>[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\.hoge]
@=&quot;Hoge.Document&quot;
</pre>

<p class="paragraph">
・・・実は、たったこれだけで拡張子の関連づけができてしまいます。後の細かい設定は、エクスプローラの「ツール」→「フォルダオプション」→「ファイルの種類」で行う方が良いと思います。アイコンとかの設定は、そちらから行った方が断然楽だと思います。
<br />
</p>

<h3 id="id0856ed">新しい拡張子のファイルをダブルクリックしたとき、何が起こるか？</h3>

<p class="paragraph">
まだシステムに登録していない拡張子のファイルをダブルクリックすると、開くアプリケーションを選択する画面が表示されます。そこで自分でアプリを選択すれば、自動的にその拡張子の関連づけを行ってくれます。この裏側では何が行われているのでしょうか？
<br />
</p>

<p class="paragraph">
結論から言うと、<strong>「拡張子_auto_file」という ProgID を自動的に生成</strong>しています。
<br />
</p>

<p class="paragraph">
上の例で言うなら、自動的に以下のエントリを設定してくれるわけです。
<br />
</p>
<ul><li> hoge_auto.reg</li></ul>
<pre>[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\.hoge]
@=&quot;hoge_auto_file&quot;

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\hoge_auto_file]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\hoge_auto_file\shell]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\hoge_auto_file\shell\open]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\hoge_auto_file\shell\open\command]
@=&quot;\&quot;C:\\Program Files\\Hoge\\hoge.exe\&quot; \&quot;%1\&quot;&quot;
</pre>

<h3 id="id9ea733">「プログラムから開く」のからくり(Inside for &quot;Open With...&quot; dialog box.)</h3>

<p class="paragraph">
著者がこのドキュメントを公開する直接の動機は、<strong>「プログラムから開く」でプログラムを参照できない</strong>というトラブルに見舞われた経験から来ています。（原因そのものは非常に単純なものでしたが・・・）
<br />
</p>

<p class="paragraph">
しかし、トラブルに見舞われずとも「プログラムから開く」で表示されるプログラムの一覧はどこから来ているのか、不思議に思われている方も多いのではないでしょうか？さらに不思議なのは、一度でも「参照」で自分で設定したプログラムは、自動的に一覧に登録してくれる点です。
<br />
</p>

<p class="paragraph">
ここではそのからくりについてみていきます。からくり・・・と言っても、その原理は驚くほど単純です。
<br />
</p>

<h4 id="id47af4b">&quot;NoOpenWith&quot;エントリ</h4>

<p class="paragraph">
(Excluding your applications from &quot;Open With...&quot; dialog box list.)
<br />
</p>

<p class="paragraph">
結論から言うと、「プログラムから開く」(英語だと「Open With...」)に表示されるプログラムの一覧は、次のレジストリキー以下にあります。
<br />
</p>

<pre>HKEY_LOCAL_MACHIN\\SOFTWARE\Classes\Applications
</pre>

<p class="paragraph">
ユーザーが「参照」で自分で指定したプログラムの一覧は、次のレジストリキー以下に保存されます。
<br />
</p>

<pre>HKEY_USERS\(ユーザー識別子)\Software\Classes\Applications
</pre>

<p class="paragraph">
では、今回の例に従い実際に「hoge.exe」を追加してみます。ユーザー別ではなく、HKLMの方を利用してみましょう。結論から提示します。以下の自動登録ファイルのようになります。
<br />
</p>
<ul><li> hoge_openwith.reg</li></ul>
<pre>[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Applications\hoge.exe]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Applications\hoge.exe\shell]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Applications\hoge.exe\shell\open]
[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Applications\hoge.exe\shell\open\command]
@=&quot;\&quot;C:\\Program Files\\Hoge\\hoge.exe\&quot; \&quot;%1\&quot;&quot;
</pre>

<p class="paragraph">
&quot;ProgID&quot;の登録の時と似ています。ユーザーが自分で「参照」で選択した場合、 HKU\...\Classes\Applications 以下にこれと同様のキーとエントリが追加されます。
<br />
</p>

<p class="paragraph">
しかし、実際には HKLM\Software\Classes\Applications には一覧で表示されるよりも遙かに多数の .exe が登録されています。それらはなぜ表示されないのか？結論から言うと、<strong>「NoOpenWith」エントリが存在するから</strong>です。
<br />
NoOpenWith エントリ自体は中身が空の文字列ですが、これが設定されているキーは「プログラムから開く」の一覧には表示されません。
<br />
</p>

<h4 id="ida45219">「プログラムから開く」の履歴</h4>

<p class="paragraph">
(How to delete history from &quot;Open With...&quot; sub menu)
<br />
</p>

<p class="paragraph">
これはインターネット上でも広く知られているTipsです。
<br />
</p>

<pre>HKEY_USERS\...\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts
</pre>

<p class="paragraph">
上記中に、これまでユーザーが開いてきた拡張子の一覧がキーとして登録されています。さらにその中の &quot;OpenWithList&quot; 中に、a から始まるエントリが存在します。それがこれまでそのファイルを開いてきたプログラムの履歴となります。
<br />
</p>

<p class="paragraph">
履歴を削除するには、好みのエントリを削除すれば良いわけです。
<br />
</p>

<h4 id="ida35f91">トラブルシューティング(Trouble Shooting)</h4>

<p class="paragraph">
著者自身が遭遇したトラブルは、&quot;「プログラムから開く」でプログラムを参照できない」&quot;という珍妙な現象でした。原因は単純で、<strong>C:\Program Files 以下にインストールしたフリーソフトのエディタを、丸ごとマイドキュメント以下に移動したことが原因</strong>でした。
<br />
</p>

<p class="paragraph">
詳しく説明すると、C:\Program Files 以下にインストールした時点で、一度「プログラムから開く」で参照できました。「プログラムから開く」の一覧にも表示されていました。この時点で、HKU\...\Software\Classes\Applications 以下にそのエディタのキーが登録されます。（利用したエディタは、インストーラなど無く、圧縮ファイルで展開されたフォルダ中のexeを実行すればそれで済むタイプでした。）
<br />
</p>

<p class="paragraph">
いけなかったのはその後で、エディタの入っているフォルダをマイドキュメント以下に移動してしまったのです。
<br />
</p>

<p class="paragraph">
これにより、「プログラムから開く」一覧を生成する際に「参照先が存在しない」として表示されません。さらにまずいのは、エントリ自体はすでに存在するため、「参照」で移動先のプログラムを指定しても修正されず、結局、プログラムを参照できない状態に陥ったわけです。（試しに適当なフリーのエディタをDLし、実験してみてください。フォルダ名を変更するだけで発現します）
<br />
</p>

<p class="paragraph">
この場合の解決策としては、HKLM\Software\Classes\Applications または HKU\...\Software\Classes\Applications 中の該当プログラムのエントリを一度削除します。その後、改めて「プログラムから開く」で移動先のプログラムを参照すれば、新規エントリとして正常に追加されます。
<br />
</p>

<h3 id="id26fc50">参考URL</h3>

<p class="paragraph">
2008年11月時点での参考URLです。
<br />
</p>
<ul><li> Registry<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/library/ms724871%28VS.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms724871%28VS.85%29.aspx</a></li></ul></li>
<li> Registering File Extensions for Side-By-Side Deployments<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/library/bb166182.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/library/bb166182.aspx</a></li></ul></li>
<li> Extending Shortcut Menus<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/library/cc144101%28VS.85%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/cc144101%28VS.85%29.aspx</a></li></ul></li>
<li> Extending Shortcut Menus for a File Class<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/library/aa926808.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/aa926808.aspx</a></li></ul></li></ul>

<p class="paragraph">
記事作成当時は下記URLを参考にしたのですが、サイト構成などが変更されたようで、現在全てLOSTしています。
<br />
</p>

<ul><li> Windows 2000 Registry<ul><li> <a class="externallink" href="http://msdn.microsoft.com/msdnmag/issues/1100/Registry/print.asp" target="_blank">http://msdn.microsoft.com/msdnmag/issues/1100/Registry/print.asp</a></li></ul></li>
<li> Creating a File Association<ul><li> <a class="externallink" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/programmersguide/shell_basics/shell_basics_extending/fileassociations/fileassoc.asp" target="_blank">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/programmersguide/shell_basics/shell_basics_extending/fileassociations/fileassoc.asp</a></li></ul></li>
<li> Extending Shortcut Menus<ul><li> <a class="externallink" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/programmersguide/shell_basics/shell_basics_extending/context.asp" target="_blank">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/programmersguide/shell_basics/shell_basics_extending/context.asp</a></li></ul></li></ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/14<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>