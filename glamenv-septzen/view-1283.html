<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Java/JAX-RS/勉強メモ(JAX-RS 2.0) - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">Java/JAX-RS/勉強メモ(JAX-RS 2.0)</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2014-04-29 23:30:54 &nbsp; / &nbsp; last updated at: 2014-04-29 23:32:12<br>
カテゴリ: <a href="category-11.html">Java</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1300.html" title="Java/JAX-RS/Jerseyメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1413.html" title="Java/JCE Unlimited Strength Jurisdiction Policy Files + security関連の設定ファイルをカスタマイズしたJREの頒布について調査メモ">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-457.html" title="Java">Java</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
JAX-RS 2.0 (JSR 339)の使い心地について調べたのでメモ。
<br />
</p>

<ul><li> <a class="externallink" href="https://jax-rs-spec.java.net/" target="_blank">https://jax-rs-spec.java.net/</a></li>
<li> <a class="externallink" href="https://jcp.org/en/jsr/detail?id=339" target="_blank">https://jcp.org/en/jsr/detail?id=339</a></li>
<li> <a class="externallink" href="http://ja.wikipedia.org/wiki/JAX-RS" target="_blank">http://ja.wikipedia.org/wiki/JAX-RS</a></li></ul>

<p class="paragraph">
実装：
<br />
</p>
<ul><li> Jersey<ul><li> <a class="externallink" href="https://jersey.java.net/" target="_blank">https://jersey.java.net/</a><ul><li> GlassFish プロジェクトでも使われてる、Sunマイクロシステムズ時代からのJAX-RSのリファレンス実装。ライセンスはCDDLv1.1とGPLv2のデュアルライセンス。</li></ul></li></ul></li>
<li> Apache CXF -- Index<ul><li> <a class="externallink" href="http://cxf.apache.org/" target="_blank">http://cxf.apache.org/</a><ul><li> JAX-RSだけでなく、JAX-WSも含めたWebサービスの実装。ライセンスは当然ASL2.0</li></ul></li></ul></li>
<li> RESTEasy - JBoss Community<ul><li> <a class="externallink" href="http://resteasy.jboss.org/" target="_blank">http://resteasy.jboss.org/</a><ul><li> JBoss中心で実装が進んだJAX-RS実装。ライセンスはASL2.0</li></ul></li></ul></li></ul>



<ul><li><a href="#id567a40">雑多なトピック</a></li>
<li><a href="#id86d1ad">JAX-RSでのユーザ認証について</a></li>
<li><a href="#idf93bb4">RESTfulなAPIサービスと、HTTPセッションについて</a></li>
<li><a href="#id7eec00">RESTとステートレス性についてのそもそもの話</a></li>
<li><a href="#idfed67c">JAX-RS 2.0のフィルタ機能の参考</a></li>
<li><a href="#id7e5660">Jersey使った時に、アプリ全体の初期化処理用のフックとかあるかな？(Servletのinitみたいな)</a></li>
<li><a href="#id44dc63">エラー・例外のカスタマイズ</a></li>
<li><a href="#id074036">レスポンスHTTPヘッダーやボディのカスタマイズ</a></li></ul>
<hr />
<h3 id="id567a40">雑多なトピック</h3>

<p class="paragraph">
JAX-RSを一般的なWebアプリケーションのためのフレームワークとしてはどう評価されているのか？
<br />
</p>
<ul><li> JAX-RSはHTML Webアプリケーションを開発するのに充分なフレームワークであるか？ - AOEの日記<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/aoe-tk/20130317/1363527825" target="_blank">http://d.hatena.ne.jp/aoe-tk/20130317/1363527825</a></li></ul></li>
<li> JAX-RSとかの話 — 裏紙<ul><li> <a class="externallink" href="http://backpaper0.github.io/2013/05/02/jaxrs.html" target="_blank">http://backpaper0.github.io/2013/05/02/jaxrs.html</a></li></ul></li></ul>

<p class="paragraph">
結論：まずます良さげ。
<br />
</p>

<p class="paragraph">
JAX-RS関連調べてて気になったトピック
<br />
</p>
<ul><li> Bean Validation: Bean Validation<ul><li> <a class="externallink" href="http://beanvalidation.org/" target="_blank">http://beanvalidation.org/</a><ul><li> JAX-RSの実装でもvalidationに使われてる、アノテーションベースのvalidationの仕様と実装</li></ul></li></ul></li>
<li> 私のBeanValidationの使い方(Java EE Advent Calendar 2013) — 裏紙<ul><li> <a class="externallink" href="http://backpaper0.github.io/2013/12/03/javaee_advent_calendar_2013.html" target="_blank">http://backpaper0.github.io/2013/12/03/javaee_advent_calendar_2013.html</a></li></ul></li>
<li> JAX-RSでパラメータの受け取り方をいろいろ試す — 裏紙<ul><li> <a class="externallink" href="http://backpaper0.github.io/2013/07/17/jaxrs_parameter.html" target="_blank">http://backpaper0.github.io/2013/07/17/jaxrs_parameter.html</a><ul><li> サンプルとして参考になります。</li></ul></li></ul></li>
<li> Oracle Blogs 日本語のまとめ: [Java] Java EE 7 and JAX-RS 2.0<ul><li> <a class="externallink" href="http://orablogs-jp.blogspot.jp/2013/04/java-ee-7-and-jax-rs-20.html" target="_blank">http://orablogs-jp.blogspot.jp/2013/04/java-ee-7-and-jax-rs-20.html</a><ul><li> JavaEE7とJAX-RS 2.0の紹介</li></ul></li></ul></li>
<li> Project Grizzly - Http Server Framework Overview<ul><li> <a class="externallink" href="https://grizzly.java.net/httpserverframework.html" target="_blank">https://grizzly.java.net/httpserverframework.html</a><ul><li> HTTP ServerとしてのGrizzlyの提供するフレームワーク概要。セッションとかフィルタなど、ちゃんと備えてる。</li></ul></li></ul></li>
<li> Grizzly 2.0: HttpServer API. Implementing simple HTTP server (Mytec)<ul><li> <a class="externallink" href="https://blogs.oracle.com/oleksiys/entry/grizzly_2_0_httpserver_api" target="_blank">https://blogs.oracle.com/oleksiys/entry/grizzly_2_0_httpserver_api</a><ul><li> OracleのBlog記事。</li></ul></li></ul></li></ul>


<h3 id="id86d1ad">JAX-RSでのユーザ認証について</h3>

<p class="paragraph">
Servletコンテナで提供しているRoleベースの認証機能を使う。JAX-RSでは&quot;@Context&quot;アノテーションでSecurity Contextにアクセスできるよう定められているため、Servletコンテナ側でBasic認証など設定していれば、FilterなどのProviderや、リソースから&quot;@Context&quot;経由で参照し、処理出来る。
<br />
</p>

<ul><li> A simple JAX-RS security context example in GlassFish | IT Business Tonic<ul><li> <a class="externallink" href="http://www.butonic.de/2010/06/18/a-simple-jax-rs-security-context-example-in-glassfish/" target="_blank">http://www.butonic.de/2010/06/18/a-simple-jax-rs-security-context-example-in-glassfish/</a></li></ul></li>
<li> Jersey (JAX-RS) のアクセス制御 - あめだま<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/momijiame/20120215/1329317290" target="_blank">http://d.hatena.ne.jp/momijiame/20120215/1329317290</a></li></ul></li>
<li> forcing the Jersey Grizzly server to authenicate - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/15980658/forcing-the-jersey-grizzly-server-to-authenicate" target="_blank">http://stackoverflow.com/questions/15980658/forcing-the-jersey-grizzly-server-to-authenicate</a><ul><li> Grizzlyでのユーザ認証でSecurityContextをどう使うかについての相談</li></ul></li></ul></li>
<li> Jersey (JAX-RS) implements a HTTP Basic Auth decoder | Simple API<ul><li> <a class="externallink" href="http://simplapi.wordpress.com/2013/01/24/jersey-jax-rs-implements-a-http-basic-auth-decoder/" target="_blank">http://simplapi.wordpress.com/2013/01/24/jersey-jax-rs-implements-a-http-basic-auth-decoder/</a><ul><li> JAX RSで、Filterを使って独自にBasic認証を実装するサンプル</li></ul></li></ul></li></ul>

<p class="paragraph">
→結論は↓のトピックに持ち越し
<br />
</p>

<h3 id="idf93bb4">RESTfulなAPIサービスと、HTTPセッションについて</h3>

<ul><li> Jersey - In JAX-RS: Jersey: API model, how do you access HTTP session variables<ul><li> <a class="externallink" href="http://jersey.576304.n2.nabble.com/In-JAX-RS-Jersey-API-model-how-do-you-access-HTTP-session-variables-td2953702.html" target="_blank">http://jersey.576304.n2.nabble.com/In-JAX-RS-Jersey-API-model-how-do-you-access-HTTP-session-variables-td2953702.html</a><ul><li> そもそもRESTでセッション使うものなんだっけ？というメールスレッド。基本的にはRESTのステートレス性を損なうので使わない方が良いのだけれど、使うならこうしてね、というアドバイスの返信がある。</li></ul></li></ul></li></ul>

<p class="paragraph">
以下、RESTfulなAPIサービスで認証をどう実装すればよいのか、Stack Overflowでも賑わってました：
<br />
</p>
<ul><li> web services - How Can I Retrieve The Session Id from a Jax RS Webservice? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/4819837/how-can-i-retrieve-the-session-id-from-a-jax-rs-webservice" target="_blank">http://stackoverflow.com/questions/4819837/how-can-i-retrieve-the-session-id-from-a-jax-rs-webservice</a><ul><li> JAX RSでServletRequestからセッションIDを取得する方法の例示。</li></ul></li></ul></li>
<li> jersey - HttpSession is null in RESTful web service? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/13882935/httpsession-is-null-in-restful-web-service" target="_blank">http://stackoverflow.com/questions/13882935/httpsession-is-null-in-restful-web-service</a><ul><li> Tomcat7でJersey使った時に、HttpServletRequest#getSession(boolean)でちょっとハマった事例。</li></ul></li></ul></li>
<li> Authentication for REST web services - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/19721403/authentication-for-rest-web-services" target="_blank">http://stackoverflow.com/questions/19721403/authentication-for-rest-web-services</a></li></ul></li>
<li> methods - How do I authenticate user in REST web service? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/5528272/how-do-i-authenticate-user-in-rest-web-service" target="_blank">http://stackoverflow.com/questions/5528272/how-do-i-authenticate-user-in-rest-web-service</a></li></ul></li></ul>

<p class="paragraph">
→結論は↓のトピックに再度持ち越し
<br />
</p>

<h3 id="id7eec00">RESTとステートレス性についてのそもそもの話</h3>

<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/REST" target="_blank">http://en.wikipedia.org/wiki/REST</a></li>
<li> <a class="externallink" href="http://www.ics.uci.edu/~taylor/documents/2002-REST-TOIT.pdf" target="_blank">http://www.ics.uci.edu/~taylor/documents/2002-REST-TOIT.pdf</a></li>
<li> REST について調べたまとめ - Slow Dance<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/LukeSilvia/20091025/p1" target="_blank">http://d.hatena.ne.jp/LukeSilvia/20091025/p1</a></li></ul></li></ul>

<p class="paragraph">
RESTではスケーラビリティ等を考慮して、ステートレスにしよう、という思想がある。そこで、CookieによるセッションIDで認証状態を管理してしまうと、サーバ側でのスケーラビリティで色々制約や工夫の必要が生じてしまうので、なるべくクライアント側だけでステートを持たせようね、という話があるようです。
<br />
</p>
<ul><li> Representational State Transfer (REST) : 5.1.3 Stateless<ul><li> <a class="externallink" href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_3" target="_blank">http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_3</a></li></ul></li>
<li> Experience and Evaluation : 6.3.4.2 Cookies<ul><li> <a class="externallink" href="http://www.ics.uci.edu/~fielding/pubs/dissertation/evaluation.htm#sec_6_3_4_2" target="_blank">http://www.ics.uci.edu/~fielding/pubs/dissertation/evaluation.htm#sec_6_3_4_2</a></li></ul></li>
<li> RESTアンチパターン<ul><li> <a class="externallink" href="http://www.infoq.com/jp/articles/rest-anti-patterns" target="_blank">http://www.infoq.com/jp/articles/rest-anti-patterns</a></li></ul></li>
<li> Learn REST: A Tutorial: 14.3. How do I handle authentication in REST?<ul><li> <a class="externallink" href="http://rest.elkstein.org/2008/01/how-do-i-handle-authentication-in-rest.html" target="_blank">http://rest.elkstein.org/2008/01/how-do-i-handle-authentication-in-rest.html</a></li></ul></li></ul>

<p class="paragraph">
結論・・・というかとりあえずの検討結果：
<br />
</p>
<ul><li> ステートレス性を犠牲にしてスケーラビリティで苦労するのを受け入れた上で、普通にServletのCookieによるセッション管理機能をフィルタとかで組み込む方向性はアリだと思いました。</li>
<li> Ajaxを使ったRIAで、AjaxだけBasic認証というのはかなり辛いと思いますので、OAuth2.0系を使ってtokenをクライアント側で管理してGET以外のパラメータでやりとりするのもありかなと。GETでやりとりしてしまうとプロキシやサーバログとかに残ってセキュリティ上問題になるので、GET禁止・・・となるとまたRESTの特性の一部が失われますが。</li>
<li> Railsがやってるように、Client側のCookieの中にセッション状態を詰め込むのもアリだと思いますが、これはもう言語やプラットフォームごとにこのアプローチの得手不得手が出てきてしまいます。うかつに独自実装すると、セキュリティ上穴が出来てしまわないか怖いですし・・・。</li>
<li> どちらにしても、原理主義でいくか、現場主義でいくか、バランス取らないとやってけないと思いました。</li></ul>


<h3 id="idfed67c">JAX-RS 2.0のフィルタ機能の参考</h3>

<ul><li> Chapter 9. Filters and Interceptors<ul><li> <a class="externallink" href="https://jersey.java.net/documentation/latest/filters-and-interceptors.html" target="_blank">https://jersey.java.net/documentation/latest/filters-and-interceptors.html</a></li></ul></li>
<li> JAX-RS のリファレンス実装 Jersey のフィルタを使う方法 - あめだま<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/momijiame/20111115/1321372807" target="_blank">http://d.hatena.ne.jp/momijiame/20111115/1321372807</a></li></ul></li>
<li> JAX-RS のリファレンス実装 Jersey のフィルタを使う方法 その2 - あめだま<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/momijiame/20111116/1321455103" target="_blank">http://d.hatena.ne.jp/momijiame/20111116/1321455103</a></li></ul></li>
<li> WebAPIのステートレスなCSRF対策 - あめだま<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/momijiame/20111204/1323000833" target="_blank">http://d.hatena.ne.jp/momijiame/20111204/1323000833</a><ul><li> ・・・これ、XHR2 で他のOriginからもXHR呼べるようになったので、このCSRF対策破綻してるような・・・。</li></ul></li></ul></li></ul>


<p class="paragraph">
フィルタ中から、ContainerRequestContext#setProperty()経由でセットしたオブジェクトを、リソースクラスから読み出せるか？
<br />
</p>
<ul><li> java - JBoss / Resteasy how to prepopulate objects using a filter before the exposed API? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/20239025/jboss-resteasy-how-to-prepopulate-objects-using-a-filter-before-the-exposed-ap" target="_blank">http://stackoverflow.com/questions/20239025/jboss-resteasy-how-to-prepopulate-objects-using-a-filter-before-the-exposed-ap</a></li></ul></li>
<li> java - How I can add parameter to request from jersey filter request (ContainerRequestFilter) - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/18876053/how-i-can-add-parameter-to-request-from-jersey-filter-request-containerrequestf" target="_blank">http://stackoverflow.com/questions/18876053/how-i-can-add-parameter-to-request-from-jersey-filter-request-containerrequestf</a></li></ul></li>
<li> Read request attribute in a Jersey ContainerRequestFilter - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/19691753/read-request-attribute-in-a-jersey-containerrequestfilter" target="_blank">http://stackoverflow.com/questions/19691753/read-request-attribute-in-a-jersey-containerrequestfilter</a></li></ul></li></ul>

<p class="paragraph">
結論：JAX-RS 2.0としての仕様ではそうしたアクセス用APIは（多分）提供されてない（っぽい）。
<br />
一応、Servletアプリ上で動かす場合はContainerRequestContext#setProperty()/getProperty()は ServletRequest の Attribute と連動しているよう定められているため、リソースクラスに &quot;@Context&quot; で HttpServletRequest をインジェクションして、そこから取り出す方法はある。
<br />
なお、JAX-RSのApplicationクラスが提供しているgetProperties()は、JAX-RSアプリ全体のconfigurationだったり、Servlet実装の場合は&lt;context-param&gt;や&lt;init-param&gt;と連動してたりするため、フィルタ機能とは関係ない。ただし、アプリ全体の設定値を取得する際には活用できそう。
<br />
</p>

<h3 id="id7e5660">Jersey使った時に、アプリ全体の初期化処理用のフックとかあるかな？(Servletのinitみたいな)</h3>

<ul><li> java - Initialize database on Jersey webapp startup - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/12875682/initialize-database-on-jersey-webapp-startup" target="_blank">http://stackoverflow.com/questions/12875682/initialize-database-on-jersey-webapp-startup</a></li></ul></li>
<li> Jersey app-run initialization code on startup to initialize application - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/7424465/jersey-app-run-initialization-code-on-startup-to-initialize-application" target="_blank">http://stackoverflow.com/questions/7424465/jersey-app-run-initialization-code-on-startup-to-initialize-application</a></li></ul></li>
<li> Jersey - Servlet.Init() For Jersey REST Service<ul><li> <a class="externallink" href="http://jersey.576304.n2.nabble.com/Servlet-Init-For-Jersey-REST-Service-td6507144.html" target="_blank">http://jersey.576304.n2.nabble.com/Servlet-Init-For-Jersey-REST-Service-td6507144.html</a></li></ul></li></ul>

<p class="paragraph">
結論：仕様としては、無い。
<br />
</p>

<p class="paragraph">
ただし、例えばFilterはライフサイクル上、ひとつのアプリで1インスタンスだけなので、コンストラクタでグローバルな設定を初期化するのはアリだろう。
<br />
また、Servletコンテナ上で動かすのであれば、普通にServletのinit中で、Singletonで初期化するのもアリ。Servlet中のClassLoader上で動作するのであれば、JAX-RSアプリ内からも参照できるはず。Singletonを上手く使うのもちょっと色々工夫がいるだろうけど・・・。
<br />
あとはSpringやGuiceなどのDIコンテナと上手く組み合わせて工夫するとか。
<br />
</p>


<h3 id="id44dc63">エラー・例外のカスタマイズ</h3>

<ul><li> 6.3. WebApplicationException and Mapping Exceptions to Responses<ul><li> <a class="externallink" href="https://jersey.java.net/documentation/latest/representations.html" target="_blank">https://jersey.java.net/documentation/latest/representations.html</a></li></ul></li>
<li> JAX-RS アプリケーションの 404 Not Found のカスタマイズ (リソースが見つからない場合) - ひだまりソケットは壊れない<ul><li> <a class="externallink" href="http://vividcode.hatenablog.com/entry/java/jax-rs/not-found-customize" target="_blank">http://vividcode.hatenablog.com/entry/java/jax-rs/not-found-customize</a></li></ul></li>
<li> java - JAX-RS / Jersey how to customize error handling? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/583973/jax-rs-jersey-how-to-customize-error-handling" target="_blank">http://stackoverflow.com/questions/583973/jax-rs-jersey-how-to-customize-error-handling</a></li></ul></li></ul>

<p class="paragraph">
リソースクラスの処理内で発生した例外についてはこんな感じかな？
<br />
</p>
<ol><li> 自力でtry-catchした後に、カスタマイズした専用のWebApplicationException派生の例外クラスをthrowする。</li>
<li> カスタマイズしたException派生の例外クラスをthrowし、それに対応するExceptionMapperをProviderとして用意しておく。</li>
<li> カスタマイズしたException派生の例外クラスをthrowし、実行環境(Servletコンテナなど)のデフォルトの例外処理に委譲する。</li></ol>


<p class="paragraph">
また、JAX-RS側のデフォルトの404例外などをカスタマイズしたい場合は、内部的に以下のような例外が定められていてthrowされるので、それに対応するExceptionMapperを自分たちで準備しておけば良いっぽい。（単にJavaDocからそれっぽいのを引っ張ってきてるだけのため、本当にそうなのかは不明。）
<br />
</p>
<ul><li> NoContentException</li>
<li> NotAcceptableException</li>
<li> NotAllowedException</li>
<li> NotAuthorizedException</li>
<li> NotFoundException</li>
<li> NotSupportedException</li></ul>

<p class="paragraph">
こういうのがあるのを知っておけば、カスタム例外を作る手間が省けて、JAX-RS側で用意してくれてるこれらの例外で済ませられるケースもあるかも？
<br />
</p>


<h3 id="id074036">レスポンスHTTPヘッダーやボディのカスタマイズ</h3>

<ul><li> Chapter 6. Representations and Responses<ul><li> <a class="externallink" href="https://jersey.java.net/documentation/latest/representations.html" target="_blank">https://jersey.java.net/documentation/latest/representations.html</a></li></ul></li>
<li> jax rs - Is it possible to control the filename for a Response from a Jersey Rest service? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/5318132/is-it-possible-to-control-the-filename-for-a-response-from-a-jersey-rest-service" target="_blank">http://stackoverflow.com/questions/5318132/is-it-possible-to-control-the-filename-for-a-response-from-a-jersey-rest-service</a></li></ul></li>
<li> my kingdom for a smile :-): How to return a Location header from a Jersey REST service<ul><li> <a class="externallink" href="http://usna86-techbits.blogspot.jp/2013/02/how-to-return-location-header-from.html" target="_blank">http://usna86-techbits.blogspot.jp/2013/02/how-to-return-location-header-from.html</a></li></ul></li></ul>


<p class="paragraph">
結論としては、HTTPレスポンスのカスタマイズ性は非常に自由度が高い状態にある。
<br />
まず、Response#status()でステータスコードを指定してResponseBuilderのインスタンスを取得する。
<br />
ResponseBuilderには、以下のようにレスポンスをカスタマイズできるメソッドが公開されている。
<br />
</p>
<ul><li> entity() : byte[]やStringやObjectなど、レスポンスBODYを設定出来る。</li>
<li> header() : レスポンスヘッダをカスタマイズ出来る。</li>
<li> type() : Content-Typeヘッダをカスタマイズできる。&quot;text/html&quot;や&quot;application/octet-stream&quot;など頻用される値についてはMediaTYpeのstaticインスタンスとして定義済みなので、いちいち正確な綴りを思い出す必要がない。&quot;charset&quot;指定も、自然な形でメソッドとして統合されている。</li>
<li> location() : 基本的にリダイレクト系は、Response#seeOther(URI), temporaryRedirect(URI), created(URI) でステータスコードも一緒に設定してくれるが、フルカスタマイズで個別にLocationヘッダーを設定したい場合はこちらのメソッドが使える。</li>
<li> encoding() : ガラケーサイト向けにSJISで出力したい、という場合に、entity()にはJava世界の文字列をそのままStringで渡して、こちらのencoding()で実際に出力するときのエンコーディングを指定する。Content-Typeのcharsetが自動的に連動してくれるかは不明なので、自分でtype()で指定しておくのが無難か。</li></ul>

<p class="paragraph">
上記メソッドは、いずれもそのメソッドで更新されたResponseBuilder()を返してくるので、メソッドコールのチェインをつなげていく格好になり、最後に&quot;build()&quot;メソッドを呼べば、最終的なResponseクラスのインスタンスが返される。これを単純にreturnすればよい。
<br />
</p>

<p class="paragraph">
※&quot;@Context&quot;でHttpServletResponseをインジェクとしてもらって、それも合わせて操作した場合に、何か衝突など発生しないか、については未検証。セッション管理系のCookie操作とか大丈夫かな？
<br />
</p>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1300.html" title="Java/JAX-RS/Jerseyメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1413.html" title="Java/JCE Unlimited Strength Jurisdiction Policy Files + security関連の設定ファイルをカスタマイズしたJREの頒布について調査メモ">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-457.html" title="Java">Java</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1283<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>