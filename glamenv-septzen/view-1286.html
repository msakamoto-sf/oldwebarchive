<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/ソフトウェア設計/ドメインモデル(Domain Model), Service Layer周辺 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/ソフトウェア設計/ドメインモデル(Domain Model), Service Layer周辺</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2014-05-06 23:06:40 &nbsp; / &nbsp; last updated at: 2014-05-06 23:07:54<br>
カテゴリ: <a href="category-11.html">Java</a>&nbsp;<a href="category-22.html">システム開発</a>&nbsp;<a href="category-12.html">プログラミング</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1390.html" title="技術/ソフトウェア設計/MVVM(Model View ViewModel)デザインパターンとData Bindingの参考URLメモ(2015-03時点)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-327.html" title="技術/プロトコルまとめメモ(HTTP,SMTP,POP3)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
会社で、Ruby on RailsのバックグラウンドがあるけどJavaはそれほど深くない人向けに、Javaでのオブジェクト指向設計とか、パッケージやクラスの分け方、置き方を説明した方が良いかなーという場面が出てきました。
<br />
</p>

<p class="paragraph">
が、いざ棚卸ししてみますと、特にドメインモデル周辺について自分も良く理解してない点が多々有りまして。なんかざっと記事を漁ってみまして、それのログというかメモ書きになります。
<br />
</p>

<p class="paragraph">
全体的に「如是我聞」な内容・・・どころか、そのまんま載せるのに力不足でもしかしたら曲解・誤解して書いてる内容があるかもしれません。とにかく参考資料（記事のURLや、PoEAA本のP数）については載せましたので、不審に感じたら元資料をあたってみてください。
<br />
</p>



<ul><li><a href="#id794c90">開始点 : service layerとかdomainの分け方</a></li>
<li><a href="#id4de3af">キーワード：「ドメイン」</a></li>
<li><a href="#ida0ce2a">キーワード： &quot;Service Layer&quot; （ここから迷走が始まる）</a></li>
<li><a href="#ide87123">キーワード： 「値オブジェクト (Value Object&quot;)」「エンティティ (Entity)」</a></li>
<li><a href="#id7df19a">キーワード：「ドメインモデル貧血症」(AnemicDomainModel)</a></li>
<li><a href="#id89511b">ドメインモデル貧血症への対処について</a></li>
<li><a href="#id3f0c8b">キーワード：「データ転送オブジェクト」(Data Transfer Object)</a></li>
<li><a href="#id859b35">RailsのActiveRecordとDomain Modelについて</a></li>
<li><a href="#id5a796c">&quot;fat model&quot;, &quot;fat controller&quot; への対処</a></li>
<li><a href="#idbb04c1">EJBはどう考えようか？</a></li>
<li><a href="#id5f63f5">参考資料</a></li>
<li><a href="#id7a575c">感想</a></li></ul>
<hr />
<h3 id="id794c90">開始点 : service layerとかdomainの分け方</h3>

<p class="paragraph">
うろ覚えになってたのが、「なんかservice layerとかdomain modelとかbusiness logicとかに分けるんだよなー」レベルでしたので、そもそも service layer ってなんだろうと適当にググりました。
<br />
</p>

<ul><li> Service-oriented architecture - Wikipedia, the free encyclopedia<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/Service-oriented_architecture" target="_blank">http://en.wikipedia.org/wiki/Service-oriented_architecture</a></li></ul></li>
<li> Chapter 1: Service Oriented Architecture (SOA)<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/library/bb833022.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/bb833022.aspx</a></li></ul></li></ul>

<p class="paragraph">
・・・SOAは飛びすぎた・・・。
<br />
</p>

<ul><li> 2.4. アプリケーションのレイヤ化 — TERASOLUNA Global Framework Development Guideline 1.0.0.publicreview documentation<ul><li> <a class="externallink" href="http://terasolunaorg.github.io/guideline/public_review/Overview/ApplicationLayering.html" target="_blank">http://terasolunaorg.github.io/guideline/public_review/Overview/ApplicationLayering.html</a></li></ul></li></ul>

<p class="paragraph">
TERASOLUNA というフレームワーク用の解説になってますが、うろ覚えレベルの知識でも、「ああ、そうそう、こんなレイヤー分けだったわ。」的な図が載ってて分かりやすい。
<br />
</p>

<h3 id="id4de3af">キーワード：「ドメイン」</h3>

<p class="paragraph">
「ドメイン」というのが分かりづらいのですが、そのアプリの解決すべき問題を表現するものらしいです。
<br />
</p>


<p class="paragraph">
ここで分かりづらいのが、「ドメインロジック(domain logic)」とか「ドメインモデル(domain model)」みたいな用語が乱れ飛んでる点でした。
<br />
</p>

<ul><li> ドメインモデル - Wikipedia<ul><li> <a class="externallink" href="http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%A2%E3%83%87%E3%83%AB" target="_blank">http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%A2%E3%83%87%E3%83%AB</a></li></ul></li></ul>

<p class="paragraph">
この記載を参考にすれば、システムに関わる実体とその関係を説明する、概念レベルの模型化、ということで、そんなに違和感は感じません。
<br />
</p>

<p class="paragraph">
ところが、Martin Fowlerの&quot;Patterns of Enterprise Application Architecture&quot;(PoEAA)にも「パターン」の一つとして「Domain Model」というのが出てきます。
<br />
こちらはUMLで図を書いて模型化する・・・という話ではなくて、概念に名前をつけた（ドメイン）オブジェクトに振る舞いも持たせるパターンがPoEAAの書くところのDomain Model パターン・・・らしい、です・・・。（これについて断言できるの、PoEAAの著者だけちゃうんか？めんどくさいから全部に「如是我聞」付けたろか。）
<br />
</p>

<p class="paragraph">
例えばblogシステムだったら、「記事」という概念がドメインとしてそのまま、Articleというオブジェクトで表現されます。記事の属性やテキストデータが、オブジェクトのプロパティとかフィールドに格納される。で、記事の作成とか編集が、Articleオブジェクトのメソッドとして公開されます。多分こんな感じ。
<br />
</p>

<p class="paragraph">
ところが、機能が増えてくると色々、本来の「記事」とは関連しないような操作が要求されるようになります。
<br />
例えばユーザがある記事を &quot;watch&quot; して、記事が更新されたりコメントが投稿されたらメールで教えて欲しいとか。
<br />
「コメント」は「記事」に関連する別概念として切り出したほうが良いでしょうか？そうなると、データの表現として、「記事」オブジェクトと「コメント」オブジェクトはどう関連付ければ良いのでしょうか？
<br />
</p>

<p class="paragraph">
ここで、どうやら2つの方向性があるっぽいです。(PoEAA, p117)
<br />
1つ目は、「シンプルな」Domain Modelと呼ばれてるもので、RDBなどでテーブルをそのまま1つのドメインとして切り出した形式で、Active Record パターンなどが使われるようです。
<br />
2つ目は、「リッチな」Domain Modelと呼ばれてるもので、もっと複雑なロジックやデザインパターンを活用して、1つのドメインに対応するデータベースの実体を特定できないほど複雑なタイプで、これは Data Mapper パターンが上手く当てはまるようです。
<br />
</p>

<h3 id="ida0ce2a">キーワード： &quot;Service Layer&quot; （ここから迷走が始まる）</h3>

<p class="paragraph">
アプリやシステムを構築していくと、Domain Modelに収まらないような概念や処理が出てきます。例えば決裁管理のワークフローを実現するようなアプリケーションだと、決裁処理が進むと、対象となる書類、申請者、決裁者、など複数の概念（ドメイン）が関連して状態が変化します。
<br />
そうなった時に導入を検討するのが、アプリケーションとして必要なドメイン処理をまとめたレイヤーで、これが PoEAA p133で &quot;Service Layer&quot;パターンとして紹介されてます。
<br />
</p>

<p class="paragraph">
<strong>多分、本来の Service Layer は複数のDomain ModelかTransaction Script (PoEAA p110)を連携させるだけの薄いラッパー処理になることを意図していたように思われます。</strong>
<br />
こんな感じで、ひとつの境界線として機能するわけです：
<br />
</p>
<pre>UI/Batch/HTTP &lt;-&gt; Service Layer &lt;-&gt; Domain Models / Transaction Scripts
</pre>

<p class="paragraph">
ところがだんだん、Domain Model の扱いがおざなりになってきて、
<br />
</p>
<pre>UI/Batch/HTTP &lt;-&gt; Service Layer &lt;-&gt; SQLなど永続化処理、各種ビジネスロジック
                                &lt;-&gt; 値オブジェクト / エンティティ
</pre>
<p class="paragraph">
のようになってきて、&quot;Domain Model&quot;がデータ表現だけを扱う状態になってしまい、Service Layerの中に処理がどんどん入ってきてしまう、そんな設計が増えてきてしまったようです。
<br />
</p>

<h3 id="ide87123">キーワード： 「値オブジェクト (Value Object&quot;)」「エンティティ (Entity)」</h3>

<p class="paragraph">
「値オブジェクト」というのは、識別する必要のないラベル値、量などを表現するパターンです。
<br />
</p>
<ul><li> PoEAA, p486, &quot;Value Object&quot; : &quot;A small simple object, like money or a date range, whose equality isn&#039;t based on identity.&quot;</li>
<li> ドメイン駆動設計・アプリケーション構築編・値オブジェクト - Strategic Choice<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/asakichy/20110525/1306276845" target="_blank">http://d.hatena.ne.jp/asakichy/20110525/1306276845</a></li></ul></li></ul>


<p class="paragraph">
「エンティティ」というのは、ドメインの表現により強く関連し、ID値を持っていて、他のデータと区別する必要があるオブジェクトです。ユーザや記事、グループなど、一般的なCRUD操作が必要となるデータ表現全般に当てはまるオブジェクトです。
<br />
</p>
<ul><li> ドメイン駆動設計・アプリケーション構築編・エンティティ - Strategic Choice<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/asakichy/20110524/1306190461" target="_blank">http://d.hatena.ne.jp/asakichy/20110524/1306190461</a></li></ul></li></ul>

<p class="paragraph">
この辺の記事を読んでみると、例えば「ユーザ」の1人を表現するのが「エンティティ」で、その性別を表現するラベル付の値は「値オブジェクト」として考えて差し支えなさそうです。
<br />
</p>
<ul><li> .NETでドメイン駆動開発～ValueObject 前編～<ul><li> <a class="externallink" href="http://www.infoq.com/jp/articles/DDD_ValueObject" target="_blank">http://www.infoq.com/jp/articles/DDD_ValueObject</a></li></ul></li>
<li> .NETでドメイン駆動開発～ValueObject後編～<ul><li> <a class="externallink" href="http://www.infoq.com/jp/articles/DDD_ValueObject_0325" target="_blank">http://www.infoq.com/jp/articles/DDD_ValueObject_0325</a></li>
<li> 「Entityのプロパティに使用する。」「Entityのプロパティに使用する属性用のclassのこと。」辺りの記述が参考になりそう。</li></ul></li></ul>

<p class="paragraph">
&quot;Service Layer&quot;の誤用の話題に戻すと、本来のDomain Modelとの関係から離れてしまって、単なるValue ObjectやEntityオブジェクトを&quot;Domain Model&quot;と呼んでしまい、ドメインに関連するロジックがすべて Service Layer で実装されてしまう設計が問題視されたようです。
<br />
</p>

<h3 id="id7df19a">キーワード：「ドメインモデル貧血症」(AnemicDomainModel)</h3>

<p class="paragraph">
前述のような、Service Layerに処理が書かれすぎてしまい、肝心の Domain Model が Domain Model の本来の機能を果たしていない、という状況について Martin Fowler たちが「ドメインモデル貧血症」というアンチパターンを命名しました。
<br />
</p>

<ul><li> AnemicDomainModel<ul><li> <a class="externallink" href="http://www.martinfowler.com/bliki/AnemicDomainModel.html" target="_blank">http://www.martinfowler.com/bliki/AnemicDomainModel.html</a></li></ul></li>
<li> Martin Fowler&#039;s Bliki in Japanese - ドメインモデル貧血症<ul><li> <a class="externallink" href="http://capsctrl.que.jp/kdmsnr/wiki/bliki/?AnemicDomainModel" target="_blank">http://capsctrl.que.jp/kdmsnr/wiki/bliki/?AnemicDomainModel</a></li></ul></li></ul>

<p class="paragraph">
Javaとは離れてしまいますが、MSDNマガジンで「ドメインモデル貧血症」、「リッチなDomain Model」、「値オブジェクト」について分かりやすい記事が公開されています。
<br />
</p>
<ul><li> データ ポイント - ドメイン駆動設計のコーディング: データを重視する開発者のためのヒント (第 2 部)<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/magazine/dn385704.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/magazine/dn385704.aspx</a></li>
<li> 引用:「値オブジェクトの基本は、ID キーのないクラスです。」</li></ul></li></ul>

<h3 id="id89511b">ドメインモデル貧血症への対処について</h3>

<p class="paragraph">
まだ調査が進んでいないのですが、そもそもPoEAAでもDomain Model自体が「ものにする」のが難しいパターンで、コンサルタントを呼んで学んだり、トレーニングを積んだり、コーチングを受けて使えるようになるまでは Transaction Script やData Mapperを採用する手もある、と書かれているほどです。(PoEAA, p119, &quot;When to Use It&quot;)
<br />
</p>

<p class="paragraph">
あくまでも私見ですが、それほどまでに習熟が難しい&quot;Domain Model&quot;パターンを、限られたリソースしか投入できない現実の開発現場で、本当にMartin Fowlerたちが目論んだどおりの意図に厳密に従い適用するのは、そもそも現実的な話なのでしょうか？
<br />
</p>

<p class="paragraph">
Data Modelのメリットとしては、OOPの作り方を活かせるため、処理が分散しない、という点が挙げられます。しかし、本当にそのメリットを享受するだけの価値が、Data Modelの学習コストでペイ出来るんでしょうか・・・？？？
<br />
</p>

<p class="paragraph">
Data Model「でなければならない」というのは、法律で定められてる訳ではないので、ある程度のリスクを取った上で、Transaction Script や Data Mapper を適用した方が適切なケースはある筈です。
<br />
</p>

<p class="paragraph">
Service Layerの切り分けについても、粒度の問題があります。アプリのユースケースに対して、Service Layer や Domain Model, Transaction Scirpt の粒度をどのように調整するのか、という観点が出てきます。
<br />
これについては以下の記事が参考になると思います。
<br />
</p>
<ul><li> いまさらきけない「ドメインモデル」と「トランザクションスクリプト」 - ひがやすを blog<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/higayasuo/20080519/1211183826" target="_blank">http://d.hatena.ne.jp/higayasuo/20080519/1211183826</a></li>
<li> 「ドメインで扱う概念の中には、機能で閉じていて、もの（オブジェクト）として扱うのが不自然なものがある」</li></ul></li></ul>

<p class="paragraph">
上手くDomain Modelを組み立てられないような処理が出てきたので、徐々にService Layerが太っていった可能性もあり、そうした場合の解としてはやはり、Service に組み込む、というアプローチがあるようです。
<br />
</p>
<ul><li> [ 技術講座 ] Domain-Driven Designのエッセンス 第2回<ul><li> <a class="externallink" href="http://www.ogis-ri.co.jp/otc/hiroba/technical/DDDEssence/chap2.html#Services" target="_blank">http://www.ogis-ri.co.jp/otc/hiroba/technical/DDDEssence/chap2.html#Services</a></li></ul></li></ul>

<h3 id="id3f0c8b">キーワード：「データ転送オブジェクト」(Data Transfer Object)</h3>

<p class="paragraph">
実際にアプリケーションを設計する際は、プレゼンテーション層のことも忘れてはいけません。
<br />
ここで、Domain Model辺りを検討していると、「はたして、プレゼンテーション層がダイレクトにDomain Modelに触るのは適切だろうか？」という疑問が出てきます。
<br />
ましてや Service Layer を導入すると、そもそも Service Layer は境界線として機能するため、プレゼンテーション層が Service Layer を介して Domain Model のオブジェクトを取得できてアクセスできてしまうのはどうも一貫性に欠けている気もします。
<br />
</p>

<p class="paragraph">
そういう場合に、DTOに変換することで、データ転送のためだけの、シリアライズ可能なオブジェクトとして扱うパターンが「データ転送オブジェクト」(DTO)のようです。(PoEAA, p401)
<br />
シリアライズが出てくるのは、ネットワークを介した分散システムを想定しているからのようです。
<br />
</p>

<p class="paragraph">
MSDNマガジンの記事で、調度良いのがありました：
<br />
</p>
<ul><li> Cutting Edge: データ転送オブジェクトの長所と短所<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/magazine/ee236638.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/magazine/ee236638.aspx</a></li></ul></li></ul>

<h3 id="id859b35">RailsのActiveRecordとDomain Modelについて</h3>

<p class="paragraph">
Railsの場合、ActiveRecordが&quot;model&quot;の役目も負っていることにより、なんでもかんでもmodelに入れたり、かなり設計技法や概念的な部分で開発者が困惑し、誤用したり乱用するケースがあるようです。
<br />
</p>

<ul><li> デザインパターンから見たActive Record (2) | TECHSCORE(テックスコア)<ul><li> <a class="externallink" href="http://www.techscore.com/tech/Ruby/Rails/other/designpattern/2/" target="_blank">http://www.techscore.com/tech/Ruby/Rails/other/designpattern/2/</a></li></ul></li>
<li> O/RマッパーやActiveRecordによるMVCの誤解 - Togetterまとめ<ul><li> <a class="externallink" href="http://togetter.com/li/114000" target="_blank">http://togetter.com/li/114000</a></li>
<li> ActiveRecordでの誤用、それにより引き起こされる誤解についての解説</li></ul></li>
<li> ActiveRecord のモデルを整理する7つのパターン - tkawachi Blog<ul><li> <a class="externallink" href="http://tkawachi.github.io/blog/2013/09/21/active-model-7-pattern/" target="_blank">http://tkawachi.github.io/blog/2013/09/21/active-model-7-pattern/</a></li></ul></li>
<li> Rails の ActiveRecord モデルテストの書き方ガイドライン - passingloopの日記<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/passingloop/20111125/how_to_write_rails_activerecord_model_tests" target="_blank">http://d.hatena.ne.jp/passingloop/20111125/how_to_write_rails_activerecord_model_tests</a></li></ul></li>
<li> Crossing borders: Exploring Active Record<ul><li> <a class="externallink" href="http://www.ibm.com/developerworks/library/j-cb03076/" target="_blank">http://www.ibm.com/developerworks/library/j-cb03076/</a></li></ul></li></ul>

<p class="paragraph">
さらにこれが、MVCパターンの&quot;Model&quot;の部分と絡みあってしまい、混乱に拍車をかけてる感じが・・・。
<br />
</p>
<ul><li> Life is beautiful: Ruby on Railsの「えせMVC」の弊害<ul><li> <a class="externallink" href="http://satoshi.blogs.com/life/2009/10/rails_mvc.html" target="_blank">http://satoshi.blogs.com/life/2009/10/rails_mvc.html</a></li></ul></li>
<li> そのMVCだと思っているものはMVCでないかもしれない - ふくちはるき×blog<ul><li> <a class="externallink" href="http://fukuchiharuki.blogspot.jp/2013/05/mvcmvc.html" target="_blank">http://fukuchiharuki.blogspot.jp/2013/05/mvcmvc.html</a></li></ul></li></ul>

<h3 id="id5a796c">&quot;fat model&quot;, &quot;fat controller&quot; への対処</h3>

<p class="paragraph">
このへんの議論については、ひがやすをさんの意見が一番バランスが良い気がします。
<br />
</p>
<ul><li> えせMVCについてそろそろ一言言っておくか - ひがやすを blog<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/higayasuo/20091013/1255408723" target="_blank">http://d.hatena.ne.jp/higayasuo/20091013/1255408723</a></li></ul></li></ul>

<p class="paragraph">
そもそも、どこに何を置こうと、制約や当初の前提が崩れることはどうしても出てきてしまうので、そこはソフトウェアテストの自動化を適用してService Layerに対するテストを自動化した上で、リファクタリングで対処する。これが現実的なアプローチに思います。
<br />
</p>

<h3 id="idbb04c1">EJBはどう考えようか？</h3>

<p class="paragraph">
ぶっちゃけEJBを使う予定は当分ないので、ググって見つかった上位記事だけを数点メモ。
<br />
</p>
<ul><li> 第1回 EJBのすべてを知る | Think IT<ul><li> <a class="externallink" href="http://thinkit.co.jp/free/article/0709/14/1/page/0/2" target="_blank">http://thinkit.co.jp/free/article/0709/14/1/page/0/2</a></li></ul></li>
<li> 技術トピックス｜業務アプリもJ2EE一辺倒からWeb 2.0的な軽量技術が現実解に(1/4) | ウルシステムズ株式会社 | UL Systems, Inc.<ul><li>  <a class="externallink" href="https://www.ulsystems.co.jp/technology-topic019-01.html" target="_blank">https://www.ulsystems.co.jp/technology-topic019-01.html</a></li></ul></li>
<li> java - What use are EJBs - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/5579890/what-use-are-ejbs" target="_blank">http://stackoverflow.com/questions/5579890/what-use-are-ejbs</a></li></ul></li></ul>

<h3 id="id5f63f5">参考資料</h3>

<p class="paragraph">
Martin Fowler氏による&quot;Service Layer&quot;パターンのPoEAA記事（PoEAA本とほぼそのままのよう）
<br />
</p>
<ul><li> Service Layer | Framework Design Guidelines: Domain Logic Patterns | InformIT<ul><li> <a class="externallink" href="http://www.informit.com/articles/article.aspx?p=1398617&amp;seqNum=4" target="_blank">http://www.informit.com/articles/article.aspx?p=1398617&amp;seqNum=4</a></li></ul></li></ul>

<p class="paragraph">
DDDについての日本語解説記事
<br />
</p>
<ul><li> [ 技術講座 ] Domain-Driven Designのエッセンス -目次-<ul><li> <a class="externallink" href="https://www.ogis-ri.co.jp/otc/hiroba/technical/DDDEssence/index.html" target="_blank">https://www.ogis-ri.co.jp/otc/hiroba/technical/DDDEssence/index.html</a></li></ul></li>
<li> ドメイン駆動設計・俯瞰編・アプリケーション構築 - Strategic Choice<ul><li> <a class="externallink" href="http://d.hatena.ne.jp/asakichy/20110425/1303683158" target="_blank">http://d.hatena.ne.jp/asakichy/20110425/1303683158</a></li></ul></li></ul>

<p class="paragraph">
MSDNマガジンより。.NETテクノロジーをベースとした話になっていますが、クラス分けやレイヤー分けの考え方、アドバイスについてはJavaでも十分展開可能な内容となっており、参考になります。
<br />
</p>
<ul><li> データ駆動開発からドメイン駆動開発へ (InfoQによるMSDNマガジン連載記事の紹介)<ul><li> <a class="externallink" href="http://www.infoq.com/jp/news/2013/10/data-driven-to-ddd" target="_blank">http://www.infoq.com/jp/news/2013/10/data-driven-to-ddd</a></li></ul></li>
<li> データ ポイント - ドメイン駆動設計のコーディング: データを重視する開発者のためのヒント<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/magazine/dn342868.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/magazine/dn342868.aspx</a></li></ul></li>
<li> データ ポイント - ドメイン駆動設計のコーディング: データを重視する開発者のためのヒント (第 2 部)<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/magazine/dn385704.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/magazine/dn385704.aspx</a></li></ul></li>
<li> データ ポイント - ドメイン駆動設計のコーディング: データを重視する開発者のためのヒント (第 3 部)<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/magazine/dn451438.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/magazine/dn451438.aspx</a></li></ul></li>
<li> Data Points - Coding for Domain-Driven Design: Tips for Data-Focused Devs<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/magazine/dn342868.aspx" target="_blank">http://msdn.microsoft.com/en-us/magazine/dn342868.aspx</a></li>
<li> 英語での第一回目？記事</li></ul></li></ul>

<p class="paragraph">
SpringでのService Layer, Domain Model の実装例解説
<br />
</p>
<ul><li> Spring – Designing the domain model and the service layer | Java Code Geeks<ul><li> <a class="externallink" href="http://www.javacodegeeks.com/2012/09/spring-designing-domain-model-and.html" target="_blank">http://www.javacodegeeks.com/2012/09/spring-designing-domain-model-and.html</a></li></ul></li></ul>

<p class="paragraph">
PHPでのService Layer, Domain Model の実装例解説
<br />
</p>
<ul><li> An Introduction to Services<ul><li> <a class="externallink" href="http://www.sitepoint.com/an-introduction-to-services/" target="_blank">http://www.sitepoint.com/an-introduction-to-services/</a></li></ul></li></ul>

<p class="paragraph">
その他の議論、解説：
<br />
</p>
<ul><li> Part 1 – Designing the domain model and the service layer | vrtoonjava<ul><li> <a class="externallink" href="http://vrtoonjava.wordpress.com/2012/06/17/part-1-designing-the-domain-model-and-the-service-layer/" target="_blank">http://vrtoonjava.wordpress.com/2012/06/17/part-1-designing-the-domain-model-and-the-service-layer/</a></li></ul></li>
<li> ASP.NET MVC Business Logic in Domain Model vs Service Layer - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/14657656/asp-net-mvc-business-logic-in-domain-model-vs-service-layer" target="_blank">http://stackoverflow.com/questions/14657656/asp-net-mvc-business-logic-in-domain-model-vs-service-layer</a></li></ul></li>
<li> design patterns - How accurate is &quot;Business logic should be in a service, not in a model&quot;? - Programmers Stack Exchange<ul><li> <a class="externallink" href="http://programmers.stackexchange.com/questions/218011/how-accurate-is-business-logic-should-be-in-a-service-not-in-a-model" target="_blank">http://programmers.stackexchange.com/questions/218011/how-accurate-is-business-logic-should-be-in-a-service-not-in-a-model</a></li></ul></li></ul>


<h3 id="id7a575c">感想</h3>

<p class="paragraph">
仏教史とかキリスト教史かじってるせいか、経典や師の言葉の解釈がどんどん枝分かれして、極端に走ったり揺れ戻ったり、互いに批判したり、誤用されたり濫用されたりとか、そのまんまですよ奥様・・・。
<br />
</p>

<p class="paragraph">
「パターン」は技法というか考え方、思想、表現方法であって、「こうでないと間違い」という類のものではないはずです。というか、「パターン」の本来の意図どおりに使われて無くても、結果としてそのアプリケーションなりシステムなりを、妥当な品質と妥当なコストと妥当なメンテナンス性と妥当なソースコード可読性でもって構築できていれば、現実的には問題は無いはずなんです。
<br />
・・・と考えるのは異端なんでしょうか。
<br />
（まぁ、まだ勉強途中の開発者がそのアーキテクチャをみて、「ふ～ん、これが○○というパターンの適用例なのか」と刷り込み学習してしまう危険性はありますが。）
<br />
</p>

<p class="paragraph">
あくまでも、超個人的な意見としてですが、一番気をつけなければイケないのは<strong>データ表現方式のレイヤー間でのミスマッチ</strong>だと思うんですよ。
<br />
次点でソフトウェアによるテスト自動化。
<br />
</p>

<p class="paragraph">
Webアプリにせよ、ネイティブアプリにせよ、あるいは他システム間連携のNW分散システムにせよ、ファイル読み書きしかしないバッチ処理にせよ、絶対に、「入力/出力」のデータフォーマットと、内部のビジネスロジックで扱い易いデータフォーマットにミスマッチがあるはずなんです。
<br />
もちろんシステムの規模や言語によってそれは変動して、単純なCSVレコードを処理するような場合だとほとんど入力・出力と内部処理の表現のミスマッチがない場合があるでしょうし、逆に、WebアプリだとHTTPでやってくるパラメータ形式と、OOPの言語やライブラリで扱い易いオブジェクト表現にはそうとうなミスマッチが出てくると思います。
<br />
もう一つミスマッチが発生しやすいのが、ビジネスロジックと永続化レイヤーの間です。
<br />
これも、SQLだったりシリアライズ処理だったりと、それぞれの言語や永続化機構、ライブラリ、フレームワークによりミスマッチの程度は異なってきます。
<br />
</p>

<p class="paragraph">
で、このミスマッチを、無理やり、メタオブジェクトプログラミングとか、リフレクションとかを使って「単純なケースなら自動マッピングOK」としてしまうと、色々崩壊してくると思うんですよ・・・ってこれも私見ですが。
<br />
</p>

<p class="paragraph">
自動マッピングならコード書かなくて済むじゃない・・・と言われると思うんですが、案外、テストさえ自動化できてれば、多少手作業でも素直に、愚直に、自前で変換処理を作ったほうが、後々自動マッピングの罠や制限で苦労しなくて済む場合が多そうに思うんですが・・・どうなんでしょうかね。もちろんそのへんの地雷とか罠とか、自動マッピング処理が適用できる限界点を把握した上で付き合う分には問題ナッシングと思います。
<br />
</p>

<p class="paragraph">
超個人的な意見ですが、あんまりOOPの継承とか派生をこのへんの仕組みに適用しすぎても、却って後々の変更に弱くなりそうな気がします。単純なEntityとテーブルマッピングにしておいて、多少Service Layerがfatになっても良いのでロジックはあまりEntity側に入れない、代わりにService Layerに対してAPIとしてのテスト自動化を進めて、後々のリファクタリングやリグレッションテストを効率化する、という方が良い気がするのです。
<br />
OOPとしての筋の良さよりは、品質、メンテナンス性、可読性、<strong>そして理解しやすさと、「誤解のしにくさ」</strong>が何よりも大事かと思います。
<br />
そうした点で、徒に Domain Model とかレイヤー分けとかモデリングの「絶対的な正しさ」にこだわって凝ったアーキテクチャ設計にしてしまうと、後から入ってきたり突発的にお手伝いに入った開発者がすぐに活躍できない状況になってしまいそうです。
<br />
OOPが活用されないと可読性や再利用性が・・・と言われそうですが、これをテストの自動化とリファクタリングでカバーするイメージです。
<br />
でないと、Domainがドーノとか、あるべき設計は～というのを議論したり勉強するのだけで何十時間も、何年も費やすことになってしまい、「ぼちぼち妥当で可読性と理解しやすさ、誤解のしにくさ」を備えたコードを作る機会を逸してしまいそうです・・・。
<br />
</p>

<p class="paragraph">
とりあえず今回の調査はここまで。
<br />
</p>

<p class="paragraph">
※前にこんなの書いてた : <a href="./view-1128.html" >日記/2012/12/31/SQLをうまく扱うプログラム設計メモ</a>
<br />
</p>


<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1390.html" title="技術/ソフトウェア設計/MVVM(Model View ViewModel)デザインパターンとData Bindingの参考URLメモ(2015-03時点)">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-327.html" title="技術/プロトコルまとめメモ(HTTP,SMTP,POP3)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1286<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>