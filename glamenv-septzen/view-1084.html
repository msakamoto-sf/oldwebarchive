<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Java/Maven3/tools.jarを使う時のトラブルシュート(&lt;scope&gt;=system, &lt;systemPath&gt;) - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">Java/Maven3/tools.jarを使う時のトラブルシュート(&lt;scope&gt;=system, &lt;systemPath&gt;)</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2012-06-02 23:03:30 &nbsp; / &nbsp; last updated at: 2013-07-14 12:48:20<br>
カテゴリ: <a href="category-63.html">Eclipse</a>&nbsp;<a href="category-11.html">Java</a>&nbsp;<a href="category-62.html">Maven</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1281.html" title="Java/Maven3/siteの使い方参考メモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1083.html" title="Java/Maven3/warパッケージングで&quot;selected war files include a WEB-INF/web.xml which will be ignored&quot;警告">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-457.html" title="Java">Java</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
Mavenでtools.jarを参照するときに、主に環境面でトラブルに遭遇することがあります。
<br />
そこで主なトラブルと対処法についてまとめてみました。
<br />
</p>

<h3 id="ide92fd3">そもそもtools.jarを参照する方法が分からない</h3>

<p class="paragraph">
&quot;&lt;dependency&gt;&quot;で&quot;&lt;scope&gt;&quot;に&quot;system&quot;を設定します。これはローカル上のjarファイルをコンパイル時に参照させたい(でもパッケージング時には含めない)場合に使います。&quot;&lt;systemPath&gt;&quot;によりローカル上のtools.jarを指定します。
<br />
</p>

<p class="paragraph">
pom.xmlの&quot;&lt;dependency&gt;&quot;の例(Windows or unix)：
<br />
</p>
<pre class="plugin_pre">
&lt;dependency&gt;
   &lt;groupId&gt;com.sun&lt;/groupId&gt;
   &lt;artifactId&gt;tools&lt;/artifactId&gt;
   &lt;version&gt;1.5&lt;/version&gt;
   &lt;scope&gt;system&lt;/scope&gt;
   &lt;systemPath&gt;${java.home}/../lib/tools.jar&lt;/systemPath&gt;
 &lt;/dependency&gt;
</pre>

<h3 id="idb18688">MacOSXの場合はtools.jarがclasses.jarに含まれているので不要になるが、マルチOSに柔軟に対応させるには？</h3>

<p class="paragraph">
MacOSXの場合はtools.jarがclasses.jarに含まれているので不要のようです。
<br />
このようにOS毎に設定を切り替えるにはMavenの&quot;profile&quot;という機能を使います。
<br />
以下に2種類のバリエーションを紹介します。
<br />
</p>

<ul><li> Windowsならtools.jar, Macならclasses.jarで切り替えるタイプ<ul><li> → java - JDK tools.jar as maven dependency - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/3080437/jdk-tools-jar-as-maven-dependency" target="_blank">http://stackoverflow.com/questions/3080437/jdk-tools-jar-as-maven-dependency</a></li></ul></li></ul></li></ul>
<pre class="plugin_pre">
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;windows_profile&lt;/id&gt;
      &lt;activation&gt;
        &lt;os&gt;
          &lt;family&gt;Windows&lt;/family&gt;
        &lt;/os&gt;
      &lt;/activation&gt;
      &lt;properties&gt;
        &lt;toolsjar&gt;${java.home}/../lib/tools.jar&lt;/toolsjar&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
    &lt;profile&gt;
      &lt;id&gt;osx_profile&lt;/id&gt;
      &lt;activation&gt;
        &lt;os&gt;
          &lt;family&gt;mac&lt;/family&gt;
        &lt;/os&gt;
      &lt;/activation&gt;
      &lt;properties&gt;
        &lt;toolsjar&gt;${java.home}/../Classes/classes.jar&lt;/toolsjar&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
</pre>
<ul><li> Macの場合はclasses.jarをデフォルトで参照してるので必要ない、unixとwindowsのみtools.jarを参照させる。<ul><li> [maven2]tools.jarについて - hello,world</li>
<li> <a class="externallink" href="http://www.sorich.jp/blog/shimamura/2009/04/maven2toolsjar.html" target="_blank">http://www.sorich.jp/blog/shimamura/2009/04/maven2toolsjar.html</a></li></ul></li></ul>
<pre class="plugin_pre">
    &lt;profile&gt;  
      &lt;id&gt;excluding_mac&lt;/id&gt;  
      &lt;activation&gt;  
        &lt;os&gt;  
          &lt;family&gt;!mac&lt;/family&gt;  
        &lt;/os&gt;  
      &lt;/activation&gt;  
      &lt;dependencies&gt;  
        &lt;dependency&gt;  
          &lt;groupId&gt;com.sun&lt;/groupId&gt;  
          &lt;artifactId&gt;tools&lt;/artifactId&gt;  
          &lt;version&gt;1.5.0&lt;/version&gt;  
          &lt;scope&gt;system&lt;/scope&gt;  
          &lt;systemPath&gt;${java.home}/../lib/tools.jar&lt;/systemPath&gt;  
        &lt;/dependency&gt;  
      &lt;/dependencies&gt;  
    &lt;/profile&gt;  
</pre>

<p class="paragraph">
他、参照：
<br />
</p>
<ul><li> Maven Enforcer Plugin - Require OS Version<ul><li> <a class="externallink" href="http://maven.apache.org/plugins/maven-enforcer-plugin/rules/requireOS.html" target="_blank">http://maven.apache.org/plugins/maven-enforcer-plugin/rules/requireOS.html</a></li></ul></li>
<li> Maven - Introduction to build profiles<ul><li> <a class="externallink" href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html" target="_blank">http://maven.apache.org/guides/introduction/introduction-to-profiles.html</a></li></ul></li>
<li> java - Missing artifact com.sun:tools:jar - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/8375423/missing-artifact-com-suntoolsjar" target="_blank">http://stackoverflow.com/questions/8375423/missing-artifact-com-suntoolsjar</a></li></ul></li>
<li> java - maven: How to load tools.jar/classes.jar in an OS independent way? - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/6219533/maven-how-to-load-tools-jar-classes-jar-in-an-os-independent-way" target="_blank">http://stackoverflow.com/questions/6219533/maven-how-to-load-tools-jar-classes-jar-in-an-os-independent-way</a></li></ul></li></ul>

<h3 id="idcee101">tools.jarへの依存関係が解決できない｡ﾟ(ﾟ´Д｀ﾟ)ﾟ｡</h3>

<p class="paragraph">
mvn単体で発生する場合と、mvnでは問題ないのにEclipse + m2eプラグインだと発生してしまう場合があります。
<br />
結論から言うと、<strong>mvn または Eclipse のランタイム環境がJDKであることを確認してください。</strong>
<br />
前述のとおり&quot;&lt;systemPath&gt;&quot;に ${java.home} からの相対パスを指定している場合は特にこれでトラブルになる可能性が高いと思われます。
<br />
</p>

<h4 id="idfc3c50">mvnのランタイム環境を確認：&quot;mvn -version&quot;で確認</h4>

<pre class="plugin_pre">
&gt; mvn -version
Apache Maven 3.0.4 (r1232337; 2012-01-17 17:44:56+0900)
Maven home: C:\in_vitro\apps\apache-maven-3.0.4\bin\..
Java version: 1.6.0_22, vendor: Sun Microsystems Inc.
Java home: C:\Program Files\Java\jdk1.6.0_22\jre
Default locale: ja_JP, platform encoding: MS932
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;x86&quot;, family: &quot;windows&quot;
</pre>

<p class="paragraph">
なおその上で、pom.xmlでjvmのバージョンや&quot;&lt;systemPath&gt;&quot;の指定を確認し、最終的に参照されるtools.jarの存在を確認してください。
<br />
</p>

<h4 id="idb092e0">Eclipseのランタイム環境を確認</h4>

<p class="paragraph">
まずEclipse + m2e環境でtools.jarへの参照を解決できない場合、問題やエラーログに詳細が表示されますので確認してください。
<br />
自分の場合、以下の様なログが出ていました。
<br />
</p>
<pre class="plugin_pre">
Missing artifact com.sun:tools:jar:1.5.0 pom.xml
コンテナー &#039;Maven 依存関係&#039; が存在しないライブラリー
&#039;C:\Users\xxxxxx\.m2\repository\com\sun\tools\1.5.0\tools-1.5.0.jar&#039;
を参照しています
ビルド・パスのエラーが解決されるまで、プロジェクトをビルドできません
</pre>
<p class="paragraph">
→ &quot;${java.home}&quot;でなく、&quot;$HOME/.m2/repository&quot;を参照している時点で明らかにJavaのランタイム環境がおかしくなっています。
<br />
</p>

<p class="paragraph">
EclipseのランタイムJava環境は「ヘルプ」→「Eclipseについて」→「インストール詳細」→「構成」タブから&quot;-vm&quot;行を確認します。これがJDKになっていない場合は、eclipse.ini(Winならeclipse.exeと同じフォルダにある)に&quot;-vm&quot;オプションを追加します。なお&quot;-vm&quot;オプションは&quot;-vmargs&quot;の前に設定することを忘れずに。&quot;-vmargs&quot;以下はJVMへの引数として解釈されてしまいます。
<br />
例：
<br />
</p>
<pre>...
-vm
C:/Program Files/Java/jdk1.6.0_xx/bin/javaw.exe
-vmargs
...
</pre>


<p class="paragraph">
参考：(最初m2eのバグの可能性も考えて色々調べたのですが、結局ランタイムがJDKになってなかったことが原因でした)
<br />
</p>
<ul><li> java home - weird problem with JAVA_HOME and maven dependencies - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/5359520/weird-problem-with-java-home-and-maven-dependencies" target="_blank">http://stackoverflow.com/questions/5359520/weird-problem-with-java-home-and-maven-dependencies</a></li></ul></li>
<li> maven - Eclipse Indigo M2E Ignores MAVEN_OPTS in external installation - Stack Overflow<ul><li> <a class="externallink" href="http://stackoverflow.com/questions/9706089/eclipse-indigo-m2e-ignores-maven-opts-in-external-installation" target="_blank">http://stackoverflow.com/questions/9706089/eclipse-indigo-m2e-ignores-maven-opts-in-external-installation</a></li></ul></li>
<li> [m2e-users] System dependencies unresolved<ul><li> <a class="externallink" href="http://dev.eclipse.org/mhonarc/lists/m2e-users/msg02028.html" target="_blank">http://dev.eclipse.org/mhonarc/lists/m2e-users/msg02028.html</a></li></ul></li>
<li> [#MPLUGIN-202] Dependency on tools.jar should be expressed with profiles - jira.codehaus.org<ul><li> <a class="externallink" href="http://jira.codehaus.org/browse/MPLUGIN-202" target="_blank">http://jira.codehaus.org/browse/MPLUGIN-202</a></li></ul></li>
<li> Bug 338072 ? ${env.VARIABLE} is not getting expanded<ul><li> <a class="externallink" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=338072" target="_blank">https://bugs.eclipse.org/bugs/show_bug.cgi?id=338072</a></li></ul></li>
<li> m2eclipse Issues Mailing List - [m2e issues] [JIRA] Commented: (MNGECLIPSE-581) [mng] Fail to resolve dependencies if the system path contains envirnoment variable<ul><li> <a class="externallink" href="http://m2eclipse-issues-mailing-list.2838316.n2.nabble.com/m2e-issues-JIRA-Commented-MNGECLIPSE-581-mng-Fail-to-resolve-dependencies-if-the-system-path-containe-td6057920.html" target="_blank">http://m2eclipse-issues-mailing-list.2838316.n2.nabble.com/m2e-issues-JIRA-Commented-MNGECLIPSE-581-mng-Fail-to-resolve-dependencies-if-the-system-path-containe-td6057920.html</a></li></ul></li>
<li> [#MNGECLIPSE-581] [mng] Fail to resolve dependencies if the system path contains envirnoment variable - Sonatype JIRA<ul><li> <a class="externallink" href="https://issues.sonatype.org/browse/MNGECLIPSE-581" target="_blank">https://issues.sonatype.org/browse/MNGECLIPSE-581</a></li></ul></li></ul>


<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1281.html" title="Java/Maven3/siteの使い方参考メモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1083.html" title="Java/Maven3/warパッケージングで&quot;selected war files include a WEB-INF/web.xml which will be ignored&quot;警告">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-457.html" title="Java">Java</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1084<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>