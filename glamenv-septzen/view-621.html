<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>C言語系/呼び出し規約/x86/thiscall - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">C言語系/呼び出し規約/x86/thiscall</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2010-03-17 10:33:52 &nbsp; / &nbsp; last updated at: 2010-03-27 13:00:27<br>
カテゴリ: <a href="category-48.html">Assembler</a>&nbsp;<a href="category-10.html">C言語</a>&nbsp;<a href="category-38.html">UNIX</a>&nbsp;<a href="category-8.html">Windows</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-623.html" title="C言語系/呼び出し規約/x86/syscall">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-628.html" title="C言語系/呼び出し規約/x86/watcall">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
<strong>thiscall</strong>呼び出し規約：
<br />
</p>
<ul><li> C++でクラスのメンバ関数(インスタンスメソッド)で使われる。</li>
<li> 引数はスタック上にPUSHする。(主に右から左へPUSH)</li>
<li><strong>スタックのクリーンアップは、コンパイラや可変長引数の有無により異なる。</strong><ul><li> 関数(callee)側でスタックをクリーンアップする場合は、アセンブラレベルでは &quot;RET imm16&quot; 命令を使い、戻る時にスタックポインタを&quot;imm16&quot;バイト分だけ戻す。つまり、&quot;imm16&quot;バイト分だけSPが増える(x86ではスタックはアドレスの小さい方へ進んでいくので、「戻る」＝SPのアドレス値は大きくなる)。</li>
<li> 関数を呼ぶ(caller)側でスタックをクリーンアップする場合は、アセンブラレベルではCALL命令の直後（＝関数からRETした直後）に、スタックポインタ(SP)にPUSHした引数のバイト分だけ即値を加算 (ADD)する。(x86ではスタックはアドレスの小さい方へ進んでいくので、「スタックのクリーンアップ」＝「戻る」＝SPのアドレス値を大きくする)。</li></ul></li>
<li> thiscall呼び出し規約はC++専用のため、C言語での他の呼び出し規約における装飾名のルールは使われず、C++でのmanglingがそのまま適用される。</li></ul>



<hr />
<ul><li><a href="#id325234">サンプルコード</a><ul><li><a href="#id9bd59f">foo.cpp (メンバ関数の実装)</a></li>
<li><a href="#id236561">foo.hpp (クラス定義ヘッダーファイル)</a></li>
<li><a href="#id78c60d">main.cpp (main()関数定義)</a></li></ul></li>
<li><a href="#ide3a938">VC++2008 Express Edtion</a><ul><li><a href="#id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</a></li>
<li><a href="#id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</a></li></ul></li>
<li><a href="#id2b5e58">Borland C++ Compiler</a><ul><li><a href="#id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</a></li>
<li><a href="#id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</a></li></ul></li>
<li><a href="#id02eebe">OpenWatcom Compiler(16bit)</a><ul><li><a href="#id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</a></li>
<li><a href="#id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</a></li></ul></li>
<li><a href="#idc5b16b">OpenWatcom Compiler(32bit)</a><ul><li><a href="#id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</a></li>
<li><a href="#id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</a></li></ul></li>
<li><a href="#id94356b">Turbo C++ 4.0J</a><ul><li><a href="#id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</a></li>
<li><a href="#id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</a></li></ul></li>
<li><a href="#id12f36d">GCC4.1.2 + binutils-2.7.50.0.6 (CentOS5.2)</a><ul><li><a href="#idddaa36">foo.cpp のアセンブラ出力(foo.s)（抜粋）</a></li>
<li><a href="#ida62298">main.cpp のアセンブラ出力(main.s)（抜粋）</a></li></ul></li></ul>
<hr />
<h3 id="id325234">サンプルコード</h3>

<h4 id="id9bd59f">foo.cpp (メンバ関数の実装)</h4>
<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&quot;</span><span class="hl-string">foo.hpp</span><span class="hl-quotes">&quot;</span><span ></span><span class="hl-code">
 
</span><span class="hl-comment">// Borland C++ Compilerで必要。VC++2008では有っても無くても影響なし。</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-comment">// 他のコンパイラは不明。OpenWatcom, TurboC++, GCCでは有りで確認している。</span><span class="hl-comment"></span><span class="hl-code">
</span><span class="hl-reserved">using</span><span class="hl-code"> </span><span >namespace</span><span class="hl-code"> </span><span class="hl-identifier">std</span><span class="hl-code">;
 
</span><span class="hl-identifier">foo</span><span class="hl-code">::</span><span class="hl-identifier">foo</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">x</span><span class="hl-code"> = </span><span class="hl-identifier">x</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo</span><span class="hl-code">::</span><span class="hl-identifier">bar</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code"> + </span><span class="hl-identifier">c</span><span class="hl-code"> + </span><span class="hl-identifier">d</span><span class="hl-code"> + </span><span class="hl-identifier">e</span><span class="hl-code"> + </span><span class="hl-reserved">this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">x</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo</span><span class="hl-code">::</span><span class="hl-identifier">baz</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argn</span><span class="hl-code">, ...</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">va_list</span><span class="hl-code"> </span><span class="hl-identifier">ap</span><span class="hl-code">;
    </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">r</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">-&gt;</span><span class="hl-identifier">x</span><span class="hl-code">;
    </span><span class="hl-identifier">va_start</span><span class="hl-brackets">(</span><span class="hl-identifier">ap</span><span class="hl-code">, </span><span class="hl-identifier">argn</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">for</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">i</span><span class="hl-code"> = </span><span class="hl-number">0</span><span class="hl-code">; </span><span class="hl-identifier">i</span><span class="hl-code"> &lt; </span><span class="hl-identifier">argn</span><span class="hl-code">; </span><span class="hl-identifier">i</span><span class="hl-code">++, </span><span class="hl-identifier">va_arg</span><span class="hl-brackets">(</span><span class="hl-identifier">ap</span><span class="hl-code">, </span><span >int</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">r</span><span class="hl-code"> += *</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code">*</span><span class="hl-brackets">)</span><span class="hl-identifier">ap</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-identifier">va_end</span><span class="hl-brackets">(</span><span class="hl-identifier">ap</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">r</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<h4 id="id236561">foo.hpp (クラス定義ヘッダーファイル)</h4>
<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&lt;</span><span class="hl-string">cstdarg</span><span class="hl-quotes">&gt;</span><span ></span><span class="hl-code">
</span><span >#ifndef</span><span class="hl-code"> </span><span class="hl-identifier">FOO_HPP</span><span ></span><span class="hl-code">
</span><span >#define</span><span class="hl-code"> </span><span class="hl-identifier">FOO_HPP</span><span ></span><span class="hl-code">
 
</span><span >class</span><span class="hl-code"> </span><span class="hl-identifier">foo</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
</span><span class="hl-reserved">protected</span><span class="hl-code">:
    </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-code">;
</span><span class="hl-reserved">public</span><span class="hl-code">:
    </span><span class="hl-identifier">foo</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">x</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">bar</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">baz</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argn</span><span class="hl-code">, ...</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-brackets">}</span><span class="hl-code">;
 
</span><span >#endif</span><span class="hl-code"> </span><span class="hl-mlcomment">/*</span><span class="hl-mlcomment"> FOO_HPP </span><span class="hl-mlcomment">*/</span></pre></div>

<h4 id="id78c60d">main.cpp (main()関数定義)</h4>
<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&lt;</span><span class="hl-string">iostream</span><span class="hl-quotes">&gt;</span><span ></span><span class="hl-code">
</span><span >#include</span><span > </span><span class="hl-quotes">&quot;</span><span class="hl-string">foo.hpp</span><span class="hl-quotes">&quot;</span><span ></span><span class="hl-code">
 
</span><span class="hl-reserved">using</span><span class="hl-code"> </span><span >namespace</span><span class="hl-code"> </span><span class="hl-identifier">std</span><span class="hl-code">;
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">main</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argc</span><span class="hl-code">, </span><span >char</span><span class="hl-code"> *</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">foo</span><span class="hl-code"> *</span><span class="hl-identifier">f</span><span class="hl-code">;
    </span><span class="hl-identifier">f</span><span class="hl-code"> = </span><span class="hl-reserved">new</span><span class="hl-code"> </span><span class="hl-identifier">foo</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-code">;
    
    </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">r</span><span class="hl-code"> = </span><span class="hl-identifier">f</span><span class="hl-code">-&gt;</span><span class="hl-identifier">bar</span><span class="hl-brackets">(</span><span class="hl-number">1</span><span class="hl-code">, </span><span class="hl-number">2</span><span class="hl-code">, </span><span class="hl-number">3</span><span class="hl-code">, </span><span class="hl-number">4</span><span class="hl-code">, </span><span class="hl-number">5</span><span class="hl-brackets">)</span><span class="hl-code">;
 
    </span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">&quot;</span><span class="hl-string">foo::bar() = </span><span class="hl-quotes">&quot;</span><span class="hl-code"> &lt;&lt; </span><span class="hl-identifier">r</span><span class="hl-code"> &lt;&lt; </span><span class="hl-identifier">endl</span><span class="hl-code">;
 
    </span><span class="hl-identifier">r</span><span class="hl-code"> = </span><span class="hl-identifier">f</span><span class="hl-code">-&gt;</span><span class="hl-identifier">baz</span><span class="hl-brackets">(</span><span class="hl-number">3</span><span class="hl-code">, </span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-code">, </span><span class="hl-number">30</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">cout</span><span class="hl-code"> &lt;&lt; </span><span class="hl-quotes">&quot;</span><span class="hl-string">foo::baz() = </span><span class="hl-quotes">&quot;</span><span class="hl-code"> &lt;&lt; </span><span class="hl-identifier">r</span><span class="hl-code"> &lt;&lt; </span><span class="hl-identifier">endl</span><span class="hl-code">;
 
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<h3 id="ide3a938">VC++2008 Express Edtion</h3>

<dl>
<dt> 可変長引数を使わない時 </dt>
<dd>
<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタはECX経由で渡される。</strong></li>
<li> stdcallと同様、<strong>関数(callee)側で</strong>スタッククリーンアップする。</li></ul></dd>
<dt> 可変長引数を使う時 </dt>
<dd>
<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul></dd>
</dl>

<p class="paragraph">
コンパイル＆リンク＆実行
<br />
</p>
<pre>&gt; cl /c /Od /FAs foo.cpp
&gt; cl /c /Od /FAs /EHsc main.cpp
&gt; cl main.obj foo.obj
&gt; main.exe
foo::bar() = 25
foo::baz() = 70
</pre>

<h4 id="id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</h4>
<pre class="plugin_pre">
(...)
PUBLIC	??0foo@@QAE@H@Z					; foo::foo
; Function compile flags: /Odtp
; File c:\in_vitro\c\cc_thiscall\foo.cpp
_TEXT	SEGMENT
_this$ = -4						; size = 4
_x$ = 8							; size = 4
??0foo@@QAE@H@Z PROC					; foo::foo
; _this$ = ecx

; 3    : foo::foo(int x) { this-&gt;x = x; }

	push	ebp
	mov	ebp, esp
	push	ecx
	mov	DWORD PTR _this$[ebp], ecx
	mov	eax, DWORD PTR _this$[ebp]
	mov	ecx, DWORD PTR _x$[ebp]
	mov	DWORD PTR [eax], ecx
	mov	eax, DWORD PTR _this$[ebp]
	mov	esp, ebp
	pop	ebp
	ret	4
??0foo@@QAE@H@Z ENDP					; foo::foo
_TEXT	ENDS
PUBLIC	?bar@foo@@QAEHHHHHH@Z				; foo::bar
; Function compile flags: /Odtp
_TEXT	SEGMENT
_this$ = -4						; size = 4
_a$ = 8							; size = 4
_b$ = 12						; size = 4
_c$ = 16						; size = 4
_d$ = 20						; size = 4
_e$ = 24						; size = 4
?bar@foo@@QAEHHHHHH@Z PROC				; foo::bar
; _this$ = ecx

; 5    : int foo::bar(int a, int b, int c, int d, int e) {

	push	ebp
	mov	ebp, esp
	push	ecx
	mov	DWORD PTR _this$[ebp], ecx

; 6    : 	return a + b + c + d + e + this-&gt;x;

	mov	eax, DWORD PTR _a$[ebp]
	add	eax, DWORD PTR _b$[ebp]
	add	eax, DWORD PTR _c$[ebp]
	add	eax, DWORD PTR _d$[ebp]
	add	eax, DWORD PTR _e$[ebp]
	mov	ecx, DWORD PTR _this$[ebp]
	add	eax, DWORD PTR [ecx]

; 7    : }

	mov	esp, ebp
	pop	ebp
	ret	20					; 00000014H
?bar@foo@@QAEHHHHHH@Z ENDP				; foo::bar
_TEXT	ENDS
PUBLIC	?baz@foo@@QAAHHZZ				; foo::baz
; Function compile flags: /Odtp
_TEXT	SEGMENT
_i$2881 = -12						; size = 4
_ap$ = -8						; size = 4
_r$ = -4						; size = 4
_this$ = 8						; size = 4
_argn$ = 12						; size = 4
?baz@foo@@QAAHHZZ PROC					; foo::baz

; 8    : int foo::baz(int argn, ...) {

	push	ebp
	mov	ebp, esp
	sub	esp, 12					; 0000000cH

; 9    : 	va_list ap;
; 10   : 	int r = this-&gt;x;

	mov	eax, DWORD PTR _this$[ebp]
	mov	ecx, DWORD PTR [eax]
	mov	DWORD PTR _r$[ebp], ecx

; 11   : 	va_start(ap, argn);

	lea	edx, DWORD PTR _argn$[ebp+4]
	mov	DWORD PTR _ap$[ebp], edx

; 12   : 	for (int i = 0; i &lt; argn; i++, va_arg(ap, int)) {

	mov	DWORD PTR _i$2881[ebp], 0
	jmp	SHORT $LN3@baz
$LN2@baz:
	mov	eax, DWORD PTR _i$2881[ebp]
	add	eax, 1
	mov	DWORD PTR _i$2881[ebp], eax
	mov	ecx, DWORD PTR _ap$[ebp]
	add	ecx, 4
	mov	DWORD PTR _ap$[ebp], ecx
$LN3@baz:
	mov	edx, DWORD PTR _i$2881[ebp]
	cmp	edx, DWORD PTR _argn$[ebp]
	jge	SHORT $LN1@baz

; 13   : 		r += *(int*)ap;

	mov	eax, DWORD PTR _ap$[ebp]
	mov	ecx, DWORD PTR _r$[ebp]
	add	ecx, DWORD PTR [eax]
	mov	DWORD PTR _r$[ebp], ecx

; 14   : 	}

	jmp	SHORT $LN2@baz
$LN1@baz:

; 15   : 	va_end(ap);

	mov	DWORD PTR _ap$[ebp], 0

; 16   : 	return r;

	mov	eax, DWORD PTR _r$[ebp]

; 17   : }

	mov	esp, ebp
	pop	ebp
	ret	0
?baz@foo@@QAAHHZZ ENDP					; foo::baz
_TEXT	ENDS
(...)
</pre>

<h4 id="id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</h4>
<pre class="plugin_pre">
; 11   : 	int r = f-&gt;bar(1, 2, 3, 4, 5);

	push	5
	push	4
	push	3
	push	2
	push	1
	mov	ecx, DWORD PTR _f$[ebp]
	call	?bar@foo@@QAEHHHHHH@Z			; foo::bar
	mov	DWORD PTR _r$[ebp], eax
</pre>
<pre class="plugin_pre">
; 15   : 	r = f-&gt;baz(3, 10, 20, 30);

	push	30					; 0000001eH
	push	20					; 00000014H
	push	10					; 0000000aH
	push	3
	mov	eax, DWORD PTR _f$[ebp]
	push	eax
	call	?baz@foo@@QAAHHZZ			; foo::baz
	add	esp, 20					; 00000014H
	mov	DWORD PTR _r$[ebp], eax
</pre>

<h3 id="id2b5e58">Borland C++ Compiler</h3>

<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul>

<p class="paragraph">
※可変長引数の有無に依らない。
<br />
</p>

<p class="paragraph">
アセンブラコードを生成
<br />
</p>
<pre>&gt; bcc32 -Od -S foo.cpp
&gt; bcc32 -Od -S main.cpp
</pre>

<p class="paragraph">
コンパイル＆リンク＆実行
<br />
</p>
<pre>&gt; bcc32 -Od -c foo.cpp
&gt; bcc32 -Od -c main.cpp
&gt; bcc32 main.obj foo.obj
&gt; main.exe
foo::bar() = 25
foo::baz() = 70
</pre>

<h4 id="id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</h4>
<pre class="plugin_pre">
(...)
_TEXT	segment dword public use32 &#039;CODE&#039;
@foo@$bctr$qi	segment virtual
@@foo@$bctr$qi	proc	near
?live16385@0:
   ;	
   ;	foo::foo(int x) { this-&gt;x = x; }
   ;	
	push      ebp
	mov       ebp,esp
	add       esp,-36
@1:
	mov       eax,offset @@_$ECTA$@foo@$bctr$qi
	call      @__InitExceptBlockLDTC
	mov       edx,dword ptr [ebp+12]
	mov       ecx,dword ptr [ebp+8]
	mov       dword ptr [ecx],edx
	mov       eax,dword ptr [ebp-36]
	mov       dword ptr fs:[0],eax
	mov       eax,dword ptr [ebp+8]
@3:
@2:
	mov       esp,ebp
	pop       ebp
	ret 
@@foo@$bctr$qi	endp
@foo@$bctr$qi	ends
_TEXT	ends
_TEXT	segment dword public use32 &#039;CODE&#039;
@foo@bar$qiiiii	segment virtual
@@foo@bar$qiiiii	proc	near
?live16387@0:
   ;	
   ;	int foo::bar(int a, int b, int c, int d, int e) {
   ;	
	push      ebp
	mov       ebp,esp
   ;	
   ;		return a + b + c + d + e + this-&gt;x;
   ;	
@4:
	mov       eax,dword ptr [ebp+12]
	add       eax,dword ptr [ebp+16]
	add       eax,dword ptr [ebp+20]
	add       eax,dword ptr [ebp+24]
	add       eax,dword ptr [ebp+28]
	mov       edx,dword ptr [ebp+8]
	add       eax,dword ptr [edx]
   ;	
   ;	}
   ;	
@6:
@5:
	pop       ebp
	ret 
@@foo@bar$qiiiii	endp
@foo@bar$qiiiii	ends
_TEXT	ends
_TEXT	segment dword public use32 &#039;CODE&#039;
@foo@baz$qie	segment virtual
@@foo@baz$qie	proc	near
?live16388@0:
   ;	
   ;	int foo::baz(int argn, ...) {
   ;	
	push      ebp
	mov       ebp,esp
	add       esp,-12
   ;	
   ;		va_list ap;
   ;		int r = this-&gt;x;
   ;	
@7:
	mov       eax,dword ptr [ebp+8]
	mov       edx,dword ptr [eax]
	mov       dword ptr [ebp-8],edx
   ;	
   ;		va_start(ap, argn);
   ;	
	lea       ecx,dword ptr [ebp+16]
	mov       dword ptr [ebp-4],ecx
   ;	
   ;		for (int i = 0; i &lt; argn; i++, va_arg(ap, int)) {
   ;	
@8:
	xor       eax,eax
	mov       dword ptr [ebp-12],eax
	mov       edx,dword ptr [ebp-12]
	cmp       edx,dword ptr [ebp+12]
	jge       short @10
   ;	
   ;			r += *(int*)ap;
   ;	
@9:
	mov       ecx,dword ptr [ebp-4]
	mov       eax,dword ptr [ecx]
	add       dword ptr [ebp-8],eax
@11:
	inc       dword ptr [ebp-12]
	add       dword ptr [ebp-4],4
	mov       edx,dword ptr [ebp-12]
	cmp       edx,dword ptr [ebp+12]
	jl        short @9
   ;	
   ;		}
   ;		va_end(ap);
   ;		return r;
   ;	
@10:
	mov       eax,dword ptr [ebp-8]
   ;	
   ;	}
   ;	
@14:
@13:
	mov       esp,ebp
	pop       ebp
	ret 
@@foo@baz$qie	endp
@foo@baz$qie	ends
_TEXT	ends
(...)
</pre>

<h4 id="id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</h4>
<pre class="plugin_pre">
   ;		int r = f-&gt;bar(1, 2, 3, 4, 5);
   ;	
	push      5
	push      4
	push      3
	push      2
	push      1
	push      dword ptr [ebp-44]
	call      @@foo@bar$qiiiii
	add       esp,24
	mov       dword ptr [ebp-48],eax
</pre>
<pre class="plugin_pre">
   ;		r = f-&gt;baz(3, 10, 20, 30);
   ;	
	push      30
	push      20
	push      10
	push      3
	push      dword ptr [ebp-44]
	call      @@foo@baz$qie
	add       esp,20
	mov       dword ptr [ebp-48],eax
</pre>

<h3 id="id02eebe">OpenWatcom Compiler(16bit)</h3>

<dl>
<dt> 可変長引数を使わない時 </dt>
<dd>
<ul><li> 左から3つまでの引数は、左から順にDX, BX, CXレジスタ経由で渡される。</li>
<li> 左から4つ目以降の引数は、右から左へスタックへ積まれる。</li>
<li><strong>&quot;this&quot;ポインタはAXレジスタ経由で渡される。</strong></li>
<li> stdcallと同様、<strong>関数(callee)側で</strong>スタッククリーンアップする。</li></ul>

<p class="paragraph">
これは丁度 watcall(<a href="./view-628.html" >C言語系/呼び出し規約/x86/watcall</a>)) 呼び出し規約で、&quot;this&quot;ポインタが暗黙的に第一引数に指定された状況と同じになる。watcallでは左から4つめまでの引数が AX, DX, BX, CX の順で渡されるが、最初のAXの分が&quot;this&quot;ポインタに指定され、以降一つ分ずれた形になる。
<br />
</p></dd>
<dt> 可変長引数を使う時 </dt>
<dd>
<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul></dd>
</dl>

<p class="paragraph">
OpenWatcom Compiler(16bit)では、foo.cppのfoo::baz()メソッドで以下の修正を行う必要があった。
<br />
</p>

<pre>b = *(int*)ap;
</pre>
<p class="paragraph">
→
<br />
</p>
<pre>b = **ap;
</pre>

<p class="paragraph">
コンパイル＆リンク＆実行
<br />
</p>
<pre>&gt; wpp -od -d0 foo.cpp
&gt; wpp -od -d0 main.cpp
&gt; wcl -fe=main16.exe main.obj foo.obj
&gt; main16.exe
foo::bar() = 25
foo::baz() = 70
</pre>

<p class="paragraph">
アセンブラ生成
<br />
</p>
<pre>&gt; wdis -a -l=foo.asm foo.obj
&gt; wdis -a -l=main.asm main.obj
</pre>

<h4 id="id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</h4>
<pre class="plugin_pre">
(...)
`W?$ct:foo$n(i)_`:
    push        ax 
    mov         ax,12H 
    call        near ptr __STK 
    pop         ax 
    push        bx 
    push        cx 
    push        si 
    push        di 
    push        bp 
    mov         bp,sp 
    sub         sp,6 
    mov         word ptr -6[bp],ax 
    mov         word ptr -4[bp],dx 
    mov         ax,word ptr -4[bp] 
    mov         bx,word ptr -6[bp] 
    mov         word ptr [bx],ax 
    mov         bx,word ptr -6[bp] 
    mov         word ptr -2[bp],bx 
    mov         ax,word ptr -2[bp] 
    mov         sp,bp 
    pop         bp 
    pop         di 
    pop         si 
    pop         cx 
    pop         bx 
    ret         
`W?bar$:foo$n(iiiii)i`:
    push        ax 
    mov         ax,12H 
    call        near ptr __STK 
    pop         ax 
    push        si 
    push        di 
    push        bp 
    mov         bp,sp 
    sub         sp,0aH 
    mov         word ptr -0aH[bp],ax 
    mov         word ptr -8[bp],dx 
    mov         word ptr -6[bp],bx 
    mov         word ptr -4[bp],cx 
    mov         bx,word ptr -8[bp] 
    add         bx,word ptr -6[bp] 
    add         bx,word ptr -4[bp] 
    add         bx,word ptr 8[bp] 
    mov         ax,word ptr 0aH[bp] 
    add         ax,bx 
    mov         bx,word ptr -0aH[bp] 
    mov         bx,word ptr [bx] 
    add         bx,ax 
    mov         word ptr -2[bp],bx 
    mov         ax,word ptr -2[bp] 
    mov         sp,bp 
    pop         bp 
    pop         di 
    pop         si 
    ret         4 
`W?baz$:foo$n(ie)i`:
    mov         ax,16H 
    call        near ptr __STK 
    push        bx 
    push        cx 
    push        dx 
    push        si 
    push        di 
    push        bp 
    mov         bp,sp 
    sub         sp,8 
    mov         bx,word ptr 0eH[bp] 
    mov         ax,word ptr [bx] 
    mov         word ptr -8[bp],ax 
    mov         word ptr -4[bp],0 
    lea         ax,12H[bp] 
    mov         word ptr -6[bp],ax 
    mov         word ptr -2[bp],0 
    jmp         L$2 
L$1:
    inc         word ptr -2[bp] 
    add         word ptr -6[bp],2 
L$2:
    mov         ax,word ptr -2[bp] 
    cmp         ax,word ptr 10H[bp] 
    jge         L$3 
    mov         bx,word ptr -6[bp] 
    mov         al,byte ptr [bx] 
    xor         ah,ah 
    mov         word ptr -4[bp],ax 
    mov         ax,word ptr -4[bp] 
    add         word ptr -8[bp],ax 
    jmp         L$1 
L$3:
    mov         word ptr -6[bp],0 
    mov         ax,word ptr -8[bp] 
    mov         sp,bp 
    pop         bp 
    pop         di 
    pop         si 
    pop         dx 
    pop         cx 
    pop         bx 
    ret         
(...)
</pre>

<h4 id="id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</h4>
<pre class="plugin_pre">
    mov         ax,5 
    push        ax 
    mov         ax,4 
    push        ax 
    mov         cx,3 
    mov         bx,2 
    mov         dx,1 
    mov         ax,word ptr -22H[bp] 
    call        near ptr `W?bar$:foo$n(iiiii)i` 
</pre>
<pre class="plugin_pre">
    mov         ax,1eH 
    push        ax 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    mov         ax,3 
    push        ax 
    push        word ptr -22H[bp] 
    call        near ptr `W?baz$:foo$n(ie)i` 
    add         sp,0aH 
</pre>

<h3 id="idc5b16b">OpenWatcom Compiler(32bit)</h3>

<dl>
<dt> 可変長引数を使わない時 </dt>
<dd>
<ul><li> 左から3つまでの引数は、左から順にEDX, EBX, ECXレジスタ経由で渡される。</li>
<li> 左から4つ目以降の引数は、右から左へスタックへ積まれる。</li>
<li><strong>&quot;this&quot;ポインタはEAXレジスタ経由で渡される。</strong></li>
<li> stdcallと同様、<strong>関数(callee)側で</strong>スタッククリーンアップする。</li></ul>

<p class="paragraph">
これは丁度 watcall(<a href="./view-628.html" >C言語系/呼び出し規約/x86/watcall</a>)) 呼び出し規約で、&quot;this&quot;ポインタが暗黙的に第一引数に指定された状況と同じになる。watcallでは左から4つめまでの引数が EAX, EDX, EBX, ECX の順で渡されるが、最初のEAXの分が&quot;this&quot;ポインタに指定され、以降一つ分ずれた形になる。
<br />
</p></dd>
<dt> 可変長引数を使う時 </dt>
<dd>
<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul></dd>
</dl>

<p class="paragraph">
OpenWatcom Compiler(32bit)では、foo.cppのfoo::baz()メソッドで以下の修正を行う必要があった。
<br />
</p>

<pre>b = *(int*)ap;
</pre>
<p class="paragraph">
→
<br />
</p>
<pre>b = **ap;
</pre>

<p class="paragraph">
コンパイル＆リンク＆実行
<br />
</p>
<pre>&gt; wpp386 -od -d0 foo.cpp
&gt; wpp386 -od -d0 main.cpp
&gt; wcl386 -fe=main32.exe main.obj foo.obj
&gt; main32.exe
foo::bar() = 25
foo::baz() = 70
</pre>

<p class="paragraph">
アセンブラ生成
<br />
</p>
<pre>&gt; wdis -a -l=foo.asm foo.obj
&gt; wdis -a -l=main.asm main.obj
</pre>

<h4 id="id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</h4>
<pre class="plugin_pre">
(...)
`W?bar$:foo$n(iiiii)i`:
    push        24H 
    call        near ptr FLAT:__CHK 
    push        esi 
    push        edi 
    push        ebp 
    mov         ebp,esp 
    sub         esp,14H 
    mov         dword ptr -14H[ebp],eax 
    mov         dword ptr -10H[ebp],edx 
    mov         dword ptr -0cH[ebp],ebx 
    mov         dword ptr -8[ebp],ecx 
    mov         eax,dword ptr -10H[ebp] 
    add         eax,dword ptr -0cH[ebp] 
    add         eax,dword ptr -8[ebp] 
    add         eax,dword ptr 10H[ebp] 
    mov         edx,dword ptr 14H[ebp] 
    add         edx,eax 
    mov         eax,dword ptr -14H[ebp] 
    mov         eax,dword ptr [eax] 
    add         eax,edx 
    mov         dword ptr -4[ebp],eax 
    mov         eax,dword ptr -4[ebp] 
    mov         esp,ebp 
    pop         ebp 
    pop         edi 
    pop         esi 
    ret         8 
`W?baz$:foo$n(ie)i`:
    push        2cH 
    call        near ptr FLAT:__CHK 
    push        ebx 
    push        ecx 
    push        edx 
    push        esi 
    push        edi 
    push        ebp 
    mov         ebp,esp 
    sub         esp,10H 
    mov         eax,dword ptr 1cH[ebp] 
    mov         eax,dword ptr [eax] 
    mov         dword ptr -10H[ebp],eax 
    mov         dword ptr -8[ebp],0 
    lea         eax,24H[ebp] 
    mov         dword ptr -0cH[ebp],eax 
    mov         dword ptr -4[ebp],0 
    jmp         L$2 
L$1:
    inc         dword ptr -4[ebp] 
    add         dword ptr -0cH[ebp],4 
L$2:
    mov         eax,dword ptr -4[ebp] 
    cmp         eax,dword ptr 20H[ebp] 
    jge         L$3 
    mov         eax,dword ptr -0cH[ebp] 
    movzx       eax,byte ptr [eax] 
    mov         dword ptr -8[ebp],eax 
    mov         eax,dword ptr -8[ebp] 
    add         dword ptr -10H[ebp],eax 
    jmp         L$1 
L$3:
    mov         dword ptr -0cH[ebp],0 
    mov         eax,dword ptr -10H[ebp] 
    mov         esp,ebp 
    pop         ebp 
    pop         edi 
    pop         esi 
    pop         edx 
    pop         ecx 
    pop         ebx 
    ret         
(...)
</pre>

<h4 id="id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</h4>
<pre class="plugin_pre">
    push        5 
    push        4 
    mov         ecx,3 
    mov         ebx,2 
    mov         edx,1 
    mov         eax,dword ptr -40H[ebp] 
    call        near ptr FLAT:`W?bar$:foo$n(iiiii)i` 
</pre>
<pre class="plugin_pre">
    push        1eH 
    push        14H 
    push        0aH 
    push        3 
    push        dword ptr -40H[ebp] 
    call        near ptr FLAT:`W?baz$:foo$n(ie)i` 
    add         esp,14H 
</pre>

<h3 id="id94356b">Turbo C++ 4.0J</h3>

<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul>

<p class="paragraph">
※可変長引数の有無に依らない。
<br />
※&quot;using namespace&quot;を削除、&quot;cstdarg&quot; → &quot;stdarg.h&quot; に修正して確認。(これらを行わないと、コンパイルエラーになってしまう)
<br />
※TC4Jについてはリンク＆実行までは行っていない。
<br />
</p>

<p class="paragraph">
アセンブラコードを生成
<br />
</p>
<pre>&gt; tcc -S foo.cpp
&gt; tcc -S main.cpp
</pre>

<h4 id="id6e470f">foo.cpp のアセンブラ出力(foo.asm)（抜粋）</h4>
<pre class="plugin_pre">
(...)
   ;	
   ;	int foo::bar(int a, int b, int c, int d, int e) {
   ;	
	assume	cs:_TEXT,ds:DGROUP
@foo@bar$qiiiii	proc	near
	push	bp
	mov	bp,sp
	push	si
	mov	si,word ptr [bp+4]
   ;	
   ;		return a + b + c + d + e + this-&gt;x;
   ;	
	mov	ax,word ptr [bp+6]
	add	ax,word ptr [bp+8]
	add	ax,word ptr [bp+10]
	add	ax,word ptr [bp+12]
	add	ax,word ptr [bp+14]
	add	ax,word ptr [si]
	jmp	short @2@58
@2@58:
   ;	
   ;	}
   ;	
	pop	si
	pop	bp
	ret	
@foo@bar$qiiiii	endp
   ;	
   ;	int foo::baz(int argn, ...) {
   ;	
	assume	cs:_TEXT,ds:DGROUP
@foo@baz$qie	proc	near
	enter	2,0
	push	si
	push	di
	mov	si,word ptr [bp+4]
   ;	
   ;		va_list ap;
   ;		int r = this-&gt;x;
   ;	
	mov	dx,word ptr [si]
   ;	
   ;		int b = 0;
   ;	
	xor	di,di
   ;	
   ;		va_start(ap, argn);
   ;	
	lea	ax,word ptr [bp+8]
	mov	word ptr [bp-2],ax
   ;	
   ;		for (int i = 0; i &lt; argn; i++, va_arg(ap, int)) {
   ;	
	xor	cx,cx
	jmp	short @3@114
@3@58:
   ;	
   ;			b = *(int*)ap;
   ;	
	mov	bx,word ptr [bp-2]
	mov	di,word ptr [bx]
   ;	
   ;			r += b;
   ;	
	add	dx,di
	inc	cx
	add	word ptr [bp-2],2
	mov	bx,word ptr [bp-2]
@3@114:
	cmp	cx,word ptr [bp+6]
	jl	short @3@58
   ;	
   ;		}
   ;		va_end(ap);
   ;	
   ;	
   ;		return r;
   ;	
	mov	ax,dx
	jmp	short @3@170
@3@170:
   ;	
   ;	}
   ;	
	pop	di
	pop	si
	leave	
	ret	
@foo@baz$qie	endp
(...)
</pre>

<h4 id="id89d83b">main.cpp のアセンブラ出力(main.asm)（抜粋）</h4>
<pre class="plugin_pre">
   ;	
   ;		
   ;		int r = f-&gt;bar(1, 2, 3, 4, 5);
   ;	
	push	5
	push	4
	push	3
	push	2
	push	1
   ;	この上で、thisポインタがDIレジスタに格納済
	push	di
	call	near ptr @foo@bar$qiiiii
	add	sp,12
</pre>
<pre class="plugin_pre">
   ;	
   ;	
   ;		r = f-&gt;baz(3, 10, 20, 30);
   ;	
	push	30
	push	20
	push	10
	push	3
   ;	この上で、thisポインタがDIレジスタに格納済
	push	di
	call	near ptr @foo@baz$qie
	add	sp,10
</pre>

<h3 id="id12f36d">GCC4.1.2 + binutils-2.7.50.0.6 (CentOS5.2)</h3>

<ul><li> 引数は右から左へスタックにPUSHされる。</li>
<li><strong>&quot;this&quot;ポインタは最後にスタックにPUSHされる。</strong></li>
<li> cdeclと同様、<strong>関数を呼ぶ(caller)側で</strong>スタッククリーンアップする。</li></ul>

<p class="paragraph">
※可変長引数の有無に依らない。
<br />
</p>

<dl>
<dt> 特記事項 </dt>
<dd></dd>
<dd><blockquote></blockquote></dd>
<dd><ul><li><strong>生成されたアセンブラ上はESPの相対アドレスを使ってMOVしているが、結果としてメモリレイアウト上は右から左へ PUSHされた状態になる。</strong></li>
<li> なおgcc側の仕様か、呼び出し側(main())で使用するローカル領域分、冒頭でまとめてスタック上に確保してしまい、以降ESP は動かさずにESPからの相対アドレスを使ってスタック上に値を置いていく。<ul><li> これにより<strong>関数呼び出し側でのスタッククリーンアップを一切行わずに済む</strong>ようなアセンブラコードになっている点に注意。</li></ul></li></ul></dd>
</dl>

<p class="paragraph">
コンパイル＆リンク＆実行 
<br />
</p>
<pre>$ g++ -O0 -Wall --save-temps -c foo.cpp
$ g++ -O0 -Wall --save-temps -c main.cpp
$ g++ -o main main.o foo.o
$ ./main
foo::bar() = 25
foo::baz() = 70
</pre>

<h4 id="idddaa36">foo.cpp のアセンブラ出力(foo.s)（抜粋）</h4>
<pre class="plugin_pre">
(...)
.globl _ZN3foo3barEiiiii
	.type	_ZN3foo3barEiiiii, @function
_ZN3foo3barEiiiii:
.LFB5:
	pushl	%ebp
.LCFI4:
	movl	%esp, %ebp
.LCFI5:
	movl	16(%ebp), %eax
	addl	12(%ebp), %eax
	addl	20(%ebp), %eax
	addl	24(%ebp), %eax
	movl	%eax, %edx
	addl	28(%ebp), %edx
	movl	8(%ebp), %eax
	movl	(%eax), %eax
	leal	(%edx,%eax), %eax
	popl	%ebp
	ret
.LFE5:
	.size	_ZN3foo3barEiiiii, .-_ZN3foo3barEiiiii
	.align 2
.globl _ZN3foo3bazEiz
	.type	_ZN3foo3bazEiz, @function
_ZN3foo3bazEiz:
.LFB6:
	pushl	%ebp
.LCFI6:
	movl	%esp, %ebp
.LCFI7:
	subl	$16, %esp
.LCFI8:
	movl	8(%ebp), %eax
	movl	(%eax), %eax
	movl	%eax, -12(%ebp)
	movl	$0, -8(%ebp)
	leal	16(%ebp), %eax
	movl	%eax, -16(%ebp)
	movl	$0, -4(%ebp)
	jmp	.L8
.L9:
	movl	-16(%ebp), %eax
	movl	(%eax), %eax
	movl	%eax, -8(%ebp)
	movl	-8(%ebp), %eax
	addl	%eax, -12(%ebp)
	addl	$1, -4(%ebp)
	movl	-16(%ebp), %eax
	addl	$4, %eax
	movl	%eax, -16(%ebp)
.L8:
	movl	-4(%ebp), %eax
	cmpl	12(%ebp), %eax
	jl	.L9
	movl	-12(%ebp), %eax
	leave
	ret
.LFE6:
	.size	_ZN3foo3bazEiz, .-_ZN3foo3bazEiz
(...)
</pre>

<h4 id="ida62298">main.cpp のアセンブラ出力(main.s)（抜粋）</h4>
<pre class="plugin_pre">
	movl	$5, 20(%esp)
	movl	$4, 16(%esp)
	movl	$3, 12(%esp)
	movl	$2, 8(%esp)
	movl	$1, 4(%esp)
	movl	-16(%ebp), %eax
	movl	%eax, (%esp)
.LEHB2:
	call	_ZN3foo3barEiiiii
</pre>
<pre class="plugin_pre">
	movl	$30, 16(%esp)
	movl	$20, 12(%esp)
	movl	$10, 8(%esp)
	movl	$3, 4(%esp)
	movl	-16(%ebp), %eax
	movl	%eax, (%esp)
	call	_ZN3foo3bazEiz
</pre>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-623.html" title="C言語系/呼び出し規約/x86/syscall">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-628.html" title="C言語系/呼び出し規約/x86/watcall">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-615.html" title="C言語系/呼び出し規約/x86">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/621<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>