<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>技術/Linux/手作りLinuxシステム/01. Boot from Floppy Disk (kernel-2.6.x) - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">技術/Linux/手作りLinuxシステム/01. Boot from Floppy Disk (kernel-2.6.x)</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2011-04-06 15:37:14 &nbsp; / &nbsp; last updated at: 2011-04-29 15:38:22<br>
カテゴリ: <a href="category-20.html">Linux</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-940.html" title="技術/Linux/手作りLinuxシステム">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-943.html" title="技術/Linux/手作りLinuxシステム/02. Boot from Floppy Disk (kernel-2.4.x)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
Linux Kernel 2.6.x を使ってフロッピーディスクから起動するLinuxシステムを作ってみます。
<br />
</p>



<ul><li><a href="#idc21f18">Kernel 2.6.x の入手とコンパイル</a></li>
<li><a href="#id3d8f7e">FDブート用のイメージを作成</a></li>
<li><a href="#ida883f9">SYSLINUXを使ったrootデバイスの設定</a></li>
<li><a href="#ide4013e">ルートファイルシステムの作成</a></li>
<li><a href="#id65bfef">BusyBoxの導入</a></li>
<li><a href="#id0cec77">上手く動かない時は：</a><ul><li><a href="#id0f4a46">&quot;make mrproper&quot; と .config ファイル</a></li></ul></li></ul>
<hr />
<h3 id="idc21f18">Kernel 2.6.x の入手とコンパイル</h3>

<p class="paragraph">
今回は linux-2.6.38.2.tar.bz2 を使います。
<br />
入手先：
<br />
</p>
<ul><li> The Linux Kernel Archives<ul><li> <a class="externallink" href="http://www.kernel.org/" target="_blank">http://www.kernel.org/</a></li></ul></li></ul>

<pre>$ pwd
/home/msakamoto/reduced.linux
$ ls
... linux-2.6.38.2.tar.bz2 ...
$ tar jxf linux-2.6.38.2.tar.bz2
</pre>

<p class="paragraph">
出力用ディレクトリを作成し、KBUILD_OUTPUT環境変数を使ってmake menuconfigします。makeコマンドの詳細は &quot;make help&quot; で確認して下さい。
<br />
</p>
<pre>$ mkdir 01_boot_from_fd_2.6
$ export KBUILD_OUTPUT=`pwd`/01_boot_from_fd_2.6
$ echo $KBUILD_OUTPUT
/home/msakamoto/reduced.linux/01_boot_from_fd_2.6
$ cd linux-2.6.38.2/
$ make help
...
   # &quot;make O=/foo/bar&quot; としてmakeの都度ディレクトリを指定する方法もありますが、
   # 今回は使いません。
...
$ make allnoconfig
...
$ make menuconfig
</pre>
<p class="paragraph">
CONFIG_IKCONFIG, EFL実行ファイルのサポート, FDのBlockDevice, Ext2ファイルシステムを追加します。
<br />
allnoconfigとmenuconfig後の差分：
<br />
</p>
<pre class="plugin_pre">
$ diff .config .config.old
4c4
&lt; # Wed Apr  6 09:33:17 2011
---
&gt; # Wed Apr  6 09:31:49 2011
99,100c99
&lt; CONFIG_IKCONFIG=y
&lt; CONFIG_IKCONFIG_PROC=y
---
&gt; # CONFIG_IKCONFIG is not set
369,370c368
&lt; CONFIG_BINFMT_ELF=y
&lt; # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
---
&gt; # CONFIG_BINFMT_ELF is not set
395,405c393
&lt; CONFIG_BLK_DEV=y
&lt; CONFIG_BLK_DEV_FD=y
&lt; # CONFIG_BLK_DEV_COW_COMMON is not set
&lt; # CONFIG_BLK_DEV_LOOP is not set
&lt;
&lt; #
&lt; # DRBD disabled because PROC_FS, INET or CONNECTOR not selected
&lt; #
&lt; # CONFIG_BLK_DEV_RAM is not set
&lt; # CONFIG_CDROM_PKTCDVD is not set
&lt; # CONFIG_BLK_DEV_HD is not set
---
&gt; # CONFIG_BLK_DEV is not set
586,588c574
&lt; CONFIG_EXT2_FS=y
&lt; # CONFIG_EXT2_FS_XATTR is not set
&lt; # CONFIG_EXT2_FS_XIP is not set
---
&gt; # CONFIG_EXT2_FS is not set
</pre>

<p class="paragraph">
ビルドします。 &quot;01_...&quot; にcdすれば、KBUILD_OUTPUT環境変数が空でもbuildできます。
<br />
</p>
<pre class="plugin_pre">
$ cd 01_boot_from_fd_2.6
$ make
...
  HOSTCC  arch/x86/boot/tools/build
  BUILD   arch/x86/boot/bzImage
Root device is (253, 0)
Setup is 14008 bytes (padded to 14336 bytes).
System is 763 kB
CRC 43289aa6
Kernel: arch/x86/boot/bzImage is ready  (#1)
</pre>
<p class="paragraph">
ここまで来ればコンパイルは成功です。
<br />
</p>

<h3 id="id3d8f7e">FDブート用のイメージを作成</h3>

<p class="paragraph">
2.6.xの場合、bzImageのままではFDブート出来ません。
<br />
SYSLINUXをインストールした上で
<br />
</p>
<pre>make fdimage
</pre>
<p class="paragraph">
します。CentOS 5.5 の場合はパッケージとしてsyslinuxが提供されていますので、そのまま使います。入っていなければyumなどで適宜インストールしておきます。
<br />
</p>
<pre># which syslinux
/usr/bin/syslinux
# rpm -qf /usr/bin/syslinux
syslinux-3.11-4
</pre>
<p class="paragraph">
というわけで make してみます。
<br />
</p>
<pre>$ make fdimage
...
dd if=/dev/zero of=arch/x86/boot/fdimage bs=1024 count=1440
...
$ wc -c arch/x86/boot/fdimage
1474560 arch/x86/boot/fdimage
</pre>
<p class="paragraph">
root側でloopbackマウントし、中身を確認してみます。
<br />
</p>
<pre># mount .../x86/boot/fdimage /mnt/floppy -t msdos -o loop
# ls /mnt/floppy/
ldlinux.sys  linux  syslinux.cfg
# cat /mnt/floppy/syslinux.cfg
default linux
</pre>
<p class="paragraph">
SYSLINUXでFDブートの場合はFAT16フォーマットされたFDの中にカーネルイメージが&quot;linux&quot;というファイル名で配置されます。
<br />
ここまで来ればVMwareなど適当な仮想マシン上で動かせます。
<br />
</p>

<p class="paragraph">
ところが、実際に動かしてみると分かりますが root デバイスが見つからずpanicになります。
<br />
</p>

<h3 id="ida883f9">SYSLINUXを使ったrootデバイスの設定</h3>

<p class="paragraph">
rdev(util-linuxパッケージ)を使う方法と &quot;root=&quot; カーネルパラメータを使う方法があります。
<br />
将来GRUBなど他のBootLoaderを使うときにもお世話になり、柔軟性もある後者の方法を紹介します。
<br />
</p>

<p class="paragraph">
今回はSYSLINUXをBootLoaderに使っているので、SYSLINUXの流儀でカーネルパラメータを指定します。FDブートの場合はFD直下の&quot;SYSLINUX.CFG&quot;ファイルを編集します。
<br />
参考：
<br />
</p>
<ul><li> Syslinux Wiki<ul><li> <a class="externallink" href="http://syslinux.zytor.com/" target="_blank">http://syslinux.zytor.com/</a></li></ul></li>
<li> How do I Configure SYSLINUX<ul><li> <a class="externallink" href="http://syslinux.zytor.com/wiki/index.php/SYSLINUX#How_do_I_Configure_SYSLINUX.3F" target="_blank">http://syslinux.zytor.com/wiki/index.php/SYSLINUX#How_do_I_Configure_SYSLINUX.3F</a></li></ul></li></ul>

<p class="paragraph">
SYSLINUX.CFG:
<br />
</p>
<pre>default linux
</pre>
<p class="paragraph">
→
<br />
</p>
<pre>default linux
label linux
  kernel linux
  append root=0200
</pre>
<p class="paragraph">
なお改行はDOSの流儀に従い
<br />
</p>
<pre>\r\n
</pre>
<p class="paragraph">
にする必要があります。vimでは
<br />
</p>
<pre>:set fileformat=dos
</pre>
<p class="paragraph">
とすれば自動でDOS改行に変換してくれます。
<br />
</p>

<p class="paragraph">
NOTE: &quot;root=&quot;オプションですが、
<br />
</p>
<pre>root=/dev/fd0
</pre>
<p class="paragraph">
や
<br />
</p>
<pre>root=/dev/VolGroup00/LogVol00
</pre>
<p class="paragraph">
のようにデバイスファイル名を指定するパターンを多く見かけると思います。これらはinitrdがそうしたデバイスファイルを作っています。
<br />
今回はinitrdを使わないため、デバイスファイル名を指定できません。
<br />
そういう場合は今回のようにデバイスのmajor, minor番号をhexで指定できます。
<br />
</p>

<p class="paragraph">
というわけでもう一度VMwareなりBochsなりで動かしてみると、今度は
<br />
</p>
<pre>VFS: Insert root floppy and press ENTER
</pre>
<p class="paragraph">
という表示で停止しました。
<br />
</p>

<p class="paragraph">
ではいよいよルートファイルシステムを作ってみます。
<br />
</p>

<h3 id="ide4013e">ルートファイルシステムの作成</h3>

<p class="paragraph">
今回作るルートファイルシステム：
<br />
</p>
<ul><li> 1.4MBフロッピーディスクサイズ</li>
<li> Ext2ファイルシステム</li>
<li> 最小限度のディレクトリとデバイスファイル</li></ul>

<p class="paragraph">
まず1.4MBフロッピーディスクサイズのデータファイルを作成します。
<br />
</p>
<pre class="plugin_pre">
$ pwd
/home/msakamoto/reduced.linux/01_boot_from_fd_2.6
$ dd if=/dev/zero of=root_fs.img bs=1024 count=1440
1440+0 records in
1440+0 records out
1474560 bytes (1.5 MB) copied, 0.0135535 seconds, 109 MB/s
</pre>
<p class="paragraph">
続いてExt2ファイルシステムを作成します。mke2fsコマンドで作成します。
<br />
</p>
<pre class="plugin_pre">
$ su
# /sbin/mke2fs -F root_fs.img
mke2fs 1.39 (29-May-2006)
Filesystem label=
OS type: Linux
Block size=1024 (log=0)
...
#
</pre>
<p class="paragraph">
loopbackマウントしてみます。
<br />
</p>
<pre class="plugin_pre">
# mkdir /mnt/loop0
# mount root_fs.img /mnt/loop0 -t ext2 -o loop
# ls -l /mnt/loop0/
合計 12
drwx------ 2 root root 12288  4月  5 21:01 lost+found
</pre>
<p class="paragraph">
/dev, /proc, /etc ディレクトリを作成します。
<br />
</p>
<pre># pushd /mnt/loop0; mkdir dev proc etc; popd
</pre>
<p class="paragraph">
最低限度必要なデバイスファイルを &quot;cp -a&quot; でコピーします。
<br />
</p>
<pre># cp -a \
/dev/console \
/dev/tty[0-4] \
/dev/null \
/dev/zero \
/dev/urandom \
/dev/fd0 \
/mnt/loop0/dev/
</pre>

<p class="paragraph">
これで「容器」は出来上がりました：
<br />
</p>
<pre class="plugin_pre">
# tree /mnt/loop0/
/mnt/loop0/
|-- dev
|   |-- console
|   |-- fd0
|   |-- null
|   |-- tty0
|   |-- tty1
|   |-- tty2
|   |-- tty3
|   |-- tty4
|   |-- urandom
|   `-- zero
|-- etc
|-- lost+found
`-- proc

4 directories, 10 files
</pre>

<p class="paragraph">
続いてBusyBoxを使って「中身」を入れます。root_fs.imgはloopbackマウントしたままにしておきます。
<br />
</p>

<h3 id="id65bfef">BusyBoxの導入</h3>

<p class="paragraph">
BusyBoxの紹介は下記参照：
<br />
</p>
<ul><li> 組み込みLinuxで際立つ「BusyBox」の魅力（1/2） － ＠IT MONOist<ul><li> <a class="externallink" href="http://monoist.atmarkit.co.jp/fembedded/articles/busybox/busyboxa.html" target="_blank">http://monoist.atmarkit.co.jp/fembedded/articles/busybox/busyboxa.html</a></li></ul></li></ul>

<p class="paragraph">
今回は busybox-1.18.4.tar.bz2 を使いました。
<br />
</p>
<ul><li> BusyBox<ul><li> <a class="externallink" href="http://www.busybox.net/" target="_blank">http://www.busybox.net/</a></li></ul></li></ul>

<p class="paragraph">
ビルドの際はlinux kernelと同様cursesベースの設定ツールを使います。
<br />
</p>
<ul><li> <a href="./view-507.html" >技術/UNIX/BusyBox</a></li></ul>

<pre class="plugin_pre">
$ pwd
/home/msakamoto/reduced.linux
$ ls
... busybox-1.18.4.tar.bz2 ...
$ tar jxf busybox-1.18.4.tar.bz2
$ cd busybox-1.18.4/
$ make help
Cleaning:
  clean                 - delete temporary files created by build
  distclean             - delete all non-source files (including .config)
  doc-clean             - delete all generated documentation

Build:
  all                   - Executable and documentation
  busybox               - the swiss-army executable
  doc                   - docs/BusyBox.{txt,html,1}
  html                  - create html-based cross-reference
...
</pre>
<p class="paragraph">
BusyBoxの場合、makeコマンドの&quot;O=&quot;オプションで別ディレクトリに出力できます。
<br />
</p>
<pre>$ pwd
/home/msakamoto/reduced.linux
$ mkdir 01_busy_box_build
$ cd busybox-1.18.4/
$ make O=../01_busy_box_build allnoconfig
...
</pre>
<p class="paragraph">
これで一旦全オプションを無効化した設定になります。続いて &quot;make menuconfig&quot; で必要分だけ有効化します。
<br />
</p>
<pre>$ cd ../01_busy_box_build/
$ make menuconfig
</pre>
<p class="paragraph">
今回は静的バイナリとしてビルドするので、下記オプションを有効にします。
<br />
</p>
<pre>Busybox Settings  ---&gt;
  Build Options  ---&gt;
    Build BusyBox as a static binary (no shared libs)
</pre>
<p class="paragraph">
また mount コマンドを有効にするため、下記オプションを有効にします。
<br />
</p>
<pre>Busybox Settings  ---&gt;
  General Configuration  ---&gt;
    Enable Linux-specific applets and features
</pre>
<p class="paragraph">
その他は最低限以下の機能を有効にします。
<br />
</p>
<ul><li> Core Utilities : 適当に最低限度のファイルシステム操作を出来るコマンドを選択しておきます。</li>
<li> Shell : ashで良いと思います。sh, bashにエイリアスできます。</li>
<li> Init Utilities : poweroff, halt, reboot, initを入れます。</li>
<li> Linux System Utilities : mount, umountを入れます。&quot;-a&quot;オプションを有効にしておきます。</li></ul>
<p class="paragraph">
あとはお好みで有効化し、ビルドします。
<br />
</p>
<pre>$ make
...
  LINK    busybox_unstripped
Trying libraries: crypt m
 Library crypt is not needed, excluding it
 Library m is not needed, excluding it
Final link with: &lt;none&gt;
  DOC     busybox.pod
  DOC     BusyBox.txt
  DOC     busybox.1
  DOC     BusyBox.html
$ ls
...
busybox*
busybox_unstripped*
...
$ wc -c busybox
716096 busybox
$ file busybox
busybox: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), \
 for GNU/Linux 2.6.9, statically linked, for GNU/Linux 2.6.9, stripped
</pre>

<p class="paragraph">
ルートファイルシステムにインストールします。
<br />
</p>
<pre>$ su
# make CONFIG_PREFIX=/mnt/loop0 install
</pre>

<p class="paragraph">
inittabを用意します。
<br />
</p>
<pre># vim /mnt/loop0/etc/inittab
</pre>
<p class="paragraph">
内容：
<br />
</p>
<pre>::sysinit:/etc/rcS

::askfirst:-/bin/sh
tty2::askfirst:-/bin/sh
tty3::askfirst:-/bin/sh
tty4::askfirst:-/bin/sh

::restart:/sbin/init
::ctrlaltdel:/sbin/reboot
::shutdown:/bin/umount -a -r
</pre>

<p class="paragraph">
BusyBoxのinittabの文法に付いてはソースコード &quot;init/init.c&quot; の末尾に書かれていますのでそちらを参照してください。
<br />
続いて &quot;/etc/rcS&quot; ファイルを用意します。
<br />
</p>
<pre># vim /mnt/loop0/etc/rcS
</pre>
<p class="paragraph">
内容：
<br />
</p>
<pre>#!/bin/sh
mount -a
/bin/sh
</pre>
<p class="paragraph">
実行属性をつけるのを忘れずに。
<br />
</p>
<pre># chmod +x /mnt/loop0/etc/rcS
</pre>

<p class="paragraph">
最後にmountコマンドが使う fstab を用意します。
<br />
</p>
<pre># vim /mnt/loop0/etc/fstab
</pre>
<p class="paragraph">
内容：
<br />
</p>
<pre>/proc      /proc     proc   defaults
/dev/fd0   /         ext2   defaults
</pre>

<p class="paragraph">
loopbackマウントを解除します。
<br />
</p>
<pre># umount /mnt/loop0
</pre>

<p class="paragraph">
あとはVMwareなりBochsを動かすホストマシンにroot_fs.imgを転送し、fdimageから立ち上げます。
<br />
</p>
<pre>VFS: Insert root floppy and press ENTER
</pre>
<p class="paragraph">
と出たらroot_fs.imgに切り替え、ENTERを入力します。
<br />
</p>

<p class="paragraph">
上手く行けば下図のようにシェルが立ち上がり、mountコマンドを確認できます。
<br />
</p>

<p class="paragraph">
<a href="./../images/reduced.linux/01_01.png" title="" target="_blank"><img src="./../images/reduced.linux/01_01.png" alt="" title=""  /></a>
<br />
</p>

<h3 id="id0cec77">上手く動かない時は：</h3>

<p class="paragraph">
・カーネルをロードできない
<br />
→ &quot;make fdimage&quot;、および syslinux.cfg の修正までの作業工程を確認してみてください。
<br />
</p>

<p class="paragraph">
・ルートファイルシステムをマウントできない
<br />
→ Ext2ファイルシステムをbuilt-inしているか確認して下さい : CONFIG_EXT2_FS
<br />
→ Floppy Diskを有効化しているか確認して下さい : CONFIG_BLK_DEV, CONFIG_BLK_DEV_FD
<br />
</p>

<p class="paragraph">
・&quot;/sbin/init&quot;が起動しない
<br />
→ ホストマシンでルートファイルシステムを調整した後、ちゃんとumountしてからVMwareなりBochsに読み込ませているか確認して下さい。
<br />
→ &quot;/etc/inittab&quot;, &quot;/etc/rcS&quot; の内容および &quot;/etc/rcS&quot; の実行権限を確認して下さい。
<br />
→ どうしても動かないようであれば、syslinux.cfg で &quot;init=/bin/sh&quot; パラメータを追加指定し、とりあえずシェルが立ち上がるか確認してみてください。
<br />
</p>

<p class="paragraph">
・その他、&quot;VFS: ...&quot; で始まるエラーメッセージが表示される
<br />
→ Kernelソースの &quot;init&quot; ディレクトリの中をエラーメッセージでgrepしてみてください。ルートファイルシステムやinitrd絡みのエラーメッセージはこの中でprintk()されている事が多いです。ソースを読んで、必要なら詳しいprintk()を自分で挿入しリビルドしてみるなどしていくと、原因が分かるかもしれません。
<br />
</p>

<p class="paragraph">
自分が嵌ってしまったのは「Ext2モジュール組み込み忘れ」と「ホストマシンでルートファイルシステムをumountせずに使ってしまった」の２点です。
<br />
umountを忘れたせいか、&quot;/sbin/init&quot;が起動せず困りました。
<br />
KGDBを有効化してホストマシンからのgdbデバッグも試みたのですが、あれこれ試してるうちに &quot;init=&quot; パラメータを追加すれば動くようになって、「じゃあ大丈夫じゃね？」と &quot;init=&quot; パラメータを外してKGDBも外して元に戻してみたらちゃんと動き始めたり・・・。
<br />
なかなか悩ましいです。ってかマジでなんでFDブートするためだけにこんなにハマらなくっちゃならないんだ・・・。
<br />
</p>

<h4 id="id0f4a46">&quot;make mrproper&quot; と .config ファイル</h4>

<p class="paragraph">
色々試行錯誤する中でKernel Configurationを変更し、一旦全部クリーンしてからリビルドする場合があると思います。
<br />
</p>
<pre>make mrproper
</pre>
<p class="paragraph">
すると Kernel Configuration を保存した &quot;.config&quot; も消してしまうので注意してください。(kernel-2.4.xの場合も同様)
<br />
</p>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-940.html" title="技術/Linux/手作りLinuxシステム">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-943.html" title="技術/Linux/手作りLinuxシステム/02. Boot from Floppy Disk (kernel-2.4.x)">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-940.html" title="技術/Linux/手作りLinuxシステム">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-23.html" title="技術">技術</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/941<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>