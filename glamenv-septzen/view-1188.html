<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Groovy/Maven/Examples (includes &quot;Java Joint Compile&quot;) - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">Groovy/Maven/Examples (includes &quot;Java Joint Compile&quot;)</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2013-04-22 00:04:15 &nbsp; / &nbsp; last updated at: 2013-04-28 00:11:47<br>
カテゴリ: <a href="category-68.html">Groovy</a>&nbsp;<a href="category-11.html">Java</a>&nbsp;<a href="category-62.html">Maven</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1217.html" title="Groovy/Maven/Eclipse + GGTS使用時のメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1152.html" title="Groovy/Maven/GMaven + Eclipse memo">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1101.html" title="Groovy">Groovy</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
<a href="./view-1163.html" >Groovy/Gradle/Mixing Java and Groovy</a> でGradleを使ったJava/Groovy混在プロジェクトでのポイントをまとめました。
<br />
しかしながら、既存のMaven資産や（ようやく安定し始めた感のある）m2e + Eclipse IDEとの統合開発環境を活用したいいために、引き続きJavaを中心でビルドシステムはMaven、開発効率化としてGroovyで脇を固めたい、というニーズもあるはずです。・・・あるんですってば。
<br />
</p>

<p class="paragraph">
そうした場合にも、2013-04現在では大きく2種類の方式で、Java/Groovy混在プロジェクトをMavenで統合管理出来ます。
<br />
</p>
<ol><li> &quot;groovyc&quot; Antタスクを、maven-antrun-pluginから起動する。</li>
<li> GMaven Mavenプラグインを利用する。</li></ol>

<p class="paragraph">
<a href="./view-1152.html" >Groovy/Maven/GMaven + Eclipse memo</a> ではGMavenをごく簡単に紹介しましたが、今回はより深く突っ込んで、以下のパターンそれぞれで、&quot;groovyc&quot; AntタスクによるビルドとGMavenによるビルドを構成してみます。
<br />
</p>
<ul><li> GroovyのみのMavenプロジェクト</li>
<li> Java + GroovyのMavenプロジェクト（Java -&gt; Groovy参照：無し、Groovy -&gt; Java参照：有り）</li>
<li> Java + GroovyのMavenプロジェクト（Java -&gt; Groovy参照：有り、Groovy -&gt; Java参照：有り）</li></ul>

<p class="paragraph">
というわけで作成したのが以下になります。
<br />
</p>
<ul><li> <a class="externallink" href="https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1" target="_blank">https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1</a></li></ul>

<p class="paragraph">
細かい解説は、README.mdおよび実際のコードを参照してください。
<br />
</p>

<p class="paragraph">
むしろ本記事では、これらの作成で思いっきり地雷を踏み抜いいたり嵌ってしまった部分を紹介して行きたいと思います。
<br />
さらに、おまけとして一番複雑な「Java + GroovyのMavenプロジェクト（Java -&gt; Groovy参照：有り、Groovy -&gt; Java参照：有り）」を題材に、Eclipse + m2e環境でインポートして &quot;mvn tomcat6:run&quot; でJava/Groovyそれぞれをデバッグ実行するためのポイントも簡単に紹介します。
<br />
</p>

<hr />

<h3 id="id230e03">参考にしたサイト</h3>

<p class="paragraph">
最初に参考サイトです。
<br />
</p>

<p class="paragraph">
GMaven参考
<br />
</p>
<ul><li> GMaven の世界<ul><li> <a class="externallink" href="http://www5.ocn.ne.jp/~coast/programming/groovy/gmaven.html" target="_blank">http://www5.ocn.ne.jp/~coast/programming/groovy/gmaven.html</a></li></ul></li>
<li> Home - GMaven - Codehaus<ul><li> <a class="externallink" href="http://docs.codehaus.org/display/GMAVEN/Home" target="_blank">http://docs.codehaus.org/display/GMAVEN/Home</a></li></ul></li></ul>


<p class="paragraph">
GroovyのAntタスクを、maven-antrun-pluginから呼び出す：
<br />
</p>
<ul><li> Groovy - Compiling With Maven2<ul><li> <a class="externallink" href="http://groovy.codehaus.org/Compiling+With+Maven2" target="_blank">http://groovy.codehaus.org/Compiling+With+Maven2</a></li></ul></li>
<li> Maven AntRun Plugin<ul><li> <a class="externallink" href="http://maven.apache.org/plugins/maven-antrun-plugin/" target="_blank">http://maven.apache.org/plugins/maven-antrun-plugin/</a></li></ul></li>
<li> Groovy - The groovyc Ant Task<ul><li> <a class="externallink" href="http://groovy.codehaus.org/The+groovyc+Ant+Task" target="_blank">http://groovy.codehaus.org/The+groovyc+Ant+Task</a></li></ul></li></ul>

<h3 id="id7efbbf">&quot;Java Joint Compile&quot; で嵌った箇所</h3>

<p class="paragraph">
嵌った箇所・・・ではありませんが、そもそも&quot;Java Joint Compile&quot;とはどういったものかについてです。
<br />
</p>

<p class="paragraph">
まず、基本的に xxxx.groovy が yyyy.java ソースのクラスを参照するだけであればどのビルドシステムを使っても大して問題は起きません。
<br />
</p>
<ol><li> yyyy.java がコンパイルされる。</li>
<li> xxxx.groovy がコンパイルされる。 -&gt; yyyy.classが存在するのでコンパイル成功。</li></ol>

<p class="paragraph">
ところが、yyyy.java が zzzz.groovy ソース内のクラスを参照しているとなると、問題が起こります。
<br />
大抵のビルドシステムでは・・・というかGradle/Maven/Antでは、特に意識しない限りは、「Javaコンパイル」→「Groovyコンパイル」の順に処理されます。教科書（＝公式サイト）の解説にしたがってGroovyコンパイルを追加しただけだと。
<br />
すると、yyyy.java をコンパイルするには zzzz.groovy をコンパイルしたクラスが必要ですが、 zzzz.groovy をコンパイルするにはJavaコンパイルフェーズが完了していなければならず、鶏が先か卵が先か、という状況になってしまいます。
<br />
</p>

<p class="paragraph">
これを解決するのが &quot;Java Joint Compile&quot; (念のため：本記事で便宜的につけてる名前で、プラグインや記事によって表記ゆれがあるっぽいです) です。
<br />
これは、最初に xxxx.groovy, zzzz.groovy を、クラスやメソッドのシグネチャだけJavaに変換した &quot;Stub&quot; の java ファイルを生成します。これらは戻り値のあるメソッドであればnullを返すだけなど、本当に、単にそれらを参照してる java ファイルのコンパイルを成功させるためだけの内容です。
<br />
続いて、それを含めて本来のyyyy.javaがビルドシステムのJavaコンパイルフェーズでコンパイルされます。
<br />
最後に、本来の xxxx.groovy や zzzz.groovy が改めてGroovyでコンパイルされます。↑でコンパイルされたStubの同名classファイルは、このステップにより本来のGroovyソースがコンパイルされた正しい内容で上書きされます。
<br />
</p>

<p class="paragraph">
・・・一応上記説明はイメージです。今回色々試行錯誤して、失敗時や成功時のエラーメッセージを見たり途中過程を追ううちに、多分こうなってるんじゃないかな～程度で。
<br />
</p>

<p class="paragraph">
ということで、「まずStubを生成する」という&quot;Java Joint Compile&quot;の特性を理解していないと、GMavenやgroovyc AntTask + maven-antrun-pluginをうまく構成出来ません。
<br />
</p>

<h3 id="id51a93c">GMavenで嵌った箇所</h3>

<p class="paragraph">
<strong>2013-04-27追記：</strong>何を間違えていたのか、今日改めて確認してみたら次の設定で問題なく、GMavenのstub生成とcompileが適切なタイミングで実行されました。
<br />
</p>
<pre class="plugin_pre">
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;generateStubs&lt;/goal&gt;
              &lt;goal&gt;compile&lt;/goal&gt;
              &lt;goal&gt;generateTestStubs&lt;/goal&gt;
              &lt;goal&gt;testCompile&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
</pre>

<p class="paragraph">
GitHubの方には既に上記のようなシンプルな設定に直したpom.xmlを上げてあります。
<br />
<a class="externallink" href="https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1/commit/09109628f6ddd4f4b9c2b7df7e295d25bf7f10a5" target="_blank">https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1/commit/09109628f6ddd4f4b9c2b7df7e295d25bf7f10a5</a>
<br />
</p>

<p class="paragraph">
以下の手法は、もし上記の設定でうまく動かなかった場合の、手動調整用として参照してください。
<br />
</p>

<hr />
<p class="paragraph">
<a href="./view-1122.html" >Groovy/Maven/Java + TestNG Example</a> で既にGMavenを使ってMavenプロジェクトを構成していましたが、<del>その時点では</del>
<br />
</p>
<pre>mvn groovy:compile groovy:testCompile
</pre>
<p class="paragraph">
<del>というふうに手動でGMavenのゴールを指定する必要がありますよ・・・と書いてました。</del>(2013-04-27：書いてませんでしたね。何を勘違いしてたんだろう・・・)
<br />
pom.xmlはこんな感じです：
<br />
</p>
<pre class="plugin_pre">
&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.gmaven&lt;/groupId&gt;
  &lt;artifactId&gt;gmaven-plugin&lt;/artifactId&gt;
  &lt;version&gt;${gmavenVersion}&lt;/version&gt;
  &lt;configuration&gt;
    &lt;providerSelection&gt;${gmavenProviderSelection}&lt;/providerSelection&gt;
    &lt;sourceEncoding&gt;UTF-8&lt;/sourceEncoding&gt;
  &lt;/configuration&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;generateStubs&lt;/goal&gt;
        &lt;goal&gt;compile&lt;/goal&gt;
        &lt;goal&gt;generateTestStubs&lt;/goal&gt;
        &lt;goal&gt;testCompile&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
      &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
      &lt;version&gt;${groovyVersion}&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/plugin&gt;
</pre>

<p class="paragraph">
<del>今だから言えますが、これ、単にGMavenの公式Web上のコピペしただけですので、本来のGMavenのゴールを正しく、対応するフェーズで実行する設定にはなってません。</del><strong>2013-04-27に改めて検証したところ、上記設定で問題ないようです。</strong>(何か別のところでミスってたか、勘違いしてたか。)
<br />
</p>

<p class="paragraph">
本来は、各ゴールは以下のフェーズで実行されるのが・・・多分、今日試してた限りではgoodぽい。
<br />
</p>
<ul><li> groovy:generateStubs -&gt; &quot;generate-sources&quot; phase</li>
<li> groovy:compile -&gt; &quot;compile&quot; phase</li>
<li> groovy:generateTestStubs -&gt; &quot;generate-test-sources&quot; phase</li>
<li> groovy:testCompile -&gt; &quot;test-compile&quot; phase</li></ul>

<p class="paragraph">
ということで、上記のマッピングでGMavenのゴールとphaseが連動するように調整したのが、以下になります。
<br />
</p>
<pre class="plugin_pre">
  &lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.gmaven&lt;/groupId&gt;
    &lt;artifactId&gt;gmaven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${gmavenVersion}&lt;/version&gt;
    &lt;configuration&gt;
      &lt;providerSelection&gt;${gmavenProviderSelection}&lt;/providerSelection&gt;
      &lt;sourceEncoding&gt;UTF-8&lt;/sourceEncoding&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;gmaven-generate-stubs&lt;/id&gt;
        &lt;phase&gt;generate-sources&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;generateStubs&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;gmaven-compile&lt;/id&gt;
        &lt;phase&gt;compile&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;compile&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;gmaven-generate-test-stubs&lt;/id&gt;
        &lt;phase&gt;generate-test-sources&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;generateTestStubs&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
      &lt;execution&gt;
        &lt;id&gt;gmaven-generate-test-compile&lt;/id&gt;
        &lt;phase&gt;test-compile&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;testCompile&lt;/goal&gt;
        &lt;/goals&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
        &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
        &lt;version&gt;${groovyVersion}&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/plugin&gt;
</pre>

<p class="paragraph">
いや～、これに辿り着くまで、改めてMavenのphaseとgoalの関係を勉強しなおしたり、ちょっとした嵌りどころでした。
<br />
</p>

<p class="paragraph">
<strong>2013-04-27追記：</strong>改めて、本来は前述のような簡略化されたgoal設定で問題ないようです。うまく動かなかったりした時の、手動設定として上記のmappingを参照してください。
<br />
</p>

<h3 id="id24d14b">groovyc Antタスク + maven-antrun-plugin で &quot;Java Joint Compile&quot; の嵌りどころ</h3>

<p class="paragraph">
groovyc Antタスクでは&quot;&lt;javac&gt;&quot;タスクをネストすることで自動的に&quot;Java Joint Compile&quot;を処理してくれます。
<br />
が・・・Mavenに組み込もうとするとちょっとした・・・どころじゃなくて、ドエライ嵌りどころが出てきます。
<br />
<strong>maven-compiler-pluginのデフォルト挙動をストップする必要があるのが嵌りポイントです。</strong>
<br />
</p>

<p class="paragraph">
これ、解決までに5時間を要しました。
<br />
</p>

<p class="paragraph">
groovyc Antタスクは、compileフェーズで起動するようにmaven-antrun-pluginを使って設定されます。
<br />
ところが、そうなるとデフォルト状態では&quot;maven-compiler-plugin&quot;によるデフォルトのJavaコンパイルも発動してしまいます。このプラグインによるコンパイルは、Groovyの存在など全く知らないため、 Groovyソースを参照しているJavaソースをコンパイルしようとしたら当然エラーになります。
<br />
</p>

<p class="paragraph">
groovyc Antタスクがサポートしている&quot;Joint Compile&quot;を使わずに、&quot;maven-compiler-plugin&quot;によるコンパイルでJavaソースをコンパイルしようとすると、Stubファイルを予め生成する必要が出てくるわけです。
<br />
が・・・「この辺手動で生成すればうまくいけるんじゃねーかなー」と、そう考えていた時代が僕にもありました。
<br />
</p>
<ul><li> GenerateStubsTask (groovy 2.1.3 API)<ul><li> <a class="externallink" href="http://groovy.codehaus.org/gapi/org/codehaus/groovy/ant/GenerateStubsTask.html" target="_blank">http://groovy.codehaus.org/gapi/org/codehaus/groovy/ant/GenerateStubsTask.html</a></li></ul></li>
<li> UberCompileTask (groovy 2.1.3 API)<ul><li> <a class="externallink" href="http://groovy.codehaus.org/gapi/org/codehaus/groovy/ant/UberCompileTask.html" target="_blank">http://groovy.codehaus.org/gapi/org/codehaus/groovy/ant/UberCompileTask.html</a></li></ul></li></ul>

<p class="paragraph">
手動でstubを生成して・・・
<br />
</p>

<ul><li> Build Helper Maven Plugin - Introduction<ul><li> <a class="externallink" href="http://mojo.codehaus.org/build-helper-maven-plugin/index.html" target="_blank">http://mojo.codehaus.org/build-helper-maven-plugin/index.html</a></li></ul></li>
<li> Build Helper Maven Plugin - build-helper:add-source<ul><li> <a class="externallink" href="http://mojo.codehaus.org/build-helper-maven-plugin/add-source-mojo.html" target="_blank">http://mojo.codehaus.org/build-helper-maven-plugin/add-source-mojo.html</a></li></ul></li></ul>

<p class="paragraph">
↑↑この辺使って動的にaddSourceして・・・
<br />
その後、maven-compiler-plugin によるデフォルトのJavaコンパイラ起動、さらにその後、groovycのAntタスクを起動でどうにかならね？
<br />
・・・と思ったのですが。実験してみればすぐわかるんですが、 
<br />
</p>
<ol><li> maven-compiler-pluginによって、Stubのjavaソースもコンパイルされて、classファイルになる。</li>
<li> maven-antrun-pluginによって、groovycのAntタスクが起動。</li>
<li> →<strong>Stubファイルのコンパイルにより、既に同名のクラスファイルが最新のタイムスタンプで生成されているため、Groovyコンパイラがスルーしてしまう。</strong></li>
<li> →<strong>Stubファイルはシグネチャ合わせてnullをreturnするだけの中身空っぽのソースなので、当然、実行するとNullPointerExceptionだらけになる。</strong></li>
<li> →<strong>でもGroovyコンパイラがスルーしてしまうため、本来のGroovyコードはコンパイルされない。</strong></li>
<li> →<strong>手詰まり状態＼(^o^)／ｵﾜﾀ </strong></li></ol>

<p class="paragraph">
という流れで、にっちもさっちも行かなくなります。（ここでさらに独自のantタスクとか準備して、Groovyソースと同名のクラスファイルが生成されていれば一旦それらを削除してからgroovycのAntタスク起動・・・とかやるのもアリなんですが、あまりにもなんというか、力技過ぎる気がするので却下しました。）
<br />
</p>

<p class="paragraph">
そうなると、最終的な回答としてはStubファイルの手動生成 + maven-compiler-plugin<strong>ではなく、</strong>groovyc Antタスクがサポートしているネストされた &quot;&lt;javac&gt;&quot; による &quot;Java Joint Compile&quot; が残された手段になります。
<br />
その場合もネックになるのが maven-compiler-plugin の無効化です。というわけで今回最も時間を取られた嵌りどころが・・・
<br />
</p>

<h3 id="id12bc69">How to disable maven-compiler-plugin ?</h3>

<p class="paragraph">
そこでようやく本題ですが、<strong>Googleで調べた &quot;disable maven-compiler-plugin&quot; の尽くが全く期待通りに動いてくれなかったんですよ！！！ </strong>
<br />
</p>

<p class="paragraph">
先に答えを書くと、以下のように&quot;&lt;id&gt;&quot;で &quot;default-compile&quot;, &quot;default-testCompile&quot; を指定した上で&quot;&lt;phase&gt;none&lt;/phase&gt;&quot;を指定すると、compile/test-compileの各フェーズでmaven-compiler-pluginが無効化されます。
<br />
</p>
<pre class="plugin_pre">
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;default-compile&lt;/id&gt;
            &lt;phase&gt;none&lt;/phase&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;default-testCompile&lt;/id&gt;
            &lt;phase&gt;none&lt;/phase&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
</pre>

<p class="paragraph">
<strong>Googleで調べて見つけた記事では、この &lt;id&gt; 指定をしてる記事が見当たらなかったんですよ。</strong>(いや、そりゃヒットした上位数件を見ただけなので、細かく見てけばもっとちゃんとしたのもあったとは思うんですが。)
<br />
</p>

<p class="paragraph">
実は、&quot;&lt;id&gt;&quot;指定を省略すると<strong>デフォルトの &lt;id&gt; の設定が残ってしまうので、どんなに頑張ってもそれが残ってるので maven-compiler-plugin のデフォルトコンパイルを無効化出来ない</strong>というとんでもない罠が潜んでます。
<br />
</p>

<p class="paragraph">
これ、ようやく半信半疑で &quot;mvn help:effective-pom&quot; で見つけるまでに、試行錯誤で5時間費やしました・・・。
<br />
</p>

<p class="paragraph">
なお、環境は
<br />
</p>
<pre>JDK 1.7
Maven 3.4
maven-compiler-plugin 3.0
</pre>
<p class="paragraph">
です。もしかしたら古いバージョンでは&quot;&lt;id&gt;&quot;指定なしでも無効化出来たのかもしれませんね。
<br />
</p>

<h3 id="id390a7c">e4.2 + m2e 1.3 にインポートするときの注意点</h3>

<p class="paragraph">
では最後のトピックです。
<br />
<a class="externallink" href="https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1" target="_blank">https://github.com/msakamoto-sf/maven-java-groovy-conjunction-demo1</a>
<br />
の、&quot;sample6 : 02-java-refer-groovy-antrun&quot; をEclipseにインポートするときの注意点です。
<br />
</p>

<p class="paragraph">
環境：
<br />
</p>
<pre>JDK 1.7
Eclipse 4.2 (Juno SR-2)
m2e 1.3.1
Groovy-Eclipse Plugin 2.8.0 (SpringSourceのGGTSでまとめて導入)
</pre>

<p class="paragraph">
そのまま &quot;Existing Maven Projects&quot; でインポートしようとすると、
<br />
</p>
<pre>Plugin execution not covered by lifecycle configuration: org.apache.maven.plugins:maven-antrun-plugin...
</pre>
<p class="paragraph">
とエラーが発生します。このエラー自体は後で修正出来るタイプのエラーらしく、インポート自体は完了します。
<br />
また、その後プロジェクト右クリック -&gt; &quot;Configure&quot; -&gt; &quot;Convert to Groovy Project&quot; でGroovyサポートを組み込み、ソースディレクトリを手動で調整してあげれば、コンパイルも成功します。
<br />
</p>

<p class="paragraph">
あとは上記のエラーだけですが、この内容は端的に言うと、「pom.xml中で指定されたmaven-antrun-pluginを、Eclipse上でいつ実行すれば良いのか分かりません。」というエラーです。
<br />
詳細は以下で解説されてます。
<br />
</p>
<ul><li> M2E plugin execution not covered - Eclipsepedia<ul><li> <a class="externallink" href="http://wiki.eclipse.org/M2E_plugin_execution_not_covered" target="_blank">http://wiki.eclipse.org/M2E_plugin_execution_not_covered</a></li></ul></li></ul>

<p class="paragraph">
対処法としては、m2e 1.3であれば pom.xml にm2eのlifecycle設定用のmapping情報を埋め込みます。これにより、どのプラグインをEclipse上でどのタイミングで実行すればよいのか、mapping情報が埋め込まれることで、m2eは上記エラーを解決出来ます。
<br />
</p>

<p class="paragraph">
今回のmaven-antrun-plugin設定については、結局のところEclipse上ではEclipseのJavaコンパイラとGroovy-Eclipse PluginによるGroovyプラグインが、自動的に Java Joint Compile も処理してくれるため、Eclipse上では不要となります。そのため、以下のように単に&quot;&lt;ignore /&gt;&quot;を&quot;&lt;action&gt;&quot;に設定すればOKです。
<br />
</p>
<pre class="plugin_pre">
&lt;project&gt;
...

  &lt;build&gt;
  ...
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;org.eclipse.m2e&lt;/groupId&gt;
        &lt;artifactId&gt;lifecycle-mapping&lt;/artifactId&gt;
        &lt;version&gt;1.0.0&lt;/version&gt;
        &lt;configuration&gt;
          &lt;lifecycleMappingMetadata&gt;
            &lt;pluginExecutions&gt;
              &lt;pluginExecution&gt;
                &lt;pluginExecutionFilter&gt;
                  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                  &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
                  &lt;versionRange&gt;[1.7,)&lt;/versionRange&gt;
                  &lt;goals&gt;
                    &lt;goal&gt;run&lt;/goal&gt;
                  &lt;/goals&gt;
                &lt;/pluginExecutionFilter&gt;
                &lt;action&gt;
                  &lt;ignore /&gt;
                &lt;/action&gt;
              &lt;/pluginExecution&gt;
            &lt;/pluginExecutions&gt;
          &lt;/lifecycleMappingMetadata&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</pre>

<p class="paragraph">
以上のテクニックを用いて、
<br />
<a class="externallink" href="https://github.com/msakamoto-sf/groovyservlet-sample-template" target="_blank">https://github.com/msakamoto-sf/groovyservlet-sample-template</a>
<br />
に上記を適用したpom.xmlを用い、&quot;mvn tomcat6:run&quot;をデバッグ実行、見事Eclipse上で対話的にブレークポイント設定して、ブレークで止められたのが以下にupした画像になります。
<br />
<a class="externallink" href="http://twitpic.com/ckyezv" target="_blank">http://twitpic.com/ckyezv</a>
<br />
</p>

<hr />
<p class="paragraph">
Groovy/Java/Maven/EclipseのIntegrationネタは大体、以上でひと通り出揃ったと思います。
<br />
というかこれ以上地雷が潜んでるとか勘弁して欲しいので、ホント、これで終わりにしたいです。
<br />
</p>

<p class="paragraph">
Groovy・・・というか、JVM上で動作する言語(Groovy, Scala, JRuby, Jython, Clojure)は言語それ自体だけでなく、JVMをとりまくエコシステム(ビルドシステム, IDE)をトータルで扱えて初めて、Javaを超えることが出来るという感じがします。
<br />
教科書（＝公式サイト）には載っていないようなイレギュラーなケースに対応出来て、初めて実際の開発現場でその威力を発揮できるはずです。
<br />
</p>

<p class="paragraph">
ということで、本記事が「言語自体はスゴイのだけれど、既存のMavenで組み上げられたJava中心のプロジェクトに追加するのはちょっと・・・」と感じているエンジニアの方に、その壁をぶち壊す突破口を切り開くお手伝いになることを祈ります。
<br />
</p>

<p class="paragraph">
・・・いやホント、自分が嵌ってプライベート時間を無駄遣いしたのは、他で困ってるエンジニアを救ったという事実が救済してくれますので、何卒どこかで役立つことを祈ってます。
<br />
</p>


<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1217.html" title="Groovy/Maven/Eclipse + GGTS使用時のメモ">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1152.html" title="Groovy/Maven/GMaven + Eclipse memo">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1101.html" title="Groovy">Groovy</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1188<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2007 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>