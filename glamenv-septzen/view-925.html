<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>読書メモ/&quot;Advanced .NET Debugging&quot; - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">読書メモ/&quot;Advanced .NET Debugging&quot;</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2011-02-28 16:28:45 &nbsp; / &nbsp; last updated at: 2011-04-02 16:21:05<br>
カテゴリ: <a href="category-56.html">.NET</a>&nbsp;<a href="category-57.html">WinDBG</a>&nbsp;<a href="category-8.html">Windows</a>&nbsp;<a href="category-12.html">プログラミング</a>&nbsp;<a href="category-46.html">読書</a>&nbsp;</div>

<div class="data_body">
<p class="paragraph">
<a href="./view-917.html" >読書メモ/&quot;Advanced Windows Debugging&quot;</a> の続編。
<br />
.NETアプリケーションのデバッグにおける、&quot;Debugging Tools for Windows&quot;やMS謹製のフリーツールの使用方法や問題分析の流れを詳しく解説している。
<br />
</p>

<a href="https://www.amazon.co.jp/dp/0321578899" target="_blank">Amazon | Advanced .NET Debugging | Hewardt, Mario | Networking</a><br>

<ul><li> Advanced .NET Debugging<ul><li> <a class="externallink" href="http://www.advanceddotnetdebugging.com/" target="_blank">http://www.advanceddotnetdebugging.com/</a></li></ul></li></ul>

<p class="paragraph">
内容の詳細はアマゾンなどを参照して欲しい。
<br />
個人的なお薦めポイントとしては、CLRと.NET Frameworkの関係、「アセンブリ」の概念とロード機構、CLRのヒープ管理とGC、ファイナライズキューなどなどの、.NETで今ひとつ分かりづらいけど重要な「裏舞台」を分かりやすく紹介してくれている点。.NET入門者にとっては呪文めいた「アセンブリ」や「マニフェスト」といった用語がきちんと解説されている。
<br />
</p>

<p class="paragraph">
注意点としては、実際のデバッグの流れが掲載されているが、若干の省略が見られる点。特に
<br />
</p>
<pre>.loadby sos mscorwks
</pre>
<p class="paragraph">
は省略されがちに思えた。デバッグコマンドが一つ一つ書かれているからと言って、その通りに最初から打ち込んでもうまくいかない原因は大抵、こうした前提となるイロハのコマンドが省略されているから。そこだけ注意が必要。
<br />
</p>

<p class="paragraph">
他にも何気にtypoミスがあったり、酷いところでは公式HPからDLできるサンプルコードに抜けがあったりする。下記HPを参照のこと。
<br />
</p>
<ul><li> Advanced .NET Debugging book - If broken it is, fix it you should - Site Home - MSDN Blogs<ul><li> <a class="externallink" href="http://blogs.msdn.com/b/tess/archive/2009/12/15/advanced-net-debugging-book.aspx" target="_blank">http://blogs.msdn.com/b/tess/archive/2009/12/15/advanced-net-debugging-book.aspx</a></li></ul></li>
<li> Advanced .NET Debugging – The Book by Mario Hewardt » Advanced .NET Debugging<ul><li> <a class="externallink" href="http://dotnetdebug.net/2009/11/30/advanced-net-debugging-the-book-by-mario-hewardt/" target="_blank">http://dotnetdebug.net/2009/11/30/advanced-net-debugging-the-book-by-mario-hewardt/</a></li></ul></li></ul>

<p class="paragraph">
いくつか「編集者真面目に仕事したのか・・・？」と首を傾げる点はあるものの、本書の価値を損なうほどのものではない。.NETアプリの開発に携わる人達であれば一読しておいて損はない一冊となっている。
<br />
</p>


<hr />
<p class="paragraph">
以下、本書を読んでいて気になった点などメモ。補足的なメモや、本書出版から数年が経過している2011年現在、紹介されているツールでいくつか注意点が出てきたものなど。
<br />
</p>

<dl>
<dt> &quot;.loadby sos mscorwks&quot; で &quot;Unable to find module &#039;mscorwks&#039;&quot; 発生 </dt>
<dd>
<p class="paragraph">
<a class="externallink" href="http://geekswithblogs.net/.netonmymind/archive/2006/03/14/72262.aspx" target="_blank">http://geekswithblogs.net/.netonmymind/archive/2006/03/14/72262.aspx</a>
<br />
のコメント参照。mscorwks.dllが読み込まれていない段階で&quot;.loadby&quot;やっちゃってるので、まずは&quot;g&quot;などで続行させ、loadされた段階でCtrl-BREAK, Ctrl-Cなどで停止、&quot;.loadby&quot;し直せばOK.
<br />
</p>

<p class="paragraph">
あるいは
<br />
</p>
<pre>sxe ld mscorwks.dll
</pre>
<p class="paragraph">
しておけば、mscorwks.dllがロードされた時点で一旦デバッガにbreakするので、そこで &quot;.loadby&quot; してもよい。
<br />
</p></dd>
<dt> CLR ProfilerとCLRのバージョン </dt>
<dd>
<p class="paragraph">
CLR Profiler: 3.5までは 2.0のCLR使ってるので .NET 2.0用のCLR ProfilerでOKのはず。
<br />
<a class="externallink" href="http://stackoverflow.com/questions/1055803/is-there-a-clr-profiler-that-works-with-net-3-5-sp1-and-wpf" target="_blank">http://stackoverflow.com/questions/1055803/is-there-a-clr-profiler-that-works-with-net-3-5-sp1-and-wpf</a>
<br />
.NET 4.0で.NET 2.0用CLR使う場合は環境変数をセット。
<br />
<a class="externallink" href="http://social.msdn.microsoft.com/Forums/ja-JP/vsgeneralja/thread/a97370a2-faf8-4a9c-8d0a-37099b8038b4" target="_blank">http://social.msdn.microsoft.com/Forums/ja-JP/vsgeneralja/thread/a97370a2-faf8-4a9c-8d0a-37099b8038b4</a>
<br />
</p>

<p class="paragraph">
2011年1月末に、4.0に対応したCLRProfilerがでたばっかり：
<br />
<a class="externallink" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=be2d842b-fdce-4600-8d32-a3cf74fda5e1" target="_blank">http://www.microsoft.com/downloads/en/details.aspx?FamilyID=be2d842b-fdce-4600-8d32-a3cf74fda5e1</a>
<br />
</p></dd>
<dt> CLR Profilerで &quot;Waiting for application to start common language runtime&quot; が消えない </dt>
<dd>
<p class="paragraph">
「管理者として実行」する＋.NETランタイムのバージョンを確認する。片手落ちだとこのメッセージが消えず、プロファイルも取れない。
<br />
詳細は&quot;CLRProfiler Waiting for application to start common language runtime&quot;でggrks.
<br />
</p></dd>
<dt> その他、フリーの.NETアプリプロファイラ </dt>
<dd><a class="externallink" href="http://d.hatena.ne.jp/Wacky/20080823/1219500273" target="_blank">http://d.hatena.ne.jp/Wacky/20080823/1219500273</a></dd>
<dt> 本書中で紹介されているフリーの逆コンパイラ, &quot;.NET Reflector&quot;について </dt>
<dd>
<p class="paragraph">
2011年3月以降、有償化されるようです。
<br />
<a class="externallink" href="http://www.atmarkit.co.jp/fdotnet/tools/dotfuscator/dotfuscator_01.html" target="_blank">http://www.atmarkit.co.jp/fdotnet/tools/dotfuscator/dotfuscator_01.html</a>
<br />
<a class="externallink" href="http://www.red-gate.com/products/dotnet-development/reflector/" target="_blank">http://www.red-gate.com/products/dotnet-development/reflector/</a>
<br />
</p></dd>
<dt> .NET Managed Debugging Assistants 参考資料 </dt>
<dd>
<ul><li> Diagnosing Errors with Managed Debugging Assistants<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/library/d21c150d.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/d21c150d.aspx</a><ul><li> &quot;MSDN Library&quot; &gt; &quot;.NET Development&quot; &gt; &quot;.NET Framework 4&quot; &gt; &quot;.NET Framework Core Development&quot; &gt; &quot;Debugging, Tracing, and Profiling&quot; &gt; &quot;Diagnosing Errors with Managed Debugging Assistants&quot;</li></ul></li></ul></li>
<li> Let the CLR Find Bugs For You With Managed Debugging Assistants<ul><li> <a class="externallink" href="http://msdn.microsoft.com/en-us/magazine/cc163606.aspx" target="_blank">http://msdn.microsoft.com/en-us/magazine/cc163606.aspx</a></li></ul></li>
<li> InformIT: .NET Reference Guide &gt; Managed Debugging Assistants in .NET 2.0<ul><li> <a class="externallink" href="http://www.informit.com/guides/content.aspx?g=dotnet&amp;seqNum=500" target="_blank">http://www.informit.com/guides/content.aspx?g=dotnet&amp;seqNum=500</a></li></ul></li></ul>

<p class="paragraph">
有効・無効の切り替え：
<br />
</p>
<pre>reg query HKLM\SOFTWARE\Microsoft\.NETFramework /v MDA
reg add HKLM\SOFTWARE\Microsoft\.NETFramework /v MDA /t REG_SZ /d &quot;1&quot;
reg add HKLM\SOFTWARE\Microsoft\.NETFramework /v MDA /t REG_SZ /d &quot;0&quot;
</pre>

<p class="paragraph">
使い終わったら&quot;0&quot;に戻しておく。
<br />
</p></dd>
<dt> fuslogvw.exe 関連のトラブル </dt>
<dd>
<p class="paragraph">
&quot;HKLM\Software\Microsoft\Fusion!EnableLog&quot;を1にするのを忘れずに。
<br />
</p>
<pre>reg add HKLM\Software\Microsoft\Fusion /v EnableLog /t REG_DWORD /d 1
</pre>

<p class="paragraph">
管理者権限が必要なので、Vista以降なら「管理者として実行」するのを忘れずに。
<br />
あと、ログ保存先は&quot;Custom log&quot;にしないと保存してくれなかった。
<br />
</p></dd>
<dt> アプリケーションドメイン一覧から&quot;!name2ee&quot;まで辿る流れ </dt>
<dd>
<p class="paragraph">
書かれてないのが不思議なくらいだったのでメモ。
<br />
</p>
<pre>!dumpdomain
↓ドメインの一覧→アセンブリGET
!dumpassembly
↓アセンブリの一覧→モジュールGET
!dumpmodule -mt
↓モジュール→ Method Table GET
!dumpmt -md
↓MT→Method Descriptor GET
!dumpmd
↓MD→&quot;!name2ee&quot;に渡せる完全タイプ名取得
!name2ee
</pre></dd>
<dt> Chapter4 の 04CodeGen.exe(.cs) がおかしい </dt>
<dd>謎。 <a href="./view-926.html" >日記/2011/02/28/System.Reflection.Emitでの動的コード生成が謎の挙動を示す。</a> 参照。</dd>
</dl>

<p class="paragraph">
ショートカット用のピンポイントメモ：
<br />
</p>
<dl>
<dt> MDA xml file -&gt; &quot;assistant&quot; elements -&gt; Alphanumeric order </dt>
<dd>p20</dd>
<dt> &quot;sxe clr&quot; enables CLR Exception break </dt>
<dd>p130</dd>
<dt> &quot;Retail v.s. Debug Builds&quot; from JIT &amp; GC perspective </dt>
<dd>p223</dd>
<dt> &quot;Pinned Objects&quot;, GC, &quot;fixed&quot; buffers </dt>
<dd>p248-</dd>
<dt> &quot;!verifyHeap&quot; and GC timing </dt>
<dd>p260</dd>
<dt> lock window and &quot;lock&quot; syntax sugar </dt>
<dd>p334</dd>
<dt> &quot;delegate&quot; calling convention in unmanaged world </dt>
<dd>p372</dd>
</dl>




</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/925<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>