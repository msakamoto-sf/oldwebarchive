<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>JavaScript/ExtJS/Ext.Component を使ったカスタムコンポーネントの練習 - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">JavaScript/ExtJS/Ext.Component を使ったカスタムコンポーネントの練習</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2014-07-05 22:56:34 &nbsp; / &nbsp; last updated at: 2014-07-06 01:47:06<br>
カテゴリ: <a href="category-86.html">ExtJS</a>&nbsp;<a href="category-27.html">JavaScript</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1315.html" title="JavaScript/ExtJS">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1291.html" title="JavaScript/ExtJS/ExtJS4 + Sencha Cmd 勉強メモ1">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-162.html" title="JavaScript">JavaScript</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
ExtJSは豊富なコンポーネントが用意されています。しかしながら、現実のアプリケーション開発ではどうしても、自分でコンポーネントを作成するようなケースが出てきます。カスタムコンポーネントの作成については、ExtJSのドキュメントにも説明はありますが、実際の開発ではHTML要素のレンダリングなどExtJSの内部を知る必要があります。
<br />
他のコンポーネントを包含しない、単体で動作するコンポーネントは一般的にExt.Componentを派生させて作成します。その時に、HTMLのレンダリング処理やイベントハンドラをどのように設定すればよいのか、イロハが分かるような資料を目指して本記事を作成しました。
<br />
</p>

<p class="paragraph">
環境：
<br />
</p>
<ul><li> ExtJS 5.0.0 GPLバージョン(ExtJSのCDN環境で配布されているものを使用)</li>
<li> 一部、ExtJSの内部ソースの調査では ExtJS 4.2 GPLバージョン(ext-4.2.1.883) を参照しています。</li></ul>



<ul><li><a href="#idcb00ea">準備：Sencha公式サイトの&quot;Hello World&quot;を用意する。</a></li>
<li><a href="#iddbd127">HTML要素のレンダリングを試してみる。</a><ul><li><a href="#iddcc1ff">空っぽの Ext.Component</a></li>
<li><a href="#id0ef7c9">height, width, border, style を指定してみる</a></li>
<li><a href="#idc158cc">html を指定してみる。</a></li>
<li><a href="#id647700">autoEl を指定してみる。</a></li>
<li><a href="#idbb3089">autoEl と html を併用してみる。</a></li>
<li><a href="#id456e50">autoEl と html と tpl と data を併用してみる。</a></li>
<li><a href="#idf8c472">renderTpl と renderData を使ってみる。</a></li>
<li><a href="#id6b5f25">autoEl, renderTpl, html, tpl の階層構造</a></li>
<li><a href="#id6012c6">Ext.Component#update() による動的更新</a></li>
<li><a href="#id1d0445">renderTo を指定して、autoEl, renderTpl + renderData, html, tpl + data がレンダリングされる仕組み</a><ul><li><a href="#id848bbe">renderTo が指定された場合の、constructorからの処理を追ってみる。</a></li>
<li><a href="#iddac192">autoEl, renderTpl, html, tpl の構築ポイント再考</a></li></ul></li></ul></li>
<li><a href="#id0f6111">カスタムコンポーネントのイベントハンドリング</a><ul><li><a href="#id3a7984">Ext.util.ObservableとDOM要素のイベント設定について</a></li></ul></li></ul>
<hr />
<h3 id="idcb00ea">準備：Sencha公式サイトの&quot;Hello World&quot;を用意する。</h3>

<p class="paragraph">
まず、Sencha公式サイトで紹介されている&quot;Hello World&quot;を動かします。
<br />
</p>
<ul><li> Ext JS - Hello World | Sencha<ul><li> <a class="externallink" href="http://www.sencha.com/products/extjs/up-and-running/extjs-hello-world" target="_blank">http://www.sencha.com/products/extjs/up-and-running/extjs-hello-world</a></li></ul></li></ul>

<p class="paragraph">
index.html: 公式サイトのサンプルでは&quot;ext-all.js&quot;を読み込んでいますが、幸い&quot;ext-all-debug.js&quot;が置いてあるようでしたのでそちらに修正してます。
<br />
</p>
<div class="hl-main"><pre><span class="hl-brackets">&lt;</span><span class="hl-code">!</span><span class="hl-var">DOCTYPE</span><span class="hl-code"> </span><span class="hl-var">html</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">html</span><span class="hl-code"> </span><span class="hl-var">lang</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">en</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">head</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">meta</span><span class="hl-code"> </span><span class="hl-var">charset</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">UTF-8</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">title</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">title</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">link</span><span class="hl-code"> </span><span class="hl-var">rel</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">stylesheet</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/css</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">href</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">http://cdn.sencha.com/ext/gpl/5.0.0/build/packages/ext-theme-neptune/build/resources/ext-theme-neptune-all.css</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">script</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/javascript</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">src</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">http://cdn.sencha.com/ext/gpl/5.0.0/build/ext-all-debug.js</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">script</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">script</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/javascript</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">src</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">app.js</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">script</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">head</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">body</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">body</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">html</span><span class="hl-brackets">&gt;</span></pre></div>

<p class="paragraph">
app.js: 公式サイトのままですので割愛します。
<br />
</p>

<p class="paragraph">
動作確認ができましたら、&quot;app.js&quot; をロードしている部分をサンプルのJSファイルに順次書き換えて、練習していきます。
<br />
</p>

<h3 id="iddbd127">HTML要素のレンダリングを試してみる。</h3>

<p class="paragraph">
Ext.Component で autoEl, html, tpl, renderTpl 設定を使い、どの設定がどのようなDOM要素にレンダリングされるのかステップバイステップで見ていきます。
<br />
</p>

<p class="paragraph">
元ネタ：
<br />
</p>
<ul><li> &quot;HTML and ExtJS Components&quot; : Skirtle&#039;s Den<ul><li> <a class="externallink" href="http://skirtlesden.com/articles/html-and-extjs-components" target="_blank">http://skirtlesden.com/articles/html-and-extjs-components</a></li></ul></li></ul>

<h4 id="iddcc1ff">空っぽの Ext.Component</h4>

<p class="paragraph">
空のExt.Componentをレンダリングする、以下の様なJavaScriptファイルを作成します。
<br />
</p>

<p class="paragraph">
t1.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
index.html: app.jsをロードしていた部分を、t1.jsをロードするよう修正します。
<br />
</p>
<div class="hl-main"><pre><span class="hl-brackets">&lt;</span><span class="hl-code">!</span><span class="hl-var">DOCTYPE</span><span class="hl-code"> </span><span class="hl-var">html</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">html</span><span class="hl-code"> </span><span class="hl-var">lang</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">en</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">head</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">meta</span><span class="hl-code"> </span><span class="hl-var">charset</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">UTF-8</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">title</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">title</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">link</span><span class="hl-code"> </span><span class="hl-var">rel</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">stylesheet</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/css</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">href</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">http://cdn.sencha.com/ext/gpl/5.0.0/build/packages/ext-theme-neptune/build/resources/ext-theme-neptune-all.css</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">script</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/javascript</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">src</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">http://cdn.sencha.com/ext/gpl/5.0.0/build/ext-all-debug.js</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">script</span><span class="hl-brackets">&gt;</span><span class="hl-code">
  </span><span class="hl-brackets">&lt;</span><span class="hl-reserved">script</span><span class="hl-code"> </span><span class="hl-var">type</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">text/javascript</span><span class="hl-quotes">&quot;</span><span class="hl-code"> </span><span class="hl-var">src</span><span class="hl-code">=</span><span class="hl-quotes">&quot;</span><span class="hl-string">t1.js</span><span class="hl-quotes">&quot;</span><span class="hl-brackets">&gt;</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">script</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">head</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;</span><span class="hl-reserved">body</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">body</span><span class="hl-brackets">&gt;</span><span class="hl-code">
</span><span class="hl-brackets">&lt;/</span><span class="hl-reserved">html</span><span class="hl-brackets">&gt;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t1.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t1.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
ブラウザアドオンなどの開発者ツールからDOM構造をダンプすると、以下のようになりました。Ext.Componentが空っぽのdiv要素としてレンダリングされているのを確認できます。
<br />
</p>
<pre class="plugin_pre">
&lt;html lang=&quot;en&quot;&gt;
...
&lt;body id=&quot;ext-element-1&quot; class=&quot;x-body x-gecko&quot;&gt;

# ここから、quicktips系で自動的に追加されてるっぽい。
&lt;div id=&quot;ext-quicktips-tip&quot; class=&quot;x-tip  x-layer x-tip-default x-border-box&quot; data-sticky=&quot;true&quot; style=&quot;display: none;&quot;&gt;
(長いので省略)
&lt;/div&gt;

# これが、t1.jsで作成した Ext.Component のDOM要素
&lt;div id=&quot;component-1010&quot; class=&quot;x-component  x-component-default x-border-box&quot;&gt;&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>

<h4 id="id0ef7c9">height, width, border, style を指定してみる</h4>

<p class="paragraph">
Ext.Componentのconfigurationで、height, width, border, style を指定してみると、style属性に反映されました。
<br />
</p>

<p class="paragraph">
t2.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">height</span><span class="hl-code">: </span><span class="hl-number">100</span><span class="hl-code">,
      </span><span class="hl-identifier">width</span><span class="hl-code">: </span><span class="hl-number">200</span><span class="hl-code">,
      </span><span class="hl-identifier">border</span><span class="hl-code">: </span><span class="hl-number">5</span><span class="hl-code">,
      </span><span class="hl-identifier">style</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">borderColor</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">red</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">borderStyle</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">solid</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t2.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t2.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素だけを抜き出し、属性で見やすく改行：
<br />
</p>
<pre class="plugin_pre">
&lt;div 
  id=&quot;component-1010&quot; 
  style=&quot;border-color:red;border-style:solid;border-width:5px 5px 5px 5px;width:200px;height:100px;&quot; 
  class=&quot;x-component  x-component-default x-border-box&quot;&gt;&lt;/div&gt;
</pre>

<h4 id="idc158cc">html を指定してみる。</h4>

<p class="paragraph">
Ext.Component の html 設定を使うと、HTML文字列をそのままコンテンツとしてDOM要素に組み込まれます。
<br />
</p>

<p class="paragraph">
t3.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&lt;i&gt;hello&lt;/i&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t3.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t3.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素を確認：
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;x-component  x-component-default x-border-box&quot;&gt;
  &lt;i&gt;hello&lt;/i&gt;
&lt;/div&gt;
</pre>


<h4 id="id647700">autoEl を指定してみる。</h4>

<p class="paragraph">
静的なHTML要素を構築したい場合は、autoEl 設定を使うこともできます。autoEl 設定ではExt.DomHelperで使える階層化されたオブジェクト要素を設定します。
<br />
</p>

<p class="paragraph">
t4.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">autoEl</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">ul</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">cls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">class-t4</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">children</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">,
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item2</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">,
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">cn</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">a</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">href</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">http://www.example.com/</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">linktest</span><span class="hl-quotes">'</span><span class="hl-brackets">}</span><span class="hl-brackets">]</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t4.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t4.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素だけを抜き出し、見やすく改行：
<br />
</p>
<pre class="plugin_pre">
&lt;ul id=&quot;component-1010&quot; class=&quot;class-t4&quot;&gt;
&lt;li&gt;item1&lt;/li&gt;
&lt;li&gt;item2&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.example.com/&quot;&gt;linktest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</pre>

<h4 id="idbb3089">autoEl と html を併用してみる。</h4>

<p class="paragraph">
autoEl と html 設定は併用ができる。ただし、静的なHTML要素をレンダリングするだけであれば、この組み合わせを使うケースは無いかもしれません。
<br />
t5.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">autoEl</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">p</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">cls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">class-p</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">hello</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">children</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">,
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item2</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">,
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">li</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">cn</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">a</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">href</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">http://www.example.com/</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">linktest</span><span class="hl-quotes">'</span><span class="hl-brackets">}</span><span class="hl-brackets">]</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&lt;i&gt;html configuration&lt;/i&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t5.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t5.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素だけを抜き出し、見やすく改行：autoElのtagを&lt;p&gt;タグに指定してみたら、微妙に壊れてしまった・・・。
<br />
</p>
<pre class="plugin_pre">
&lt;p id=&quot;component-1010&quot; class=&quot;class-p&quot;&gt;
&lt;i&gt;html configuration&lt;/i&gt;
hello
&lt;/p&gt;
&lt;li&gt;item1&lt;/li&gt;
&lt;li&gt;item2&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.example.com/&quot;&gt;linktest&lt;/a&gt;&lt;/li&gt;
&lt;p id=&quot;ext-element-3&quot;&gt;&lt;/p&gt;&lt;/body&gt;
</pre>

<h4 id="id456e50">autoEl と html と tpl と data を併用してみる。</h4>

<p class="paragraph">
tpl 設定と data 設定を使うと、Ext.XTemplate/Ext.Templateを使ったテンプレート処理を埋め込むことができます。これまでのautoEl, html と組み合わせてどの順番で出力されるのか確認してみます。
<br />
※なお、autoElのタグは&lt;p&gt;だと中にブロック要素を入れられないのか分断されてしまってたので、&lt;div&gt;にしました。
<br />
</p>

<p class="paragraph">
t6.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">autoEl</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">cls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">class-abc</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&amp;nbsp;&lt;s&gt;hello&lt;/s&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">children</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">a</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">href</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">http://www.example.com/</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&lt;i&gt;html configuration&lt;/i&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">tpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;tpl for=&quot;.&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;li&gt;{.:htmlEncode}&lt;/li&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/tpl&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">data</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">item2</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">&lt;b&gt;item3&lt;/b&gt;</span><span class="hl-quotes">'</span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t6.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t6.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素だけを抜き出し、見やすく改行：
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
&lt;i&gt;html configuration&lt;/i&gt;
&lt;ul&gt;
&lt;li&gt;item1&lt;/li&gt;
&lt;li&gt;item2&lt;/li&gt;
&lt;li&gt;&amp;lt;b&amp;gt;item3&amp;lt;/b&amp;gt;&lt;/li&gt;
&lt;/ul&gt;
&amp;nbsp;&lt;s&gt;hello&lt;/s&gt;
&lt;a href=&quot;http://www.example.com/&quot;&gt;item1&lt;/a&gt;
&lt;/div&gt;
</pre>

<h4 id="idf8c472">renderTpl と renderData を使ってみる。</h4>

<p class="paragraph">
renderTpl 設定は、後述しますが html や tpl 設定で構築した要素全体を制御する、全体的なテンプレートを設定しています。
<br />
Ext.AbstractComponentにおいて、renderTplのデフォルト値は以下のようになっています。テンプレートを使っており、この中の &quot;this&quot; はExt.XTemplateのインスタンスを指し、それのrenderContent()メソッドの内容を出力しています。後で見ていきますが、renderContent()は最終的に html や tpl 設定を出力します。ここでrenderTplを上書きすることで、htmlやtpl設定を無視するようなレンダリングも可能となります。
<br />
</p>
<pre>renderTpl: &#039;{%this.renderContent(out,values)%}&#039;,
</pre>

<p class="paragraph">
テンプレートの中では、Ext.AbstractComponent のドキュメントもあるように renderData で渡される値を使うことができます。
<br />
実際に、autoEl, renderTpl, renderData, html, tpl をすべて併用したサンプルを作ってみます。
<br />
</p>

<p class="paragraph">
t7.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">autoEl</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">cls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">class-abc</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&amp;nbsp;&lt;s&gt;hello&lt;/s&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">children</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">a</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">href</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">http://www.example.com/</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&lt;i&gt;html configuration&lt;/i&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">tpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;tpl for=&quot;.&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;li&gt;{.:htmlEncode}&lt;/li&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/tpl&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">data</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">item2</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">&lt;b&gt;item3&lt;/b&gt;</span><span class="hl-quotes">'</span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
        </span><span class="hl-comment">//</span><span class="hl-comment"> id, uiCls, baseCls, componentCls などは デフォルトでrenderDataとしてassign済み</span><span class="hl-comment"></span><span class="hl-code">
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;div id=&quot;{id}&quot; class=&quot;{uiCls} {baseCls} {componentCls}&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;h2&gt;{title:htmlEncode}&lt;/h2&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;tpl for=&quot;iter&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;p&gt;{.}&lt;/p&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/tpl&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">{%this.renderContent(out,values)%}</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/div&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">baseCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">myapp-custom</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">componentCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">myapp-component</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderData</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">title</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">renderTpl() &lt;s&gt;test&lt;/s&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">iter</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block1</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block2</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block3</span><span class="hl-quotes">'</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t7.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t7.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→DOM要素だけを抜き出し、見やすく改行：
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
  &lt;div class=&quot; myapp-custom myapp-component&quot; id=&quot;component-1010&quot;&gt;
    &lt;h2&gt;renderTpl() &amp;lt;s&amp;gt;test&amp;lt;/s&amp;gt;&lt;/h2&gt;
    &lt;p&gt;sub-block1&lt;/p&gt;
    &lt;p&gt;sub-block2&lt;/p&gt;
    &lt;p&gt;sub-block3&lt;/p&gt;
    &lt;i&gt;html configuration&lt;/i&gt;
    &lt;ul&gt;
      &lt;li&gt;item1&lt;/li&gt;
      &lt;li&gt;item2&lt;/li&gt;
      &lt;li&gt;&amp;lt;b&amp;gt;item3&amp;lt;/b&amp;gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
  &amp;nbsp;&lt;s&gt;hello&lt;/s&gt;
  &lt;a href=&quot;http://www.example.com/&quot;&gt;item1&lt;/a&gt;
&lt;/div&gt;
</pre>

<h4 id="id6b5f25">autoEl, renderTpl, html, tpl の階層構造</h4>

<p class="paragraph">
ここまでのサンプルから、以下の様な階層構造でHTML要素が構築されていくことを確認しました。
<br />
</p>
<pre class="plugin_pre">
autoEl.tag + autoEl.cls
  renderTpl + renderData
    # 以下、renderTpl中の &#039;{%this.renderContent(out,values)%}&#039; により出力される
    html
    tpl + data
    autoEl.html
    autoEl.children
</pre>

<h4 id="id6012c6">Ext.Component#update() による動的更新</h4>

<p class="paragraph">
autoEl.tag の要素の中身は、Ext.Component#update()により動的に変更することが可能です。
<br />
ただし、以下のサンプルコードで試すと renderTpl + renderData も含めて、autoEl.tagの中身が丸ごと変更されてしまいました。
<br />
renderTplなど避けて、上手く特定の要素以下を update() で更新する方法については今回は未調査です。
<br />
</p>

<p class="paragraph">
update()の引数については、Ext.dom.Element#update()の引数と同じですので、そちらのAPIドキュメントが参考になります。第二引数の loadScripts は、HTMLソースを第一引数に指定した際、scriptタグが含まれていた場合にそれを実行するか否かを制御できるようです（デフォルトはfalseで実行しない）。
<br />
t8.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">cmp</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">autoEl</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">cls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">class-abc</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&amp;nbsp;&lt;s&gt;hello&lt;/s&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">children</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">a</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">href</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">http://www.example.com/</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code"> </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">html</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">&lt;i&gt;html configuration&lt;/i&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">tpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;tpl for=&quot;.&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;li&gt;{.:htmlEncode}&lt;/li&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/tpl&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/ul&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">data</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-quotes">'</span><span class="hl-string">item1</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">item2</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">&lt;b&gt;item3&lt;/b&gt;</span><span class="hl-quotes">'</span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;div id=&quot;{id}&quot; class=&quot;{uiCls} {baseCls} {componentCls}&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;h2&gt;{title:htmlEncode}&lt;/h2&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;tpl for=&quot;iter&quot;&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;p&gt;{.}&lt;/p&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/tpl&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">{%this.renderContent(out,values)%}</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/div&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
      </span><span class="hl-brackets">]</span><span class="hl-code">,
      </span><span class="hl-identifier">baseCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">myapp-custom</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">componentCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">myapp-component</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderData</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">title</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">renderTpl() &lt;s&gt;test&lt;/s&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
        </span><span class="hl-identifier">iter</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block1</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block2</span><span class="hl-quotes">'</span><span class="hl-code">,
          </span><span class="hl-quotes">'</span><span class="hl-string">sub-block3</span><span class="hl-quotes">'</span><span class="hl-code">
        </span><span class="hl-brackets">]</span><span class="hl-code">
      </span><span class="hl-brackets">}</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Button</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">text</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">update(data)</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,
      </span><span class="hl-identifier">handler</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">update</span><span class="hl-brackets">(</span><span class="hl-brackets">[</span><span class="hl-quotes">'</span><span class="hl-string">item4</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">item5</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-quotes">'</span><span class="hl-string">item6</span><span class="hl-quotes">'</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Button</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">text</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">update(html(, loadScripts : default = false))</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,
      </span><span class="hl-identifier">handler</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">update</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">&lt;b&gt;update(html)&lt;/b&gt;&lt;script&gt;alert(&quot;hello&quot;);&lt;/script&gt;</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.Button</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">text</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">update(html, loadScripts : true)</span><span class="hl-quotes">'</span><span class="hl-code">,
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,
      </span><span class="hl-identifier">handler</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">update</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">&lt;b&gt;update(html)&lt;/b&gt;&lt;script&gt;alert(&quot;hello&quot;);&lt;/script&gt;</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">true</span><span class="hl-brackets">)</span><span class="hl-code">;
      </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t8_1.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t8_1.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→最初に表示された段階でDOM要素だけを抜き出し、見やすく改行：
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
  &lt;div class=&quot; myapp-custom myapp-component&quot; id=&quot;component-1010&quot;&gt;
    &lt;h2&gt;renderTpl() &amp;lt;s&amp;gt;test&amp;lt;/s&amp;gt;&lt;/h2&gt;
    &lt;p&gt;sub-block1&lt;/p&gt;
    &lt;p&gt;sub-block2&lt;/p&gt;
    &lt;p&gt;sub-block3&lt;/p&gt;
    &lt;i&gt;html configuration&lt;/i&gt;
    &lt;ul&gt;
      &lt;li&gt;item1&lt;/li&gt;
      &lt;li&gt;item2&lt;/li&gt;
      &lt;li&gt;&amp;lt;b&amp;gt;item3&amp;lt;/b&amp;gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
  &amp;nbsp;&lt;s&gt;hello&lt;/s&gt;
  &lt;a href=&quot;http://www.example.com/&quot;&gt;item1&lt;/a&gt;
&lt;/div&gt;
</pre>

<p class="paragraph">
→&quot;update(data)&quot;ボタンをクリックすると、renderTplの要素も含めてごっそり、tpl + update()で渡した新しいデータのテンプレート処理内容に入れ替わりました。
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
  &lt;ul&gt;
    &lt;li&gt;item4&lt;/li&gt;
    &lt;li&gt;item5&lt;/li&gt;
    &lt;li&gt;item6&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;
</pre>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t8_2.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t8_2.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→&quot;update(html(, loadScripts : default = false))&quot;ボタンをクリックすると、renderTplの要素も含めてごっそり、指定したHTMLソースに入れ替わりました。scriptタグ中のJSは実行されませんでした。
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
  &lt;b&gt;update(html)&lt;/b&gt;
  &lt;script&gt;alert(&quot;hello&quot;);&lt;/script&gt;
&lt;/div&gt;
</pre>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t8_3.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t8_3.png" alt="" title=""  /></a>
<br />
</p>

<p class="paragraph">
→&quot;update(html, loadScripts : true)&quot;ボタンをクリックすると、renderTplの要素も含めてごっそり、指定したHTMLソースに入れ替わりました。scriptタグ中のJSは実行されました。
<br />
</p>
<pre class="plugin_pre">
&lt;div id=&quot;component-1010&quot; class=&quot;class-abc&quot;&gt;
  &lt;b&gt;update(html)&lt;/b&gt;
&lt;/div&gt;
</pre>

<p class="paragraph">
<a href="./../images/20140706_extjs_custom_ext_component/t8_4.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t8_4.png" alt="" title=""  /></a>
<br />
</p>

<h4 id="id1d0445">renderTo を指定して、autoEl, renderTpl + renderData, html, tpl + data がレンダリングされる仕組み</h4>

<ul><li> 実際にHTML要素をレンダリングする機能は、Ext.util.Renderable (private) クラスに集約されています。</li>
<li> Ext.Component は Ext.AbstractComponent (private) クラスから派生しており、Ext.AbstractComponentクラスには Ext.util.Renderable クラスがmixinされています。</li>
<li> Ext.Component およびその派生クラス (Ext.container.Containerなど含む) はmixinされたExt.util.Renderable クラスの render() メソッドを起点としてHTML要素のレンダリングを開始します。</li></ul>

<h5 id="id848bbe">renderTo が指定された場合の、constructorからの処理を追ってみる。</h5>

<p class="paragraph">
renderTo 設定が指定されていれば、Ext.AbstractComponent のコンストラクタ中でmixinされた Ext.util.Renderable クラスの render() メソッドが呼ばれます。
<br />
ext/src/AbstractComponent.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">define</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">Ext.AbstractComponent</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
...
    </span><span class="hl-identifier">constructor</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">config</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">,
            </span><span class="hl-identifier">i</span><span class="hl-code">, </span><span class="hl-identifier">len</span><span class="hl-code">, </span><span class="hl-identifier">xhooks</span><span class="hl-code">;
...
       </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">renderTo</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">render</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">renderTo</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-comment">//</span><span class="hl-comment"> EXTJSIV-1935 - should be a way to do afterShow or something, but that</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> won't work. Likewise, rendering hidden and then showing (w/autoShow) has</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> implications to afterRender so we cannot do that.</span><span class="hl-comment"></span><span class="hl-code">
        </span><span class="hl-brackets">}</span><span class="hl-code">
...</span></pre></div>

<p class="paragraph">
Ext.util.Renderable#update()では、初めてのレンダリング(= me.el が空)の場合は getRenderTree() でDOM要素の設定情報(= Ext.DomHelperが扱えるオブジェクト階層)を構築した後、Ext.DomHelperを使って親要素に追加してます。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">render</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">container</span><span class="hl-code">, </span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">,
            </span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">el</span><span class="hl-code"> &amp;&amp; </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">get</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">, </span><span class="hl-comment">//</span><span class="hl-comment"> ensure me.el is wrapped</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-identifier">vetoed</span><span class="hl-code">,
            </span><span class="hl-identifier">tree</span><span class="hl-code">,
            </span><span class="hl-identifier">nextSibling</span><span class="hl-code">;
 
        </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">suspendLayouts</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-identifier">container</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initContainer</span><span class="hl-brackets">(</span><span class="hl-identifier">container</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-identifier">nextSibling</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">getInsertPosition</span><span class="hl-brackets">(</span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-code">!</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> 初回はelが空っぽなので、getRenderTree() でDOM要素の設定情報を構築する。</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-identifier">tree</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">getRenderTree</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">ownerLayout</span><span class="hl-code"> &amp;&amp; </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">ownerLayout</span><span class="hl-code">.</span><span class="hl-identifier">transformItemRenderTree</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-identifier">tree</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">ownerLayout</span><span class="hl-code">.</span><span class="hl-identifier">transformItemRenderTree</span><span class="hl-brackets">(</span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-brackets">}</span><span class="hl-code">
 
            </span><span class="hl-comment">//</span><span class="hl-comment"> tree will be null if a beforerender listener returns false</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-comment">//</span><span class="hl-comment"> treeを構築したら、親要素に追加/挿入</span><span class="hl-comment"></span><span class="hl-code">
                </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">nextSibling</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                    </span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">DomHelper</span><span class="hl-code">.</span><span class="hl-identifier">insertBefore</span><span class="hl-brackets">(</span><span class="hl-identifier">nextSibling</span><span class="hl-code">, </span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code">;
                </span><span class="hl-brackets">}</span><span class="hl-code"> </span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                    </span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">DomHelper</span><span class="hl-code">.</span><span class="hl-identifier">append</span><span class="hl-brackets">(</span><span class="hl-identifier">container</span><span class="hl-code">, </span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code">;
                </span><span class="hl-brackets">}</span><span class="hl-code">
 
                </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">wrapPrimaryEl</span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">}</span><span class="hl-code"> </span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> 既にelが構築済みの場合の追加/挿入処理</span><span class="hl-comment"></span><span class="hl-code">
            ...
        </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-code"> &amp;&amp; !</span><span class="hl-identifier">vetoed</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> レンダリングで要素の追加/購入処理が発生したら、finishRender()を呼ぶ。</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">finishRender</span><span class="hl-brackets">(</span><span class="hl-identifier">position</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">
 
        </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">resumeLayouts</span><span class="hl-brackets">(</span><span class="hl-code">!</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">hidden</span><span class="hl-code"> &amp;&amp; !</span><span class="hl-identifier">container</span><span class="hl-code">.</span><span class="hl-identifier">isDetachedBody</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
Ext.util.Renderable#getRenderTree() では、&quot;beforerender&quot;イベントが未設定 or 設定済みならイベントを発生させ、その戻り値がtrue の場合にExt.util.Renderable#getElConfig() の戻り値を返します。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">getRenderTree</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">;
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-code">!</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">hasListeners</span><span class="hl-code">.</span><span class="hl-identifier">beforerender</span><span class="hl-code"> || </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">fireEvent</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">beforerender</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">me</span><span class="hl-brackets">)</span><span class="hl-code"> !== </span><span class="hl-reserved">false</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">beforeRender</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
 
            </span><span class="hl-comment">//</span><span class="hl-comment"> Flag to let the layout's finishRenderItems and afterFinishRenderItems</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> know which items to process</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">rendering</span><span class="hl-code"> = </span><span class="hl-reserved">true</span><span class="hl-code">;
 
            </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-comment">//</span><span class="hl-comment"> Since we are producing a render tree, we produce a &quot;proxy el&quot; that will</span><span class="hl-comment"></span><span class="hl-code">
                </span><span class="hl-comment">//</span><span class="hl-comment"> sit in the rendered DOM precisely where me.el belongs. We replace the</span><span class="hl-comment"></span><span class="hl-code">
                </span><span class="hl-comment">//</span><span class="hl-comment"> proxy el in the finishRender phase.</span><span class="hl-comment"></span><span class="hl-code">
                </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                    </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
                    </span><span class="hl-identifier">id</span><span class="hl-code">: </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.$</span><span class="hl-identifier">pid</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">id</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">
                </span><span class="hl-brackets">}</span><span class="hl-code">;
            </span><span class="hl-brackets">}</span><span class="hl-code">
 
            </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">getElConfig</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">
 
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-reserved">null</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
Ext.util.Renderable#getElConfig() では、autoElプロパティが設定されていればそれを使い、未設定であればdivタグ要素を使って、Ext.DomHelperが扱える形のDOM要素を表すオブジェクト階層を構築して返します。また、frameInfoは設定していないため、config.tplは initRenderTpl() の戻り値が返します。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">getElConfig</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">,
            </span><span class="hl-identifier">autoEl</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">autoEl</span><span class="hl-code">,
            </span><span class="hl-identifier">frameInfo</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">getFrameInfo</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,
            </span><span class="hl-identifier">config</span><span class="hl-code"> = </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
                </span><span class="hl-identifier">tpl</span><span class="hl-code">: </span><span class="hl-identifier">frameInfo</span><span class="hl-code"> ? </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initFramingTpl</span><span class="hl-brackets">(</span><span class="hl-identifier">frameInfo</span><span class="hl-code">.</span><span class="hl-identifier">table</span><span class="hl-brackets">)</span><span class="hl-code"> : </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initRenderTpl</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
            </span><span class="hl-brackets">}</span><span class="hl-code">,
            </span><span class="hl-identifier">protoEl</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">protoEl</span><span class="hl-code">,
            </span><span class="hl-identifier">i</span><span class="hl-code">, </span><span class="hl-identifier">frameElNames</span><span class="hl-code">, </span><span class="hl-identifier">len</span><span class="hl-code">, </span><span class="hl-identifier">suffix</span><span class="hl-code">, </span><span class="hl-identifier">frameGenId</span><span class="hl-code">, </span><span class="hl-identifier">frameData</span><span class="hl-code">;
 
        </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initStyles</span><span class="hl-brackets">(</span><span class="hl-identifier">protoEl</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-identifier">protoEl</span><span class="hl-code">.</span><span class="hl-identifier">writeTo</span><span class="hl-brackets">(</span><span class="hl-identifier">config</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-identifier">protoEl</span><span class="hl-code">.</span><span class="hl-identifier">flush</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">isString</span><span class="hl-brackets">(</span><span class="hl-identifier">autoEl</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">config</span><span class="hl-code">.</span><span class="hl-identifier">tag</span><span class="hl-code"> = </span><span class="hl-identifier">autoEl</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code"> </span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">apply</span><span class="hl-brackets">(</span><span class="hl-identifier">config</span><span class="hl-code">, </span><span class="hl-identifier">autoEl</span><span class="hl-brackets">)</span><span class="hl-code">; </span><span class="hl-comment">//</span><span class="hl-comment"> harmless if !autoEl</span><span class="hl-comment"></span><span class="hl-code">
        </span><span class="hl-brackets">}</span><span class="hl-code">
...
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">config</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
Ext.util.Renderable#initRenderTpl() では、&quot;renderTpl&quot;にテンプレートが設定されていれば Ext.util.Renderable#setupRenderTpl() を呼び、ばテンプレートインスタンスのセットアップを行います。
<br />
Ext.AbstractComponent においては、renderTplはデフォルトのテンプレートが設定済みなので、明示的にnullやundefinedで上書きしていない限りは、テンプレートインスタンスがセットアップされることになります。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">initRenderTpl</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">tpl</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">.</span><span class="hl-identifier">getTpl</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">renderTpl</span><span class="hl-quotes">'</span><span class="hl-brackets">)</span><span class="hl-code">;
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">tpl</span><span class="hl-code"> &amp;&amp; !</span><span class="hl-identifier">tpl</span><span class="hl-code">.</span><span class="hl-identifier">renderContent</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-reserved">this</span><span class="hl-code">.</span><span class="hl-identifier">setupRenderTpl</span><span class="hl-brackets">(</span><span class="hl-identifier">tpl</span><span class="hl-brackets">)</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">
 
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">tpl</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
Ext.util.Renderable#setupRenderTpl() では、テンプレートインスタンスの &quot;renderBocy()&quot;, &quot;renderContent()&quot; メソッドの実体をmixinされたExt.util.Renderableインスタンスの doRenderContent メソッドを参照するよう調整します。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">setupRenderTpl</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">renderTpl</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-identifier">renderTpl</span><span class="hl-code">.</span><span class="hl-identifier">renderBody</span><span class="hl-code"> = </span><span class="hl-identifier">renderTpl</span><span class="hl-code">.</span><span class="hl-identifier">renderContent</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">.</span><span class="hl-identifier">doRenderContent</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>


<p class="paragraph">
Ext.util.Renderable#doRenderContent() では、ここでようやく、mixinされたインスタンスに&quot;html&quot;か&quot;tpl&quot;プロパティがあれば、順繰りにDOM要素として追加していきます。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">doRenderContent</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">out</span><span class="hl-code">, </span><span class="hl-identifier">renderData</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-comment">//</span><span class="hl-comment"> Careful! This method is bolted on to the renderTpl so all we get for context is</span><span class="hl-comment"></span><span class="hl-code">
        </span><span class="hl-comment">//</span><span class="hl-comment"> the renderData! The &quot;this&quot; pointer is the renderTpl instance!</span><span class="hl-comment"></span><span class="hl-code">
 
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-identifier">renderData</span><span class="hl-code">.$</span><span class="hl-identifier">comp</span><span class="hl-code">;
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">html</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">DomHelper</span><span class="hl-code">.</span><span class="hl-identifier">generateMarkup</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">html</span><span class="hl-code">, </span><span class="hl-identifier">out</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-reserved">delete</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">html</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">
 
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">tpl</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-comment">//</span><span class="hl-comment"> Make sure this.tpl is an instantiated XTemplate</span><span class="hl-comment"></span><span class="hl-code">
            </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-code">!</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">tpl</span><span class="hl-code">.</span><span class="hl-identifier">isTemplate</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">tpl</span><span class="hl-code"> = </span><span class="hl-reserved">new</span><span class="hl-code"> </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">XTemplate</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">tpl</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-brackets">}</span><span class="hl-code">
 
            </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">data</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-comment">//</span><span class="hl-comment">me.tpl[me.tplWriteMode](target, me.data);</span><span class="hl-comment"></span><span class="hl-code">
                </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">tpl</span><span class="hl-code">.</span><span class="hl-identifier">applyOut</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">data</span><span class="hl-code">, </span><span class="hl-identifier">out</span><span class="hl-brackets">)</span><span class="hl-code">;
                </span><span class="hl-reserved">delete</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">data</span><span class="hl-code">;
            </span><span class="hl-brackets">}</span><span class="hl-code">
        </span><span class="hl-brackets">}</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
initRenderTpl()からのテンプレートセットアップ処理で寄り道してしまいましたが、getElConfig()に戻ると、autoElはデフォルトではdivタグ用に初期化されていますが、autoEl設定が指定されていればExt.apply()でマージしています。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">getElConfig</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
        </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">,
            </span><span class="hl-identifier">autoEl</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">autoEl</span><span class="hl-code">,
            </span><span class="hl-identifier">frameInfo</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">getFrameInfo</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">,
            </span><span class="hl-identifier">config</span><span class="hl-code"> = </span><span class="hl-brackets">{</span><span class="hl-code">
                </span><span class="hl-identifier">tag</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">div</span><span class="hl-quotes">'</span><span class="hl-code">,
                </span><span class="hl-identifier">tpl</span><span class="hl-code">: </span><span class="hl-identifier">frameInfo</span><span class="hl-code"> ? </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initFramingTpl</span><span class="hl-brackets">(</span><span class="hl-identifier">frameInfo</span><span class="hl-code">.</span><span class="hl-identifier">table</span><span class="hl-brackets">)</span><span class="hl-code"> : </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">initRenderTpl</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
            </span><span class="hl-brackets">}</span><span class="hl-code">,
            </span><span class="hl-identifier">protoEl</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">protoEl</span><span class="hl-code">,
            </span><span class="hl-identifier">i</span><span class="hl-code">, </span><span class="hl-identifier">frameElNames</span><span class="hl-code">, </span><span class="hl-identifier">len</span><span class="hl-code">, </span><span class="hl-identifier">suffix</span><span class="hl-code">, </span><span class="hl-identifier">frameGenId</span><span class="hl-code">, </span><span class="hl-identifier">frameData</span><span class="hl-code">;
...
        </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">isString</span><span class="hl-brackets">(</span><span class="hl-identifier">autoEl</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">config</span><span class="hl-code">.</span><span class="hl-identifier">tag</span><span class="hl-code"> = </span><span class="hl-identifier">autoEl</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code"> </span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">apply</span><span class="hl-brackets">(</span><span class="hl-identifier">config</span><span class="hl-code">, </span><span class="hl-identifier">autoEl</span><span class="hl-brackets">)</span><span class="hl-code">; </span><span class="hl-comment">//</span><span class="hl-comment"> harmless if !autoEl</span><span class="hl-comment"></span><span class="hl-code">
        </span><span class="hl-brackets">}</span><span class="hl-code">
...
        </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">config</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>

<p class="paragraph">
この結果、以下の様なオブジェクトがgetRenderTree()の戻り値として返されます。
<br />
</p>
<pre>{
  tag: &#039;div&#039;, //デフォルト。
  tpl: (renderTpl + renderDataを処理するExt.XTemplateのインスタンス),
  // 以下、指定されていれば。
  html: ...,
  css: ...,
  children: ...
}
</pre>

<p class="paragraph">
このオブジェクトが、最終的にrender()メソッド中で Ext.DomHelper の insertBefore()/append() メソッドに渡され、そのなかで最終的にautoElやrenderTplのDOM構築が処理されます。
<br />
</p>
<div class="hl-main"><pre><span class="hl-comment">//</span><span class="hl-comment"> tree will be null if a beforerender listener returns false</span><span class="hl-comment"></span><span class="hl-code">
 </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
     </span><span class="hl-reserved">if</span><span class="hl-code"> </span><span class="hl-brackets">(</span><span class="hl-identifier">nextSibling</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
         </span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">DomHelper</span><span class="hl-code">.</span><span class="hl-identifier">insertBefore</span><span class="hl-brackets">(</span><span class="hl-identifier">nextSibling</span><span class="hl-code">, </span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code">;
     </span><span class="hl-brackets">}</span><span class="hl-code"> </span><span class="hl-reserved">else</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
         </span><span class="hl-identifier">el</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">DomHelper</span><span class="hl-code">.</span><span class="hl-identifier">append</span><span class="hl-brackets">(</span><span class="hl-identifier">container</span><span class="hl-code">, </span><span class="hl-identifier">tree</span><span class="hl-brackets">)</span><span class="hl-code">;
     </span><span class="hl-brackets">}</span><span class="hl-code">
 
     </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">wrapPrimaryEl</span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code">;
 </span><span class="hl-brackets">}</span></pre></div>

<h5 id="iddac192">autoEl, renderTpl, html, tpl の構築ポイント再考</h5>

<p class="paragraph">
render()の処理の流れを、autoEl, renderTpl, html, tpl の階層と重ねあわせてみると、以下の様な枠組みになるようです。（ちょっと分かりづらいかも・・・）
<br />
</p>
<pre class="plugin_pre">
# Ext.AbstractComponent -&gt; Ext.util.Renderable#render() -&gt; getRenderTree() -&gt; Ext.DomHelper.[insertBefore|append]()
autoEl.tag + autoEl.cls
  # Ext.AbstractComponent#renderTpl(default=&#039;{%this.renderContent(out,values)%}&#039;) -&gt; Ext.util.Renderable#initRenderTpl()
  renderTpl + renderData
    # 以下、renderTpl中の &#039;{%this.renderContent(out,values)%}&#039; により出力される
    html
    tpl + data
    autoEl.html
    autoEl.children
</pre>


<h3 id="id0f6111">カスタムコンポーネントのイベントハンドリング</h3>

<p class="paragraph">
HTML要素をカスタマイズした後は、イベント設定を考えることになります。
<br />
ExtJSでは Ext.util.Observable というmixin用のクラスが用意されており、Ext.AbstractComponentにmixinされています。
<br />
そのため、イベントの定義や追加、削除を Ext.Component の派生クラスから簡単にできるようになっています。
<br />
</p>

<p class="paragraph">
コンポーネントにおけるイベントの使い方については、以下の公式ドキュメントで解説されています。
<br />
</p>
<ul><li> <a class="externallink" href="http://docs.sencha.com/extjs/5.0.0/core_concepts/events.html" target="_blank">http://docs.sencha.com/extjs/5.0.0/core_concepts/events.html</a></li></ul>

<p class="paragraph">
今回は以下の様なサンプルコンポーネントを作って、実際にfireEvent()やボタンクリックでイベントの発生を確認してみました。
<br />
</p>
<ul><li> &#039;foo&#039;, &#039;bar&#039;, &#039;baz&#039; という3種類のイベントを用意しておき、&#039;bar&#039;はイベントの定義だけで、処理は空っぽにしておく。</li>
<li> renderTplの中でボタンを2つ作成し、それぞれのclickイベントをサンプルコンポーネント側で設定する。<ul><li> 1つ目のボタンは単にconsole.log()するだけ。</li>
<li> 2つ目のボタンはconsole.log()した後に、&#039;baz&#039; イベントをfireEvent()する。</li></ul></li>
<li> 上記サンプルコンポーネントをExt.create()する際に、さらにconfigとして&#039;foo&#039;イベントを設定したlistenerを渡す。<ul><li> 元々の&#039;foo&#039;イベントのハンドラは実行されるか？上書きされてしまい、実行されないか？</li></ul></li>
<li> 上記サンプルコンポーネントをExt.create()した後、1秒後、2秒後、3秒後に &#039;foo&#039;, &#039;bar&#039;, &#039;baz&#039; イベントを順に fireEvent() していき、特に&#039;bar&#039;イベントがどうなるか見てみる。</li></ul>

<p class="paragraph">
t9.js:
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">define</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">My.Cmp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">extend</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">Ext.Component</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">baseCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">my-cmp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">componentCls</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">my-cmp-component</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">constructor</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">config</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">;
    </span><span class="hl-identifier">config</span><span class="hl-code"> = </span><span class="hl-identifier">config</span><span class="hl-code"> || </span><span class="hl-brackets">{</span><span class="hl-brackets">}</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">apply</span><span class="hl-brackets">(</span><span class="hl-identifier">me</span><span class="hl-code">, </span><span class="hl-identifier">config</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">renderData</span><span class="hl-code"> = </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">renderData</span><span class="hl-code"> || </span><span class="hl-brackets">{</span><span class="hl-code">-
      </span><span class="hl-identifier">title</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">My.Cmp Title</span><span class="hl-quotes">'</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-code">;
    </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">callParent</span><span class="hl-brackets">(</span><span class="hl-brackets">[</span><span class="hl-identifier">config</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-comment">//</span><span class="hl-comment"> deprecated in ExtJS 5.0</span><span class="hl-comment"></span><span class="hl-code">
    </span><span class="hl-comment">//</span><span class="hl-comment">me.addEvents('foo', 'bar', 'baz');</span><span class="hl-comment"></span><span class="hl-code">
  </span><span class="hl-brackets">}</span><span class="hl-code">,
  </span><span class="hl-identifier">listeners</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">foo</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">console</span><span class="hl-code">.</span><span class="hl-identifier">log</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">default foo event</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">,
    </span><span class="hl-identifier">bar</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">emptyFn</span><span class="hl-code">, </span><span class="hl-comment">//</span><span class="hl-comment"> definition only</span><span class="hl-comment"></span><span class="hl-code">
    </span><span class="hl-identifier">baz</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">console</span><span class="hl-code">.</span><span class="hl-identifier">log</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">default baz event</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">
  </span><span class="hl-brackets">}</span><span class="hl-code">,
  </span><span class="hl-identifier">renderTpl</span><span class="hl-code">: </span><span class="hl-brackets">[</span><span class="hl-code">
    </span><span class="hl-quotes">'</span><span class="hl-string">&lt;h2 id=&quot;{id}-title&quot; class=&quot;{baseCls}-title {componentCls}-title&quot;&gt;{title}&lt;/h2&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-quotes">'</span><span class="hl-string">&lt;div&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-quotes">'</span><span class="hl-string">&lt;input class=&quot;my-cmp-btn1&quot; type=&quot;button&quot; name=&quot;btn1&quot; value=&quot;btn1.click()&quot;&gt;&lt;br&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-quotes">'</span><span class="hl-string">&lt;input class=&quot;my-cmp-btn2&quot; type=&quot;button&quot; name=&quot;btn2&quot; value=&quot;btn2.click()&quot;&gt;&lt;br&gt;</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-quotes">'</span><span class="hl-string">&lt;/div&gt;</span><span class="hl-quotes">'</span><span class="hl-code">
  </span><span class="hl-brackets">]</span><span class="hl-code">,
  </span><span class="hl-identifier">renderSelectors</span><span class="hl-code">: </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">button1</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">input.my-cmp-btn1</span><span class="hl-quotes">'</span><span class="hl-code">,
    </span><span class="hl-identifier">button2</span><span class="hl-code">: </span><span class="hl-quotes">'</span><span class="hl-string">input.my-cmp-btn2</span><span class="hl-quotes">'</span><span class="hl-code">
  </span><span class="hl-brackets">}</span><span class="hl-code">,
  </span><span class="hl-identifier">afterRender</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-comment">//</span><span class="hl-comment"> renderTpl中の要素に対してrernderSelectorsでアクセスできる</span><span class="hl-comment"></span><span class="hl-code">
    </span><span class="hl-comment">//</span><span class="hl-comment"> タイミングとしてafterRender()を採用</span><span class="hl-comment"></span><span class="hl-code">
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">me</span><span class="hl-code"> = </span><span class="hl-reserved">this</span><span class="hl-code">;
    </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">button1</span><span class="hl-code">.</span><span class="hl-identifier">on</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">click</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">console</span><span class="hl-code">.</span><span class="hl-identifier">log</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">button1-click</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">this</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-identifier">me</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">me</span><span class="hl-code">.</span><span class="hl-identifier">button2</span><span class="hl-code">.</span><span class="hl-identifier">on</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">click</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">console</span><span class="hl-code">.</span><span class="hl-identifier">log</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">button2-click</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">this</span><span class="hl-brackets">)</span><span class="hl-code">;
      </span><span class="hl-reserved">this</span><span class="hl-code">.</span><span class="hl-identifier">fireEvent</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">baz</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">this</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-identifier">me</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">application</span><span class="hl-brackets">(</span><span class="hl-brackets">{</span><span class="hl-code">
  </span><span class="hl-identifier">name</span><span class="hl-code">   : </span><span class="hl-quotes">'</span><span class="hl-string">MyApp</span><span class="hl-quotes">'</span><span class="hl-code">,
  </span><span class="hl-identifier">launch</span><span class="hl-code"> : </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-reserved">var</span><span class="hl-code"> </span><span class="hl-identifier">cmp</span><span class="hl-code"> = </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">create</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">My.Cmp</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">renderTo</span><span class="hl-code">: </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">getBody</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code">
    </span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">on</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">foo</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">console</span><span class="hl-code">.</span><span class="hl-identifier">log</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">foo-event</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">el</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-identifier">cmp</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">defer</span><span class="hl-brackets">(</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">fireEvent</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">foo</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">cmp</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-number">1000</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">defer</span><span class="hl-brackets">(</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">fireEvent</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">bar</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">cmp</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-number">2000</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">defer</span><span class="hl-brackets">(</span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
      </span><span class="hl-identifier">cmp</span><span class="hl-code">.</span><span class="hl-identifier">fireEvent</span><span class="hl-brackets">(</span><span class="hl-quotes">'</span><span class="hl-string">baz</span><span class="hl-quotes">'</span><span class="hl-code">, </span><span class="hl-identifier">cmp</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-brackets">}</span><span class="hl-code">, </span><span class="hl-number">3000</span><span class="hl-brackets">)</span><span class="hl-code">;
  </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span class="hl-brackets">}</span><span class="hl-brackets">)</span><span class="hl-code">;</span></pre></div>

<p class="paragraph">
画面表示後、Ext.defer() で &#039;foo&#039;, &#039;bar&#039;, &#039;baz&#039; イベントをfireEvent()し終わった状態：
<br />
<a href="./../images/20140706_extjs_custom_ext_component/t9_1.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t9_1.png" alt="" title=""  /></a>
<br />
</p>

<ul><li> &#039;foo&#039; イベントのイベントハンドラについては、元々のハンドラ + Ext.create()時に指定したハンドラが順に動作していました。（上書きされない）</li>
<li> &#039;bar&#039; イベントのハンドラについては、空の処理を指定していたため、特にログ上に変化はありませんでした。</li>
<li> &#039;baz&#039; イベントのハンドラについては、元々のハンドラが動作しました。</li></ul>

<p class="paragraph">
(consoleログをクリアしてから) &quot;btn1.click()&quot;ボタンをクリックした状態：
<br />
<a href="./../images/20140706_extjs_custom_ext_component/t9_2.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t9_2.png" alt="" title=""  /></a>
<br />
</p>

<ul><li> My.Cmp#afterRender() 中で設定した click イベントハンドラが正常に動作していました。</li></ul>

<p class="paragraph">
(consoleログをクリアしてから) &quot;btn2.click()&quot;ボタンをクリックした状態：
<br />
<a href="./../images/20140706_extjs_custom_ext_component/t9_3.png" title="" target="_blank"><img src="./../images/20140706_extjs_custom_ext_component/t9_3.png" alt="" title=""  /></a>
<br />
</p>

<ul><li> My.Cmp#afterRender() 中で設定した click イベントハンドラが動いてから、その中でfireEvent()した&#039;baz&#039;イベントハンドラが正常に動作していました。</li></ul>

<h4 id="id3a7984">Ext.util.ObservableとDOM要素のイベント設定について</h4>

<p class="paragraph">
Ext.Component がlistenできるのは、あくまでもmixinされたExt.util.Observableを経由した、ExtJS上でのイベント処理となります。
<br />
t9.js ではbutton要素のclickイベントを、afterRender()中で設定していましたが、これはrenderSelectors経由で取得したExt.dom.Elementインスタンスのon()メソッドを使っています。
<br />
Ext.dom.Elementクラスのon()メソッドは、ExtJS 4.2 における実装は以下のようにExt.EventManager#on()メソッドに委譲している状態です。
<br />
</p>
<div class="hl-main"><pre><span class="hl-identifier">on</span><span class="hl-code">: </span><span class="hl-reserved">function</span><span class="hl-brackets">(</span><span class="hl-identifier">eventName</span><span class="hl-code">, </span><span class="hl-identifier">fn</span><span class="hl-code">, </span><span class="hl-identifier">scope</span><span class="hl-code">, </span><span class="hl-identifier">options</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code">
            </span><span class="hl-identifier">Ext</span><span class="hl-code">.</span><span class="hl-identifier">EventManager</span><span class="hl-code">.</span><span class="hl-identifier">on</span><span class="hl-brackets">(</span><span class="hl-reserved">this</span><span class="hl-code">, </span><span class="hl-identifier">eventName</span><span class="hl-code">, </span><span class="hl-identifier">fn</span><span class="hl-code">, </span><span class="hl-identifier">scope</span><span class="hl-code"> || </span><span class="hl-reserved">this</span><span class="hl-code">, </span><span class="hl-identifier">options</span><span class="hl-brackets">)</span><span class="hl-code">;
            </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-reserved">this</span><span class="hl-code">;
        </span><span class="hl-brackets">}</span><span class="hl-code">,</span></pre></div>
<p class="paragraph">
ブラウザごとの細かい調整など泥臭い処理については、Ext.EventManagerの内部に封じ込められており、開発者は意識しなくて済むようになっています。
<br />
</p>

<p class="paragraph">
コンポーネントをカスタマイズして複雑なDOM要素を構築し、さらにDOM要素のイベントハンドラを調整するような場合に、最終的にそのDOM要素をExt.dom.Elementでラップしたインスタンスを取得できれば、Ext.EventManagerの恩恵を受けることができます。
<br />
ただし、DOM要素の取得で Ext#get()(=Ext.dom.Element#get()) や Ext#select()(=Ext.dom.Element#select()) などを使うと、root要素を指定できないため、document空間全体から要素を探す必要があります。そうなると、カスタムコンポーネントでHTML要素を構築するときにid指定を上手く使うか、class指定の衝突を常に意識する必要が出てきます。
<br />
renderSelectors によりDOM要素を保存したり、root要素を指定できる Ext#query()(=Ext.dom.Query#select()) を使って Ext.Component#getEl() をroot要素にして探索空間をインスタンスに限定するなど、工夫が必要になると感じました。
<br />
</p>


<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-1315.html" title="JavaScript/ExtJS">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1291.html" title="JavaScript/ExtJS/ExtJS4 + Sencha Cmd 勉強メモ1">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-1315.html" title="JavaScript/ExtJS">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-162.html" title="JavaScript">JavaScript</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/1297<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>