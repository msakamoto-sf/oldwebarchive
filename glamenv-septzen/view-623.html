<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>C言語系/呼び出し規約/x86/syscall - Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</title>
<!-- favicon 2017's reference:
https://developers.google.com/web/fundamentals/design-and-ui/browser-customization/
https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx
https://developer.chrome.com/multidevice/android/installtohomescreen
https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html
-->
<link rel="shortcut icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="icon" href="../favicons/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" sizes="57x57" href="../favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="../favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="../favicons/favicon-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-160x160.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-196x196.png" sizes="96x96">
<link rel="icon" type="image/png" href="../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../favicons/favicon-32x32.png" sizes="32x32">

<!-- browserconfig.xml : https://msdn.microsoft.com/ja-jp/library/dn455106(v=vs.85).aspx -->
<meta name="msapplication-TileColor" content="#990000">
<meta name="msapplication-TileImage" content="../favicons/mstile-144x144.png">

<!-- these favicon files were generated by https://ao-system.net/favicongenerator/ , thanks!!(2017-02-18) -->

<style type="text/css"></style>

<link href="./css/pcbrowser.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_plugins.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/pcbrowser_wiki.css" rel="stylesheet" type="text/css" media="screen"/>
<link href="./css/print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<!-- body start -->
<div class="body">
<div style="display: inline"><a name="pagetop"></a></div>
<div id="header-wrap">
<img src="./images/logo1.jpg" style="float: left; margin-right: 1em;"/>
<a href="./index.html" title="Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)"><img src="./icons/home.png" alt="home"/>&nbsp;Glamenv-Septzen(ぐらめぬ・ぜぷつぇん)(archive)</a>


<h1 style="margin-bottom: 10px;">C言語系/呼び出し規約/x86/syscall</h1>

<div style="clear: both;"></div>
</div><!-- //header-wrap -->

<!-- content-wrap start -->
<div id="content-wrap"><div class="contents_s">

<!-- data_main -->
<div class="data_main">

<div class="data_attrs_pre">
作成日: 2010-03-17 13:06:39 &nbsp; / &nbsp; last updated at: 2010-03-19 16:48:39<br>
カテゴリ: <a href="category-48.html">Assembler</a>&nbsp;<a href="category-10.html">C言語</a>&nbsp;<a href="category-8.html">Windows</a>&nbsp;</div>

<div class="data_body">
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-616.html" title="C言語系/呼び出し規約/x86/stdcall">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-621.html" title="C言語系/呼び出し規約/x86/thiscall">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
<hr class="full_hr" />

<p class="paragraph">
sysycall呼び出し規約は、OS/2 の 32bit API で使われていた。
<br />
Linux/BSDでのsyscall(2)とは無関係。
<br />
</p>

<ul><li> x86 calling conventions - Wikipedia, the free encyclopedia<ul><li> <a class="externallink" href="http://en.wikipedia.org/wiki/X86_calling_conventions" target="_blank">http://en.wikipedia.org/wiki/X86_calling_conventions</a></li></ul></li></ul>

<p class="paragraph">
2010年の時点のMSDNによると、現在は &quot;__syscall&quot; 呼び出し規約はサポートされていない。(obsoleted)
<br />
</p>
<ul><li> Obsolete Calling Conventions<ul><li> <a class="externallink" href="http://msdn.microsoft.com/ja-jp/library/wda6h6df%28VS.80%29.aspx" target="_blank">http://msdn.microsoft.com/ja-jp/library/wda6h6df%28VS.80%29.aspx</a></li></ul></li></ul>

<p class="paragraph">
OpenWatcom 1.8 においては、現在もサポートされている。(2010年3月時点)
<br />
</p>
<ul><li> 関数名の装飾は無し。</li>
<li> 引数は<strong>右か左へ</strong>スタックにPUSHされる。</li>
<li><strong>スタッククリーンアップは関数を呼ぶ側(caller)で実現</strong>する。</li></ul>

<p class="paragraph">
OpenWatcom 1.8 User&#039;s manual より：
<br />
</p>
<dl>
<dt> __syscall (32-bit only) </dt>
<dd>
<p class="paragraph">
The __syscall keyword may be used with function definitions, and indicates that the calling convention used is compatible with functions provided by 32-bit OS/2.
<br />
Notes:
<br />
</p>
<ol><li> Symbols names are not modified, that is, they are not adorned with leading or trailing underscores.</li>
<li> Arguments are pushed on the stack from right to left. That is, the last argument is pushed first. The calling routine will remove the arguments from the stack.</li>
<li> When a structure is returned, the caller allocates space on the stack. The address of the allocated space will be pushed on the stack immediately before the call instruction. Upon returning from the call, register EAX will contain address of the space allocated for the return value. Floating-point values are returned in 80x87 register ST(0).</li>
<li> Registers EAX, ECX and EDX are not saved and restored when a call is made.</li></ol></dd>
</dl>



<hr />
<ul><li><a href="#id1e65c9">サンプルコード</a><ul><li><a href="#id1bc1b9">callee.c (呼ばれる関数側)</a></li>
<li><a href="#id25d833">caller.c (呼ぶ main() 側)</a></li></ul></li>
<li><a href="#id637cf0">OpenWatcom Compiler(16bit)</a><ul><li><a href="#idcd8d48">callee.c のアセンブラ出力(callee.asm)</a></li>
<li><a href="#id636132">caller.c のアセンブラ出力(caller.asm)</a></li></ul></li>
<li><a href="#id0b5a2b">OpenWatcom Compiler(32bit)</a><ul><li><a href="#idcd8d48">callee.c のアセンブラ出力(callee.asm)</a></li>
<li><a href="#id636132">caller.c のアセンブラ出力(caller.asm)</a></li></ul></li></ul>
<hr />
<h3 id="id1e65c9">サンプルコード</h3>

<h4 id="id1bc1b9">callee.c (呼ばれる関数側)</h4>
<div class="hl-main"><pre><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo1</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> * </span><span class="hl-number">2</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo2</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo3</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code"> + </span><span class="hl-identifier">c</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo4</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code"> + </span><span class="hl-identifier">c</span><span class="hl-code"> + </span><span class="hl-identifier">d</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo5</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code"> + </span><span class="hl-identifier">c</span><span class="hl-code"> + </span><span class="hl-identifier">d</span><span class="hl-code"> + </span><span class="hl-identifier">e</span><span class="hl-code">; </span><span class="hl-brackets">}</span><span class="hl-code">
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo6</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">f</span><span class="hl-brackets">)</span><span class="hl-code"> </span><span class="hl-brackets">{</span><span class="hl-code"> </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code"> + </span><span class="hl-identifier">b</span><span class="hl-code"> + </span><span class="hl-identifier">c</span><span class="hl-code"> + </span><span class="hl-identifier">d</span><span class="hl-code"> + </span><span class="hl-identifier">e</span><span class="hl-code"> + </span><span class="hl-identifier">f</span><span class="hl-code">; </span><span class="hl-brackets">}</span></pre></div>

<h4 id="id25d833">caller.c (呼ぶ main() 側)</h4>
<div class="hl-main"><pre><span >#include</span><span > </span><span class="hl-quotes">&lt;</span><span class="hl-string">stdio.h</span><span class="hl-quotes">&gt;</span><span ></span><span class="hl-code">
 
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo1</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo2</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo3</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo4</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo5</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-brackets">)</span><span class="hl-code">;
</span><span >extern</span><span class="hl-code"> </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">foo6</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">a</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">b</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">c</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">d</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">e</span><span class="hl-code">, </span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">f</span><span class="hl-brackets">)</span><span class="hl-code">;
 
</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">__cdecl</span><span class="hl-code"> </span><span class="hl-identifier">main</span><span class="hl-brackets">(</span><span >int</span><span class="hl-code"> </span><span class="hl-identifier">argc</span><span class="hl-code">, </span><span >char</span><span class="hl-code"> *</span><span class="hl-identifier">argv</span><span class="hl-brackets">[</span><span class="hl-brackets">]</span><span class="hl-brackets">)</span><span class="hl-code">
</span><span class="hl-brackets">{</span><span class="hl-code">
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo1() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo1</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo2() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo2</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo3() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo3</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-code">, </span><span class="hl-number">30</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo4() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo4</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-code">, </span><span class="hl-number">30</span><span class="hl-code">, </span><span class="hl-number">40</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo5() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo5</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-code">, </span><span class="hl-number">30</span><span class="hl-code">, </span><span class="hl-number">40</span><span class="hl-code">, </span><span class="hl-number">50</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-identifier">printf</span><span class="hl-brackets">(</span><span class="hl-quotes">&quot;</span><span class="hl-string">foo6() = %d</span><span class="hl-special">\</span><span class="hl-string">n</span><span class="hl-quotes">&quot;</span><span class="hl-code">, </span><span class="hl-identifier">foo6</span><span class="hl-brackets">(</span><span class="hl-number">10</span><span class="hl-code">, </span><span class="hl-number">20</span><span class="hl-code">, </span><span class="hl-number">30</span><span class="hl-code">, </span><span class="hl-number">40</span><span class="hl-code">, </span><span class="hl-number">50</span><span class="hl-code">, </span><span class="hl-number">60</span><span class="hl-brackets">)</span><span class="hl-brackets">)</span><span class="hl-code">;
    </span><span class="hl-reserved">return</span><span class="hl-code"> </span><span class="hl-number">0</span><span class="hl-code">;
</span><span class="hl-brackets">}</span></pre></div>

<h3 id="id637cf0">OpenWatcom Compiler(16bit)</h3>

<dl>
<dt> 指定方法 </dt>
<dd>
<pre>int __syscall foobar();
typedef int (__syscall *ptr)();
</pre></dd>
<dt> コンパイラオプション </dt>
<dd>&quot;-ecs&quot;</dd>
<dt> 装飾名 </dt>
<dd>装飾無し。</dd>
</dl>

<p class="paragraph">
コンパイル＆リンク＆実行 
<br />
</p>
<pre class="plugin_pre">
&gt; wcc -od -d0 -ecs callee.c
&gt; wcc -od -d0 -ecs caller.c
&gt; wcl -fe=syscall16.exe caller.obj callee.obj
&gt; syscall16.exe
foo1() = 20
foo2() = 30
foo3() = 60
foo4() = 100
foo5() = 150
foo6() = 210
</pre>

<p class="paragraph">
アセンブラ生成
<br />
</p>
<pre class="plugin_pre">
&gt; wdis -a -l=callee.asm callee.obj
&gt; wdis -a -l=caller.asm caller.obj
</pre>

<h4 id="idcd8d48">callee.c のアセンブラ出力(callee.asm)</h4>
<pre class="plugin_pre">
.387
		PUBLIC	foo1
		PUBLIC	foo2
		PUBLIC	foo3
		PUBLIC	foo4
		PUBLIC	foo5
		PUBLIC	foo6
		EXTRN	__STK:BYTE
		EXTRN	_small_code_:BYTE
DGROUP		GROUP	CONST,CONST2,_DATA
_TEXT		SEGMENT	BYTE PUBLIC USE16 &#039;CODE&#039;
		ASSUME CS:_TEXT, DS:DGROUP, SS:DGROUP
foo1:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    shl         ax,1 
    pop         bp 
    ret         
foo2:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    add         ax,word ptr 6[bp] 
    pop         bp 
    ret         
foo3:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    add         ax,word ptr 6[bp] 
    add         ax,word ptr 8[bp] 
    pop         bp 
    ret         
foo4:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    add         ax,word ptr 6[bp] 
    add         ax,word ptr 8[bp] 
    add         ax,word ptr 0aH[bp] 
    pop         bp 
    ret         
foo5:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    add         ax,word ptr 6[bp] 
    add         ax,word ptr 8[bp] 
    add         ax,word ptr 0aH[bp] 
    add         ax,word ptr 0cH[bp] 
    pop         bp 
    ret         
foo6:
    mov         ax,4 
    call        near ptr __STK 
    push        bp 
    mov         bp,sp 
    mov         ax,word ptr 4[bp] 
    add         ax,word ptr 6[bp] 
    add         ax,word ptr 8[bp] 
    add         ax,word ptr 0aH[bp] 
    add         ax,word ptr 0cH[bp] 
    add         ax,word ptr 0eH[bp] 
    pop         bp 
    ret         
_TEXT		ENDS
CONST		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
CONST		ENDS
CONST2		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
CONST2		ENDS
_DATA		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
_DATA		ENDS
		END
</pre>

<h4 id="id636132">caller.c のアセンブラ出力(caller.asm)</h4>
<pre class="plugin_pre">
.387
		PUBLIC	main_
		EXTRN	__STK:BYTE
		EXTRN	foo1:BYTE
		EXTRN	printf_:BYTE
		EXTRN	foo2:BYTE
		EXTRN	foo3:BYTE
		EXTRN	foo4:BYTE
		EXTRN	foo5:BYTE
		EXTRN	foo6:BYTE
		EXTRN	__argc:BYTE
		EXTRN	_small_code_:BYTE
		EXTRN	_cstart_:BYTE
DGROUP		GROUP	CONST,CONST2,_DATA
_TEXT		SEGMENT	BYTE PUBLIC USE16 &#039;CODE&#039;
		ASSUME CS:_TEXT, DS:DGROUP, SS:DGROUP
main_:
    push        ax 
    mov         ax,12H 
    call        near ptr __STK 
    pop         ax 
    push        bx 
    push        cx 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo1 
    add         sp,2 
    push        ax 
    mov         ax,offset DGROUP:L$1 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo2 
    add         sp,4 
    push        ax 
    mov         ax,offset DGROUP:L$2 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    mov         ax,1eH 
    push        ax 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo3 
    add         sp,6 
    push        ax 
    mov         ax,offset DGROUP:L$3 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    mov         ax,28H 
    push        ax 
    mov         ax,1eH 
    push        ax 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo4 
    add         sp,8 
    push        ax 
    mov         ax,offset DGROUP:L$4 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    mov         ax,32H 
    push        ax 
    mov         ax,28H 
    push        ax 
    mov         ax,1eH 
    push        ax 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo5 
    add         sp,0aH 
    push        ax 
    mov         ax,offset DGROUP:L$5 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    mov         ax,3cH 
    push        ax 
    mov         ax,32H 
    push        ax 
    mov         ax,28H 
    push        ax 
    mov         ax,1eH 
    push        ax 
    mov         ax,14H 
    push        ax 
    mov         ax,0aH 
    push        ax 
    call        near ptr foo6 
    add         sp,0cH 
    push        ax 
    mov         ax,offset DGROUP:L$6 
    push        ax 
    call        near ptr printf_ 
    add         sp,4 
    xor         ax,ax 
    pop         cx 
    pop         bx 
    ret         
_TEXT		ENDS
CONST		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
L$1:
    DB	66H, 6fH, 6fH, 31H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$2:
    DB	66H, 6fH, 6fH, 32H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$3:
    DB	66H, 6fH, 6fH, 33H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$4:
    DB	66H, 6fH, 6fH, 34H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$5:
    DB	66H, 6fH, 6fH, 35H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$6:
    DB	66H, 6fH, 6fH, 36H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0

CONST		ENDS
CONST2		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
CONST2		ENDS
_DATA		SEGMENT	WORD PUBLIC USE16 &#039;DATA&#039;
_DATA		ENDS
		END
</pre>

<h3 id="id0b5a2b">OpenWatcom Compiler(32bit)</h3>

<dl>
<dt> 指定方法 </dt>
<dd>
<pre>int __syscall foobar();
typedef int (__syscall *ptr)();
</pre></dd>
<dt> コンパイラオプション </dt>
<dd>&quot;-ecs&quot;</dd>
<dt> 装飾名 </dt>
<dd>装飾無し。</dd>
</dl>

<p class="paragraph">
コンパイル＆リンク＆実行 
<br />
</p>
<pre class="plugin_pre">
&gt; wcc386 -od -d0 -ecs callee.c
&gt; wcc386 -od -d0 -ecs caller.c
&gt; wcl386 -fe=syscall32.exe caller.obj callee.obj
&gt; syscall32.exe
foo1() = 20
foo2() = 30
foo3() = 60
foo4() = 100
foo5() = 150
foo6() = 210
</pre>

<p class="paragraph">
アセンブラ生成
<br />
</p>
<pre class="plugin_pre">
&gt; wdis -a -l=callee.asm callee.obj
&gt; wdis -a -l=caller.asm caller.obj
</pre>

<h4 id="idcd8d48">callee.c のアセンブラ出力(callee.asm)</h4>
<pre class="plugin_pre">
.387
.386p
.model flat
		PUBLIC	foo1
		PUBLIC	foo2
		PUBLIC	foo3
		PUBLIC	foo4
		PUBLIC	foo5
		PUBLIC	foo6
		EXTRN	__CHK:BYTE
DGROUP		GROUP	CONST,CONST2,_DATA
_TEXT		SEGMENT	BYTE PUBLIC USE32 &#039;CODE&#039;
		ASSUME CS:_TEXT, DS:DGROUP, SS:DGROUP
foo1:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,eax 
    ret         
foo2:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,dword ptr 8[esp] 
    ret         
foo3:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,dword ptr 8[esp] 
    add         eax,dword ptr 0cH[esp] 
    ret         
foo4:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,dword ptr 8[esp] 
    add         eax,dword ptr 0cH[esp] 
    add         eax,dword ptr 10H[esp] 
    ret         
foo5:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,dword ptr 8[esp] 
    add         eax,dword ptr 0cH[esp] 
    add         eax,dword ptr 10H[esp] 
    add         eax,dword ptr 14H[esp] 
    ret         
foo6:
    push        4 
    call        near ptr FLAT:__CHK 
    mov         eax,dword ptr 4[esp] 
    add         eax,dword ptr 8[esp] 
    add         eax,dword ptr 0cH[esp] 
    add         eax,dword ptr 10H[esp] 
    add         eax,dword ptr 14H[esp] 
    add         eax,dword ptr 18H[esp] 
    ret         
_TEXT		ENDS
CONST		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
CONST		ENDS
CONST2		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
CONST2		ENDS
_DATA		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
_DATA		ENDS
		END
</pre>

<h4 id="id636132">caller.c のアセンブラ出力(caller.asm)</h4>
<pre class="plugin_pre">
.387
.386p
.model flat
		PUBLIC	main_
		EXTRN	__CHK:BYTE
		EXTRN	foo1:BYTE
		EXTRN	printf_:BYTE
		EXTRN	foo2:BYTE
		EXTRN	foo3:BYTE
		EXTRN	foo4:BYTE
		EXTRN	foo5:BYTE
		EXTRN	foo6:BYTE
		EXTRN	__argc:BYTE
		EXTRN	_cstart_:BYTE
DGROUP		GROUP	CONST,CONST2,_DATA
_TEXT		SEGMENT	BYTE PUBLIC USE32 &#039;CODE&#039;
		ASSUME CS:_TEXT, DS:DGROUP, SS:DGROUP
main_:
    push        20H 
    call        near ptr FLAT:__CHK 
    push        ecx 
    push        0aH 
    call        near ptr FLAT:foo1 
    add         esp,4 
    push        eax 
    push        offset FLAT:L$1 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    push        14H 
    push        0aH 
    call        near ptr FLAT:foo2 
    add         esp,8 
    push        eax 
    push        offset FLAT:L$2 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    push        1eH 
    push        14H 
    push        0aH 
    call        near ptr FLAT:foo3 
    add         esp,0cH 
    push        eax 
    push        offset FLAT:L$3 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    push        28H 
    push        1eH 
    push        14H 
    push        0aH 
    call        near ptr FLAT:foo4 
    add         esp,10H 
    push        eax 
    push        offset FLAT:L$4 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    push        32H 
    push        28H 
    push        1eH 
    push        14H 
    push        0aH 
    call        near ptr FLAT:foo5 
    add         esp,14H 
    push        eax 
    push        offset FLAT:L$5 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    push        3cH 
    push        32H 
    push        28H 
    push        1eH 
    push        14H 
    push        0aH 
    call        near ptr FLAT:foo6 
    add         esp,18H 
    push        eax 
    push        offset FLAT:L$6 
    call        near ptr FLAT:printf_ 
    add         esp,8 
    xor         eax,eax 
    pop         ecx 
    ret         
_TEXT		ENDS
CONST		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
L$1:
    DB	66H, 6fH, 6fH, 31H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$2:
    DB	66H, 6fH, 6fH, 32H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$3:
    DB	66H, 6fH, 6fH, 33H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$4:
    DB	66H, 6fH, 6fH, 34H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$5:
    DB	66H, 6fH, 6fH, 35H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0
L$6:
    DB	66H, 6fH, 6fH, 36H, 28H, 29H, 20H, 3dH
    DB	20H, 25H, 64H, 0aH, 0

CONST		ENDS
CONST2		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
CONST2		ENDS
_DATA		SEGMENT	DWORD PUBLIC USE32 &#039;DATA&#039;
_DATA		ENDS
		END
</pre>

<hr class="full_hr" />
<ul class="plugin_navi">
<li>[&nbsp;<a href="./view-616.html" title="C言語系/呼び出し規約/x86/stdcall">Prev</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-621.html" title="C言語系/呼び出し規約/x86/thiscall">Next</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-615.html" title="C言語系/呼び出し規約/x86">Up</a>&nbsp;]</li>
<li>[&nbsp;<a href="./view-478.html" title="C言語系">C言語系</a>&nbsp;]</li>
</ul>
</div>

<div class="data_attrs_post">
original url: https://www.glamenv-septzen.net/view/623<br>
</div>

</div>
<!-- //data_main -->

</div>


</div>
<!-- /content-wrap end -->

<!-- footer start -->
<div id="footer">
Copyright &copy; 2001 - 2025 Masahiko Sakamoto(msakamoto-sf)<br>
License&nbsp;:&nbsp;<a target="_blank" href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br>
Contact&nbsp;:&nbsp;<a target="_blank" href="https://x.com/msakamoto_sf">x(twitter)</a> / <a target="_blank" href="https://github.com/msakamoto-sf/">github</a> / <a class="maillink" target="_blank" href="mailto:&#x73;&#x61;&#x6B;&#x61;&#x6D;&#x6F;&#x74;&#x6F;&#x2E;&#x67;&#x73;&#x79;&#x63;&#x2E;&#x33;&#x73;&#x40;&#x67;&#x6D;&#x61;&#x69;&#x6C;&#x2E;&#x63;&#x6F;&#x6D;">email</a><br>
--&nbsp;Beautiful Icons&nbsp;--<br />
<a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank" title="Mark James Silk icon set 1.3">Mark James Silk icon set 1.3</a> by famfamfam<br />
<a href="http://www.pinvoke.com/" target="_blank" title="Fugue Icons">Fugue Icons</a> by Yusuke Kamiyamane<br />
</div>
<!-- /footer end -->

</div>
<!-- /body end -->

</body>
</html>